<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='PTS-controller-dashboard-Calendar'>/**
</span> * @class PTS.controller.dashboard.Calendar
 */
Ext.define('PTS.controller.dashboard.Calendar', {
    extend: 'Ext.app.Controller',
    requires: [
        'Extensible.calendar.data.EventModel',
        'Extensible.calendar.data.CalendarModel'
    ],

    views: [
        'dashboard.Calendar'
    ],

    init: function() {

        Extensible.calendar.data.EventMappings = {
            // These are the same fields as defined in the standard EventRecord object but the
            // names and mappings have all been customized. Note that the name of each field
            // definition object (e.g., 'EventId') should NOT be changed for the default fields
            // as it is the key used to access the field data programmatically.
            EventId:     {name: 'ID', mapping:'deliverableid', type:'int'}, // int by default
            CalendarId:  {name: 'CalendarId', mapping: 'id', type: 'int', convert: this.getCalendar}, // int by default
            Title:       {name: 'EvtTitle', mapping: 'title'},
            StartDate:   {name: 'StartDt', mapping: 'duedate', type: 'mydate'},
            EndDate:     {name: 'EndDt', mapping: 'duedate', type: 'mydate'},
            RRule:       {name: 'RecurRule', mapping: 'recur'},
            Location:    {name: 'Location', mapping: 'location'},
            Notes:       {name: 'Desc', mapping: 'description'},
            Url:         {name: 'LinkUrl', mapping: 'uri'},
            IsAllDay:    {name: 'AllDay', mapping: 'allday', type: 'boolean', defaultValue: true},
            Reminder:    {name: 'Reminder', mapping: 'reminder'},

            // We can also add some new fields that do not exist in the standard EventRecord:
            CreatedBy:   {name: 'Manager', mapping: 'manager'},
            DateReceived:{name: 'Received', mapping:'receiveddate', type: 'mydate'},
            PersonId:    {name: 'PersonID', mapping:'personid', type:'int'},
            Type:        {name: 'Type', mapping:'type', type:'string'},
            ProjectCode:        {name: 'ProjectCode', mapping:'projectcode', type:'string'}
        };

        // Don't forget to reconfigure!
        Extensible.calendar.data.EventModel.reconfigure();

        /*Extensible.calendar.data.CalendarMappings = {
            CalendarId:   {name:'ID', mapping: 'cal_id', type: 'string'}, // int by default
            Title:        {name:'CalTitle', mapping: 'cal_title', type: 'string'},
            Description:  {name:'Desc', mapping: 'cal_desc', type: 'string'},
            ColorId:      {name:'Color', mapping: 'cal_color', type: 'int'},
            IsHidden:     {name:'Hidden', mapping: 'hidden', type: 'boolean'}
        };
        // Don't forget to reconfigure!
        Extensible.calendar.data.CalendarModel.reconfigure();*/

        // One key thing to remember is that any record reconfiguration you want to perform
        // must be done PRIOR to initializing your data store, otherwise the changes will
        // not be reflected in the store's records.
        /*Ext.create('Extensible.calendar.data.MemoryCalendarStore', {
                            // defined in ../data/CalendarsCustom.js
                            data: Ext.create('PTS.data.Calendar'),
                            storeId: 'Calstore'
                        });*/
        /*this.control({
            'dashboardcalendar': {
                eventclick: function(cal, rec, el){
                    console.info(rec);
                }
            }
        });*/
    },

<span id='PTS-controller-dashboard-Calendar-method-getCalendar'>    /**
</span>     * Return the appropriate calendar id for the passed record
     * @param {Mixed} v The value from the model
     * @param {Ext.data.Model} rec The event record
     * @return {String} The calendar id defined by {PTS.data.Calendar}.
     *
     */
    getCalendar: function(v, rec) {
        var dt = rec.data.StartDt,
            today = new Date();

        //set the date to 11:59pm of the current day
        today.setHours(0,0,0,0);

        if(rec.data.Received) {
            return 4; //completed
        }else if (dt &lt; today) {
            return 1; //late
        }else if (dt &gt; Ext.Date.add(today, Ext.Date.DAY, 2)) {
            return 3; //due more than two days into the future
        }else {
            return 2; //due within two days
        }
    }
});
</pre>
</body>
</html>
