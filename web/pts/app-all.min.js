Ext.define("Extensible",{singleton:!0,version:"1.5.1",versionDetails:{major:1,minor:5,patch:1},extVersion:"4.0.1",hasBorderRadius:Ext.supports.CSS3BorderRadius,log:function(a){},getScrollWidth:function(){return Ext.getScrollbarSize?Ext.getScrollbarSize().width:Ext.getScrollBarWidth()},constructor:function(){Ext.onReady(function(){Extensible.getScrollWidth()<3&&Ext.getBody().addCls("x-no-scrollbar"),Ext.isWindows&&Ext.getBody().addCls("x-win")})},Date:{use24HourTime:!1,diff:function(a,b,c){var d=1,e=b.getTime()-a.getTime();return"s"==c?d=1e3:"m"==c?d=6e4:"h"==c&&(d=36e5),Math.round(e/d)},diffDays:function(a,b){var c=Ext.Date.clearTime,d=c(b,!0).getTime()-c(a,!0).getTime();return Math.ceil(d/864e5)},copyTime:function(a,b){var c=Ext.Date.clone(b);return c.setHours(a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()),c},compare:function(a,b,c){var d=a,e=b;return!0!==c&&(d=Ext.Date.clone(a),d.setMilliseconds(0),e=Ext.Date.clone(b),e.setMilliseconds(0)),e.getTime()-d.getTime()},maxOrMin:function(a){for(var b=a?0:Number.MAX_VALUE,c=0,d=arguments[1],e=d.length;c<e;c++)b=Math[a?"max":"min"](b,d[c].getTime());return new Date(b)},max:function(){return this.maxOrMin.apply(this,[!0,arguments])},min:function(){return this.maxOrMin.apply(this,[!1,arguments])},isInRange:function(a,b,c){return a>=b&&a<=c},rangesOverlap:function(a,b,c,d){var e=a>=c&&a<=d,f=b>=c&&b<=d,g=a<=c&&b>=d;return e||f||g},isWeekend:function(a){return a.getDay()%6==0},isWeekday:function(a){return a.getDay()%6!=0},isMidnight:function(a){return 0===a.getHours()&&0===a.getMinutes()},isToday:function(a){return 0===this.diffDays(a,this.today())},today:function(){return Ext.Date.clearTime(new Date)},add:function(a,b){if(!b)return a;var c=Ext.Date,d=c.add,e=c.clone(a);return b.years&&(e=d(e,c.YEAR,b.years)),b.months&&(e=d(e,c.MONTH,b.months)),b.weeks&&(b.days=(b.days||0)+7*b.weeks),b.days&&(e=d(e,c.DAY,b.days)),b.hours&&(e=d(e,c.HOUR,b.hours)),b.minutes&&(e=d(e,c.MINUTE,b.minutes)),b.seconds&&(e=d(e,c.SECOND,b.seconds)),b.millis&&(e=d(e,c.MILLI,b.millis)),b.clearTime?c.clearTime(e):e}}}),Ext.require(["Ext.picker.Color","Ext.form.Basic","Ext.data.MemoryProxy"]),Extensible.applyOverrides=function(){Ext.DomHelper=Ext.core.DomHelper;var a=Ext.getVersion();Ext.layout.container.AbstractCard&&Ext.layout.container.AbstractCard.override({renderChildren:function(){this.deferredRender||(this.getActiveItem(),this.callParent())}}),Ext.Component.override({getId:function(){var a,b=this;return b.id||(a=b.getXType(),a=a?a.replace(/[\.,\s]/g,"-"):"ext-comp",b.id=a+"-"+b.getAutoId()),b.id}}),Ext.picker&&Ext.picker.Color&&Ext.picker.Color.override({constructor:function(){this.renderTpl=this.renderTpl||Ext.create("Ext.XTemplate",'<tpl for="colors"><a href="#" class="color-{.}" hidefocus="on"><em><span style="background:#{.}" unselectable="on">&#160;</span></em></a></tpl>'),this.callParent(arguments)}}),a.isLessThan("4.1")&&Ext.data&&Ext.data.reader&&Ext.data.reader.Reader&&Ext.data.reader.Reader.override({extractData:function(a){var b,c,d,e=this,f=[],g=[],h=e.model,i=0,j=a.length;e.getIdProperty();for(!a.length&&Ext.isObject(a)&&(a=[a],j=1);i<j;i++)b=a[i],f=e.extractValues(b),c=e.getId(f),d=new h(f,c,b),g.push(d),e.implicitIncludes&&e.readAssociated(d,b);return g}}),Ext.form&&Ext.form.Basic&&Ext.form.Basic.override({reset:function(){var a=this;return a.getFields().each(function(a){a.reset()}),a}}),Ext.data&&Ext.data.MemoryProxy&&Ext.data.MemoryProxy.override({updateOperation:function(a,b,c){Ext.each(a.records,function(a){a.commit()}),a.setCompleted(),a.setSuccessful(),Ext.callback(b,c||this,[a])},create:function(){this.updateOperation.apply(this,arguments)},update:function(){this.updateOperation.apply(this,arguments)},destroy:function(){this.updateOperation.apply(this,arguments)}})},Ext.onReady(Extensible.applyOverrides);var OpenLayers={VERSION_NUMBER:"Release 2.13.1",singleFile:!0,_getScriptLocation:function(){for(var a,b,c=new RegExp("(^|(.*?\\/))(OpenLayers[^\\/]*?\\.js)(\\?|$)"),d=document.getElementsByTagName("script"),e="",f=0,g=d.length;f<g;f++)if((a=d[f].getAttribute("src"))&&(b=a.match(c))){e=b[1];break}return function(){return e}}(),ImgPath:""};OpenLayers.Class=function(){var a=arguments.length,b=arguments[0],c=arguments[a-1],d="function"==typeof c.initialize?c.initialize:function(){b.prototype.initialize.apply(this,arguments)};if(a>1){var e=[d,b].concat(Array.prototype.slice.call(arguments).slice(1,a-1),c);OpenLayers.inherit.apply(null,e)}else d.prototype=c;return d},OpenLayers.inherit=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c;var d,e,f;for(d=2,e=arguments.length;d<e;d++)f=arguments[d],"function"==typeof f&&(f=f.prototype),OpenLayers.Util.extend(a.prototype,f)},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.extend=function(a,b){if(a=a||{},b){for(var c in b){var d=b[c];void 0!==d&&(a[c]=d)}!("function"==typeof window.Event&&b instanceof window.Event)&&b.hasOwnProperty&&b.hasOwnProperty("toString")&&(a.toString=b.toString)}return a},OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(a,b){this.x=parseFloat(a),this.y=parseFloat(b)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(a){var b=!1;return null!=a&&(b=this.x==a.x&&this.y==a.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y)),b},distanceTo:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},add:function(a,b){if(null==a||null==b)throw new TypeError("Pixel.add cannot receive null values");return new OpenLayers.Pixel(this.x+a,this.y+b)},offset:function(a){var b=this.clone();return a&&(b=this.add(a.x,a.y)),b},CLASS_NAME:"OpenLayers.Pixel"}),OpenLayers.String={startsWith:function(a,b){return 0==a.indexOf(b)},contains:function(a,b){return-1!=a.indexOf(b)},trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(a){for(var b=a.split("-"),c=b[0],d=1,e=b.length;d<e;d++){var f=b[d];c+=f.charAt(0).toUpperCase()+f.substring(1)}return c},format:function(a,b,c){b||(b=window);var d=function(a,d){for(var e,f=d.split(/\.+/),g=0;g<f.length&&(0==g&&(e=b),void 0!==e);g++)e=e[f[g]];return"function"==typeof e&&(e=c?e.apply(null,c):e()),void 0===e?"undefined":e};return a.replace(OpenLayers.String.tokenRegEx,d)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(a){return OpenLayers.String.numberRegEx.test(a)},numericIf:function(a,b){var c=a;return!0===b&&null!=a&&a.replace&&(a=a.replace(/^\s*|\s*$/g,"")),OpenLayers.String.isNumeric(a)?parseFloat(a):c}},OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(a,b){var c=0;return b>0&&(c=parseFloat(a.toPrecision(b))),c},format:function(a,b,c,d){b=void 0!==b?b:0,c=void 0!==c?c:OpenLayers.Number.thousandsSeparator,d=void 0!==d?d:OpenLayers.Number.decimalSeparator,null!=b&&(a=parseFloat(a.toFixed(b)));var e=a.toString().split(".");1==e.length&&null==b&&(b=0);var f=e[0];if(c)for(var g=/(-?[0-9]+)([0-9]{3})/;g.test(f);)f=f.replace(g,"$1"+c+"$2");var h;if(0==b)h=f;else{var i=e.length>1?e[1]:"0";null!=b&&(i+=new Array(b-i.length+1).join("0")),h=f+d+i}return h},zeroPad:function(a,b,c){for(var d=a.toString(c||10);d.length<b;)d="0"+d;return d}},OpenLayers.Function={bind:function(a,b){var c=Array.prototype.slice.apply(arguments,[2]);return function(){var d=c.concat(Array.prototype.slice.apply(arguments,[0]));return a.apply(b,d)}},bindAsEventListener:function(a,b){return function(c){return a.call(b,c||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},OpenLayers.Array={filter:function(a,b,c){var d=[];if(Array.prototype.filter)d=a.filter(b,c);else{var e=a.length;if("function"!=typeof b)throw new TypeError;for(var f=0;f<e;f++)if(f in a){var g=a[f];b.call(c,g,f,a)&&d.push(g)}}return d}},OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(a,b,c,d){OpenLayers.Util.isArray(a)&&(d=a[3],c=a[2],b=a[1],a=a[0]),null!=a&&(this.left=OpenLayers.Util.toFloat(a)),null!=b&&(this.bottom=OpenLayers.Util.toFloat(b)),null!=c&&(this.right=OpenLayers.Util.toFloat(c)),null!=d&&(this.top=OpenLayers.Util.toFloat(d))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(a){var b=!1;return null!=a&&(b=this.left==a.left&&this.right==a.right&&this.top==a.top&&this.bottom==a.bottom),b},toString:function(){return[this.left,this.bottom,this.right,this.top].join(",")},toArray:function(a){return!0===a?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(a,b){null==a&&(a=6);var c=Math.pow(10,a),d=Math.round(this.left*c)/c,e=Math.round(this.bottom*c)/c,f=Math.round(this.right*c)/c,g=Math.round(this.top*c)/c;return!0===b?e+","+d+","+g+","+f:d+","+e+","+f+","+g},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){return this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat},scale:function(a,b){null==b&&(b=this.getCenterLonLat());var c,d;"OpenLayers.LonLat"==b.CLASS_NAME?(c=b.lon,d=b.lat):(c=b.x,d=b.y);var e=(this.left-c)*a+c,f=(this.bottom-d)*a+d,g=(this.right-c)*a+c,h=(this.top-d)*a+d;return new OpenLayers.Bounds(e,f,g,h)},add:function(a,b){if(null==a||null==b)throw new TypeError("Bounds.add cannot receive null values");return new OpenLayers.Bounds(this.left+a,this.bottom+b,this.right+a,this.top+b)},extend:function(a){if(a)switch(a.CLASS_NAME){case"OpenLayers.LonLat":this.extendXY(a.lon,a.lat);break;case"OpenLayers.Geometry.Point":this.extendXY(a.x,a.y);break;case"OpenLayers.Bounds":this.centerLonLat=null,(null==this.left||a.left<this.left)&&(this.left=a.left),(null==this.bottom||a.bottom<this.bottom)&&(this.bottom=a.bottom),(null==this.right||a.right>this.right)&&(this.right=a.right),(null==this.top||a.top>this.top)&&(this.top=a.top)}},extendXY:function(a,b){this.centerLonLat=null,(null==this.left||a<this.left)&&(this.left=a),(null==this.bottom||b<this.bottom)&&(this.bottom=b),(null==this.right||a>this.right)&&(this.right=a),(null==this.top||b>this.top)&&(this.top=b)},containsLonLat:function(a,b){"boolean"==typeof b&&(b={inclusive:b}),b=b||{};var c=this.contains(a.lon,a.lat,b.inclusive),d=b.worldBounds;if(d&&!c){var e=d.getWidth(),f=(d.left+d.right)/2,g=Math.round((a.lon-f)/e);c=this.containsLonLat({lon:a.lon-g*e,lat:a.lat},{inclusive:b.inclusive})}return c},containsPixel:function(a,b){return this.contains(a.x,a.y,b)},contains:function(a,b,c){if(null==c&&(c=!0),null==a||null==b)return!1;a=OpenLayers.Util.toFloat(a),b=OpenLayers.Util.toFloat(b);return c?a>=this.left&&a<=this.right&&b>=this.bottom&&b<=this.top:a>this.left&&a<this.right&&b>this.bottom&&b<this.top},intersectsBounds:function(a,b){if("boolean"==typeof b&&(b={inclusive:b}),b=b||{},b.worldBounds){var c=this.wrapDateLine(b.worldBounds);a=a.wrapDateLine(b.worldBounds)}else c=this;null==b.inclusive&&(b.inclusive=!0);var d=!1,e=c.left==a.right||c.right==a.left||c.top==a.bottom||c.bottom==a.top;if(b.inclusive||!e){var f=a.bottom>=c.bottom&&a.bottom<=c.top||c.bottom>=a.bottom&&c.bottom<=a.top,g=a.top>=c.bottom&&a.top<=c.top||c.top>a.bottom&&c.top<a.top,h=a.left>=c.left&&a.left<=c.right||c.left>=a.left&&c.left<=a.right,i=a.right>=c.left&&a.right<=c.right||c.right>=a.left&&c.right<=a.right;d=(f||g)&&(h||i)}if(b.worldBounds&&!d){var j=b.worldBounds,k=j.getWidth(),l=!j.containsBounds(c),m=!j.containsBounds(a);l&&!m?(a=a.add(-k,0),d=c.intersectsBounds(a,{inclusive:b.inclusive})):m&&!l&&(c=c.add(-k,0),d=a.intersectsBounds(c,{inclusive:b.inclusive}))}return d},containsBounds:function(a,b,c){null==b&&(b=!1),null==c&&(c=!0);var d=this.contains(a.left,a.bottom,c),e=this.contains(a.right,a.bottom,c),f=this.contains(a.left,a.top,c),g=this.contains(a.right,a.top,c);return b?d||e||f||g:d&&e&&f&&g},determineQuadrant:function(a){var b="",c=this.getCenterLonLat();return b+=a.lat<c.lat?"b":"t",b+=a.lon<c.lon?"l":"r"},transform:function(a,b){this.centerLonLat=null;var c=OpenLayers.Projection.transform({x:this.left,y:this.bottom},a,b),d=OpenLayers.Projection.transform({x:this.right,y:this.bottom},a,b),e=OpenLayers.Projection.transform({x:this.left,y:this.top},a,b),f=OpenLayers.Projection.transform({x:this.right,y:this.top},a,b);return this.left=Math.min(c.x,e.x),this.bottom=Math.min(c.y,d.y),this.right=Math.max(d.x,f.x),this.top=Math.max(e.y,f.y),this},wrapDateLine:function(a,b){b=b||{};var c=b.leftTolerance||0,d=b.rightTolerance||0,e=this.clone();if(a){for(var f=a.getWidth();e.left<a.left&&e.right-d<=a.left;)e=e.add(f,0);for(;e.left+c>=a.right&&e.right>a.right;)e=e.add(-f,0);var g=e.left+c;g<a.right&&g>a.left&&e.right-d>a.right&&(e=e.add(-f,0))}return e},CLASS_NAME:"OpenLayers.Bounds"}),OpenLayers.Bounds.fromString=function(a,b){var c=a.split(",");return OpenLayers.Bounds.fromArray(c,b)},OpenLayers.Bounds.fromArray=function(a,b){return!0===b?new OpenLayers.Bounds(a[1],a[0],a[3],a[2]):new OpenLayers.Bounds(a[0],a[1],a[2],a[3])},OpenLayers.Bounds.fromSize=function(a){return new OpenLayers.Bounds(0,a.h,a.w,0)},OpenLayers.Bounds.oppositeQuadrant=function(a){var b="";return b+="t"==a.charAt(0)?"b":"t",b+="l"==a.charAt(1)?"r":"l"},OpenLayers.Element={visible:function(a){return"none"!=OpenLayers.Util.getElement(a).style.display},toggle:function(){for(var a=0,b=arguments.length;a<b;a++){var c=OpenLayers.Util.getElement(arguments[a]),d=OpenLayers.Element.visible(c)?"none":"";c.style.display=d}},remove:function(a){a=OpenLayers.Util.getElement(a),a.parentNode.removeChild(a)},getHeight:function(a){return a=OpenLayers.Util.getElement(a),a.offsetHeight},hasClass:function(a,b){var c=a.className;return!!c&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(c)},addClass:function(a,b){return OpenLayers.Element.hasClass(a,b)||(a.className+=(a.className?" ":"")+b),a},removeClass:function(a,b){var c=a.className;return c&&(a.className=OpenLayers.String.trim(c.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," "))),a},toggleClass:function(a,b){return OpenLayers.Element.hasClass(a,b)?OpenLayers.Element.removeClass(a,b):OpenLayers.Element.addClass(a,b),a},getStyle:function(a,b){a=OpenLayers.Util.getElement(a);var c=null;if(a&&a.style){if(!(c=a.style[OpenLayers.String.camelize(b)]))if(document.defaultView&&document.defaultView.getComputedStyle){var d=document.defaultView.getComputedStyle(a,null);c=d?d.getPropertyValue(b):null}else a.currentStyle&&(c=a.currentStyle[OpenLayers.String.camelize(b)]);var e=["left","top","right","bottom"];window.opera&&-1!=OpenLayers.Util.indexOf(e,b)&&"static"==OpenLayers.Element.getStyle(a,"position")&&(c="auto")}return"auto"==c?null:c}},OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(a,b){OpenLayers.Util.isArray(a)&&(b=a[1],a=a[0]),this.lon=OpenLayers.Util.toFloat(a),this.lat=OpenLayers.Util.toFloat(b)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(a,b){if(null==a||null==b)throw new TypeError("LonLat.add cannot receive null values");return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(a),this.lat+OpenLayers.Util.toFloat(b))},equals:function(a){var b=!1;return null!=a&&(b=this.lon==a.lon&&this.lat==a.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(a.lon)&&isNaN(a.lat)),b},transform:function(a,b){var c=OpenLayers.Projection.transform({x:this.lon,y:this.lat},a,b);return this.lon=c.x,this.lat=c.y,this},wrapDateLine:function(a){var b=this.clone();if(a){for(;b.lon<a.left;)b.lon+=a.getWidth();for(;b.lon>a.right;)b.lon-=a.getWidth()}return b},CLASS_NAME:"OpenLayers.LonLat"}),OpenLayers.LonLat.fromString=function(a){var b=a.split(",");return new OpenLayers.LonLat(b[0],b[1])},OpenLayers.LonLat.fromArray=function(a){var b=OpenLayers.Util.isArray(a),c=b&&a[0],d=b&&a[1];return new OpenLayers.LonLat(c,d)},OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(a,b){this.w=parseFloat(a),this.h=parseFloat(b)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(a){var b=!1;return null!=a&&(b=this.w==a.w&&this.h==a.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(a.w)&&isNaN(a.h)),b},CLASS_NAME:"OpenLayers.Size"}),OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(a){alert(a)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"},function(){for(var a=document.getElementsByTagName("script"),b=0,c=a.length;b<c;++b)if(-1!=a[b].src.indexOf("firebug.js")&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}(),OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){return OpenLayers.Lang.code||OpenLayers.Lang.setCode(),OpenLayers.Lang.code},setCode:function(a){var b;a||(a="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language);var c=a.split("-");if(c[0]=c[0].toLowerCase(),"object"==typeof OpenLayers.Lang[c[0]]&&(b=c[0]),c[1]){var d=c[0]+"-"+c[1].toUpperCase();"object"==typeof OpenLayers.Lang[d]&&(b=d)}b||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+c.join("-")+" dictionary, falling back to default language"),b=OpenLayers.Lang.defaultCode),OpenLayers.Lang.code=b},translate:function(a,b){var c=OpenLayers.Lang[OpenLayers.Lang.getCode()],d=c&&c[a];return d||(d=a),b&&(d=OpenLayers.String.format(d,b)),d}},OpenLayers.i18n=OpenLayers.Lang.translate,OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.getElement=function(){for(var a=[],b=0,c=arguments.length;b<c;b++){var d=arguments[b];if("string"==typeof d&&(d=document.getElementById(d)),1==arguments.length)return d;a.push(d)}return a},OpenLayers.Util.isElement=function(a){return!(!a||1!==a.nodeType)},OpenLayers.Util.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},OpenLayers.Util.removeItem=function(a,b){for(var c=a.length-1;c>=0;c--)a[c]==b&&a.splice(c,1);return a},OpenLayers.Util.indexOf=function(a,b){if("function"==typeof a.indexOf)return a.indexOf(b);for(var c=0,d=a.length;c<d;c++)if(a[c]==b)return c;return-1},OpenLayers.Util.dotless=/\./g,OpenLayers.Util.modifyDOMElement=function(a,b,c,d,e,f,g,h){b&&(a.id=b.replace(OpenLayers.Util.dotless,"_")),c&&(a.style.left=c.x+"px",a.style.top=c.y+"px"),d&&(a.style.width=d.w+"px",a.style.height=d.h+"px"),e&&(a.style.position=e),f&&(a.style.border=f),g&&(a.style.overflow=g),parseFloat(h)>=0&&parseFloat(h)<1?(a.style.filter="alpha(opacity="+100*h+")",a.style.opacity=h):1==parseFloat(h)&&(a.style.filter="",a.style.opacity="")},OpenLayers.Util.createDiv=function(a,b,c,d,e,f,g,h){var i=document.createElement("div");return d&&(i.style.backgroundImage="url("+d+")"),a||(a=OpenLayers.Util.createUniqueID("OpenLayersDiv")),e||(e="absolute"),OpenLayers.Util.modifyDOMElement(i,a,b,c,e,f,g,h),i},OpenLayers.Util.createImage=function(a,b,c,d,e,f,g,h){function i(){j.style.display="",OpenLayers.Event.stopObservingElement(j)}var j=document.createElement("img");return a||(a=OpenLayers.Util.createUniqueID("OpenLayersDiv")),e||(e="relative"),OpenLayers.Util.modifyDOMElement(j,a,b,c,e,f,null,g),h&&(j.style.display="none",OpenLayers.Event.observe(j,"load",i),OpenLayers.Event.observe(j,"error",i)),j.style.alt=a,j.galleryImg="no",d&&(j.src=d),j},OpenLayers.IMAGE_RELOAD_ATTEMPTS=0,OpenLayers.Util.alphaHackNeeded=null,OpenLayers.Util.alphaHack=function(){if(null==OpenLayers.Util.alphaHackNeeded){var a=navigator.appVersion.split("MSIE"),b=parseFloat(a[1]),c=!1;try{c=!!document.body.filters}catch(a){}OpenLayers.Util.alphaHackNeeded=c&&b>=5.5&&b<7}return OpenLayers.Util.alphaHackNeeded},OpenLayers.Util.modifyAlphaImageDiv=function(a,b,c,d,e,f,g,h,i){OpenLayers.Util.modifyDOMElement(a,b,c,d,f,null,null,i);var j=a.childNodes[0];e&&(j.src=e),OpenLayers.Util.modifyDOMElement(j,a.id+"_innerImage",null,d,"relative",g),OpenLayers.Util.alphaHack()&&("none"!=a.style.display&&(a.style.display="inline-block"),null==h&&(h="scale"),a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+j.src+"', sizingMethod='"+h+"')",parseFloat(a.style.opacity)>=0&&parseFloat(a.style.opacity)<1&&(a.style.filter+=" alpha(opacity="+100*a.style.opacity+")"),j.style.filter="alpha(opacity=0)")},OpenLayers.Util.createAlphaImageDiv=function(a,b,c,d,e,f,g,h,i){var j=OpenLayers.Util.createDiv(),k=OpenLayers.Util.createImage(null,null,null,null,null,null,null,i);return k.className="olAlphaImg",j.appendChild(k),OpenLayers.Util.modifyAlphaImageDiv(j,a,b,c,d,e,f,g,h),j},OpenLayers.Util.upperCaseObject=function(a){var b={};for(var c in a)b[c.toUpperCase()]=a[c];return b},OpenLayers.Util.applyDefaults=function(a,b){a=a||{};var c="function"==typeof window.Event&&b instanceof window.Event;for(var d in b)(void 0===a[d]||!c&&b.hasOwnProperty&&b.hasOwnProperty(d)&&!a.hasOwnProperty(d))&&(a[d]=b[d]);return!c&&b&&b.hasOwnProperty&&b.hasOwnProperty("toString")&&!a.hasOwnProperty("toString")&&(a.toString=b.toString),a},OpenLayers.Util.getParameterString=function(a){var b=[];for(var c in a){var d=a[c];if(null!=d&&"function"!=typeof d){var e;if("object"==typeof d&&d.constructor==Array){for(var f,g=[],h=0,i=d.length;h<i;h++)f=d[h],g.push(encodeURIComponent(null===f||void 0===f?"":f));e=g.join(",")}else e=encodeURIComponent(d);b.push(encodeURIComponent(c)+"="+e)}}return b.join("&")},OpenLayers.Util.urlAppend=function(a,b){var c=a;if(b){var d=(a+" ").split(/[?&]/);c+=" "===d.pop()?b:d.length?"&"+b:"?"+b}return c},OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"},OpenLayers.Util.getImageLocation=function(a){return OpenLayers.Util.getImagesLocation()+a},OpenLayers.Util.Try=function(){for(var a=null,b=0,c=arguments.length;b<c;b++){var d=arguments[b];try{a=d();break}catch(a){}}return a},OpenLayers.Util.getXmlNodeValue=function(a){var b=null;return OpenLayers.Util.Try(function(){b=a.text,b||(b=a.textContent),b||(b=a.firstChild.nodeValue)},function(){b=a.textContent}),b},OpenLayers.Util.mouseLeft=function(a,b){for(var c=a.relatedTarget?a.relatedTarget:a.toElement;c!=b&&null!=c;)c=c.parentNode;return c!=b},OpenLayers.Util.DEFAULT_PRECISION=14,OpenLayers.Util.toFloat=function(a,b){return null==b&&(b=OpenLayers.Util.DEFAULT_PRECISION),"number"!=typeof a&&(a=parseFloat(a)),0===b?a:parseFloat(a.toPrecision(b))},OpenLayers.Util.rad=function(a){return a*Math.PI/180},OpenLayers.Util.deg=function(a){return 180*a/Math.PI},OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563},OpenLayers.Util.distVincenty=function(a,b){for(var c=OpenLayers.Util.VincentyConstants,d=c.a,e=c.b,f=c.f,g=OpenLayers.Util.rad(b.lon-a.lon),h=Math.atan((1-f)*Math.tan(OpenLayers.Util.rad(a.lat))),i=Math.atan((1-f)*Math.tan(OpenLayers.Util.rad(b.lat))),j=Math.sin(h),k=Math.cos(h),l=Math.sin(i),m=Math.cos(i),n=g,o=2*Math.PI,p=20;Math.abs(n-o)>1e-12&&--p>0;){var q=Math.sin(n),r=Math.cos(n),s=Math.sqrt(m*q*(m*q)+(k*l-j*m*r)*(k*l-j*m*r));if(0==s)return 0;var t=j*l+k*m*r,u=Math.atan2(s,t),v=Math.asin(k*m*q/s),w=Math.cos(v)*Math.cos(v),x=t-2*j*l/w,y=f/16*w*(4+f*(4-3*w));o=n,n=g+(1-y)*f*Math.sin(v)*(u+y*s*(x+y*t*(2*x*x-1)))}if(0==p)return NaN;var z=w*(d*d-e*e)/(e*e),A=1+z/16384*(4096+z*(z*(320-175*z)-768)),B=z/1024*(256+z*(z*(74-47*z)-128));return(e*A*(u-B*s*(x+B/4*(t*(2*x*x-1)-B/6*x*(4*s*s-3)*(4*x*x-3))))).toFixed(3)/1e3},OpenLayers.Util.destinationVincenty=function(a,b,c){for(var d=OpenLayers.Util,e=d.VincentyConstants,f=e.a,g=e.b,h=e.f,i=a.lon,j=a.lat,k=c,l=d.rad(b),m=Math.sin(l),n=Math.cos(l),o=(1-h)*Math.tan(d.rad(j)),p=1/Math.sqrt(1+o*o),q=o*p,r=Math.atan2(o,n),s=p*m,t=1-s*s,u=t*(f*f-g*g)/(g*g),v=1+u/16384*(4096+u*(u*(320-175*u)-768)),w=u/1024*(256+u*(u*(74-47*u)-128)),x=k/(g*v),y=2*Math.PI;Math.abs(x-y)>1e-12;){var z=Math.cos(2*r+x),A=Math.sin(x),B=Math.cos(x),C=w*A*(z+w/4*(B*(2*z*z-1)-w/6*z*(4*A*A-3)*(4*z*z-3)));y=x,x=k/(g*v)+C}var D=q*A-p*B*n,E=Math.atan2(q*B+p*A*n,(1-h)*Math.sqrt(s*s+D*D)),F=Math.atan2(A*m,p*B-q*A*n),G=h/16*t*(4+h*(4-3*t)),H=F-(1-G)*h*s*(x+G*A*(z+G*B*(2*z*z-1)));Math.atan2(s,-D);return new OpenLayers.LonLat(i+d.deg(H),d.deg(E))},OpenLayers.Util.getParameters=function(a,b){b=b||{},a=null===a||void 0===a?window.location.href:a;var c="";if(OpenLayers.String.contains(a,"?")){var d=a.indexOf("?")+1,e=OpenLayers.String.contains(a,"#")?a.indexOf("#"):a.length;c=a.substring(d,e)}for(var f={},g=c.split(/[&;]/),h=0,i=g.length;h<i;++h){var j=g[h].split("=");if(j[0]){var k=j[0];try{k=decodeURIComponent(k)}catch(a){k=unescape(k)}var l=(j[1]||"").replace(/\+/g," ");try{l=decodeURIComponent(l)}catch(a){l=unescape(l)}!1!==b.splitArgs&&(l=l.split(",")),1==l.length&&(l=l[0]),f[k]=l}}return f},OpenLayers.Util.lastSeqID=0,OpenLayers.Util.createUniqueID=function(a){return a=null==a?"id_":a.replace(OpenLayers.Util.dotless,"_"),OpenLayers.Util.lastSeqID+=1,a+OpenLayers.Util.lastSeqID},OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.37,km:39370,dd:4374754,yd:36},OpenLayers.INCHES_PER_UNIT.in=OpenLayers.INCHES_PER_UNIT.inches,OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd,OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m,OpenLayers.METERS_PER_INCH=.0254000508001016,OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:.0254/OpenLayers.METERS_PER_INCH,MicroInch:254e-7/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:.01/OpenLayers.METERS_PER_INCH,Kilometer:1e3/OpenLayers.METERS_PER_INCH,Yard:.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:.1/OpenLayers.METERS_PER_INCH,Millimeter:.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5e4/OpenLayers.METERS_PER_INCH,"150kilometers":15e4/OpenLayers.METERS_PER_INCH}),OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1e3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1e3*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH}),OpenLayers.DOTS_PER_INCH=72,OpenLayers.Util.normalizeScale=function(a){return a>1?1/a:a},OpenLayers.Util.getResolutionFromScale=function(a,b){var c;if(a){null==b&&(b="degrees");c=1/(OpenLayers.Util.normalizeScale(a)*OpenLayers.INCHES_PER_UNIT[b]*OpenLayers.DOTS_PER_INCH)}return c},OpenLayers.Util.getScaleFromResolution=function(a,b){return null==b&&(b="degrees"),a*OpenLayers.INCHES_PER_UNIT[b]*OpenLayers.DOTS_PER_INCH},OpenLayers.Util.pagePosition=function(a){var b=[0,0],c=OpenLayers.Util.getViewportElement();if(!a||a==window||a==c)return b;var d,e=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&"absolute"==OpenLayers.Element.getStyle(a,"position")&&(""==a.style.top||""==a.style.left),f=null;if(a.getBoundingClientRect){d=a.getBoundingClientRect();var g=window.pageYOffset||c.scrollTop,h=window.pageXOffset||c.scrollLeft;b[0]=d.left+h,b[1]=d.top+g}else if(document.getBoxObjectFor&&!e){d=document.getBoxObjectFor(a);var i=document.getBoxObjectFor(c);b[0]=d.screenX-i.screenX,b[1]=d.screenY-i.screenY}else{if(b[0]=a.offsetLeft,b[1]=a.offsetTop,(f=a.offsetParent)!=a)for(;f;)b[0]+=f.offsetLeft,b[1]+=f.offsetTop,f=f.offsetParent;var j=OpenLayers.BROWSER_NAME;for(("opera"==j||"safari"==j&&"absolute"==OpenLayers.Element.getStyle(a,"position"))&&(b[1]-=document.body.offsetTop),f=a.offsetParent;f&&f!=document.body;)b[0]-=f.scrollLeft,"opera"==j&&"TR"==f.tagName||(b[1]-=f.scrollTop),f=f.offsetParent}return b},OpenLayers.Util.getViewportElement=function(){var a=arguments.callee.viewportElement;return void 0==a&&(a="msie"==OpenLayers.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=a),a},OpenLayers.Util.isEquivalentUrl=function(a,b,c){c=c||{},OpenLayers.Util.applyDefaults(c,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0,splitArgs:!1});var d=OpenLayers.Util.createUrlObject(a,c),e=OpenLayers.Util.createUrlObject(b,c);for(var f in d)if("args"!==f&&d[f]!=e[f])return!1;for(var f in d.args){if(d.args[f]!=e.args[f])return!1;delete e.args[f]}for(var f in e.args)return!1;return!0},OpenLayers.Util.createUrlObject=function(a,b){if(b=b||{},!/^\w+:\/\//.test(a)){var c=window.location,d=c.port?":"+c.port:"",e=c.protocol+"//"+c.host.split(":").shift()+d;if(0===a.indexOf("/"))a=e+a;else{var f=c.pathname.split("/");f.pop(),a=e+f.join("/")+"/"+a}}b.ignoreCase&&(a=a.toLowerCase());var g=document.createElement("a");g.href=a;var h={};h.host=g.host.split(":").shift(),h.protocol=g.protocol,b.ignorePort80?h.port="80"==g.port||"0"==g.port?"":g.port:h.port=""==g.port||"0"==g.port?"80":g.port,
h.hash=b.ignoreHash||"#"===g.hash?"":g.hash;var i=g.search;if(!i){var j=a.indexOf("?");i=-1!=j?a.substr(j):""}return h.args=OpenLayers.Util.getParameters(i,{splitArgs:b.splitArgs}),h.pathname="/"==g.pathname.charAt(0)?g.pathname:"/"+g.pathname,h},OpenLayers.Util.removeTail=function(a){var b=a.indexOf("?"),c=a.indexOf("#");return-1==b?-1!=c?a.substr(0,c):a:-1!=c?a.substr(0,Math.min(b,c)):a.substr(0,b)},OpenLayers.IS_GECKO=function(){var a=navigator.userAgent.toLowerCase();return-1==a.indexOf("webkit")&&-1!=a.indexOf("gecko")}(),OpenLayers.CANVAS_SUPPORTED=function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))}(),OpenLayers.BROWSER_NAME=function(){var a="",b=navigator.userAgent.toLowerCase();return-1!=b.indexOf("opera")?a="opera":-1!=b.indexOf("msie")?a="msie":-1!=b.indexOf("safari")?a="safari":-1!=b.indexOf("mozilla")&&(a=-1!=b.indexOf("firefox")?"firefox":"mozilla"),a}(),OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME},OpenLayers.Util.getRenderedDimensions=function(a,b,c){var d,e,f=document.createElement("div");f.style.visibility="hidden";for(var g=c&&c.containerElement?c.containerElement:document.body,h=!1,i=null,j=g;j&&"body"!=j.tagName.toLowerCase();){var k=OpenLayers.Element.getStyle(j,"position");if("absolute"==k){h=!0;break}if(k&&"static"!=k)break;j=j.parentNode}!h||0!==g.clientHeight&&0!==g.clientWidth||(i=document.createElement("div"),i.style.visibility="hidden",i.style.position="absolute",i.style.overflow="visible",i.style.width=document.body.clientWidth+"px",i.style.height=document.body.clientHeight+"px",i.appendChild(f)),f.style.position="absolute",b&&(b.w?(d=b.w,f.style.width=d+"px"):b.h&&(e=b.h,f.style.height=e+"px")),c&&c.displayClass&&(f.className=c.displayClass);var l=document.createElement("div");if(l.innerHTML=a,l.style.overflow="visible",l.childNodes)for(var m=0,n=l.childNodes.length;m<n;m++)l.childNodes[m].style&&(l.childNodes[m].style.overflow="visible");return f.appendChild(l),i?g.appendChild(i):g.appendChild(f),d||(d=parseInt(l.scrollWidth),f.style.width=d+"px"),e||(e=parseInt(l.scrollHeight)),f.removeChild(l),i?(i.removeChild(f),g.removeChild(i)):g.removeChild(f),new OpenLayers.Size(d,e)},OpenLayers.Util.getScrollbarWidth=function(){var a=OpenLayers.Util._scrollbarWidth;if(null==a){var b=null,c=null,d=0,e=0;b=document.createElement("div"),b.style.position="absolute",b.style.top="-1000px",b.style.left="-1000px",b.style.width="100px",b.style.height="50px",b.style.overflow="hidden",c=document.createElement("div"),c.style.width="100%",c.style.height="200px",b.appendChild(c),document.body.appendChild(b),d=c.offsetWidth,b.style.overflow="scroll",e=c.offsetWidth,document.body.removeChild(document.body.lastChild),OpenLayers.Util._scrollbarWidth=d-e,a=OpenLayers.Util._scrollbarWidth}return a},OpenLayers.Util.getFormattedLonLat=function(a,b,c){c||(c="dms"),a=(a+540)%360-180;var d=Math.abs(a),e=Math.floor(d),f=(d-e)/(1/60),g=f;f=Math.floor(f);var h=(g-f)/(1/60);h=Math.round(10*h),h/=10,h>=60&&(h-=60,(f+=1)>=60&&(f-=60,e+=1)),e<10&&(e="0"+e);var i=e+"Â°";return c.indexOf("dm")>=0&&(f<10&&(f="0"+f),i+=f+"'",c.indexOf("dms")>=0&&(h<10&&(h="0"+h),i+=h+'"')),i+="lon"==b?a<0?OpenLayers.i18n("W"):OpenLayers.i18n("E"):a<0?OpenLayers.i18n("S"):OpenLayers.i18n("N")},OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(a){OpenLayers.Util.extend(this,a),this.options=a},destroy:function(){},read:function(a){throw new Error("Read not implemented.")},write:function(a){throw new Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"}),OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(a){window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")),OpenLayers.Format.prototype.initialize.apply(this,[a]),this.namespaces=OpenLayers.Util.extend({},this.namespaces),this.namespaceAlias={};for(var b in this.namespaces)this.namespaceAlias[this.namespaces[b]]=b},destroy:function(){this.xmldom=null,OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(a,b){this.namespaces[a]=b,this.namespaceAlias[b]=a},read:function(a){var b=a.indexOf("<");b>0&&(a=a.substring(b));var c=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var b;return b=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom,b.loadXML(a),b},this),function(){return(new DOMParser).parseFromString(a,"text/xml")},function(){var b=new XMLHttpRequest;return b.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(a),!1),b.overrideMimeType&&b.overrideMimeType("text/xml"),b.send(null),b.responseXML});return this.keepData&&(this.data=c),c},write:function(a){var b;if(this.xmldom)b=a.xml;else{var c=new XMLSerializer;if(1==a.nodeType){var d=document.implementation.createDocument("","",null);d.importNode&&(a=d.importNode(a,!0)),d.appendChild(a),b=c.serializeToString(d)}else b=c.serializeToString(a)}return b},createElementNS:function(a,b){return this.xmldom?"string"==typeof a?this.xmldom.createNode(1,b,a):this.xmldom.createNode(1,b,""):document.createElementNS(a,b)},createDocumentFragment:function(){return this.xmldom?this.xmldom.createDocumentFragment():document.createDocumentFragment()},createTextNode:function(a){return"string"!=typeof a&&(a=String(a)),this.xmldom?this.xmldom.createTextNode(a):document.createTextNode(a)},getElementsByTagNameNS:function(a,b,c){var d=[];if(a.getElementsByTagNameNS)d=a.getElementsByTagNameNS(b,c);else for(var e,f,g=a.getElementsByTagName("*"),h=0,i=g.length;h<i;++h)e=g[h],f=e.prefix?e.prefix+":"+c:c,"*"!=c&&f!=e.nodeName||"*"!=b&&b!=e.namespaceURI||d.push(e);return d},getAttributeNodeNS:function(a,b,c){var d=null;if(a.getAttributeNodeNS)d=a.getAttributeNodeNS(b,c);else for(var e,f=a.attributes,g=0,h=f.length;g<h;++g)if(e=f[g],e.namespaceURI==b&&(e.prefix?e.prefix+":"+c:c)==e.nodeName){d=e;break}return d},getAttributeNS:function(a,b,c){var d="";if(a.getAttributeNS)d=a.getAttributeNS(b,c)||"";else{var e=this.getAttributeNodeNS(a,b,c);e&&(d=e.nodeValue)}return d},getChildValue:function(a,b){var c=b||"";if(a)for(var d=a.firstChild;d;d=d.nextSibling)switch(d.nodeType){case 3:case 4:c+=d.nodeValue}return c},isSimpleContent:function(a){for(var b=!0,c=a.firstChild;c;c=c.nextSibling)if(1===c.nodeType){b=!1;break}return b},contentType:function(a){for(var b=!1,c=!1,d=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY,e=a.firstChild;e;e=e.nextSibling){switch(e.nodeType){case 1:c=!0;break;case 8:break;default:b=!0}if(c&&b)break}if(c&&b)d=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;else{if(c)return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;if(b)return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}return d},hasAttributeNS:function(a,b,c){return a.hasAttributeNS?a.hasAttributeNS(b,c):!!this.getAttributeNodeNS(a,b,c)},setAttributeNS:function(a,b,c,d){if(a.setAttributeNS)a.setAttributeNS(b,c,d);else{if(!this.xmldom)throw"setAttributeNS not implemented";if(b){var e=a.ownerDocument.createNode(2,c,b);e.nodeValue=d,a.setAttributeNode(e)}else a.setAttribute(c,d)}},createElementNSPlus:function(a,b){b=b||{};var c=b.uri||this.namespaces[b.prefix];if(!c){var d=a.indexOf(":");c=this.namespaces[a.substring(0,d)]}c||(c=this.namespaces[this.defaultPrefix]);var e=this.createElementNS(c,a);b.attributes&&this.setAttributes(e,b.attributes);var f=b.value;return null!=f&&e.appendChild(this.createTextNode(f)),e},setAttributes:function(a,b){var c,d;for(var e in b)null!=b[e]&&b[e].toString&&(c=b[e].toString(),d=this.namespaces[e.substring(0,e.indexOf(":"))]||null,this.setAttributeNS(a,d,e,c))},readNode:function(a,b){b||(b={});var c=this.readers[a.namespaceURI?this.namespaceAlias[a.namespaceURI]:this.defaultPrefix];if(c){var d=a.localName||a.nodeName.split(":").pop(),e=c[d]||c["*"];e&&e.apply(this,[a,b])}return b},readChildNodes:function(a,b){b||(b={});for(var c,d=a.childNodes,e=0,f=d.length;e<f;++e)c=d[e],1==c.nodeType&&this.readNode(c,b);return b},writeNode:function(a,b,c){var d,e,f=a.indexOf(":");f>0?(d=a.substring(0,f),e=a.substring(f+1)):(d=c?this.namespaceAlias[c.namespaceURI]:this.defaultPrefix,e=a);var g=this.writers[d][e].apply(this,[b]);return c&&c.appendChild(g),g},getChildEl:function(a,b,c){return a&&this.getThisOrNextEl(a.firstChild,b,c)},getNextEl:function(a,b,c){return a&&this.getThisOrNextEl(a.nextSibling,b,c)},getThisOrNextEl:function(a,b,c){a:for(var d=a;d;d=d.nextSibling)switch(d.nodeType){case 1:if(!(b&&b!==(d.localName||d.nodeName.split(":").pop())||c&&c!==d.namespaceURI))break a;d=null;break a;case 3:if(/^\s*$/.test(d.nodeValue))break;case 4:case 6:case 12:case 10:case 11:d=null;break a}return d||null},lookupNamespaceURI:function(a,b){var c=null;if(a)if(a.lookupNamespaceURI)c=a.lookupNamespaceURI(b);else a:switch(a.nodeType){case 1:if(null!==a.namespaceURI&&a.prefix===b){c=a.namespaceURI;break a}var d=a.attributes.length;if(d)for(var e,f=0;f<d;++f){if(e=a.attributes[f],"xmlns"===e.prefix&&e.name==="xmlns:"+b){c=e.value||null;break a}if("xmlns"===e.name&&null===b){c=e.value||null;break a}}c=this.lookupNamespaceURI(a.parentNode,b);break a;case 2:c=this.lookupNamespaceURI(a.ownerElement,b);break a;case 9:c=this.lookupNamespaceURI(a.documentElement,b);break a;case 6:case 12:case 10:case 11:break a;default:c=this.lookupNamespaceURI(a.parentNode,b)}return c},getXMLDoc:function(){return OpenLayers.Format.XML.document||this.xmldom||(document.implementation&&document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"))),OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"}),OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3},OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype),OpenLayers.Format.XML.document=null,OpenLayers.Date={dateRegEx:/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/,toISOString:function(){return"toISOString"in Date.prototype?function(a){return a.toISOString()}:function(a){return isNaN(a.getTime())?"Invalid Date":a.getUTCFullYear()+"-"+OpenLayers.Number.zeroPad(a.getUTCMonth()+1,2)+"-"+OpenLayers.Number.zeroPad(a.getUTCDate(),2)+"T"+OpenLayers.Number.zeroPad(a.getUTCHours(),2)+":"+OpenLayers.Number.zeroPad(a.getUTCMinutes(),2)+":"+OpenLayers.Number.zeroPad(a.getUTCSeconds(),2)+"."+OpenLayers.Number.zeroPad(a.getUTCMilliseconds(),3)+"Z"}}(),parse:function(a){var b,c=a.match(this.dateRegEx);if(c&&(c[1]||c[7])){var d=parseInt(c[1],10)||0,e=parseInt(c[2],10)-1||0,f=parseInt(c[3],10)||1;b=new Date(Date.UTC(d,e,f));var g=c[7];if(g){var h=parseInt(c[4],10),i=parseInt(c[5],10),j=parseFloat(c[6]),k=0|j,l=Math.round(1e3*(j-k));if(b.setUTCHours(h,i,k,l),"Z"!==g){var m=parseInt(g,10),n=parseInt(c[8],10)||0,o=-1e3*(60*m*60+60*n);b=new Date(b.getTime()+o)}}}else b=new Date("invalid");return b}},OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(a,b,c){this.layer=a,this.lonlat=b,this.data=null!=c?c:{},this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup),null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker),this.layer=null,this.id=null,this.lonlat=null,this.data=null,null!=this.marker&&(this.destroyMarker(this.marker),this.marker=null),null!=this.popup&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var a=!1;if(null!=this.layer&&null!=this.layer.map){a=this.layer.map.getExtent().containsLonLat(this.lonlat)}return a},createMarker:function(){return null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)),this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(a){if(null!=this.lonlat){if(!this.popup){var b=this.marker?this.marker.icon:null,c=this.popupClass?this.popupClass:OpenLayers.Popup.Anchored;this.popup=new c(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,b,a)}null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this}return this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:"OpenLayers.Feature"}),OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"},OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(a,b,c){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,b]),this.lonlat=null,this.geometry=a||null,this.state=null,this.attributes={},b&&(this.attributes=OpenLayers.Util.extend(this.attributes,b)),this.style=c||null},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.geometry=null,this.modified=null,OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(a){var b=!1;if(this.layer&&this.layer.map){var c=this.layer.map.getExtent();if(a){var d=this.geometry.getBounds();b=c.intersectsBounds(d)}else{b=c.toGeometry().intersects(this.geometry)}}return b},getVisibility:function(){return!(this.style&&"none"==this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(a,b,c){var d=!1;return this.geometry&&(d=this.geometry.atPoint(a,b,c)),d},destroyPopup:function(){},move:function(a){if(this.layer&&this.geometry.move){var b;b="OpenLayers.LonLat"==a.CLASS_NAME?this.layer.getViewPortPxFromLonLat(a):a;var c=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),d=this.layer.map.getResolution();return this.geometry.move(d*(b.x-c.x),d*(c.y-b.y)),this.layer.drawFeature(this),c}},toState:function(a){if(a==OpenLayers.State.UPDATE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=a;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:}else if(a==OpenLayers.State.INSERT)switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=a}else if(a==OpenLayers.State.DELETE)switch(this.state){case OpenLayers.State.INSERT:case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=a}else a==OpenLayers.State.UNKNOWN&&(this.state=a)},CLASS_NAME:"OpenLayers.Feature.Vector"}),OpenLayers.Feature.Vector.style={default:{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},delete:{display:"none"}},OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null,this.bounds=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(a){a&&(this.bounds=a.clone())},clearBounds:function(){this.bounds=null,this.parent&&this.parent.clearBounds()},extendBounds:function(a){this.getBounds()?this.bounds.extend(a):this.setBounds(a)},getBounds:function(){return null==this.bounds&&this.calculateBounds(),this.bounds},calculateBounds:function(){},distanceTo:function(a,b){},getVertices:function(a){},atPoint:function(a,b,c){var d=!1;if(null!=this.getBounds()&&null!=a){var e=null!=b?b:0,f=null!=c?c:0;d=new OpenLayers.Bounds(this.bounds.left-e,this.bounds.bottom-f,this.bounds.right+e,this.bounds.top+f).containsLonLat(a)}return d},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Geometry"}),OpenLayers.Geometry.fromWKT=function(a){var b;if(OpenLayers.Format&&OpenLayers.Format.WKT){var c=OpenLayers.Geometry.fromWKT.format;c||(c=new OpenLayers.Format.WKT,OpenLayers.Geometry.fromWKT.format=c);var d=c.read(a);if(d instanceof OpenLayers.Feature.Vector)b=d.geometry;else if(OpenLayers.Util.isArray(d)){for(var e=d.length,f=new Array(e),g=0;g<e;++g)f[g]=d[g].geometry;b=new OpenLayers.Geometry.Collection(f)}}return b},OpenLayers.Geometry.segmentsIntersect=function(a,b,c){var d=c&&c.point,e=c&&c.tolerance,f=!1,g=a.x1-b.x1,h=a.y1-b.y1,i=a.x2-a.x1,j=a.y2-a.y1,k=b.y2-b.y1,l=b.x2-b.x1,m=k*i-l*j,n=l*h-k*g,o=i*h-j*g;if(0==m)0==n&&0==o&&(f=!0);else{var p=n/m,q=o/m;if(p>=0&&p<=1&&q>=0&&q<=1)if(d){var r=a.x1+p*i,s=a.y1+p*j;f=new OpenLayers.Geometry.Point(r,s)}else f=!0}if(e){if(f){if(d){var t,r,s,u=[a,b];a:for(var v=0;v<2;++v){t=u[v];for(var w=1;w<3;++w)if(r=t["x"+w],s=t["y"+w],Math.sqrt(Math.pow(r-f.x,2)+Math.pow(s-f.y,2))<e){f.x=r,f.y=s;break a}}}}else{var x,y,r,s,z,A,u=[a,b];a:for(var v=0;v<2;++v){x=u[v],y=u[(v+1)%2];for(var w=1;w<3;++w)if(z={x:x["x"+w],y:x["y"+w]},A=OpenLayers.Geometry.distanceToSegment(z,y),A.distance<e){f=!d||new OpenLayers.Geometry.Point(z.x,z.y);break a}}}}return f},OpenLayers.Geometry.distanceToSegment=function(a,b){var c=OpenLayers.Geometry.distanceSquaredToSegment(a,b);return c.distance=Math.sqrt(c.distance),c},OpenLayers.Geometry.distanceSquaredToSegment=function(a,b){var c,d,e=a.x,f=a.y,g=b.x1,h=b.y1,i=b.x2,j=b.y2,k=i-g,l=j-h,m=(k*(e-g)+l*(f-h))/(Math.pow(k,2)+Math.pow(l,2));return m<=0?(c=g,d=h):m>=1?(c=i,d=j):(c=g+m*k,d=h+m*l),{distance:Math.pow(c-e,2)+Math.pow(d-f,2),x:c,y:d,along:m}},OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(a,b){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.x=parseFloat(a),this.y=parseFloat(b)},clone:function(a){return null==a&&(a=new OpenLayers.Geometry.Point(this.x,this.y)),OpenLayers.Util.applyDefaults(a,this),a},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(a,b){var c,d,e,f,g,h,i=!(b&&!1===b.edge),j=i&&b&&b.details;return a instanceof OpenLayers.Geometry.Point?(d=this.x,e=this.y,f=a.x,g=a.y,c=Math.sqrt(Math.pow(d-f,2)+Math.pow(e-g,2)),h=j?{x0:d,y0:e,x1:f,y1:g,distance:c}:c):(h=a.distanceTo(this,b),j&&(h={x0:h.x1,y0:h.y1,x1:h.x0,y1:h.y0,distance:h.distance})),h},equals:function(a){var b=!1;return null!=a&&(b=this.x==a.x&&this.y==a.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y)),b},toShortString:function(){return this.x+", "+this.y},move:function(a,b){this.x=this.x+a,this.y=this.y+b,this.clearBounds()},rotate:function(a,b){a*=Math.PI/180;var c=this.distanceTo(b),d=a+Math.atan2(this.y-b.y,this.x-b.x);this.x=b.x+c*Math.cos(d),this.y=b.y+c*Math.sin(d),this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(a,b,c){return c=void 0==c?1:c,this.x=b.x+a*c*(this.x-b.x),this.y=b.y+a*(this.y-b.y),this.clearBounds(),this},intersects:function(a){return"OpenLayers.Geometry.Point"==a.CLASS_NAME?this.equals(a):a.intersects(this)},transform:function(a,b){return a&&b&&(OpenLayers.Projection.transform(this,a,b),this.bounds=null),this},getVertices:function(a){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"}),OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(a){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.components=[],null!=a&&this.addComponents(a)},destroy:function(){this.components.length=0,this.components=null,OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var geometry=eval("new "+this.CLASS_NAME+"()"),i=0,len=this.components.length;i<len;i++)geometry.addComponent(this.components[i].clone());return OpenLayers.Util.applyDefaults(geometry,this),geometry},getComponentsString:function(){for(var a=[],b=0,c=this.components.length;b<c;b++)a.push(this.components[b].toShortString());return a.join(",")},calculateBounds:function(){this.bounds=null;var a=new OpenLayers.Bounds,b=this.components;if(b)for(var c=0,d=b.length;c<d;c++)a.extend(b[c].getBounds());null!=a.left&&null!=a.bottom&&null!=a.right&&null!=a.top&&this.setBounds(a)},addComponents:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0,c=a.length;b<c;b++)this.addComponent(a[b])},addComponent:function(a,b){var c=!1;if(a&&(null==this.componentTypes||OpenLayers.Util.indexOf(this.componentTypes,a.CLASS_NAME)>-1)){if(null!=b&&b<this.components.length){var d=this.components.slice(0,b),e=this.components.slice(b,this.components.length);d.push(a),this.components=d.concat(e)}else this.components.push(a);a.parent=this,this.clearBounds(),c=!0}return c},removeComponents:function(a){var b=!1;OpenLayers.Util.isArray(a)||(a=[a]);for(var c=a.length-1;c>=0;--c)b=this.removeComponent(a[c])||b;return b},removeComponent:function(a){return OpenLayers.Util.removeItem(this.components,a),this.clearBounds(),!0},getLength:function(){for(var a=0,b=0,c=this.components.length;b<c;b++)a+=this.components[b].getLength();return a},getArea:function(){for(var a=0,b=0,c=this.components.length;b<c;b++)a+=this.components[b].getArea();return a},getGeodesicArea:function(a){for(var b=0,c=0,d=this.components.length;c<d;c++)b+=this.components[c].getGeodesicArea(a);return b},getCentroid:function(a){if(!a)return this.components.length&&this.components[0].getCentroid();var b=this.components.length;if(!b)return!1;for(var c,d=[],e=[],f=0,g=Number.MAX_VALUE,h=0;h<b;++h){c=this.components[h];var i=c.getArea(),j=c.getCentroid(!0);isNaN(i)||isNaN(j.x)||isNaN(j.y)||(d.push(i),f+=i,g=i<g&&i>0?i:g,e.push(j))}if(b=d.length,0===f){for(var h=0;h<b;++h)d[h]=1;f=d.length}else{for(var h=0;h<b;++h)d[h]/=g;f/=g}for(var j,i,k=0,l=0,h=0;h<b;++h)j=e[h],i=d[h],k+=j.x*i,l+=j.y*i;return new OpenLayers.Geometry.Point(k/f,l/f)},getGeodesicLength:function(a){for(var b=0,c=0,d=this.components.length;c<d;c++)b+=this.components[c].getGeodesicLength(a);return b},move:function(a,b){for(var c=0,d=this.components.length;c<d;c++)this.components[c].move(a,b)},rotate:function(a,b){for(var c=0,d=this.components.length;c<d;++c)this.components[c].rotate(a,b)},resize:function(a,b,c){for(var d=0;d<this.components.length;++d)this.components[d].resize(a,b,c);return this},distanceTo:function(a,b){for(var c,d,e,f=!(b&&!1===b.edge),g=f&&b&&b.details,h=Number.POSITIVE_INFINITY,i=0,j=this.components.length;i<j&&(c=this.components[i].distanceTo(a,b),!((e=g?c.distance:c)<h&&(h=e,d=c,0==h)));++i);return d},equals:function(a){var b=!0;if(a&&a.CLASS_NAME&&this.CLASS_NAME==a.CLASS_NAME)if(OpenLayers.Util.isArray(a.components)&&a.components.length==this.components.length){for(var c=0,d=this.components.length;c<d;++c)if(!this.components[c].equals(a.components[c])){b=!1;break}}else b=!1;else b=!1;return b},transform:function(a,b){if(a&&b){for(var c=0,d=this.components.length;c<d;c++){this.components[c].transform(a,b)}this.bounds=null}return this},intersects:function(a){for(var b=!1,c=0,d=this.components.length;c<d&&!(b=a.intersects(this.components[c]));++c);return b},getVertices:function(a){for(var b=[],c=0,d=this.components.length;c<d;++c)Array.prototype.push.apply(b,this.components[c].getVertices(a));return b},CLASS_NAME:"OpenLayers.Geometry.Collection"}),OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(a,b){this.addComponent(a,b)},removePoint:function(a){this.removeComponent(a)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"}),OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var a=0;if(this.components&&this.components.length>1)for(var b=1,c=this.components.length;b<c;b++)a+=this.components[b-1].distanceTo(this.components[b]);return a},getGeodesicLength:function(a){var b=this;if(a){var c=new OpenLayers.Projection("EPSG:4326");c.equals(a)||(b=this.clone().transform(a,c))}var d=0;if(b.components&&b.components.length>1)for(var e,f,g=1,h=b.components.length;g<h;g++)e=b.components[g-1],f=b.components[g],d+=OpenLayers.Util.distVincenty({lon:e.x,lat:e.y},{lon:f.x,lat:f.y});return 1e3*d},CLASS_NAME:"OpenLayers.Geometry.Curve"}),OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(a){var b=this.components&&this.components.length>2;return b&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),b},intersects:function(a){var b=!1,c=a.CLASS_NAME;if("OpenLayers.Geometry.LineString"==c||"OpenLayers.Geometry.LinearRing"==c||"OpenLayers.Geometry.Point"==c){var d,e=this.getSortedSegments();d="OpenLayers.Geometry.Point"==c?[{x1:a.x,y1:a.y,x2:a.x,y2:a.y}]:a.getSortedSegments();var f,g,h,i,j,k,l,m;a:for(var n=0,o=e.length;n<o;++n){f=e[n],g=f.x1,h=f.x2,i=f.y1,j=f.y2;for(var p=0,q=d.length;p<q&&(k=d[p],!(k.x1>h));++p)if(!(k.x2<g)&&(l=k.y1,m=k.y2,!(Math.min(l,m)>Math.max(i,j))&&!(Math.max(l,m)<Math.min(i,j))&&OpenLayers.Geometry.segmentsIntersect(f,k))){b=!0;break a}}}else b=a.intersects(this);return b},getSortedSegments:function(){function a(a,b){return a.x1-b.x1}for(var b,c,d=this.components.length-1,e=new Array(d),f=0;f<d;++f)b=this.components[f],c=this.components[f+1],b.x<c.x?e[f]={x1:b.x,y1:b.y,x2:c.x,y2:c.y}:e[f]={x1:c.x,y1:c.y,x2:b.x,y2:b.y};return e.sort(a)},splitWithSegment:function(a,b){for(var c,d,e,f,g=!(b&&!1===b.edge),h=b&&b.tolerance,i=[],j=this.getVertices(),k=[],l=[],m=!1,n={point:!0,tolerance:h},o=null,p=0,q=j.length-2;p<=q;++p)if(c=j[p],k.push(c.clone()),d=j[p+1],f={x1:c.x,y1:c.y,x2:d.x,y2:d.y},(e=OpenLayers.Geometry.segmentsIntersect(a,f,n))instanceof OpenLayers.Geometry.Point&&(!!(e.x===a.x1&&e.y===a.y1||e.x===a.x2&&e.y===a.y2||e.equals(c)||e.equals(d))||g)){if(e.equals(l[l.length-1])||l.push(e.clone()),0===p&&e.equals(c))continue;if(e.equals(d))continue;m=!0,e.equals(c)||k.push(e),i.push(new OpenLayers.Geometry.LineString(k)),k=[e.clone()]}if(m&&(k.push(d.clone()),i.push(new OpenLayers.Geometry.LineString(k))),l.length>0){var r=a.x1<a.x2?1:-1,s=a.y1<a.y2?1:-1;o={lines:i,points:l.sort(function(a,b){return r*a.x-r*b.x||s*a.y-s*b.y})}}return o},split:function(a,b){var c,d,e,f,g=null,h=b&&b.mutual;if(a instanceof OpenLayers.Geometry.LineString){var i,j,k,l,m,n,o=this.getVertices(),p=[];e=[];for(var q=0,r=o.length-2;q<=r;++q){i=o[q],j=o[q+1],k={x1:i.x,y1:i.y,x2:j.x,y2:j.y},f=f||[a],h&&p.push(i.clone());for(var s=0;s<f.length;++s)if((l=f[s].splitWithSegment(k,b))&&(m=l.lines,m.length>0&&(m.unshift(s,1),Array.prototype.splice.apply(f,m),s+=m.length-2),h))for(var t=0,u=l.points.length;t<u;++t)n=l.points[t],n.equals(i)||(p.push(n),e.push(new OpenLayers.Geometry.LineString(p)),p=n.equals(j)?[]:[n.clone()])}h&&e.length>0&&p.length>0&&(p.push(j.clone()),e.push(new OpenLayers.Geometry.LineString(p)))}else g=a.splitWith(this,b);return f&&f.length>1?d=!0:f=[],e&&e.length>1?c=!0:e=[],(d||c)&&(g=h?[e,f]:f),g},splitWith:function(a,b){return a.split(this,b)},getVertices:function(a){return!0===a?[this.components[0],this.components[this.components.length-1]]:!1===a?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(a,b){var c,d=!(b&&!1===b.edge),e=d&&b&&b.details,f={},g=Number.POSITIVE_INFINITY;if(a instanceof OpenLayers.Geometry.Point){for(var h,i=this.getSortedSegments(),j=a.x,k=a.y,l=0,m=i.length;l<m;++l)if(h=i[l],c=OpenLayers.Geometry.distanceToSegment(a,h),c.distance<g){if(g=c.distance,f=c,0===g)break}else if(h.x2>j&&(k>h.y1&&k<h.y2||k<h.y1&&k>h.y2))break;f=e?{distance:f.distance,x0:f.x,y0:f.y,x1:j,y1:k}:f.distance}else if(a instanceof OpenLayers.Geometry.LineString){var n,o,p,q,r,s=this.getSortedSegments(),t=a.getSortedSegments(),u=t.length,v={point:!0};a:for(var l=0,m=s.length;l<m;++l){n=s[l],q=n.x1,r=n.y1;for(var w=0;w<u;++w){if(o=t[w],p=OpenLayers.Geometry.segmentsIntersect(n,o,v)){g=0,f={distance:0,x0:p.x,y0:p.y,x1:p.x,y1:p.y};break a}c=OpenLayers.Geometry.distanceToSegment({x:q,y:r},o),c.distance<g&&(g=c.distance,f={distance:g,x0:q,y0:r,x1:c.x,y1:c.y})}}if(e||(f=f.distance),0!==g&&n){c=a.distanceTo(new OpenLayers.Geometry.Point(n.x2,n.y2),b);var x=e?c.distance:c;x<g&&(f=e?{distance:g,x0:c.x1,y0:c.y1,x1:c.x0,y1:c.y0}:x)}}else f=a.distanceTo(this,b),e&&(f={distance:f.distance,x0:f.x1,y0:f.y1,x1:f.x0,y1:f.y0});return f},simplify:function(a){if(this&&null!==this){var b=this.getVertices();if(b.length<3)return this;var c=function(a,b){return a-b},d=function(a,b,c,f){for(var h,i=0,j=0,k=b;k<c;k++)(h=e(a[b],a[c],a[k]))>i&&(i=h,j=k);i>f&&j!=b&&(g.push(j),d(a,b,j,f),d(a,j,c,f))},e=function(a,b,c){return Math.abs(.5*(a.x*b.y+b.x*c.y+c.x*a.y-b.x*a.y-c.x*b.y-a.x*c.y))/Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))*2},f=b.length-1,g=[];for(g.push(0),g.push(f);b[0].equals(b[f]);)f--,g.push(f);d(b,0,f,a);var h=[];g.sort(c);for(var i=0;i<g.length;i++)h.push(b[g[i]]);return new OpenLayers.Geometry.LineString(h)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"}),OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(a,b){var c=!1,d=this.components.pop();null==b&&a.equals(d)||(c=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments));var e=this.components[0];return OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[e]),c},removeComponent:function(a){var b=this.components&&this.components.length>3;if(b){this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var c=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[c])}return b},move:function(a,b){for(var c=0,d=this.components.length;c<d-1;c++)this.components[c].move(a,b)},rotate:function(a,b){for(var c=0,d=this.components.length;c<d-1;++c)this.components[c].rotate(a,b)},resize:function(a,b,c){for(var d=0,e=this.components.length;d<e-1;++d)this.components[d].resize(a,b,c);return this},transform:function(a,b){if(a&&b){for(var c=0,d=this.components.length;c<d-1;c++){this.components[c].transform(a,b)}this.bounds=null}return this},getCentroid:function(){if(this.components){var a=this.components.length;if(a>0&&a<=2)return this.components[0].clone();if(a>2){var b=0,c=0,d=this.components[0].x,e=this.components[0].y,f=-1*this.getArea();if(0!=f){for(var g=0;g<a-1;g++){
var h=this.components[g],i=this.components[g+1];b+=(h.x+i.x-2*d)*((h.x-d)*(i.y-e)-(i.x-d)*(h.y-e)),c+=(h.y+i.y-2*e)*((h.x-d)*(i.y-e)-(i.x-d)*(h.y-e))}var j=d+b/(6*f),k=e+c/(6*f)}else{for(var g=0;g<a-1;g++)b+=this.components[g].x,c+=this.components[g].y;var j=b/(a-1),k=c/(a-1)}return new OpenLayers.Geometry.Point(j,k)}return null}},getArea:function(){var a=0;if(this.components&&this.components.length>2){for(var b=0,c=0,d=this.components.length;c<d-1;c++){var e=this.components[c],f=this.components[c+1];b+=(e.x+f.x)*(f.y-e.y)}a=-b/2}return a},getGeodesicArea:function(a){var b=this;if(a){var c=new OpenLayers.Projection("EPSG:4326");c.equals(a)||(b=this.clone().transform(a,c))}var d=0,e=b.components&&b.components.length;if(e>2){for(var f,g,h=0;h<e-1;h++)f=b.components[h],g=b.components[h+1],d+=OpenLayers.Util.rad(g.x-f.x)*(2+Math.sin(OpenLayers.Util.rad(f.y))+Math.sin(OpenLayers.Util.rad(g.y)));d=6378137*d*6378137/2}return d},containsPoint:function(a){for(var b,c,d,e,f,g,h,i=OpenLayers.Number.limitSigDigs,j=i(a.x,14),k=i(a.y,14),l=this.components.length-1,m=0,n=0;n<l;++n)if(b=this.components[n],d=i(b.x,14),e=i(b.y,14),c=this.components[n+1],f=i(c.x,14),g=i(c.y,14),e!=g){if((h=i(function(a,b,c,d,e){return(d-b)/(e-c)*(a-e)+d}(k,d,e,f,g),14))==j&&(e<g&&k>=e&&k<=g||e>g&&k<=e&&k>=g)){m=-1;break}h<=j||d!=f&&(h<Math.min(d,f)||h>Math.max(d,f))||(e<g&&k>=e&&k<g||e>g&&k<e&&k>=g)&&++m}else if(k==e&&(d<=f&&j>=d&&j<=f||d>=f&&j<=d&&j>=f)){m=-1;break}return-1==m?1:!!(1&m)},intersects:function(a){var b=!1;if("OpenLayers.Geometry.Point"==a.CLASS_NAME)b=this.containsPoint(a);else if("OpenLayers.Geometry.LineString"==a.CLASS_NAME)b=a.intersects(this);else if("OpenLayers.Geometry.LinearRing"==a.CLASS_NAME)b=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[a]);else for(var c=0,d=a.components.length;c<d&&!(b=a.components[c].intersects(this));++c);return b},getVertices:function(a){return!0===a?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"}),OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var a=0;if(this.components&&this.components.length>0){a+=Math.abs(this.components[0].getArea());for(var b=1,c=this.components.length;b<c;b++)a-=Math.abs(this.components[b].getArea())}return a},getGeodesicArea:function(a){var b=0;if(this.components&&this.components.length>0){b+=Math.abs(this.components[0].getGeodesicArea(a));for(var c=1,d=this.components.length;c<d;c++)b-=Math.abs(this.components[c].getGeodesicArea(a))}return b},containsPoint:function(a){var b=this.components.length,c=!1;if(b>0&&1!==(c=this.components[0].containsPoint(a))&&c&&b>1)for(var d,e=1;e<b;++e)if(d=this.components[e].containsPoint(a)){c=1===d&&1;break}return c},intersects:function(a){var b,c,d=!1;if("OpenLayers.Geometry.Point"==a.CLASS_NAME)d=this.containsPoint(a);else if("OpenLayers.Geometry.LineString"==a.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==a.CLASS_NAME){for(b=0,c=this.components.length;b<c&&!(d=a.intersects(this.components[b]));++b);if(!d)for(b=0,c=a.components.length;b<c&&!(d=this.containsPoint(a.components[b]));++b);}else for(b=0,c=a.components.length;b<c&&!(d=this.intersects(a.components[b]));++b);if(!d&&"OpenLayers.Geometry.Polygon"==a.CLASS_NAME){var e=this.components[0];for(b=0,c=e.components.length;b<c&&!(d=a.containsPoint(e.components[b]));++b);}return d},distanceTo:function(a,b){var c=!(b&&!1===b.edge);return!c&&this.intersects(a)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[a,b])},CLASS_NAME:"OpenLayers.Geometry.Polygon"}),OpenLayers.Geometry.Polygon.createRegularPolygon=function(a,b,c,d){var e=Math.PI*(1/c-.5);d&&(e+=d/180*Math.PI);for(var f,g,h,i=[],j=0;j<c;++j)f=e+2*j*Math.PI/c,g=a.x+b*Math.cos(f),h=a.y+b*Math.sin(f),i.push(new OpenLayers.Geometry.Point(g,h));var k=new OpenLayers.Geometry.LinearRing(i);return new OpenLayers.Geometry.Polygon([k])},OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(a){return a.target||a.srcElement},isSingleTouch:function(a){return a.touches&&1==a.touches.length},isMultiTouch:function(a){return a.touches&&a.touches.length>1},isLeftClick:function(a){return a.which&&1==a.which||a.button&&1==a.button},isRightClick:function(a){return a.which&&3==a.which||a.button&&2==a.button},stop:function(a,b){b||OpenLayers.Event.preventDefault(a),a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},findElement:function(a,b){for(var c=OpenLayers.Event.element(a);c.parentNode&&(!c.tagName||c.tagName.toUpperCase()!=b.toUpperCase());)c=c.parentNode;return c},observe:function(a,b,c,d){var e=OpenLayers.Util.getElement(a);if(d=d||!1,"keypress"==b&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||e.attachEvent)&&(b="keydown"),this.observers||(this.observers={}),!e._eventCacheID){var f="eventCacheID_";e.id&&(f=e.id+"_"+f),e._eventCacheID=OpenLayers.Util.createUniqueID(f)}var g=e._eventCacheID;this.observers[g]||(this.observers[g]=[]),this.observers[g].push({element:e,name:b,observer:c,useCapture:d}),e.addEventListener?e.addEventListener(b,c,d):e.attachEvent&&e.attachEvent("on"+b,c)},stopObservingElement:function(a){var b=OpenLayers.Util.getElement(a),c=b._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[c])},_removeElementObservers:function(a){if(a)for(var b=a.length-1;b>=0;b--){var c=a[b];OpenLayers.Event.stopObserving.apply(this,[c.element,c.name,c.observer,c.useCapture])}},stopObserving:function(a,b,c,d){d=d||!1;var e=OpenLayers.Util.getElement(a),f=e._eventCacheID;"keypress"==b&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||e.detachEvent)&&(b="keydown");var g=!1,h=OpenLayers.Event.observers[f];if(h)for(var i=0;!g&&i<h.length;){var j=h[i];if(j.name==b&&j.observer==c&&j.useCapture==d){h.splice(i,1),0==h.length&&delete OpenLayers.Event.observers[f],g=!0;break}i++}return g&&(e.removeEventListener?e.removeEventListener(b,c,d):e&&e.detachEvent&&e.detachEvent("on"+b,c)),g},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var a in OpenLayers.Event.observers){var b=OpenLayers.Event.observers[a];OpenLayers.Event._removeElementObservers.apply(this,[b])}OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"},OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1),OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown"],listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(a,b,c,d,e){OpenLayers.Util.extend(this,e),this.object=a,this.fallThrough=d,this.listeners={},this.extensions={},this.extensionCount={},this._msTouches=[],null!=b&&this.attachToElement(b)},destroy:function(){for(var a in this.extensions)"boolean"!=typeof this.extensions[a]&&this.extensions[a].destroy();this.extensions=null,this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)),this.element=null,this.listeners=null,this.object=null,this.fallThrough=null,this.eventHandler=null},addEventType:function(a){},attachToElement:function(a){this.element?OpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this)),this.element=a;for(var b,c=!!window.navigator.msMaxTouchPoints,d=0,e=this.BROWSER_EVENTS.length;d<e;d++)b=this.BROWSER_EVENTS[d],OpenLayers.Event.observe(a,b,this.eventHandler),c&&0===b.indexOf("touch")&&this.addMsTouchListener(a,b,this.eventHandler);OpenLayers.Event.observe(a,"dragstart",OpenLayers.Event.stop)},on:function(a){for(var b in a)"scope"!=b&&a.hasOwnProperty(b)&&this.register(b,a.scope,a[b])},register:function(a,b,c,d){if(a in OpenLayers.Events&&!this.extensions[a]&&(this.extensions[a]=new OpenLayers.Events[a](this)),null!=c){null==b&&(b=this.object);var e=this.listeners[a];e||(e=[],this.listeners[a]=e,this.extensionCount[a]=0);var f={obj:b,func:c};d?(e.splice(this.extensionCount[a],0,f),"object"==typeof d&&d.extension&&this.extensionCount[a]++):e.push(f)}},registerPriority:function(a,b,c){this.register(a,b,c,!0)},un:function(a){for(var b in a)"scope"!=b&&a.hasOwnProperty(b)&&this.unregister(b,a.scope,a[b])},unregister:function(a,b,c){null==b&&(b=this.object);var d=this.listeners[a];if(null!=d)for(var e=0,f=d.length;e<f;e++)if(d[e].obj==b&&d[e].func==c){d.splice(e,1);break}},remove:function(a){null!=this.listeners[a]&&(this.listeners[a]=[])},triggerEvent:function(a,b){var c=this.listeners[a];if(c&&0!=c.length){null==b&&(b={}),b.object=this.object,b.element=this.element,b.type||(b.type=a),c=c.slice();for(var d,e=0,f=c.length;e<f;e++){var g=c[e];if(void 0!=(d=g.func.apply(g.obj,[b]))&&0==d)break}return this.fallThrough||OpenLayers.Event.stop(b,!0),d}},handleBrowserEvent:function(a){var b=a.type,c=this.listeners[b];if(c&&0!=c.length){var d=a.touches;if(d&&d[0]){for(var e,f=0,g=0,h=d.length,i=0;i<h;++i)e=this.getTouchClientXY(d[i]),f+=e.clientX,g+=e.clientY;a.clientX=f/h,a.clientY=g/h}this.includeXY&&(a.xy=this.getMousePosition(a)),this.triggerEvent(b,a)}},getTouchClientXY:function(a){var b=window.olMockWin||window,c=b.pageXOffset,d=b.pageYOffset,e=a.clientX,f=a.clientY;return 0===a.pageY&&Math.floor(f)>Math.floor(a.pageY)||0===a.pageX&&Math.floor(e)>Math.floor(a.pageX)?(e-=c,f-=d):(f<a.pageY-d||e<a.pageX-c)&&(e=a.pageX-c,f=a.pageY-d),a.olClientX=e,a.olClientY=f,{clientX:e,clientY:f}},clearMouseCache:function(){this.element.scrolls=null,this.element.lefttop=null,this.element.offsets=null},getMousePosition:function(a){if(this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache(),!this.element.scrolls){var b=OpenLayers.Util.getViewportElement();this.element.scrolls=[window.pageXOffset||b.scrollLeft,window.pageYOffset||b.scrollTop]}return this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element)),new OpenLayers.Pixel(a.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],a.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},addMsTouchListener:function(a,b,c){function d(a){c(OpenLayers.Util.applyDefaults({stopPropagation:function(){for(var a=e.length-1;a>=0;--a)e[a].stopPropagation()},preventDefault:function(){for(var a=e.length-1;a>=0;--a)e[a].preventDefault()},type:b},a))}var e=(this.eventHandler,this._msTouches);switch(b){case"touchstart":return this.addMsTouchListenerStart(a,b,d);case"touchend":return this.addMsTouchListenerEnd(a,b,d);case"touchmove":return this.addMsTouchListenerMove(a,b,d);default:throw"Unknown touch event type"}},addMsTouchListenerStart:function(a,b,c){var d=this._msTouches,e=function(a){for(var b=!1,e=0,f=d.length;e<f;++e)if(d[e].pointerId==a.pointerId){b=!0;break}b||d.push(a),a.touches=d.slice(),c(a)};OpenLayers.Event.observe(a,"MSPointerDown",e);var f=function(a){for(var b=0,c=d.length;b<c;++b)if(d[b].pointerId==a.pointerId){d.splice(b,1);break}};OpenLayers.Event.observe(a,"MSPointerUp",f)},addMsTouchListenerMove:function(a,b,c){var d=this._msTouches,e=function(a){if(!(a.pointerType==a.MSPOINTER_TYPE_MOUSE&&0==a.buttons||1==d.length&&d[0].pageX==a.pageX&&d[0].pageY==a.pageY)){for(var b=0,e=d.length;b<e;++b)if(d[b].pointerId==a.pointerId){d[b]=a;break}a.touches=d.slice(),c(a)}};OpenLayers.Event.observe(a,"MSPointerMove",e)},addMsTouchListenerEnd:function(a,b,c){var d=this._msTouches,e=function(a){for(var b=0,e=d.length;b<e;++b)if(d[b].pointerId==a.pointerId){d.splice(b,1);break}a.touches=d.slice(),c(a)};OpenLayers.Event.observe(a,"MSPointerUp",e)},CLASS_NAME:"OpenLayers.Events"}),OpenLayers.ProxyHost="",OpenLayers.Request||(OpenLayers.Request={}),OpenLayers.Util.extend(OpenLayers.Request,{DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(a,b){var c=0!==a.indexOf("http"),d=!c&&a.match(this.URL_SPLIT_REGEX);if(d){var e=window.location;c=d[1]==e.protocol&&d[3]==e.hostname;var f=d[4],g=e.port;(80!=f&&""!=f||"80"!=g&&""!=g)&&(c=c&&f==g)}return c||b&&(a="function"==typeof b?b(a):b+encodeURIComponent(a)),a},issue:function(a){var b=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});a=a||{},a.headers=a.headers||{},a=OpenLayers.Util.applyDefaults(a,b),a.headers=OpenLayers.Util.applyDefaults(a.headers,b.headers);var c,d=!1;for(c in a.headers)a.headers.hasOwnProperty(c)&&"x-requested-with"===c.toLowerCase()&&(d=!0);!1===d&&(a.headers["X-Requested-With"]="XMLHttpRequest");var e=new OpenLayers.Request.XMLHttpRequest,f=OpenLayers.Util.urlAppend(a.url,OpenLayers.Util.getParameterString(a.params||{}));f=OpenLayers.Request.makeSameOrigin(f,a.proxy),e.open(a.method,f,a.async,a.user,a.password);for(var g in a.headers)e.setRequestHeader(g,a.headers[g]);var h=this.events,i=this;return e.onreadystatechange=function(){if(e.readyState==OpenLayers.Request.XMLHttpRequest.DONE){!1!==h.triggerEvent("complete",{request:e,config:a,requestUrl:f})&&i.runCallbacks({request:e,config:a,requestUrl:f})}},!1===a.async?e.send(a.data):window.setTimeout(function(){0!==e.readyState&&e.send(a.data)},0),e},runCallbacks:function(a){var b,c=a.request,d=a.config,e=d.scope?OpenLayers.Function.bind(d.callback,d.scope):d.callback;d.success&&(b=d.scope?OpenLayers.Function.bind(d.success,d.scope):d.success);var f;d.failure&&(f=d.scope?OpenLayers.Function.bind(d.failure,d.scope):d.failure),"file:"==OpenLayers.Util.createUrlObject(d.url).protocol&&c.responseText&&(c.status=200),e(c),(!c.status||c.status>=200&&c.status<300)&&(this.events.triggerEvent("success",a),b&&b(c)),c.status&&(c.status<200||c.status>=300)&&(this.events.triggerEvent("failure",a),f&&f(c))},GET:function(a){return a=OpenLayers.Util.extend(a,{method:"GET"}),OpenLayers.Request.issue(a)},POST:function(a){return a=OpenLayers.Util.extend(a,{method:"POST"}),a.headers=a.headers?a.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(a.headers)||(a.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(a)},PUT:function(a){return a=OpenLayers.Util.extend(a,{method:"PUT"}),a.headers=a.headers?a.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(a.headers)||(a.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(a)},DELETE:function(a){return a=OpenLayers.Util.extend(a,{method:"DELETE"}),OpenLayers.Request.issue(a)},HEAD:function(a){return a=OpenLayers.Util.extend(a,{method:"HEAD"}),OpenLayers.Request.issue(a)},OPTIONS:function(a){return a=OpenLayers.Util.extend(a,{method:"OPTIONS"}),OpenLayers.Request.issue(a)}}),function(){function a(){this._object=h&&!k?new h:new window.ActiveXObject("Microsoft.XMLHTTP"),this._listeners=[]}function b(){return new a}function c(a){if(a._object.send(a._data),i&&!a._async)for(a.readyState=b.OPENED,f(a);a.readyState<b.DONE;)if(a.readyState++,d(a),a._aborted)return}function d(a){b.onreadystatechange&&b.onreadystatechange.apply(a),a.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function e(a){var b=a.responseXML,c=a.responseText;return j&&c&&b&&!b.documentElement&&a.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)&&(b=new window.ActiveXObject("Microsoft.XMLDOM"),b.async=!1,b.validateOnParse=!1,b.loadXML(c)),b&&(j&&0!=b.parseError||!b.documentElement||b.documentElement&&"parsererror"==b.documentElement.tagName)?null:b}function f(a){try{a.responseText=a._object.responseText}catch(a){}try{a.responseXML=e(a._object)}catch(a){}try{a.status=a._object.status}catch(a){}try{a.statusText=a._object.statusText}catch(a){}}function g(a){a._object.onreadystatechange=new window.Function}var h=window.XMLHttpRequest,i=!!window.controllers,j=window.document.all&&!window.opera,k=j&&window.navigator.userAgent.match(/MSIE 7.0/);b.prototype=a.prototype,i&&h.wrapped&&(b.wrapped=h.wrapped),b.UNSENT=0,b.OPENED=1,b.HEADERS_RECEIVED=2,b.LOADING=3,b.DONE=4,b.prototype.readyState=b.UNSENT,b.prototype.responseText="",b.prototype.responseXML=null,b.prototype.status=0,b.prototype.statusText="",b.prototype.priority="NORMAL",b.prototype.onreadystatechange=null,b.onreadystatechange=null,b.onopen=null,b.onsend=null,b.onabort=null,b.prototype.open=function(a,c,e,h,k){delete this._headers,arguments.length<3&&(e=!0),this._async=e;var l,m=this,n=this.readyState;j&&e&&(l=function(){n!=b.DONE&&(g(m),m.abort())},window.attachEvent("onunload",l)),b.onopen&&b.onopen.apply(this,arguments),arguments.length>4?this._object.open(a,c,e,h,k):arguments.length>3?this._object.open(a,c,e,h):this._object.open(a,c,e),this.readyState=b.OPENED,d(this),this._object.onreadystatechange=function(){if(!i||e){if(m.readyState=m._object.readyState,f(m),m._aborted)return void(m.readyState=b.UNSENT);m.readyState==b.DONE&&(delete m._data,g(m),j&&e&&window.detachEvent("onunload",l)),n!=m.readyState&&d(m),n=m.readyState}}},b.prototype.send=function(a){b.onsend&&b.onsend.apply(this,arguments),arguments.length||(a=null),a&&a.nodeType&&(a=window.XMLSerializer?(new window.XMLSerializer).serializeToString(a):a.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")),this._data=a,c(this)},b.prototype.abort=function(){b.onabort&&b.onabort.apply(this,arguments),this.readyState>b.UNSENT&&(this._aborted=!0),this._object.abort(),g(this),this.readyState=b.UNSENT,delete this._data},b.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()},b.prototype.getResponseHeader=function(a){return this._object.getResponseHeader(a)},b.prototype.setRequestHeader=function(a,b){return this._headers||(this._headers={}),this._headers[a]=b,this._object.setRequestHeader(a,b)},b.prototype.addEventListener=function(a,b,c){for(var d,e=0;d=this._listeners[e];e++)if(d[0]==a&&d[1]==b&&d[2]==c)return;this._listeners.push([a,b,c])},b.prototype.removeEventListener=function(a,b,c){for(var d,e=0;(d=this._listeners[e])&&(d[0]!=a||d[1]!=b||d[2]!=c);e++);d&&this._listeners.splice(e,1)},b.prototype.dispatchEvent=function(a){var b={type:a.type,target:this,currentTarget:this,eventPhase:2,bubbles:a.bubbles,cancelable:a.cancelable,timeStamp:a.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};"readystatechange"==b.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[b]);for(var c,d=0;c=this._listeners[d];d++)c[0]!=b.type||c[2]||(c[1].handleEvent||c[1]).apply(this,[b])},b.prototype.toString=function(){return"[object XMLHttpRequest]"},b.toString=function(){return"[XMLHttpRequest]"},window.Function.prototype.apply||(window.Function.prototype.apply=function(a,b){b||(b=[]),a.__func=this,a.__func(b[0],b[1],b[2],b[3],b[4]),delete a.__func}),OpenLayers.Request||(OpenLayers.Request={}),OpenLayers.Request.XMLHttpRequest=b}(),OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(a,b){OpenLayers.Util.extend(this,b),this.projCode=a,"object"==typeof Proj4js&&(this.proj=new Proj4js.Proj(a))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(a){var b=a,c=!1;if(b)if(b instanceof OpenLayers.Projection||(b=new OpenLayers.Projection(b)),"object"==typeof Proj4js&&this.proj.defData&&b.proj.defData)c=this.proj.defData.replace(this.titleRegEx,"")==b.proj.defData.replace(this.titleRegEx,"");else if(b.getCode){var d=this.getCode(),e=b.getCode();c=d==e||!!OpenLayers.Projection.transforms[d]&&OpenLayers.Projection.transforms[d][e]===OpenLayers.Projection.nullTransform}return c},destroy:function(){delete this.proj,delete this.projCode},CLASS_NAME:"OpenLayers.Projection"}),OpenLayers.Projection.transforms={},OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}},OpenLayers.Projection.addTransform=function(a,b,c){if(c===OpenLayers.Projection.nullTransform){var d=OpenLayers.Projection.defaults[a];d&&!OpenLayers.Projection.defaults[b]&&(OpenLayers.Projection.defaults[b]=d)}OpenLayers.Projection.transforms[a]||(OpenLayers.Projection.transforms[a]={}),OpenLayers.Projection.transforms[a][b]=c},OpenLayers.Projection.transform=function(a,b,c){if(b&&c)if(b instanceof OpenLayers.Projection||(b=new OpenLayers.Projection(b)),c instanceof OpenLayers.Projection||(c=new OpenLayers.Projection(c)),b.proj&&c.proj)a=Proj4js.transform(b.proj,c.proj,a);else{var d=b.getCode(),e=c.getCode(),f=OpenLayers.Projection.transforms;f[d]&&f[d][e]&&f[d][e](a)}return a},OpenLayers.Projection.nullTransform=function(a){return a},function(){function a(a){return a.x=180*a.x/e,a.y=180/Math.PI*(2*Math.atan(Math.exp(a.y/e*Math.PI))-Math.PI/2),a}function b(a){a.x=a.x*e/180;var b=Math.log(Math.tan((90+a.y)*Math.PI/360))/Math.PI*e;return a.y=Math.max(-20037508.34,Math.min(b,20037508.34)),a}function c(c,d){var e,f,g,h,i,j=OpenLayers.Projection.addTransform,k=OpenLayers.Projection.nullTransform;for(e=0,f=d.length;e<f;++e)for(g=d[e],j(c,g,b),j(g,c,a),i=e+1;i<f;++i)h=d[i],j(g,h,k),j(h,g,k)}var d,e=20037508.34,f=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],g=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"];for(d=f.length-1;d>=0;--d)c(f[d],g);for(d=g.length-1;d>=0;--d)c(g[d],f)}(),OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date,extractAttributes:!0,kvpAttributes:!1,extractStyles:!1,extractTracks:!1,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(a){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,kmlColor:/(\w{2})(\w{2})(\w{2})(\w{2})/,kmlIconPalette:/root:\/\/icons\/palette-(\d+)(\.\w+)/,straightBracket:/\$\[(.*?)\]/g},this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){this.features=[],this.styles={},this.fetched={};var b={depth:0,styleBaseUrl:this.styleBaseUrl};return this.parseData(a,b)},parseData:function(a,b){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));for(var c=["Link","NetworkLink","Style","StyleMap","Placemark"],d=0,e=c.length;d<e;++d){var f=c[d],g=this.getElementsByTagNameNS(a,"*",f);if(0!=g.length)switch(f.toLowerCase()){case"link":case"networklink":this.parseLinks(g,b);break;case"style":this.extractStyles&&this.parseStyles(g,b);break;case"stylemap":this.extractStyles&&this.parseStyleMaps(g,b);break;case"placemark":this.parseFeatures(g,b)}}return this.features},parseLinks:function(a,b){if(b.depth>=this.maxDepth)return!1;var c=OpenLayers.Util.extend({},b);c.depth++;for(var d=0,e=a.length;d<e;d++){var f=this.parseProperty(a[d],"*","href");if(f&&!this.fetched[f]){this.fetched[f]=!0;var g=this.fetchLink(f);g&&this.parseData(g,c)}}},fetchLink:function(a){var b=OpenLayers.Request.GET({url:a,async:!1});if(b)return b.responseText},parseStyles:function(a,b){for(var c=0,d=a.length;c<d;c++){var e=this.parseStyle(a[c]);if(e){var f=(b.styleBaseUrl||"")+"#"+e.id;this.styles[f]=e}}},parseKmlColor:function(a){var b=null;if(a){var c=a.match(this.regExes.kmlColor);c&&(b={color:"#"+c[4]+c[3]+c[2],opacity:parseInt(c[1],16)/255})}return b},parseStyle:function(a){for(var b,c,d={},e=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"],f=0,g=e.length;f<g;++f)if(b=e[f],c=this.getElementsByTagNameNS(a,"*",b)[0])switch(b.toLowerCase()){case"linestyle":var h=this.parseProperty(c,"*","color"),i=this.parseKmlColor(h);i&&(d.strokeColor=i.color,d.strokeOpacity=i.opacity);var j=this.parseProperty(c,"*","width");j&&(d.strokeWidth=j);break;case"polystyle":var h=this.parseProperty(c,"*","color"),i=this.parseKmlColor(h);i&&(d.fillOpacity=i.opacity,d.fillColor=i.color);var k=this.parseProperty(c,"*","fill");"0"==k&&(d.fillColor="none");var l=this.parseProperty(c,"*","outline");"0"==l&&(d.strokeWidth="0");break;case"iconstyle":var m=parseFloat(this.parseProperty(c,"*","scale")||1),j=32*m,n=32*m,o=this.getElementsByTagNameNS(c,"*","Icon")[0];if(o){var p=this.parseProperty(o,"*","href");if(p){var q=this.parseProperty(o,"*","w"),r=this.parseProperty(o,"*","h");!OpenLayers.String.startsWith(p,"http://maps.google.com/mapfiles/kml")||q||r||(q=64,r=64,m/=2),q=q||r,r=r||q,q&&(j=parseInt(q)*m),r&&(n=parseInt(r)*m);var s=p.match(this.regExes.kmlIconPalette);if(s){var t=s[1],u=s[2],v=this.parseProperty(o,"*","x"),w=this.parseProperty(o,"*","y"),x=v?v/32:0,y=w?7-w/32:7,z=8*y+x;p="http://maps.google.com/mapfiles/kml/pal"+t+"/icon"+z+u}d.graphicOpacity=1,d.externalGraphic=p}}var A=this.getElementsByTagNameNS(c,"*","hotSpot")[0];if(A){var v=parseFloat(A.getAttribute("x")),w=parseFloat(A.getAttribute("y")),B=A.getAttribute("xunits");"pixels"==B?d.graphicXOffset=-v*m:"insetPixels"==B?d.graphicXOffset=v*m-j:"fraction"==B&&(d.graphicXOffset=-j*v);var C=A.getAttribute("yunits");"pixels"==C?d.graphicYOffset=w*m-n+1:"insetPixels"==C?d.graphicYOffset=-w*m+1:"fraction"==C&&(d.graphicYOffset=-n*(1-w)+1)}d.graphicWidth=j,d.graphicHeight=n;break;case"balloonstyle":var D=OpenLayers.Util.getXmlNodeValue(c);D&&(d.balloonStyle=D.replace(this.regExes.straightBracket,"${$1}"));break;case"labelstyle":var h=this.parseProperty(c,"*","color"),i=this.parseKmlColor(h);i&&(d.fontColor=i.color,d.fontOpacity=i.opacity)}!d.strokeColor&&d.fillColor&&(d.strokeColor=d.fillColor);var E=a.getAttribute("id");return E&&d&&(d.id=E),d},parseStyleMaps:function(a,b){for(var c=0,d=a.length;c<d;c++)for(var e=a[c],f=this.getElementsByTagNameNS(e,"*","Pair"),g=e.getAttribute("id"),h=0,i=f.length;h<i;h++){var j=f[h],k=this.parseProperty(j,"*","key"),l=this.parseProperty(j,"*","styleUrl");l&&"normal"==k&&(this.styles[(b.styleBaseUrl||"")+"#"+g]=this.styles[(b.styleBaseUrl||"")+l])}},parseFeatures:function(a,b){for(var c=[],d=0,e=a.length;d<e;d++){var f=a[d],g=this.parseFeature.apply(this,[f]);if(!g)throw"Bad Placemark: "+d;if(this.extractStyles&&g.attributes&&g.attributes.styleUrl&&(g.style=this.getStyle(g.attributes.styleUrl,b)),this.extractStyles){var h=this.getElementsByTagNameNS(f,"*","Style")[0];if(h){var i=this.parseStyle(h);i&&(g.style=OpenLayers.Util.extend(g.style,i))}}if(this.extractTracks){var j=this.getElementsByTagNameNS(f,this.namespaces.gx,"Track");if(j&&j.length>0){var k=j[0],l={features:[],feature:g};this.readNode(k,l),l.features.length>0&&c.push.apply(c,l.features)}}else c.push(g)}this.features=this.features.concat(c)},readers:{kml:{when:function(a,b){b.whens.push(OpenLayers.Date.parse(this.getChildValue(a)))},_trackPointAttribute:function(a,b){var c=a.nodeName.split(":").pop();b.attributes[c].push(this.getChildValue(a))}},gx:{Track:function(a,b){var c={whens:[],points:[],angles:[]};if(this.trackAttributes){var d;c.attributes={};for(var e=0,f=this.trackAttributes.length;e<f;++e)d=this.trackAttributes[e],c.attributes[d]=[],d in this.readers.kml||(this.readers.kml[d]=this.readers.kml._trackPointAttribute)}if(this.readChildNodes(a,c),c.whens.length!==c.points.length)throw new Error("gx:Track with unequal number of when ("+c.whens.length+") and gx:coord ("+c.points.length+") elements.");var g=c.angles.length>0;if(g&&c.whens.length!==c.angles.length)throw new Error("gx:Track with unequal number of when ("+c.whens.length+") and gx:angles ("+c.angles.length+") elements.");for(var h,i,j,e=0,f=c.whens.length;e<f;++e){if(h=b.feature.clone(),h.fid=b.feature.fid||b.feature.id,i=c.points[e],h.geometry=i,"z"in i&&(h.attributes.altitude=i.z),this.internalProjection&&this.externalProjection&&h.geometry.transform(this.externalProjection,this.internalProjection),this.trackAttributes)for(var k=0,l=this.trackAttributes.length;k<l;++k){var d=this.trackAttributes[k];h.attributes[d]=c.attributes[d][e]}h.attributes.when=c.whens[e],h.attributes.trackId=b.feature.id,g&&(j=c.angles[e],h.attributes.heading=parseFloat(j[0]),h.attributes.tilt=parseFloat(j[1]),h.attributes.roll=parseFloat(j[2])),b.features.push(h)}},coord:function(a,b){var c=this.getChildValue(a),d=c.replace(this.regExes.trimSpace,"").split(/\s+/),e=new OpenLayers.Geometry.Point(d[0],d[1]);d.length>2&&(e.z=parseFloat(d[2])),b.points.push(e)},angles:function(a,b){var c=this.getChildValue(a),d=c.replace(this.regExes.trimSpace,"").split(/\s+/);b.angles.push(d)}}},parseFeature:function(a){for(var b,c,d,e,f=["MultiGeometry","Polygon","LineString","Point"],g=0,h=f.length;g<h;++g)if(b=f[g],this.internalns=a.namespaceURI?a.namespaceURI:this.kmlns,c=this.getElementsByTagNameNS(a,this.internalns,b),c.length>0){var e=this.parseGeometry[b.toLowerCase()];if(!e)throw new TypeError("Unsupported geometry type: "+b);d=e.apply(this,[c[0]]),this.internalProjection&&this.externalProjection&&d.transform(this.externalProjection,this.internalProjection);break}var i;this.extractAttributes&&(i=this.parseAttributes(a));var j=new OpenLayers.Feature.Vector(d,i),k=a.getAttribute("id")||a.getAttribute("name");return null!=k&&(j.fid=k),j},getStyle:function(a,b){var c=OpenLayers.Util.removeTail(a),d=OpenLayers.Util.extend({},b);if(d.depth++,d.styleBaseUrl=c,!this.styles[a]&&!OpenLayers.String.startsWith(a,"#")&&d.depth<=this.maxDepth&&!this.fetched[c]){var e=this.fetchLink(c);e&&this.parseData(e,d)}return OpenLayers.Util.extend({},this.styles[a])},parseGeometry:{point:function(a){var b=this.getElementsByTagNameNS(a,this.internalns,"coordinates"),c=[];if(b.length>0){var d=b[0].firstChild.nodeValue;d=d.replace(this.regExes.removeSpace,""),c=d.split(",")}if(!(c.length>1))throw"Bad coordinate string: "+d;return 2==c.length&&(c[2]=null),new OpenLayers.Geometry.Point(c[0],c[1],c[2])},linestring:function(a,b){var c=this.getElementsByTagNameNS(a,this.internalns,"coordinates"),d=null;if(c.length>0){var e=this.getChildValue(c[0]);e=e.replace(this.regExes.trimSpace,""),e=e.replace(this.regExes.trimComma,",");for(var f,g=e.split(this.regExes.splitSpace),h=g.length,i=new Array(h),j=0;j<h;++j){if(f=g[j].split(","),!(f.length>1))throw"Bad LineString point coordinates: "+g[j];2==f.length&&(f[2]=null),i[j]=new OpenLayers.Geometry.Point(f[0],f[1],f[2])}if(!h)throw"Bad LineString coordinates: "+e;d=b?new OpenLayers.Geometry.LinearRing(i):new OpenLayers.Geometry.LineString(i)}return d},polygon:function(a){var b=this.getElementsByTagNameNS(a,this.internalns,"LinearRing"),c=b.length,d=new Array(c);if(c>0)for(var e,f=0,g=b.length;f<g;++f){if(!(e=this.parseGeometry.linestring.apply(this,[b[f],!0])))throw"Bad LinearRing geometry: "+f;d[f]=e}return new OpenLayers.Geometry.Polygon(d)},multigeometry:function(a){for(var b,c,d=[],e=a.childNodes,f=0,g=e.length;f<g;++f)if(b=e[f],1==b.nodeType){var h=b.prefix?b.nodeName.split(":")[1]:b.nodeName,c=this.parseGeometry[h.toLowerCase()];c&&d.push(c.apply(this,[b]))}return new OpenLayers.Geometry.Collection(d)}},parseAttributes:function(a){
var b={},c=a.getElementsByTagName("ExtendedData");c.length&&(b=this.parseExtendedData(c[0]));for(var d,e,f,g=a.childNodes,h=0,i=g.length;h<i;++h)if(d=g[h],1==d.nodeType&&(e=d.childNodes,e.length>=1&&e.length<=3)){var f;switch(e.length){case 1:f=e[0];break;case 2:var j=e[0],k=e[1];f=3==j.nodeType||4==j.nodeType?j:k;break;case 3:default:f=e[1]}if(3==f.nodeType||4==f.nodeType){var l=d.prefix?d.nodeName.split(":")[1]:d.nodeName,m=OpenLayers.Util.getXmlNodeValue(f);m&&(m=m.replace(this.regExes.trimSpace,""),b[l]=m)}}return b},parseExtendedData:function(a){var b,c,d,e,f={},g=a.getElementsByTagName("Data");for(b=0,c=g.length;b<c;b++){d=g[b],e=d.getAttribute("name");var h={},i=d.getElementsByTagName("value");if(i.length&&(h.value=this.getChildValue(i[0])),this.kvpAttributes)f[e]=h.value;else{var j=d.getElementsByTagName("displayName");j.length&&(h.displayName=this.getChildValue(j[0])),f[e]=h}}var k=a.getElementsByTagName("SimpleData");for(b=0,c=k.length;b<c;b++){var h={};d=k[b],e=d.getAttribute("name"),h.value=this.getChildValue(d),this.kvpAttributes?f[e]=h.value:(h.displayName=e,f[e]=h)}return f},parseProperty:function(a,b,c){var d,e=this.getElementsByTagNameNS(a,b,c);try{d=OpenLayers.Util.getXmlNodeValue(e[0])}catch(a){d=null}return d},write:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=this.createElementNS(this.kmlns,"kml"),c=this.createFolderXML(),d=0,e=a.length;d<e;++d)c.appendChild(this.createPlacemarkXML(a[d]));return b.appendChild(c),OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFolderXML:function(){var a=this.createElementNS(this.kmlns,"Folder");if(this.foldersName){var b=this.createElementNS(this.kmlns,"name"),c=this.createTextNode(this.foldersName);b.appendChild(c),a.appendChild(b)}if(this.foldersDesc){var d=this.createElementNS(this.kmlns,"description"),e=this.createTextNode(this.foldersDesc);d.appendChild(e),a.appendChild(d)}return a},createPlacemarkXML:function(a){var b=this.createElementNS(this.kmlns,"name"),c=a.style&&a.style.label?a.style.label:a.id,d=a.attributes.name||c;b.appendChild(this.createTextNode(d));var e=this.createElementNS(this.kmlns,"description"),f=a.attributes.description||this.placemarksDesc;e.appendChild(this.createTextNode(f));var g=this.createElementNS(this.kmlns,"Placemark");null!=a.fid&&g.setAttribute("id",a.fid),g.appendChild(b),g.appendChild(e);var h=this.buildGeometryNode(a.geometry);if(g.appendChild(h),a.attributes){var i=this.buildExtendedData(a.attributes);i&&g.appendChild(i)}return g},buildGeometryNode:function(a){var b=a.CLASS_NAME,c=b.substring(b.lastIndexOf(".")+1),d=this.buildGeometry[c.toLowerCase()],e=null;return d&&(e=d.apply(this,[a])),e},buildGeometry:{point:function(a){var b=this.createElementNS(this.kmlns,"Point");return b.appendChild(this.buildCoordinatesNode(a)),b},multipoint:function(a){return this.buildGeometry.collection.apply(this,[a])},linestring:function(a){var b=this.createElementNS(this.kmlns,"LineString");return b.appendChild(this.buildCoordinatesNode(a)),b},multilinestring:function(a){return this.buildGeometry.collection.apply(this,[a])},linearring:function(a){var b=this.createElementNS(this.kmlns,"LinearRing");return b.appendChild(this.buildCoordinatesNode(a)),b},polygon:function(a){for(var b,c,d,e=this.createElementNS(this.kmlns,"Polygon"),f=a.components,g=0,h=f.length;g<h;++g)d=0==g?"outerBoundaryIs":"innerBoundaryIs",b=this.createElementNS(this.kmlns,d),c=this.buildGeometry.linearring.apply(this,[f[g]]),b.appendChild(c),e.appendChild(b);return e},multipolygon:function(a){return this.buildGeometry.collection.apply(this,[a])},collection:function(a){for(var b,c=this.createElementNS(this.kmlns,"MultiGeometry"),d=0,e=a.components.length;d<e;++d)(b=this.buildGeometryNode.apply(this,[a.components[d]]))&&c.appendChild(b);return c}},buildCoordinatesNode:function(a){var b,c=this.createElementNS(this.kmlns,"coordinates"),d=a.components;if(d){for(var e,f=d.length,g=new Array(f),h=0;h<f;++h)e=d[h],g[h]=this.buildCoordinates(e);b=g.join(" ")}else b=this.buildCoordinates(a);var i=this.createTextNode(b);return c.appendChild(i),c},buildCoordinates:function(a){return this.internalProjection&&this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection)),a.x+","+a.y},buildExtendedData:function(a){var b=this.createElementNS(this.kmlns,"ExtendedData");for(var c in a)if(a[c]&&"name"!=c&&"description"!=c&&"styleUrl"!=c){var d=this.createElementNS(this.kmlns,"Data");d.setAttribute("name",c);var e=this.createElementNS(this.kmlns,"value");if("object"==typeof a[c]){if(a[c].value&&e.appendChild(this.createTextNode(a[c].value)),a[c].displayName){var f=this.createElementNS(this.kmlns,"displayName");f.appendChild(this.getXMLDoc().createCDATASection(a[c].displayName)),d.appendChild(f)}}else e.appendChild(this.createTextNode(a[c]));d.appendChild(e),b.appendChild(d)}return this.isSimpleContent(b)?null:b},CLASS_NAME:"OpenLayers.Format.KML"}),OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(a,b){for(var c,d,e,f,g,h=null,i=b&&b.mutual,j=[],k=[a],l=0,m=this.components.length;l<m;++l){d=this.components[l],f=!1;for(var n=0;n<k.length;++n)if(c=d.split(k[n],b)){if(i){e=c[0];for(var o=0,p=e.length;o<p;++o)0===o&&j.length?j[j.length-1].addComponent(e[o]):j.push(new OpenLayers.Geometry.MultiLineString([e[o]]));f=!0,c=c[1]}if(c.length){c.unshift(n,1),Array.prototype.splice.apply(k,c);break}}f||(j.length?j[j.length-1].addComponent(d.clone()):j=[new OpenLayers.Geometry.MultiLineString(d.clone())])}return j&&j.length>1?f=!0:j=[],k&&k.length>1?g=!0:k=[],(f||g)&&(h=i?[j,k]:k),h},splitWith:function(a,b){var c,d,e,f,g,h,i,j=null,k=b&&b.mutual;if(a instanceof OpenLayers.Geometry.LineString){i=[],h=[a];for(var l=0,m=this.components.length;l<m;++l){g=!1,d=this.components[l];for(var n=0;n<h.length;++n)if(c=h[n].split(d,b)){k&&(e=c[0],e.length&&(e.unshift(n,1),Array.prototype.splice.apply(h,e),n+=e.length-2),c=c[1],0===c.length&&(c=[d.clone()]));for(var o=0,p=c.length;o<p;++o)0===o&&i.length?i[i.length-1].addComponent(c[o]):i.push(new OpenLayers.Geometry.MultiLineString([c[o]]));g=!0}g||(i.length?i[i.length-1].addComponent(d.clone()):i=[new OpenLayers.Geometry.MultiLineString([d.clone()])])}}else j=a.split(this);return h&&h.length>1?f=!0:h=[],i&&i.length>1?g=!0:i=[],(f||g)&&(j=k?[h,i]:i),j},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"}),OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"}),OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(a){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));for(var b=this.getElementsByTagNameNS(a.documentElement,this.gmlns,this.featureName),c=[],d=0;d<b.length;d++){var e=this.parseFeature(b[d]);e&&c.push(e)}return c},parseFeature:function(a){for(var b,c,d,e,f=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"],g=0;g<f.length;++g)if(b=f[g],c=this.getElementsByTagNameNS(a,this.gmlns,b),c.length>0){if(!(e=this.parseGeometry[b.toLowerCase()]))throw new TypeError("Unsupported geometry type: "+b);d=e.apply(this,[c[0]]),this.internalProjection&&this.externalProjection&&d.transform(this.externalProjection,this.internalProjection);break}var h,i=this.getElementsByTagNameNS(a,this.gmlns,"Box");for(g=0;g<i.length;++g){var j=i[g],k=this.parseGeometry.box.apply(this,[j]),l=j.parentNode;"boundedBy"===(l.localName||l.nodeName.split(":").pop())?h=k:d=k.toGeometry()}var m;this.extractAttributes&&(m=this.parseAttributes(a));var n=new OpenLayers.Feature.Vector(d,m);n.bounds=h,n.gml={featureType:a.firstChild.nodeName.split(":")[1],featureNS:a.firstChild.namespaceURI,featureNSPrefix:a.firstChild.prefix};for(var o,p=a.firstChild;p&&(1!=p.nodeType||!(o=p.getAttribute("fid")||p.getAttribute("id")));)p=p.nextSibling;return n.fid=o,n},parseGeometry:{point:function(a){var b,c,d=[],b=this.getElementsByTagNameNS(a,this.gmlns,"pos");if(b.length>0&&(c=b[0].firstChild.nodeValue,c=c.replace(this.regExes.trimSpace,""),d=c.split(this.regExes.splitSpace)),0==d.length&&(b=this.getElementsByTagNameNS(a,this.gmlns,"coordinates"),b.length>0&&(c=b[0].firstChild.nodeValue,c=c.replace(this.regExes.removeSpace,""),d=c.split(","))),0==d.length&&(b=this.getElementsByTagNameNS(a,this.gmlns,"coord"),b.length>0)){var e=this.getElementsByTagNameNS(b[0],this.gmlns,"X"),f=this.getElementsByTagNameNS(b[0],this.gmlns,"Y");e.length>0&&f.length>0&&(d=[e[0].firstChild.nodeValue,f[0].firstChild.nodeValue])}return 2==d.length&&(d[2]=null),this.xy?new OpenLayers.Geometry.Point(d[0],d[1],d[2]):new OpenLayers.Geometry.Point(d[1],d[0],d[2])},multipoint:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,"Point"),c=[];if(b.length>0)for(var d,e=0;e<b.length;++e)(d=this.parseGeometry.point.apply(this,[b[e]]))&&c.push(d);return new OpenLayers.Geometry.MultiPoint(c)},linestring:function(a,b){var c,d,e=[],f=[];if(c=this.getElementsByTagNameNS(a,this.gmlns,"posList"),c.length>0){d=this.getChildValue(c[0]),d=d.replace(this.regExes.trimSpace,""),e=d.split(this.regExes.splitSpace);for(var g,h,i,j,k=parseInt(c[0].getAttribute("dimension")),l=0;l<e.length/k;++l)g=l*k,h=e[g],i=e[g+1],j=2==k?null:e[g+2],this.xy?f.push(new OpenLayers.Geometry.Point(h,i,j)):f.push(new OpenLayers.Geometry.Point(i,h,j))}if(0==e.length&&(c=this.getElementsByTagNameNS(a,this.gmlns,"coordinates"),c.length>0)){d=this.getChildValue(c[0]),d=d.replace(this.regExes.trimSpace,""),d=d.replace(this.regExes.trimComma,",");for(var m=d.split(this.regExes.splitSpace),l=0;l<m.length;++l)e=m[l].split(","),2==e.length&&(e[2]=null),this.xy?f.push(new OpenLayers.Geometry.Point(e[0],e[1],e[2])):f.push(new OpenLayers.Geometry.Point(e[1],e[0],e[2]))}var n=null;return 0!=f.length&&(n=b?new OpenLayers.Geometry.LinearRing(f):new OpenLayers.Geometry.LineString(f)),n},multilinestring:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,"LineString"),c=[];if(b.length>0)for(var d,e=0;e<b.length;++e)(d=this.parseGeometry.linestring.apply(this,[b[e]]))&&c.push(d);return new OpenLayers.Geometry.MultiLineString(c)},polygon:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,"LinearRing"),c=[];if(b.length>0)for(var d,e=0;e<b.length;++e)(d=this.parseGeometry.linestring.apply(this,[b[e],!0]))&&c.push(d);return new OpenLayers.Geometry.Polygon(c)},multipolygon:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,"Polygon"),c=[];if(b.length>0)for(var d,e=0;e<b.length;++e)(d=this.parseGeometry.polygon.apply(this,[b[e]]))&&c.push(d);return new OpenLayers.Geometry.MultiPolygon(c)},envelope:function(a){var b,c,d=[],e=this.getElementsByTagNameNS(a,this.gmlns,"lowerCorner");if(e.length>0){var f=[];if(e.length>0&&(b=e[0].firstChild.nodeValue,b=b.replace(this.regExes.trimSpace,""),f=b.split(this.regExes.splitSpace)),2==f.length&&(f[2]=null),this.xy)var g=new OpenLayers.Geometry.Point(f[0],f[1],f[2]);else var g=new OpenLayers.Geometry.Point(f[1],f[0],f[2])}var h=this.getElementsByTagNameNS(a,this.gmlns,"upperCorner");if(h.length>0){var f=[];if(h.length>0&&(b=h[0].firstChild.nodeValue,b=b.replace(this.regExes.trimSpace,""),f=b.split(this.regExes.splitSpace)),2==f.length&&(f[2]=null),this.xy)var i=new OpenLayers.Geometry.Point(f[0],f[1],f[2]);else var i=new OpenLayers.Geometry.Point(f[1],f[0],f[2])}if(g&&i){d.push(new OpenLayers.Geometry.Point(g.x,g.y)),d.push(new OpenLayers.Geometry.Point(i.x,g.y)),d.push(new OpenLayers.Geometry.Point(i.x,i.y)),d.push(new OpenLayers.Geometry.Point(g.x,i.y)),d.push(new OpenLayers.Geometry.Point(g.x,g.y));var j=new OpenLayers.Geometry.LinearRing(d);c=new OpenLayers.Geometry.Polygon([j])}return c},box:function(a){var b,c,d=this.getElementsByTagNameNS(a,this.gmlns,"coordinates"),e=null,f=null;if(d.length>0&&(b=d[0].firstChild.nodeValue,c=b.split(" "),2==c.length&&(e=c[0].split(","),f=c[1].split(","))),null!==e&&null!==f)return new OpenLayers.Bounds(parseFloat(e[0]),parseFloat(e[1]),parseFloat(f[0]),parseFloat(f[1]))}},parseAttributes:function(a){for(var b,c,d,e,f,g,h,i={},j=a.firstChild;j;){if(1==j.nodeType){for(b=j.childNodes,c=0;c<b.length;++c)d=b[c],1==d.nodeType&&(e=d.childNodes,1==e.length?(f=e[0],3!=f.nodeType&&4!=f.nodeType||(g=d.prefix?d.nodeName.split(":")[1]:d.nodeName,h=f.nodeValue.replace(this.regExes.trimSpace,""),i[g]=h)):i[d.nodeName.split(":").pop()]=null);break}j=j.nextSibling}return i},write:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),c=0;c<a.length;c++)b.appendChild(this.createFeatureXML(a[c]));return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(a){var b=a.geometry,c=this.buildGeometryNode(b),d=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);d.appendChild(c);var e=this.createElementNS(this.gmlns,"gml:"+this.featureName),f=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName),g=a.fid||a.id;f.setAttribute("fid",g),f.appendChild(d);for(var h in a.attributes){var i=this.createTextNode(a.attributes[h]),j=h.substring(h.lastIndexOf(":")+1),k=this.createElementNS(this.featureNS,this.featurePrefix+":"+j);k.appendChild(i),f.appendChild(k)}return e.appendChild(f),e},buildGeometryNode:function(a){this.externalProjection&&this.internalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var b=a.CLASS_NAME,c=b.substring(b.lastIndexOf(".")+1);return this.buildGeometry[c.toLowerCase()].apply(this,[a])},buildGeometry:{point:function(a){var b=this.createElementNS(this.gmlns,"gml:Point");return b.appendChild(this.buildCoordinatesNode(a)),b},multipoint:function(a){for(var b,c,d=this.createElementNS(this.gmlns,"gml:MultiPoint"),e=a.components,f=0;f<e.length;f++)b=this.createElementNS(this.gmlns,"gml:pointMember"),c=this.buildGeometry.point.apply(this,[e[f]]),b.appendChild(c),d.appendChild(b);return d},linestring:function(a){var b=this.createElementNS(this.gmlns,"gml:LineString");return b.appendChild(this.buildCoordinatesNode(a)),b},multilinestring:function(a){for(var b,c,d=this.createElementNS(this.gmlns,"gml:MultiLineString"),e=a.components,f=0;f<e.length;++f)b=this.createElementNS(this.gmlns,"gml:lineStringMember"),c=this.buildGeometry.linestring.apply(this,[e[f]]),b.appendChild(c),d.appendChild(b);return d},linearring:function(a){var b=this.createElementNS(this.gmlns,"gml:LinearRing");return b.appendChild(this.buildCoordinatesNode(a)),b},polygon:function(a){for(var b,c,d,e=this.createElementNS(this.gmlns,"gml:Polygon"),f=a.components,g=0;g<f.length;++g)d=0==g?"outerBoundaryIs":"innerBoundaryIs",b=this.createElementNS(this.gmlns,"gml:"+d),c=this.buildGeometry.linearring.apply(this,[f[g]]),b.appendChild(c),e.appendChild(b);return e},multipolygon:function(a){for(var b,c,d=this.createElementNS(this.gmlns,"gml:MultiPolygon"),e=a.components,f=0;f<e.length;++f)b=this.createElementNS(this.gmlns,"gml:polygonMember"),c=this.buildGeometry.polygon.apply(this,[e[f]]),b.appendChild(c),d.appendChild(b);return d},bounds:function(a){var b=this.createElementNS(this.gmlns,"gml:Box");return b.appendChild(this.buildCoordinatesNode(a)),b}},buildCoordinatesNode:function(a){var b=this.createElementNS(this.gmlns,"gml:coordinates");b.setAttribute("decimal","."),b.setAttribute("cs",","),b.setAttribute("ts"," ");var c=[];if(a instanceof OpenLayers.Bounds)c.push(a.left+","+a.bottom),c.push(a.right+","+a.top);else for(var d=a.components?a.components:[a],e=0;e<d.length;e++)c.push(d[e].x+","+d[e].y);var f=this.createTextNode(c.join(" "));return b.appendChild(f),b},CLASS_NAME:"OpenLayers.Format.GML"}),OpenLayers.Format.GML||(OpenLayers.Format.GML={}),OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]),this.setGeometryTypes(),a&&a.featureNS&&this.setNamespace("feature",a.featureNS),this.singleFeatureType=!a||"string"==typeof a.featureType},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b=[];if(this.readNode(a,{features:b},!0),0==b.length){var c=this.getElementsByTagNameNS(a,this.namespaces.gml,"featureMember");if(c.length)for(var d=0,e=c.length;d<e;++d)this.readNode(c[d],{features:b},!0);else{var c=this.getElementsByTagNameNS(a,this.namespaces.gml,"featureMembers");c.length&&this.readNode(c[0],{features:b},!0)}}return b},readNode:function(a,b,c){return!0===c&&!0===this.autoConfig&&(this.featureType=null,delete this.namespaceAlias[this.featureNS],delete this.namespaces.feature,this.featureNS=null),this.featureNS||a.prefix in this.namespaces||a.parentNode.namespaceURI!=this.namespaces.gml||!this.regExes.featureMember.test(a.parentNode.nodeName)||(this.featureType=a.nodeName.split(":").pop(),this.setNamespace("feature",a.namespaceURI),this.featureNS=a.namespaceURI,this.autoConfig=!0),OpenLayers.Format.XML.prototype.readNode.apply(this,[a,b])},readers:{gml:{_inherit:function(a,b,c){},featureMember:function(a,b){this.readChildNodes(a,b)},featureMembers:function(a,b){this.readChildNodes(a,b)},name:function(a,b){b.name=this.getChildValue(a)},boundedBy:function(a,b){var c={};this.readChildNodes(a,c),c.components&&c.components.length>0&&(b.bounds=c.components[0])},Point:function(a,b){var c={points:[]};this.readChildNodes(a,c),b.components||(b.components=[]),b.components.push(c.points[0])},coordinates:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,"");c=c.replace(this.regExes.trimComma,",");for(var d,e=c.split(this.regExes.splitSpace),f=e.length,g=new Array(f),h=0;h<f;++h)d=e[h].split(","),this.xy?g[h]=new OpenLayers.Geometry.Point(d[0],d[1],d[2]):g[h]=new OpenLayers.Geometry.Point(d[1],d[0],d[2]);b.points=g},coord:function(a,b){var c={};this.readChildNodes(a,c),b.points||(b.points=[]),b.points.push(new OpenLayers.Geometry.Point(c.x,c.y,c.z))},X:function(a,b){b.x=this.getChildValue(a)},Y:function(a,b){b.y=this.getChildValue(a)},Z:function(a,b){b.z=this.getChildValue(a)},MultiPoint:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.MultiPoint(c.components)]},pointMember:function(a,b){this.readChildNodes(a,b)},LineString:function(a,b){var c={};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components||(b.components=[]),b.components.push(new OpenLayers.Geometry.LineString(c.points))},MultiLineString:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.MultiLineString(c.components)]},lineStringMember:function(a,b){this.readChildNodes(a,b)},Polygon:function(a,b){var c={outer:null,inner:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),c.inner.unshift(c.outer),b.components||(b.components=[]),b.components.push(new OpenLayers.Geometry.Polygon(c.inner))},LinearRing:function(a,b){var c={};this.readers.gml._inherit.apply(this,[a,c]),this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.LinearRing(c.points)]},MultiPolygon:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.MultiPolygon(c.components)]},polygonMember:function(a,b){this.readChildNodes(a,b)},GeometryCollection:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.Collection(c.components)]},geometryMember:function(a,b){this.readChildNodes(a,b)}},feature:{"*":function(a,b){var c,d=a.localName||a.nodeName.split(":").pop();b.features?this.singleFeatureType||-1===OpenLayers.Util.indexOf(this.featureType,d)?d===this.featureType&&(c="_typeName"):c="_typeName":0==a.childNodes.length||1==a.childNodes.length&&3==a.firstChild.nodeType?this.extractAttributes&&(c="_attribute"):c="_geometry",c&&this.readers.feature[c].apply(this,[a,b])},_typeName:function(a,b){var c={components:[],attributes:{}};this.readChildNodes(a,c),c.name&&(c.attributes.name=c.name);var d=new OpenLayers.Feature.Vector(c.components[0],c.attributes);this.singleFeatureType||(d.type=a.nodeName.split(":").pop(),d.namespace=a.namespaceURI);var e=a.getAttribute("fid")||this.getAttributeNS(a,this.namespaces.gml,"id");e&&(d.fid=e),this.internalProjection&&this.externalProjection&&d.geometry&&d.geometry.transform(this.externalProjection,this.internalProjection),c.bounds&&(d.bounds=c.bounds),b.features.push(d)},_geometry:function(a,b){this.geometryName||(this.geometryName=a.nodeName.split(":").pop()),this.readChildNodes(a,b)},_attribute:function(a,b){var c=a.localName||a.nodeName.split(":").pop(),d=this.getChildValue(a);b.attributes[c]=d}},wfs:{FeatureCollection:function(a,b){this.readChildNodes(a,b)}}},write:function(a){var b;b=OpenLayers.Util.isArray(a)?"featureMembers":"featureMember";var c=this.writeNode("gml:"+b,a);return this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{gml:{featureMember:function(a){var b=this.createElementNSPlus("gml:featureMember");return this.writeNode("feature:_typeName",a,b),b},MultiPoint:function(a){for(var b=this.createElementNSPlus("gml:MultiPoint"),c=a.components||[a],d=0,e=c.length;d<e;++d)this.writeNode("pointMember",c[d],b);return b},pointMember:function(a){var b=this.createElementNSPlus("gml:pointMember");return this.writeNode("Point",a,b),b},MultiLineString:function(a){for(var b=this.createElementNSPlus("gml:MultiLineString"),c=a.components||[a],d=0,e=c.length;d<e;++d)this.writeNode("lineStringMember",c[d],b);return b},lineStringMember:function(a){var b=this.createElementNSPlus("gml:lineStringMember");return this.writeNode("LineString",a,b),b},MultiPolygon:function(a){for(var b=this.createElementNSPlus("gml:MultiPolygon"),c=a.components||[a],d=0,e=c.length;d<e;++d)this.writeNode("polygonMember",c[d],b);return b},polygonMember:function(a){var b=this.createElementNSPlus("gml:polygonMember");return this.writeNode("Polygon",a,b),b},GeometryCollection:function(a){for(var b=this.createElementNSPlus("gml:GeometryCollection"),c=0,d=a.components.length;c<d;++c)this.writeNode("geometryMember",a.components[c],b);return b},geometryMember:function(a){var b=this.createElementNSPlus("gml:geometryMember"),c=this.writeNode("feature:_geometry",a);return b.appendChild(c.firstChild),b}},feature:{_typeName:function(a){var b=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:a.fid}});a.geometry&&this.writeNode("feature:_geometry",a.geometry,b);for(var c in a.attributes){var d=a.attributes[c];null!=d&&this.writeNode("feature:_attribute",{name:c,value:d},b)}return b},_geometry:function(a){this.externalProjection&&this.internalProjection&&(a=a.clone().transform(this.internalProjection,this.externalProjection));var b=this.createElementNSPlus("feature:"+this.geometryName),c=this.geometryTypes[a.CLASS_NAME],d=this.writeNode("gml:"+c,a,b);return this.srsName&&d.setAttribute("srsName",this.srsName),b},_attribute:function(a){return this.createElementNSPlus("feature:"+a.name,{value:a.value})}},wfs:{FeatureCollection:function(a){for(var b=this.createElementNSPlus("wfs:FeatureCollection"),c=0,d=a.length;c<d;++c)this.writeNode("gml:featureMember",a[c],b);return b}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"}),OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(a,b){var c={};this.readChildNodes(a,c),b.outer=c.components[0]},innerBoundaryIs:function(a,b){var c={};this.readChildNodes(a,c),b.inner.push(c.components[0])},Box:function(a,b){var c={};this.readChildNodes(a,c),b.components||(b.components=[]);var d=c.points[0],e=c.points[1];b.components.push(new OpenLayers.Bounds(d.x,d.y,e.x,e.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(a){var b;b=OpenLayers.Util.isArray(a)?"wfs:FeatureCollection":"gml:featureMember";var c=this.writeNode(b,a);return this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(a){var b=this.createElementNSPlus("gml:Point");return this.writeNode("coordinates",[a],b),b},coordinates:function(a){for(var b,c=a.length,d=new Array(c),e=0;e<c;++e)b=a[e],this.xy?d[e]=b.x+","+b.y:d[e]=b.y+","+b.x,void 0!=b.z&&(d[e]+=","+b.z);return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:1==c?d[0]:d.join(" ")})},LineString:function(a){var b=this.createElementNSPlus("gml:LineString");return this.writeNode("coordinates",a.components,b),b},Polygon:function(a){var b=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",a.components[0],b);for(var c=1;c<a.components.length;++c)this.writeNode("innerBoundaryIs",a.components[c],b);return b},outerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:outerBoundaryIs");return this.writeNode("LinearRing",a,b),b},innerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:innerBoundaryIs");return this.writeNode("LinearRing",a,b),b},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");return this.writeNode("coordinates",a.components,b),b},Box:function(a){var b=this.createElementNSPlus("gml:Box");return this.writeNode("coordinates",[{x:a.left,y:a.bottom},{x:a.right,y:a.top}],b),this.srsName&&b.setAttribute("srsName",this.srsName),b}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"}),OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(a,b){OpenLayers.Util.extend(this,b),this.rules=[],b&&b.rules&&this.addRules(b.rules),this.setDefaultStyle(a||OpenLayers.Feature.Vector.style.default),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a=0,b=this.rules.length;a<b;a++)this.rules[a].destroy(),this.rules[a]=null;this.rules=null,this.defaultStyle=null},createSymbolizer:function(a){for(var b,c=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),a),d=this.rules,e=[],f=!1,g=0,h=d.length;g<h;g++){b=d[g];b.evaluate(a)&&(b instanceof OpenLayers.Rule&&b.elseFilter?e.push(b):(f=!0,this.applySymbolizer(b,c,a)))}if(0==f&&e.length>0){f=!0;for(var g=0,h=e.length;g<h;g++)this.applySymbolizer(e[g],c,a)}return d.length>0&&0==f&&(c.display="none"),null!=c.label&&"string"!=typeof c.label&&(c.label=String(c.label)),c},applySymbolizer:function(a,b,c){var d=c.geometry?this.getSymbolizerPrefix(c.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0],e=a.symbolizer[d]||a.symbolizer;if(!0===this.defaultsPerSymbolizer){var f=this.defaultStyle;OpenLayers.Util.applyDefaults(e,{pointRadius:f.pointRadius}),!0!==e.stroke&&!0!==e.graphic||OpenLayers.Util.applyDefaults(e,{strokeWidth:f.strokeWidth,strokeColor:f.strokeColor,strokeOpacity:f.strokeOpacity,strokeDashstyle:f.strokeDashstyle,strokeLinecap:f.strokeLinecap}),!0!==e.fill&&!0!==e.graphic||OpenLayers.Util.applyDefaults(e,{fillColor:f.fillColor,fillOpacity:f.fillOpacity}),!0===e.graphic&&OpenLayers.Util.applyDefaults(e,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}return this.createLiterals(OpenLayers.Util.extend(b,e),c)},createLiterals:function(a,b){var c=OpenLayers.Util.extend({},b.attributes||b.data);OpenLayers.Util.extend(c,this.context);for(var d in this.propertyStyles)a[d]=OpenLayers.Style.createLiteral(a[d],c,b,d);return a},findPropertyStyles:function(){var a={},b=this.defaultStyle;this.addPropertyStyles(a,b);for(var c,d,e=this.rules,f=0,g=e.length;f<g;f++){c=e[f].symbolizer;for(var h in c){if("object"!=typeof(d=c[h])){this.addPropertyStyles(a,c);break}this.addPropertyStyles(a,d)}}return a},addPropertyStyles:function(a,b){var c;for(var d in b)"string"==typeof(c=b[d])&&c.match(/\$\{\w+\}/)&&(a[d]=!0);return a},addRules:function(a){Array.prototype.push.apply(this.rules,a),this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(a){this.defaultStyle=a,this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(a){for(var b=OpenLayers.Style.SYMBOLIZER_PREFIXES,c=0,d=b.length;c<d;c++)if(-1!=a.CLASS_NAME.indexOf(b[c]))return b[c]},clone:function(){var a=OpenLayers.Util.extend({},this);if(this.rules){a.rules=[];for(var b=0,c=this.rules.length;b<c;++b)a.rules.push(this.rules[b].clone())}a.context=this.context&&OpenLayers.Util.extend({},this.context);var d=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(d,a)},CLASS_NAME:"OpenLayers.Style"}),OpenLayers.Style.createLiteral=function(a,b,c,d){return"string"==typeof a&&-1!=a.indexOf("${")&&(a=OpenLayers.String.format(a,b,[c,d]),a=isNaN(a)||!a?a:parseFloat(a)),a},OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"],OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:!1,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(a){this.symbolizer={},OpenLayers.Util.extend(this,a),this.symbolizers&&delete this.symbolizer,this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a in this.symbolizer)this.symbolizer[a]=null;this.symbolizer=null,delete this.symbolizers},evaluate:function(a){var b=this.getContext(a),c=!0;if(this.minScaleDenominator||this.maxScaleDenominator)var d=a.layer.map.getScale();return this.minScaleDenominator&&(c=d>=OpenLayers.Style.createLiteral(this.minScaleDenominator,b)),c&&this.maxScaleDenominator&&(c=d<OpenLayers.Style.createLiteral(this.maxScaleDenominator,b)),
c&&this.filter&&(c="OpenLayers.Filter.FeatureId"==this.filter.CLASS_NAME?this.filter.evaluate(a):this.filter.evaluate(b)),c},getContext:function(a){var b=this.context;return b||(b=a.attributes||a.data),"function"==typeof this.context&&(b=this.context(a)),b},clone:function(){var a=OpenLayers.Util.extend({},this);if(this.symbolizers){var b=this.symbolizers.length;a.symbolizers=new Array(b);for(var c=0;c<b;++c)a.symbolizers[c]=this.symbolizers[c].clone()}else{a.symbolizer={};var d,e;for(var f in this.symbolizer)d=this.symbolizer[f],e=typeof d,"object"===e?a.symbolizer[f]=OpenLayers.Util.extend({},d):"string"===e&&(a.symbolizer[f]=d)}return a.filter=this.filter&&this.filter.clone(),a.context=this.context&&OpenLayers.Util.extend({},this.context),new OpenLayers.Rule(a)},CLASS_NAME:"OpenLayers.Rule"}),OpenLayers.Format.OGCExceptionReport=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},defaultPrefix:"ogc",read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=a.documentElement,c={exceptionReport:null};return b&&(this.readChildNodes(a,c),null===c.exceptionReport&&(c=(new OpenLayers.Format.OWSCommon).read(a))),c},readers:{ogc:{ServiceExceptionReport:function(a,b){b.exceptionReport={exceptions:[]},this.readChildNodes(a,b.exceptionReport)},ServiceException:function(a,b){var c={code:a.getAttribute("code"),locator:a.getAttribute("locator"),text:this.getChildValue(a)};b.exceptions.push(c)}}},CLASS_NAME:"OpenLayers.Format.OGCExceptionReport"}),OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,allowFallback:!1,name:null,stringifyOutput:!1,parser:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]);var b=this.CLASS_NAME;this.name=b.substring(b.lastIndexOf(".")+1)},getVersion:function(a,b){var c;return a?(c=this.version)||(c=a.getAttribute("version"))||(c=this.defaultVersion):c=b&&b.version||this.version||this.defaultVersion,c},getParser:function(a){a=a||this.defaultVersion;var b=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=a){var c=OpenLayers.Format[this.name]["v"+a.replace(/\./g,"_")+b];if(!c&&(""!==b&&this.allowFallback&&(b="",c=OpenLayers.Format[this.name]["v"+a.replace(/\./g,"_")]),!c))throw"Can't find a "+this.name+" parser for version "+a+b;this.parser=new c(this.options)}return this.parser},write:function(a,b){var c=this.getVersion(null,b);this.parser=this.getParser(c);var d=this.parser.write(a,b);return!1===this.stringifyOutput?d:OpenLayers.Format.XML.prototype.write.apply(this,[d])},read:function(a,b){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var c=a.documentElement,d=this.getVersion(c);this.parser=this.getParser(d);var e=this.parser.read(a,b),f=this.parser.errorProperty||null;if(null!==f&&void 0===e[f]){var g=new OpenLayers.Format.OGCExceptionReport;e.error=g.read(a)}return e.version=d,e},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"}),OpenLayers.Filter=OpenLayers.Class({initialize:function(a){OpenLayers.Util.extend(this,a)},destroy:function(){},evaluate:function(a){return!0},clone:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.CQL?OpenLayers.Format.CQL.prototype.write(this):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Filter"}),OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(a){this.fids=[],OpenLayers.Filter.prototype.initialize.apply(this,[a])},evaluate:function(a){for(var b=0,c=this.fids.length;b<c;b++){if((a.fid||a.id)==this.fids[b])return!0}return!1},clone:function(){var a=new OpenLayers.Filter.FeatureId;return OpenLayers.Util.extend(a,this),a.fids=this.fids.slice(),a},CLASS_NAME:"OpenLayers.Filter.FeatureId"}),OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(a){this.filters=[],OpenLayers.Filter.prototype.initialize.apply(this,[a])},destroy:function(){this.filters=null,OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(a){var b,c;switch(this.type){case OpenLayers.Filter.Logical.AND:for(b=0,c=this.filters.length;b<c;b++)if(0==this.filters[b].evaluate(a))return!1;return!0;case OpenLayers.Filter.Logical.OR:for(b=0,c=this.filters.length;b<c;b++)if(1==this.filters[b].evaluate(a))return!0;return!1;case OpenLayers.Filter.Logical.NOT:return!this.filters[0].evaluate(a)}},clone:function(){for(var a=[],b=0,c=this.filters.length;b<c;++b)a.push(this.filters[b].clone());return new OpenLayers.Filter.Logical({type:this.type,filters:a})},CLASS_NAME:"OpenLayers.Filter.Logical"}),OpenLayers.Filter.Logical.AND="&&",OpenLayers.Filter.Logical.OR="||",OpenLayers.Filter.Logical.NOT="!",OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(a){OpenLayers.Filter.prototype.initialize.apply(this,[a]),this.type===OpenLayers.Filter.Comparison.LIKE&&void 0===a.matchCase&&(this.matchCase=null)},evaluate:function(a){a instanceof OpenLayers.Feature.Vector&&(a=a.attributes);var b,c=!1,d=a[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:b=this.value,c=this.matchCase||"string"!=typeof d||"string"!=typeof b?d==b:d.toUpperCase()==b.toUpperCase();break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:b=this.value,c=this.matchCase||"string"!=typeof d||"string"!=typeof b?d!=b:d.toUpperCase()!=b.toUpperCase();break;case OpenLayers.Filter.Comparison.LESS_THAN:c=d<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:c=d>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:c=d<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:c=d>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:c=d>=this.lowerBoundary&&d<=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:c=new RegExp(this.value,"gi").test(d);break;case OpenLayers.Filter.Comparison.IS_NULL:c=null===d}return c},value2regex:function(a,b,c){if("."==a)throw new Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison");return a=a||"*",b=b||".",c=c||"!",this.value=this.value.replace(new RegExp("\\"+c+"(.|$)","g"),"\\$1"),this.value=this.value.replace(new RegExp("\\"+b,"g"),"."),this.value=this.value.replace(new RegExp("\\"+a,"g"),".*"),this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+a),this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+b),this.value},regex2value:function(){var a=this.value;return a=a.replace(/!/g,"!!"),a=a.replace(/(\\)?\\\./g,function(a,b){return b?a:"!."}),a=a.replace(/(\\)?\\\*/g,function(a,b){return b?a:"!*"}),a=a.replace(/\\\\/g,"\\"),a=a.replace(/\.\*/g,"*")},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)},CLASS_NAME:"OpenLayers.Filter.Comparison"}),OpenLayers.Filter.Comparison.EQUAL_TO="==",OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=",OpenLayers.Filter.Comparison.LESS_THAN="<",OpenLayers.Filter.Comparison.GREATER_THAN=">",OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=",OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=",OpenLayers.Filter.Comparison.BETWEEN="..",OpenLayers.Filter.Comparison.LIKE="~",OpenLayers.Filter.Comparison.IS_NULL="NULL",OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(a){var b=!1;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(a.geometry){var c=this.value;"OpenLayers.Bounds"==this.value.CLASS_NAME&&(c=this.value.toGeometry()),a.geometry.intersects(c)&&(b=!0)}break;default:throw new Error("evaluate is not implemented for this filter type.")}return b},clone:function(){var a=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(a)},CLASS_NAME:"OpenLayers.Filter.Spatial"}),OpenLayers.Filter.Spatial.BBOX="BBOX",OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS",OpenLayers.Filter.Spatial.DWITHIN="DWITHIN",OpenLayers.Filter.Spatial.WITHIN="WITHIN",OpenLayers.Filter.Spatial.CONTAINS="CONTAINS",OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{profile:null,defaultVersion:"1.0.0",stringifyOutput:!0,namedLayersAsArray:!1,CLASS_NAME:"OpenLayers.Format.SLD"}),OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"}),OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"}),OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){var b={};return this.readers.ogc.Filter.apply(this,[a,b]),b.filter},readers:{ogc:{_expression:function(a){for(var b,c="",d=a.firstChild;d;d=d.nextSibling)switch(d.nodeType){case 1:b=this.readNode(d),b.property?c+="${"+b.property+"}":void 0!==b.value&&(c+=b.value);break;case 3:case 4:c+=d.nodeValue}return c},Filter:function(a,b){var c={fids:[],filters:[]};this.readChildNodes(a,c),c.fids.length>0?b.filter=new OpenLayers.Filter.FeatureId({fids:c.fids}):c.filters.length>0&&(b.filter=c.filters[0])},FeatureId:function(a,b){var c=a.getAttribute("fid");c&&b.fids.push(c)},And:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(a,c),b.filters.push(c)},Or:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(a,c),b.filters.push(c)},Not:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsLessThan:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsGreaterThan:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsLessThanOrEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsGreaterThanOrEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsBetween:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(a,c),b.filters.push(c)},Literal:function(a,b){b.value=OpenLayers.String.numericIf(this.getChildValue(a),!0)},PropertyName:function(a,b){b.property=this.getChildValue(a)},LowerBoundary:function(a,b){b.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,a),!0)},UpperBoundary:function(a,b){b.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,a),!0)},Intersects:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(a,b){b.distance=parseInt(this.getChildValue(a)),b.distanceUnits=a.getAttribute("units")},Function:function(a,b){},PropertyIsNull:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL});this.readChildNodes(a,c),b.filters.push(c)}}},readSpatial:function(a,b,c){var d=new OpenLayers.Filter.Spatial({type:c});this.readChildNodes(a,d),d.value=d.components[0],delete d.components,b.filters.push(d)},encodeLiteral:function(a){return a instanceof Date&&(a=OpenLayers.Date.toISOString(a)),a},writeOgcExpression:function(a,b){return a instanceof OpenLayers.Filter.Function?this.writeNode("Function",a,b):this.writeNode("Literal",a,b),b},write:function(a){return this.writers.ogc.Filter.apply(this,[a])},writers:{ogc:{Filter:function(a){var b=this.createElementNSPlus("ogc:Filter");return this.writeNode(this.getFilterType(a),a,b),b},_featureIds:function(a){for(var b=this.createDocumentFragment(),c=0,d=a.fids.length;c<d;++c)this.writeNode("ogc:FeatureId",a.fids[c],b);return b},FeatureId:function(a){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:a}})},And:function(a){for(var b,c=this.createElementNSPlus("ogc:And"),d=0,e=a.filters.length;d<e;++d)b=a.filters[d],this.writeNode(this.getFilterType(b),b,c);return c},Or:function(a){for(var b,c=this.createElementNSPlus("ogc:Or"),d=0,e=a.filters.length;d<e;++d)b=a.filters[d],this.writeNode(this.getFilterType(b),b,c);return c},Not:function(a){var b=this.createElementNSPlus("ogc:Not"),c=a.filters[0];return this.writeNode(this.getFilterType(c),c,b),b},PropertyIsLessThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThan");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsGreaterThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThan");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsLessThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsGreaterThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsBetween:function(a){var b=this.createElementNSPlus("ogc:PropertyIsBetween");return this.writeNode("PropertyName",a,b),this.writeNode("LowerBoundary",a,b),this.writeNode("UpperBoundary",a,b),b},PropertyName:function(a){return this.createElementNSPlus("ogc:PropertyName",{value:a.property})},Literal:function(a){var b=this.encodeLiteral||OpenLayers.Format.Filter.v1.prototype.encodeLiteral;return this.createElementNSPlus("ogc:Literal",{value:b(a)})},LowerBoundary:function(a){var b=this.createElementNSPlus("ogc:LowerBoundary");return this.writeOgcExpression(a.lowerBoundary,b),b},UpperBoundary:function(a){var b=this.createElementNSPlus("ogc:UpperBoundary");return this.writeNode("Literal",a.upperBoundary,b),b},INTERSECTS:function(a){return this.writeSpatial(a,"Intersects")},WITHIN:function(a){return this.writeSpatial(a,"Within")},CONTAINS:function(a){return this.writeSpatial(a,"Contains")},DWITHIN:function(a){var b=this.writeSpatial(a,"DWithin");return this.writeNode("Distance",a,b),b},Distance:function(a){return this.createElementNSPlus("ogc:Distance",{attributes:{units:a.distanceUnits},value:a.distance})},Function:function(a){for(var b=this.createElementNSPlus("ogc:Function",{attributes:{name:a.name}}),c=a.params,d=0,e=c.length;d<e;d++)this.writeOgcExpression(c[d],b);return b},PropertyIsNull:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNull");return this.writeNode("PropertyName",a,b),b}}},getFilterType:function(a){var b=this.filterMap[a.type];if(!b)throw"Filter writing not supported for rule type: "+a.type;return b},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",NULL:"PropertyIsNull",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"_featureIds"},CLASS_NAME:"OpenLayers.Format.Filter.v1"}),OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[a])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsNotEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsLike:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(a,c);var d=a.getAttribute("wildCard"),e=a.getAttribute("singleChar"),f=a.getAttribute("escape");c.value2regex(d,e,f),b.filters.push(c)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});return this.writeNode("PropertyName",a,b),this.writeNode("Literal",a.regex2value(),b),b},BBOX:function(a){var b=this.createElementNSPlus("ogc:BBOX");a.property&&this.writeNode("PropertyName",a,b);var c=this.writeNode("gml:Box",a.value,b);return a.projection&&c.setAttribute("srsName",a.projection),b}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(a,b){var c=this.createElementNSPlus("ogc:"+b);if(this.writeNode("PropertyName",a,c),a.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",a.value,c);else{var d;d=a.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",a.value).firstChild:this.writeNode("gml:Box",a.value),a.projection&&d.setAttribute("srsName",a.projection),c.appendChild(d)}return c},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"}),OpenLayers.Symbolizer=OpenLayers.Class({zIndex:0,initialize:function(a){OpenLayers.Util.extend(this,a)},clone:function(){var Type=eval(this.CLASS_NAME);return new Type(OpenLayers.Util.extend({},this))},CLASS_NAME:"OpenLayers.Symbolizer"}),OpenLayers.Symbolizer.Point=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Point"}),OpenLayers.Symbolizer.Line=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Line"}),OpenLayers.Symbolizer.Polygon=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Polygon"}),OpenLayers.Symbolizer.Text=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Text"}),OpenLayers.Symbolizer.Raster=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(a){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Raster"}),OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,multipleSymbolizers:!1,featureTypeCounter:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},read:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c={namedLayers:!0===b.namedLayersAsArray?[]:{}};return this.readChildNodes(a,c),c},readers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(a,b){b.version=a.getAttribute("version"),this.readChildNodes(a,b)},Name:function(a,b){b.name=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b.description=this.getChildValue(a)},NamedLayer:function(a,b){var c={userStyles:[],namedStyles:[]};this.readChildNodes(a,c);for(var d=0,e=c.userStyles.length;d<e;++d)c.userStyles[d].layerName=c.name;OpenLayers.Util.isArray(b.namedLayers)?b.namedLayers.push(c):b.namedLayers[c.name]=c},NamedStyle:function(a,b){b.namedStyles.push(this.getChildName(a.firstChild))},UserStyle:function(a,b){var c={defaultsPerSymbolizer:!0,rules:[]};this.featureTypeCounter=-1,this.readChildNodes(a,c);var d;this.multipleSymbolizers?(delete c.defaultsPerSymbolizer,d=new OpenLayers.Style2(c)):d=new OpenLayers.Style(this.defaultSymbolizer,c),b.userStyles.push(d)},IsDefault:function(a,b){"1"==this.getChildValue(a)&&(b.isDefault=!0)},FeatureTypeStyle:function(a,b){++this.featureTypeCounter;var c={rules:this.multipleSymbolizers?b.rules:[]};this.readChildNodes(a,c),this.multipleSymbolizers||(b.rules=c.rules)},Rule:function(a,b){var c;this.multipleSymbolizers&&(c={symbolizers:[]});var d=new OpenLayers.Rule(c);this.readChildNodes(a,d),b.rules.push(d)},ElseFilter:function(a,b){b.elseFilter=!0},MinScaleDenominator:function(a,b){b.minScaleDenominator=parseFloat(this.getChildValue(a))},MaxScaleDenominator:function(a,b){b.maxScaleDenominator=parseFloat(this.getChildValue(a))},TextSymbolizer:function(a,b){var c={};this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Text(c))):b.symbolizer.Text=OpenLayers.Util.applyDefaults(c,b.symbolizer.Text)},LabelPlacement:function(a,b){this.readChildNodes(a,b)},PointPlacement:function(a,b){var c={};this.readChildNodes(a,c),c.labelRotation=c.rotation,delete c.rotation;var d,e=b.labelAnchorPointX,f=b.labelAnchorPointY;e<=1/3?d="l":e>1/3&&e<2/3?d="c":e>=2/3&&(d="r"),f<=1/3?d+="b":f>1/3&&f<2/3?d+="m":f>=2/3&&(d+="t"),c.labelAlign=d,OpenLayers.Util.applyDefaults(b,c)},AnchorPoint:function(a,b){this.readChildNodes(a,b)},AnchorPointX:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelAnchorPointX=c)},AnchorPointY:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelAnchorPointY=c)},Displacement:function(a,b){this.readChildNodes(a,b)},DisplacementX:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelXOffset=c)},DisplacementY:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelYOffset=c)},LinePlacement:function(a,b){this.readChildNodes(a,b)},PerpendicularOffset:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelPerpendicularOffset=c)},Label:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.label=c)},Font:function(a,b){this.readChildNodes(a,b)},Halo:function(a,b){var c={};this.readChildNodes(a,c),b.haloRadius=c.haloRadius,b.haloColor=c.fillColor,b.haloOpacity=c.fillOpacity},Radius:function(a,b){var c=this.readers.ogc._expression.call(this,a);null!=c&&(b.haloRadius=c)},RasterSymbolizer:function(a,b){var c={};this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Raster(c))):b.symbolizer.Raster=OpenLayers.Util.applyDefaults(c,b.symbolizer.Raster)},Geometry:function(a,b){b.geometry={},this.readChildNodes(a,b.geometry)},ColorMap:function(a,b){b.colorMap=[],this.readChildNodes(a,b.colorMap)},ColorMapEntry:function(a,b){var c=a.getAttribute("quantity"),d=a.getAttribute("opacity");b.push({color:a.getAttribute("color"),quantity:null!==c?parseFloat(c):void 0,label:a.getAttribute("label")||void 0,opacity:null!==d?parseFloat(d):void 0})},LineSymbolizer:function(a,b){var c={};this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Line(c))):b.symbolizer.Line=OpenLayers.Util.applyDefaults(c,b.symbolizer.Line)},PolygonSymbolizer:function(a,b){var c={fill:!1,stroke:!1};this.multipleSymbolizers||(c=b.symbolizer.Polygon||c),this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Polygon(c))):b.symbolizer.Polygon=c},PointSymbolizer:function(a,b){var c={fill:!1,stroke:!1,graphic:!1};this.multipleSymbolizers||(c=b.symbolizer.Point||c),this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Point(c))):b.symbolizer.Point=c},Stroke:function(a,b){b.stroke=!0,this.readChildNodes(a,b)},Fill:function(a,b){b.fill=!0,this.readChildNodes(a,b)},CssParameter:function(a,b){var c=a.getAttribute("name"),d=this.cssMap[c];if(b.label&&("fill"===c?d="fontColor":"fill-opacity"===c&&(d="fontOpacity")),d){var e=this.readers.ogc._expression.call(this,a);e&&(b[d]=e)}},Graphic:function(a,b){b.graphic=!0;var c={};this.readChildNodes(a,c);for(var d,e,f=["stroke","strokeColor","strokeWidth","strokeOpacity","strokeLinecap","fill","fillColor","fillOpacity","graphicName","rotation","graphicFormat"],g=0,h=f.length;g<h;++g)d=f[g],void 0!=(e=c[d])&&(b[d]=e);if(void 0!=c.opacity&&(b.graphicOpacity=c.opacity),void 0!=c.size){var i=c.size/2;isNaN(i)?b.graphicWidth=c.size:b.pointRadius=c.size/2}void 0!=c.href&&(b.externalGraphic=c.href),void 0!=c.rotation&&(b.rotation=c.rotation)},ExternalGraphic:function(a,b){this.readChildNodes(a,b)},Mark:function(a,b){this.readChildNodes(a,b)},WellKnownName:function(a,b){b.graphicName=this.getChildValue(a)},Opacity:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.opacity=c)},Size:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.size=c)},Rotation:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.rotation=c)},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},Format:function(a,b){b.graphicFormat=this.getChildValue(a)}}},OpenLayers.Format.Filter.v1_0_0.prototype.readers),cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(a){var b=null;for(var c in this.cssMap)if(this.cssMap[c]==a){b=c;break}return b},getGraphicFormat:function(a){var b;for(var c in this.graphicFormats)if(this.graphicFormats[c].test(a)){b=c;break}return b||this.defaultGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(a){return this.writers.sld.StyledLayerDescriptor.apply(this,[a])},writers:OpenLayers.Util.applyDefaults({sld:{_OGCExpression:function(a,b){var c=this.createElementNSPlus(a),d="string"==typeof b?b.split("${"):[b];c.appendChild(this.createTextNode(d[0]));for(var e,f,g=1,h=d.length;g<h;g++)e=d[g],f=e.indexOf("}"),f>0?(this.writeNode("ogc:PropertyName",{property:e.substring(0,f)},c),c.appendChild(this.createTextNode(e.substring(++f)))):c.appendChild(this.createTextNode("${"+e));return c},StyledLayerDescriptor:function(a){var b=this.createElementNSPlus("sld:StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});if(b.setAttribute("xmlns:ogc",this.namespaces.ogc),b.setAttribute("xmlns:gml",this.namespaces.gml),a.name&&this.writeNode("Name",a.name,b),a.title&&this.writeNode("Title",a.title,b),a.description&&this.writeNode("Abstract",a.description,b),OpenLayers.Util.isArray(a.namedLayers))for(var c=0,d=a.namedLayers.length;c<d;++c)this.writeNode("NamedLayer",a.namedLayers[c],b);else for(var e in a.namedLayers)this.writeNode("NamedLayer",a.namedLayers[e],b);return b},Name:function(a){return this.createElementNSPlus("sld:Name",{value:a})},Title:function(a){return this.createElementNSPlus("sld:Title",{value:a})},Abstract:function(a){return this.createElementNSPlus("sld:Abstract",{value:a})},NamedLayer:function(a){var b=this.createElementNSPlus("sld:NamedLayer");if(this.writeNode("Name",a.name,b),a.namedStyles)for(var c=0,d=a.namedStyles.length;c<d;++c)this.writeNode("NamedStyle",a.namedStyles[c],b);if(a.userStyles)for(var c=0,d=a.userStyles.length;c<d;++c)this.writeNode("UserStyle",a.userStyles[c],b);return b},NamedStyle:function(a){var b=this.createElementNSPlus("sld:NamedStyle");return this.writeNode("Name",a,b),b},UserStyle:function(a){var b=this.createElementNSPlus("sld:UserStyle");if(a.name&&this.writeNode("Name",a.name,b),a.title&&this.writeNode("Title",a.title,b),a.description&&this.writeNode("Abstract",a.description,b),a.isDefault&&this.writeNode("IsDefault",a.isDefault,b),this.multipleSymbolizers&&a.rules){for(var c,d,e,f,g,h={0:[]},i=[0],j=0,k=a.rules.length;j<k;++j)if(c=a.rules[j],c.symbolizers){d={};for(var l=0,m=c.symbolizers.length;l<m;++l)e=c.symbolizers[l],f=e.zIndex,f in d||(g=c.clone(),g.symbolizers=[],d[f]=g),d[f].symbolizers.push(e.clone());for(f in d)f in h||(i.push(f),h[f]=[]),h[f].push(d[f])}else h[0].push(c.clone());i.sort();for(var n,j=0,k=i.length;j<k;++j)n=h[i[j]],n.length>0&&(g=a.clone(),g.rules=h[i[j]],this.writeNode("FeatureTypeStyle",g,b))}else this.writeNode("FeatureTypeStyle",a,b);return b},IsDefault:function(a){return this.createElementNSPlus("sld:IsDefault",{value:a?"1":"0"})},FeatureTypeStyle:function(a){for(var b=this.createElementNSPlus("sld:FeatureTypeStyle"),c=0,d=a.rules.length;c<d;++c)this.writeNode("Rule",a.rules[c],b);return b},Rule:function(a){var b=this.createElementNSPlus("sld:Rule");a.name&&this.writeNode("Name",a.name,b),a.title&&this.writeNode("Title",a.title,b),a.description&&this.writeNode("Abstract",a.description,b),a.elseFilter?this.writeNode("ElseFilter",null,b):a.filter&&this.writeNode("ogc:Filter",a.filter,b),void 0!=a.minScaleDenominator&&this.writeNode("MinScaleDenominator",a.minScaleDenominator,b),void 0!=a.maxScaleDenominator&&this.writeNode("MaxScaleDenominator",a.maxScaleDenominator,b);var c,d;if(this.multipleSymbolizers&&a.symbolizers)for(var d,e=0,f=a.symbolizers.length;e<f;++e)d=a.symbolizers[e],c=d.CLASS_NAME.split(".").pop(),this.writeNode(c+"Symbolizer",d,b);else for(var g=OpenLayers.Style.SYMBOLIZER_PREFIXES,e=0,h=g.length;e<h;++e)c=g[e],(d=a.symbolizer[c])&&this.writeNode(c+"Symbolizer",d,b);return b},ElseFilter:function(){return this.createElementNSPlus("sld:ElseFilter")},MinScaleDenominator:function(a){return this.createElementNSPlus("sld:MinScaleDenominator",{value:a})},MaxScaleDenominator:function(a){return this.createElementNSPlus("sld:MaxScaleDenominator",{value:a})},LineSymbolizer:function(a){var b=this.createElementNSPlus("sld:LineSymbolizer");return this.writeNode("Stroke",a,b),b},Stroke:function(a){var b=this.createElementNSPlus("sld:Stroke");return void 0!=a.strokeColor&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeColor"},b),void 0!=a.strokeOpacity&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeOpacity"},b),void 0!=a.strokeWidth&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeWidth"},b),void 0!=a.strokeDashstyle&&"solid"!==a.strokeDashstyle&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeDashstyle"},b),void 0!=a.strokeLinecap&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeLinecap"},b),b},CssParameter:function(a){return this.createElementNSPlus("sld:CssParameter",{attributes:{name:this.getCssProperty(a.key)},
value:a.symbolizer[a.key]})},TextSymbolizer:function(a){var b=this.createElementNSPlus("sld:TextSymbolizer");return null!=a.label&&this.writeNode("Label",a.label,b),null==a.fontFamily&&null==a.fontSize&&null==a.fontWeight&&null==a.fontStyle||this.writeNode("Font",a,b),null==a.labelAnchorPointX&&null==a.labelAnchorPointY&&null==a.labelAlign&&null==a.labelXOffset&&null==a.labelYOffset&&null==a.labelRotation&&null==a.labelPerpendicularOffset||this.writeNode("LabelPlacement",a,b),null==a.haloRadius&&null==a.haloColor&&null==a.haloOpacity||this.writeNode("Halo",a,b),null==a.fontColor&&null==a.fontOpacity||this.writeNode("Fill",{fillColor:a.fontColor,fillOpacity:a.fontOpacity},b),b},LabelPlacement:function(a){var b=this.createElementNSPlus("sld:LabelPlacement");return null==a.labelAnchorPointX&&null==a.labelAnchorPointY&&null==a.labelAlign&&null==a.labelXOffset&&null==a.labelYOffset&&null==a.labelRotation||null!=a.labelPerpendicularOffset||this.writeNode("PointPlacement",a,b),null!=a.labelPerpendicularOffset&&this.writeNode("LinePlacement",a,b),b},LinePlacement:function(a){var b=this.createElementNSPlus("sld:LinePlacement");return this.writeNode("PerpendicularOffset",a.labelPerpendicularOffset,b),b},PerpendicularOffset:function(a){return this.createElementNSPlus("sld:PerpendicularOffset",{value:a})},PointPlacement:function(a){var b=this.createElementNSPlus("sld:PointPlacement");return null==a.labelAnchorPointX&&null==a.labelAnchorPointY&&null==a.labelAlign||this.writeNode("AnchorPoint",a,b),null==a.labelXOffset&&null==a.labelYOffset||this.writeNode("Displacement",a,b),null!=a.labelRotation&&this.writeNode("Rotation",a.labelRotation,b),b},AnchorPoint:function(a){var b=this.createElementNSPlus("sld:AnchorPoint"),c=a.labelAnchorPointX,d=a.labelAnchorPointY;if(null!=c&&this.writeNode("AnchorPointX",c,b),null!=d&&this.writeNode("AnchorPointY",d,b),null==c&&null==d){var e=a.labelAlign.substr(0,1),f=a.labelAlign.substr(1,1);"l"===e?c=0:"c"===e?c=.5:"r"===e&&(c=1),"b"===f?d=0:"m"===f?d=.5:"t"===f&&(d=1),this.writeNode("AnchorPointX",c,b),this.writeNode("AnchorPointY",d,b)}return b},AnchorPointX:function(a){return this.createElementNSPlus("sld:AnchorPointX",{value:a})},AnchorPointY:function(a){return this.createElementNSPlus("sld:AnchorPointY",{value:a})},Displacement:function(a){var b=this.createElementNSPlus("sld:Displacement");return null!=a.labelXOffset&&this.writeNode("DisplacementX",a.labelXOffset,b),null!=a.labelYOffset&&this.writeNode("DisplacementY",a.labelYOffset,b),b},DisplacementX:function(a){return this.createElementNSPlus("sld:DisplacementX",{value:a})},DisplacementY:function(a){return this.createElementNSPlus("sld:DisplacementY",{value:a})},Font:function(a){var b=this.createElementNSPlus("sld:Font");return a.fontFamily&&this.writeNode("CssParameter",{symbolizer:a,key:"fontFamily"},b),a.fontSize&&this.writeNode("CssParameter",{symbolizer:a,key:"fontSize"},b),a.fontWeight&&this.writeNode("CssParameter",{symbolizer:a,key:"fontWeight"},b),a.fontStyle&&this.writeNode("CssParameter",{symbolizer:a,key:"fontStyle"},b),b},Label:function(a){return this.writers.sld._OGCExpression.call(this,"sld:Label",a)},Halo:function(a){var b=this.createElementNSPlus("sld:Halo");return a.haloRadius&&this.writeNode("Radius",a.haloRadius,b),(a.haloColor||a.haloOpacity)&&this.writeNode("Fill",{fillColor:a.haloColor,fillOpacity:a.haloOpacity},b),b},Radius:function(a){return this.createElementNSPlus("sld:Radius",{value:a})},RasterSymbolizer:function(a){var b=this.createElementNSPlus("sld:RasterSymbolizer");return a.geometry&&this.writeNode("Geometry",a.geometry,b),a.opacity&&this.writeNode("Opacity",a.opacity,b),a.colorMap&&this.writeNode("ColorMap",a.colorMap,b),b},Geometry:function(a){var b=this.createElementNSPlus("sld:Geometry");return a.property&&this.writeNode("ogc:PropertyName",a,b),b},ColorMap:function(a){for(var b=this.createElementNSPlus("sld:ColorMap"),c=0,d=a.length;c<d;++c)this.writeNode("ColorMapEntry",a[c],b);return b},ColorMapEntry:function(a){var b=this.createElementNSPlus("sld:ColorMapEntry"),c=a;return b.setAttribute("color",c.color),void 0!==c.opacity&&b.setAttribute("opacity",parseFloat(c.opacity)),void 0!==c.quantity&&b.setAttribute("quantity",parseFloat(c.quantity)),void 0!==c.label&&b.setAttribute("label",c.label),b},PolygonSymbolizer:function(a){var b=this.createElementNSPlus("sld:PolygonSymbolizer");return!1!==a.fill&&this.writeNode("Fill",a,b),!1!==a.stroke&&this.writeNode("Stroke",a,b),b},Fill:function(a){var b=this.createElementNSPlus("sld:Fill");return a.fillColor&&this.writeNode("CssParameter",{symbolizer:a,key:"fillColor"},b),null!=a.fillOpacity&&this.writeNode("CssParameter",{symbolizer:a,key:"fillOpacity"},b),b},PointSymbolizer:function(a){var b=this.createElementNSPlus("sld:PointSymbolizer");return this.writeNode("Graphic",a,b),b},Graphic:function(a){var b=this.createElementNSPlus("sld:Graphic");return void 0!=a.externalGraphic?this.writeNode("ExternalGraphic",a,b):this.writeNode("Mark",a,b),void 0!=a.graphicOpacity&&this.writeNode("Opacity",a.graphicOpacity,b),void 0!=a.pointRadius?this.writeNode("Size",2*a.pointRadius,b):void 0!=a.graphicWidth&&this.writeNode("Size",a.graphicWidth,b),void 0!=a.rotation&&this.writeNode("Rotation",a.rotation,b),b},ExternalGraphic:function(a){var b=this.createElementNSPlus("sld:ExternalGraphic");this.writeNode("OnlineResource",a.externalGraphic,b);var c=a.graphicFormat||this.getGraphicFormat(a.externalGraphic);return this.writeNode("Format",c,b),b},Mark:function(a){var b=this.createElementNSPlus("sld:Mark");return a.graphicName&&this.writeNode("WellKnownName",a.graphicName,b),!1!==a.fill&&this.writeNode("Fill",a,b),!1!==a.stroke&&this.writeNode("Stroke",a,b),b},WellKnownName:function(a){return this.createElementNSPlus("sld:WellKnownName",{value:a})},Opacity:function(a){return this.createElementNSPlus("sld:Opacity",{value:a})},Size:function(a){return this.writers.sld._OGCExpression.call(this,"sld:Size",a)},Rotation:function(a){return this.createElementNSPlus("sld:Rotation",{value:a})},OnlineResource:function(a){return this.createElementNSPlus("sld:OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":a}})},Format:function(a){return this.createElementNSPlus("sld:Format",{value:a})}}},OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"}),OpenLayers.Format.SLD.v1_0_0=OpenLayers.Class(OpenLayers.Format.SLD.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0"}),OpenLayers.Format.Context=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{layerOptions:null,layerParams:null,read:function(a,b){var c,d=OpenLayers.Format.XML.VersionedOGC.prototype.read.apply(this,arguments);if(b&&b.map)if(this.context=d,b.map instanceof OpenLayers.Map)c=this.mergeContextToMap(d,b.map);else{var e=b.map;(OpenLayers.Util.isElement(e)||"string"==typeof e)&&(e={div:e}),c=this.contextToMap(d,e)}else c=d;return c},getLayerFromContext:function(a){var b,c,d={queryable:a.queryable,visibility:a.visibility,maxExtent:a.maxExtent,metadata:OpenLayers.Util.applyDefaults(a.metadata,{styles:a.styles,formats:a.formats,abstract:a.abstract,dataURL:a.dataURL}),numZoomLevels:a.numZoomLevels,units:a.units,isBaseLayer:a.isBaseLayer,opacity:a.opacity,displayInLayerSwitcher:a.displayInLayerSwitcher,singleTile:a.singleTile,tileSize:a.tileSize?new OpenLayers.Size(a.tileSize.width,a.tileSize.height):void 0,minScale:a.minScale||a.maxScaleDenominator,maxScale:a.maxScale||a.minScaleDenominator,srs:a.srs,dimensions:a.dimensions,metadataURL:a.metadataURL};this.layerOptions&&OpenLayers.Util.applyDefaults(d,this.layerOptions);var e={layers:a.name,transparent:a.transparent,version:a.version};if(a.formats&&a.formats.length>0)for(e.format=a.formats[0].value,b=0,c=a.formats.length;b<c;b++){var f=a.formats[b];if(1==f.current){e.format=f.value;break}}if(a.styles&&a.styles.length>0)for(b=0,c=a.styles.length;b<c;b++){var g=a.styles[b];if(1==g.current){g.href?e.sld=g.href:g.body?e.sld_body=g.body:e.styles=g.name;break}}this.layerParams&&OpenLayers.Util.applyDefaults(e,this.layerParams);var h=null,i=a.service;return i==OpenLayers.Format.Context.serviceTypes.WFS?(d.strategies=[new OpenLayers.Strategy.BBOX],d.protocol=new OpenLayers.Protocol.WFS({url:a.url,featurePrefix:a.name.split(":")[0],featureType:a.name.split(":").pop()}),h=new OpenLayers.Layer.Vector(a.title||a.name,d)):i==OpenLayers.Format.Context.serviceTypes.KML?(d.strategies=[new OpenLayers.Strategy.Fixed],d.protocol=new OpenLayers.Protocol.HTTP({url:a.url,format:new OpenLayers.Format.KML}),h=new OpenLayers.Layer.Vector(a.title||a.name,d)):i==OpenLayers.Format.Context.serviceTypes.GML?(d.strategies=[new OpenLayers.Strategy.Fixed],d.protocol=new OpenLayers.Protocol.HTTP({url:a.url,format:new OpenLayers.Format.GML}),h=new OpenLayers.Layer.Vector(a.title||a.name,d)):a.features?(h=new OpenLayers.Layer.Vector(a.title||a.name,d),h.addFeatures(a.features)):!0!==a.categoryLayer&&(h=new OpenLayers.Layer.WMS(a.title||a.name,a.url,e,d)),h},getLayersFromContext:function(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=this.getLayerFromContext(a[c]);null!==e&&b.push(e)}return b},contextToMap:function(a,b){b=OpenLayers.Util.applyDefaults({maxExtent:a.maxExtent,projection:a.projection,units:a.units},b),b.maxExtent&&(b.maxResolution=b.maxExtent.getWidth()/OpenLayers.Map.TILE_WIDTH);var c={contactInformation:a.contactInformation,abstract:a.abstract,keywords:a.keywords,logo:a.logo,descriptionURL:a.descriptionURL};b.metadata=c;var d=new OpenLayers.Map(b);return d.addLayers(this.getLayersFromContext(a.layersContext)),d.setCenter(a.bounds.getCenterLonLat(),d.getZoomForExtent(a.bounds,!0)),d},mergeContextToMap:function(a,b){return b.addLayers(this.getLayersFromContext(a.layersContext)),b},write:function(a,b){return a=this.toContext(a),OpenLayers.Format.XML.VersionedOGC.prototype.write.apply(this,arguments)},CLASS_NAME:"OpenLayers.Format.Context"}),OpenLayers.Format.Context.serviceTypes={WMS:"urn:ogc:serviceType:WMS",WFS:"urn:ogc:serviceType:WFS",WCS:"urn:ogc:serviceType:WCS",GML:"urn:ogc:serviceType:GML",SLD:"urn:ogc:serviceType:SLD",FES:"urn:ogc:serviceType:FES",KML:"urn:ogc:serviceType:KML"},OpenLayers.Format.OWSContext=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"0.3.1",getVersion:function(a,b){var c=OpenLayers.Format.XML.VersionedOGC.prototype.getVersion.apply(this,arguments);return"0.3.0"===c&&(c=this.defaultVersion),c},toContext:function(a){var b={};return"OpenLayers.Map"==a.CLASS_NAME&&(b.bounds=a.getExtent(),b.maxExtent=a.maxExtent,b.projection=a.projection,b.size=a.getSize(),b.layers=a.layers),b},CLASS_NAME:"OpenLayers.Format.OWSContext"}),OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(a,b){var c=this.version;if(!c){var d=a.getAttribute("xmlns:ows");d&&"1.1"===d.substring(d.lastIndexOf("/")+1)&&(c="1.1.0"),c||(c=this.defaultVersion)}return c},CLASS_NAME:"OpenLayers.Format.OWSCommon"}),OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c={};return this.readChildNodes(a,c),c},readers:{ows:{Exception:function(a,b){var c={code:a.getAttribute("exceptionCode"),locator:a.getAttribute("locator"),texts:[]};b.exceptions.push(c),this.readChildNodes(a,c)},ExceptionText:function(a,b){var c=this.getChildValue(a);b.texts.push(c)},ServiceIdentification:function(a,b){b.serviceIdentification={},this.readChildNodes(a,b.serviceIdentification)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b.abstract=this.getChildValue(a)},Keywords:function(a,b){b.keywords={},this.readChildNodes(a,b.keywords)},Keyword:function(a,b){b[this.getChildValue(a)]=!0},ServiceType:function(a,b){b.serviceType={codeSpace:a.getAttribute("codeSpace"),value:this.getChildValue(a)}},ServiceTypeVersion:function(a,b){b.serviceTypeVersion=this.getChildValue(a)},Fees:function(a,b){b.fees=this.getChildValue(a)},AccessConstraints:function(a,b){b.accessConstraints=this.getChildValue(a)},ServiceProvider:function(a,b){b.serviceProvider={},this.readChildNodes(a,b.serviceProvider)},ProviderName:function(a,b){b.providerName=this.getChildValue(a)},ProviderSite:function(a,b){b.providerSite=this.getAttributeNS(a,this.namespaces.xlink,"href")},ServiceContact:function(a,b){b.serviceContact={},this.readChildNodes(a,b.serviceContact)},IndividualName:function(a,b){b.individualName=this.getChildValue(a)},PositionName:function(a,b){b.positionName=this.getChildValue(a)},ContactInfo:function(a,b){b.contactInfo={},this.readChildNodes(a,b.contactInfo)},Phone:function(a,b){b.phone={},this.readChildNodes(a,b.phone)},Voice:function(a,b){b.voice=this.getChildValue(a)},Address:function(a,b){b.address={},this.readChildNodes(a,b.address)},DeliveryPoint:function(a,b){b.deliveryPoint=this.getChildValue(a)},City:function(a,b){b.city=this.getChildValue(a)},AdministrativeArea:function(a,b){b.administrativeArea=this.getChildValue(a)},PostalCode:function(a,b){b.postalCode=this.getChildValue(a)},Country:function(a,b){b.country=this.getChildValue(a)},ElectronicMailAddress:function(a,b){b.electronicMailAddress=this.getChildValue(a)},Role:function(a,b){b.role=this.getChildValue(a)},OperationsMetadata:function(a,b){b.operationsMetadata={},this.readChildNodes(a,b.operationsMetadata)},Operation:function(a,b){var c=a.getAttribute("name");b[c]={},this.readChildNodes(a,b[c])},DCP:function(a,b){b.dcp={},this.readChildNodes(a,b.dcp)},HTTP:function(a,b){b.http={},this.readChildNodes(a,b.http)},Get:function(a,b){b.get||(b.get=[]);var c={url:this.getAttributeNS(a,this.namespaces.xlink,"href")};this.readChildNodes(a,c),b.get.push(c)},Post:function(a,b){b.post||(b.post=[]);var c={url:this.getAttributeNS(a,this.namespaces.xlink,"href")};this.readChildNodes(a,c),b.post.push(c)},Parameter:function(a,b){b.parameters||(b.parameters={});var c=a.getAttribute("name");b.parameters[c]={},this.readChildNodes(a,b.parameters[c])},Constraint:function(a,b){b.constraints||(b.constraints={});var c=a.getAttribute("name");b.constraints[c]={},this.readChildNodes(a,b.constraints[c])},Value:function(a,b){b[this.getChildValue(a)]=!0},OutputFormat:function(a,b){b.formats.push({value:this.getChildValue(a)}),this.readChildNodes(a,b)},WGS84BoundingBox:function(a,b){var c={};c.crs=a.getAttribute("crs"),b.BoundingBox?b.BoundingBox.push(c):(b.projection=c.crs,c=b),this.readChildNodes(a,c)},BoundingBox:function(a,b){this.readers.ows.WGS84BoundingBox.apply(this,[a,b])},LowerCorner:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,"");c=c.replace(this.regExes.trimComma,",");var d=c.split(this.regExes.splitSpace);b.left=d[0],b.bottom=d[1]},UpperCorner:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,"");c=c.replace(this.regExes.trimComma,",");var d=c.split(this.regExes.splitSpace);b.right=d[0],b.top=d[1],b.bounds=new OpenLayers.Bounds(b.left,b.bottom,b.right,b.top),delete b.left,delete b.bottom,delete b.right,delete b.top},Language:function(a,b){b.language=this.getChildValue(a)}}},writers:{ows:{BoundingBox:function(a,b){var c=this.createElementNSPlus(b||"ows:BoundingBox",{attributes:{crs:a.projection}});return this.writeNode("ows:LowerCorner",a,c),this.writeNode("ows:UpperCorner",a,c),c},LowerCorner:function(a){return this.createElementNSPlus("ows:LowerCorner",{value:a.bounds.left+" "+a.bounds.bottom})},UpperCorner:function(a){return this.createElementNSPlus("ows:UpperCorner",{value:a.bounds.right+" "+a.bounds.top})},Identifier:function(a){return this.createElementNSPlus("ows:Identifier",{value:a})},Title:function(a){return this.createElementNSPlus("ows:Title",{value:a})},Abstract:function(a){return this.createElementNSPlus("ows:Abstract",{value:a})},OutputFormat:function(a){return this.createElementNSPlus("ows:OutputFormat",{value:a})}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"}),OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(a,b){b.success=!1,b.exceptionReport={version:a.getAttribute("version"),language:a.getAttribute("language"),exceptions:[]},this.readChildNodes(a,b.exceptionReport)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"}),OpenLayers.Format.OWSContext.v0_3_1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{owc:"http://www.opengis.net/ows-context",gml:"http://www.opengis.net/gml",kml:"http://www.opengis.net/kml/2.2",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},VERSION:"0.3.1",schemaLocation:"http://www.opengis.net/ows-context http://www.ogcnetwork.net/schemas/owc/0.3.1/owsContext.xsd",defaultPrefix:"owc",extractAttributes:!0,xy:!0,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},featureNS:"http://mapserver.gis.umn.edu/mapserver",featureType:"vector",geometryName:"geometry",nestingLayerLookup:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]),OpenLayers.Format.GML.v2.prototype.setGeometryTypes.call(this)},setNestingPath:function(a){if(a.layersContext)for(var b=0,c=a.layersContext.length;b<c;b++){var d=a.layersContext[b],e=[],f=a.title||"";a.metadata&&a.metadata.nestingPath&&(e=a.metadata.nestingPath.slice()),""!=f&&e.push(f),d.metadata.nestingPath=e,d.layersContext&&this.setNestingPath(d)}},decomposeNestingPath:function(a){var b=[];if(OpenLayers.Util.isArray(a)){for(var c=a.slice();c.length>0;)b.push(c.slice()),c.pop();b.reverse()}return b},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};this.readNode(a,b),this.setNestingPath({layersContext:b.layersContext});var c=[];return this.processLayer(c,b),delete b.layersContext,b.layersContext=c,b},processLayer:function(a,b){if(b.layersContext)for(var c=0,d=b.layersContext.length;c<d;c++){var e=b.layersContext[c];a.push(e),e.layersContext&&this.processLayer(a,e)}},write:function(a,b){this.nestingLayerLookup={},b=b||{},OpenLayers.Util.applyDefaults(b,a);var c=this.writeNode("OWSContext",b);return this.nestingLayerLookup=null,this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[c])},readers:{kml:{Document:function(a,b){b.features=new OpenLayers.Format.KML({kmlns:this.namespaces.kml,extractStyles:!0}).read(a)}},owc:{OWSContext:function(a,b){this.readChildNodes(a,b)},General:function(a,b){this.readChildNodes(a,b)},ResourceList:function(a,b){this.readChildNodes(a,b)},Layer:function(a,b){var c={metadata:{},visibility:"1"!=a.getAttribute("hidden"),queryable:"1"==a.getAttribute("queryable"),opacity:null!=a.getAttribute("opacity")?parseFloat(a.getAttribute("opacity")):null,name:a.getAttribute("name"),categoryLayer:null==a.getAttribute("name"),formats:[],styles:[]};b.layersContext||(b.layersContext=[]),b.layersContext.push(c),this.readChildNodes(a,c)},InlineGeometry:function(a,b){b.features=[];var c,d=this.getElementsByTagNameNS(a,this.namespaces.gml,"featureMember");if(d.length>=1&&(c=d[0]),c&&c.firstChild){var e=c.firstChild.nextSibling?c.firstChild.nextSibling:c.firstChild;this.setNamespace("feature",e.namespaceURI),this.featureType=e.localName||e.nodeName.split(":").pop(),this.readChildNodes(a,b)}},Server:function(a,b){(b.service||b.version)&&b.service==OpenLayers.Format.Context.serviceTypes.WMS||(b.service=a.getAttribute("service"),b.version=a.getAttribute("version"),this.readChildNodes(a,b))},Name:function(a,b){b.name=this.getChildValue(a),this.readChildNodes(a,b)},Title:function(a,b){b.title=this.getChildValue(a),this.readChildNodes(a,b)},StyleList:function(a,b){this.readChildNodes(a,b.styles)},Style:function(a,b){var c={};b.push(c),this.readChildNodes(a,c)},LegendURL:function(a,b){var c={};b.legend=c,this.readChildNodes(a,c)},OnlineResource:function(a,b){b.url=this.getAttributeNS(a,this.namespaces.xlink,"href"),this.readChildNodes(a,b)}},ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows,gml:OpenLayers.Format.GML.v2.prototype.readers.gml,sld:OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{owc:{OWSContext:function(a){var b=this.createElementNSPlus("OWSContext",{attributes:{version:this.VERSION,id:a.id||OpenLayers.Util.createUniqueID("OpenLayers_OWSContext_")}});return this.writeNode("General",a,b),this.writeNode("ResourceList",a,b),b},General:function(a){var b=this.createElementNSPlus("General");return this.writeNode("ows:BoundingBox",a,b),this.writeNode("ows:Title",a.title||"OpenLayers OWSContext",b),b},ResourceList:function(a){for(var b=this.createElementNSPlus("ResourceList"),c=0,d=a.layers.length;c<d;c++){var e=a.layers[c],f=this.decomposeNestingPath(e.metadata.nestingPath);this.writeNode("_Layer",{layer:e,subPaths:f},b)}return b},Server:function(a){var b=this.createElementNSPlus("Server",{attributes:{version:a.version,service:a.service}});return this.writeNode("OnlineResource",a,b),b},OnlineResource:function(a){return this.createElementNSPlus("OnlineResource",{attributes:{"xlink:href":a.url}})},InlineGeometry:function(a){var b=this.createElementNSPlus("InlineGeometry"),c=a.getDataExtent();null!==c&&this.writeNode("gml:boundedBy",c,b);for(var d=0,e=a.features.length;d<e;d++)this.writeNode("gml:featureMember",a.features[d],b);return b},StyleList:function(a){for(var b=this.createElementNSPlus("StyleList"),c=0,d=a.length;c<d;c++)this.writeNode("Style",a[c],b);return b},Style:function(a){var b=this.createElementNSPlus("Style");return this.writeNode("Name",a,b),this.writeNode("Title",a,b),a.legend&&this.writeNode("LegendURL",a,b),b},Name:function(a){return this.createElementNSPlus("Name",{value:a.name})},Title:function(a){return this.createElementNSPlus("Title",{value:a.title})},LegendURL:function(a){var b=this.createElementNSPlus("LegendURL");return this.writeNode("OnlineResource",a.legend,b),b},_WMS:function(a){var b=this.createElementNSPlus("Layer",{attributes:{name:a.params.LAYERS,queryable:a.queryable?"1":"0",hidden:a.visibility?"0":"1",opacity:a.hasOwnProperty("opacity")?a.opacity:null}});return this.writeNode("ows:Title",a.name,b),this.writeNode("ows:OutputFormat",a.params.FORMAT,b),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WMS,version:a.params.VERSION,url:a.url},b),a.metadata.styles&&a.metadata.styles.length>0&&this.writeNode("StyleList",a.metadata.styles,b),b},_Layer:function(a){var b,c,d,e;if(b=a.layer,c=a.subPaths,d=null,e=null,c.length>0){var f=c[0].join("/"),g=f.lastIndexOf("/");return d=this.nestingLayerLookup[f],e=g>0?f.substring(g+1,f.length):f,d||(d=this.createElementNSPlus("Layer"),this.writeNode("ows:Title",e,d),this.nestingLayerLookup[f]=d),a.subPaths.shift(),this.writeNode("_Layer",a,d),d}return b instanceof OpenLayers.Layer.WMS?d=this.writeNode("_WMS",b):b instanceof OpenLayers.Layer.Vector&&(b.protocol instanceof OpenLayers.Protocol.WFS.v1?d=this.writeNode("_WFS",b):b.protocol instanceof OpenLayers.Protocol.HTTP?b.protocol.format instanceof OpenLayers.Format.GML?(b.protocol.format.version="2.1.2",d=this.writeNode("_GML",b)):b.protocol.format instanceof OpenLayers.Format.KML&&(b.protocol.format.version="2.2",d=this.writeNode("_KML",b)):(this.setNamespace("feature",this.featureNS),d=this.writeNode("_InlineGeometry",b))),b.options.maxScale&&this.writeNode("sld:MinScaleDenominator",b.options.maxScale,d),b.options.minScale&&this.writeNode("sld:MaxScaleDenominator",b.options.minScale,d),this.nestingLayerLookup[b.name]=d,d},_WFS:function(a){var b=this.createElementNSPlus("Layer",{attributes:{name:a.protocol.featurePrefix+":"+a.protocol.featureType,hidden:a.visibility?"0":"1"}});return this.writeNode("ows:Title",a.name,b),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WFS,version:a.protocol.version,url:a.protocol.url},b),b},_InlineGeometry:function(a){var b=this.createElementNSPlus("Layer",{attributes:{name:this.featureType,hidden:a.visibility?"0":"1"}});return this.writeNode("ows:Title",a.name,b),this.writeNode("InlineGeometry",a,b),b},_GML:function(a){var b=this.createElementNSPlus("Layer");return this.writeNode("ows:Title",a.name,b),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.GML,url:a.protocol.url,version:a.protocol.format.version},b),b},_KML:function(a){var b=this.createElementNSPlus("Layer");return this.writeNode("ows:Title",a.name,b),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.KML,version:a.protocol.format.version,url:a.protocol.url},b),b}},gml:OpenLayers.Util.applyDefaults({boundedBy:function(a){var b=this.createElementNSPlus("gml:boundedBy");return this.writeNode("gml:Box",a,b),b}},OpenLayers.Format.GML.v2.prototype.writers.gml),ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.writers.ows,sld:OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},CLASS_NAME:"OpenLayers.Format.OWSContext.v0_3_1"}),OpenLayers.Format.CSWGetRecords=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Format.CSWGetRecords.DEFAULTS);var b=OpenLayers.Format.CSWGetRecords["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported CSWGetRecords version: "+a.version;return new b(a)},OpenLayers.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"},OpenLayers.Format.WFSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",CLASS_NAME:"OpenLayers.Format.WFSCapabilities"}),OpenLayers.Format.WFSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wfs:"http://www.opengis.net/wfs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},errorProperty:"featureTypeList",defaultPrefix:"wfs",read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},readers:{wfs:{WFS_Capabilities:function(a,b){this.readChildNodes(a,b)},FeatureTypeList:function(a,b){b.featureTypeList={featureTypes:[]},this.readChildNodes(a,b.featureTypeList)},FeatureType:function(a,b){var c={};this.readChildNodes(a,c),b.featureTypes.push(c)},Name:function(a,b){var c=this.getChildValue(a);if(c){var d=c.split(":");b.name=d.pop(),d.length>0&&(b.featureNS=this.lookupNamespaceURI(a,d[0]))}},Title:function(a,b){var c=this.getChildValue(a);c&&(b.title=c)},Abstract:function(a,b){var c=this.getChildValue(a);c&&(b.abstract=c)}}},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1"}),OpenLayers.Format.WFSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},readers:{wfs:OpenLayers.Util.applyDefaults({DefaultSRS:function(a,b){var c=this.getChildValue(a);c&&(b.srs=c)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs),ows:OpenLayers.Format.OWSCommon.v1.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_1_0"}),OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:!1,createGeometryFromItem:function(a){var b=this.getElementsByTagNameNS(a,this.georssns,"point"),c=this.getElementsByTagNameNS(a,this.geons,"lat"),d=this.getElementsByTagNameNS(a,this.geons,"long"),e=this.getElementsByTagNameNS(a,this.georssns,"line"),f=this.getElementsByTagNameNS(a,this.georssns,"polygon"),g=this.getElementsByTagNameNS(a,this.georssns,"where"),h=this.getElementsByTagNameNS(a,this.georssns,"box");if(b.length>0||c.length>0&&d.length>0){var i;b.length>0?(i=OpenLayers.String.trim(b[0].firstChild.nodeValue).split(/\s+/),2!=i.length&&(i=OpenLayers.String.trim(b[0].firstChild.nodeValue).split(/\s*,\s*/))):i=[parseFloat(c[0].firstChild.nodeValue),parseFloat(d[0].firstChild.nodeValue)];var j=new OpenLayers.Geometry.Point(i[1],i[0])}else if(e.length>0){for(var b,k=OpenLayers.String.trim(this.getChildValue(e[0])).split(/\s+/),l=[],m=0,n=k.length;m<n;m+=2)b=new OpenLayers.Geometry.Point(k[m+1],k[m]),l.push(b);j=new OpenLayers.Geometry.LineString(l)}else if(f.length>0){for(var b,k=OpenLayers.String.trim(this.getChildValue(f[0])).split(/\s+/),l=[],m=0,n=k.length;m<n;m+=2)b=new OpenLayers.Geometry.Point(k[m+1],k[m]),l.push(b);j=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(l)])}else if(g.length>0){this.gmlParser||(this.gmlParser=new OpenLayers.Format.GML({xy:this.xy}));var o=this.gmlParser.parseFeature(g[0]);j=o.geometry}else if(h.length>0){var b,k=OpenLayers.String.trim(h[0].firstChild.nodeValue).split(/\s+/),l=[];k.length>3&&(b=new OpenLayers.Geometry.Point(k[1],k[0]),l.push(b),b=new OpenLayers.Geometry.Point(k[1],k[2]),l.push(b),b=new OpenLayers.Geometry.Point(k[3],k[2]),l.push(b),b=new OpenLayers.Geometry.Point(k[3],k[0]),l.push(b),b=new OpenLayers.Geometry.Point(k[1],k[0]),l.push(b)),j=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(l)])}return j&&this.internalProjection&&this.externalProjection&&j.transform(this.externalProjection,this.internalProjection),j},createFeatureFromItem:function(a){var b=this.createGeometryFromItem(a),c=this._getChildValue(a,"*","title",this.featureTitle),d=this._getChildValue(a,"*","description",this._getChildValue(a,"*","content",this._getChildValue(a,"*","summary",this.featureDescription))),e=this._getChildValue(a,"*","link");if(!e)try{e=this.getElementsByTagNameNS(a,"*","link")[0].getAttribute("href")}catch(a){e=null}var f=this._getChildValue(a,"*","id",null),g={title:c,description:d,link:e},h=new OpenLayers.Feature.Vector(b,g);return h.fid=f,h},_getChildValue:function(a,b,c,d){var e=this.getElementsByTagNameNS(a,b,c);return e&&e[0]&&e[0].firstChild&&e[0].firstChild.nodeValue?this.getChildValue(e[0]):void 0==d?"":d},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=null;b=this.getElementsByTagNameNS(a,"*","item"),0==b.length&&(b=this.getElementsByTagNameNS(a,"*","entry"));for(var c=b.length,d=new Array(c),e=0;e<c;e++)d[e]=this.createFeatureFromItem(b[e]);return d},write:function(a){var b;if(OpenLayers.Util.isArray(a)){b=this.createElementNS(this.rssns,"rss");for(var c=0,d=a.length;c<d;c++)b.appendChild(this.createFeatureXML(a[c]))}else b=this.createFeatureXML(a);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(a){var b=this.buildGeometryNode(a.geometry),c=this.createElementNS(this.rssns,"item"),d=this.createElementNS(this.rssns,"title");d.appendChild(this.createTextNode(a.attributes.title?a.attributes.title:""));var e=this.createElementNS(this.rssns,"description");if(e.appendChild(this.createTextNode(a.attributes.description?a.attributes.description:"")),c.appendChild(d),c.appendChild(e),a.attributes.link){var f=this.createElementNS(this.rssns,"link");f.appendChild(this.createTextNode(a.attributes.link)),c.appendChild(f)}for(var g in a.attributes)if("link"!=g&&"title"!=g&&"description"!=g){var h=this.createTextNode(a.attributes[g]),i=g;-1!=g.search(":")&&(i=g.split(":")[1]);var j=this.createElementNS(this.featureNS,"feature:"+i);j.appendChild(h),c.appendChild(j)}return c.appendChild(b),c},buildGeometryNode:function(a){this.internalProjection&&this.externalProjection&&(a=a.clone(),
a.transform(this.internalProjection,this.externalProjection));var b;if("OpenLayers.Geometry.Polygon"==a.CLASS_NAME)b=this.createElementNS(this.georssns,"georss:polygon"),b.appendChild(this.buildCoordinatesNode(a.components[0]));else if("OpenLayers.Geometry.LineString"==a.CLASS_NAME)b=this.createElementNS(this.georssns,"georss:line"),b.appendChild(this.buildCoordinatesNode(a));else{if("OpenLayers.Geometry.Point"!=a.CLASS_NAME)throw"Couldn't parse "+a.CLASS_NAME;b=this.createElementNS(this.georssns,"georss:point"),b.appendChild(this.buildCoordinatesNode(a))}return b},buildCoordinatesNode:function(a){var b=null;a.components&&(b=a.components);var c;if(b){for(var d=b.length,e=new Array(d),f=0;f<d;f++)e[f]=b[f].y+" "+b[f].x;c=e.join(" ")}else c=a.y+" "+a.x;return this.createTextNode(c)},CLASS_NAME:"OpenLayers.Format.GeoRSS"}),OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:["mousedown","mouseup","click","dblclick","touchstart","touchmove","touchend","keydown"],startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(a){this.target=a;for(var b=this.events.length-1;b>=0;--b)this.target.register(this.events[b],this,this.buttonClick,{extension:!0})},destroy:function(){for(var a=this.events.length-1;a>=0;--a)this.target.unregister(this.events[a],this,this.buttonClick);delete this.target},getPressedButton:function(a){var b,c=3;do{if(OpenLayers.Element.hasClass(a,"olButton")){b=a;break}a=a.parentNode}while(--c>0&&a);return b},ignore:function(a){var b=3,c=!1;do{if("a"===a.nodeName.toLowerCase()){c=!0;break}a=a.parentNode}while(--b>0&&a);return c},buttonClick:function(a){var b=!0,c=OpenLayers.Event.element(a);if(c&&(OpenLayers.Event.isLeftClick(a)||!~a.type.indexOf("mouse"))){var d=this.getPressedButton(c);if(d){if("keydown"===a.type)switch(a.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:d}),OpenLayers.Event.stop(a),b=!1}else if(this.startEvt){if(this.completeRegEx.test(a.type)){var e=OpenLayers.Util.pagePosition(d),f=OpenLayers.Util.getViewportElement(),g=window.pageYOffset||f.scrollTop,h=window.pageXOffset||f.scrollLeft;e[0]=e[0]-h,e[1]=e[1]-g,this.target.triggerEvent("buttonclick",{buttonElement:d,buttonXY:{x:this.startEvt.clientX-e[0],y:this.startEvt.clientY-e[1]}})}this.cancelRegEx.test(a.type)&&delete this.startEvt,OpenLayers.Event.stop(a),b=!1}this.startRegEx.test(a.type)&&(this.startEvt=a,OpenLayers.Event.stop(a),b=!1)}else b=!this.ignore(OpenLayers.Event.element(a)),delete this.startEvt}return b}}),OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.vendorPrefix=function(){"use strict";function a(a){return a?a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()}).replace(/^ms-/,"-ms-"):null}function b(b){if(void 0===g[b]){var c=b.replace(/(-[\s\S])/g,function(a){return a.charAt(1).toUpperCase()}),e=d(c);g[b]=a(e)}return g[b]}function c(a,b){if(void 0===h[b]){var c,d,f=0,g=e.length,i=void 0!==a.cssText;for(h[b]=null;f<g;f++)if(d=e[f],d?(i||(d=d.toLowerCase()),c=d+b.charAt(0).toUpperCase()+b.slice(1)):c=b,void 0!==a[c]){h[b]=c;break}}return h[b]}function d(a){return c(f,a)}var e=["","O","ms","Moz","Webkit"],f=document.createElement("div").style,g={},h={};return{css:b,js:c,style:d,cssCache:g,jsCache:h}}(),OpenLayers.Animation=function(a){function b(a,b,c){b=b>0?b:Number.POSITIVE_INFINITY;var d=++g,e=+new Date;return h[d]=function(){h[d]&&+new Date-e<=b?(a(),h[d]&&f(h[d],c)):delete h[d]},f(h[d],c),d}function c(a){delete h[a]}var d=OpenLayers.Util.vendorPrefix.js(a,"requestAnimationFrame"),e=!!d,f=function(){var b=a[d]||function(b,c){a.setTimeout(b,16)};return function(c,d){b.apply(a,[c,d])}}(),g=0,h={};return{isNative:e,requestFrame:f,start:b,stop:c}}(window),OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,minFrameRate:null,startTime:null,animationId:null,playing:!1,initialize:function(a){this.easing=a||OpenLayers.Easing.Expo.easeOut},start:function(a,b,c,d){this.playing=!0,this.begin=a,this.finish=b,this.duration=c,this.callbacks=d.callbacks,this.minFrameRate=d.minFrameRate||30,this.time=0,this.startTime=(new Date).getTime(),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin),this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.playing=!1)},play:function(){var a={};for(var b in this.begin){var c=this.begin[b],d=this.finish[b];if(null==c||null==d||isNaN(c)||isNaN(d))throw new TypeError("invalid value for Tween");var e=d-c;a[b]=this.easing.apply(this,[this.time,c,e,this.duration])}this.time++,this.callbacks&&this.callbacks.eachStep&&((new Date).getTime()-this.startTime)/this.time<=1e3/this.minFrameRate&&this.callbacks.eachStep.call(this,a),this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"}),OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"},OpenLayers.Easing.Linear={easeIn:function(a,b,c,d){return c*a/d+b},easeOut:function(a,b,c,d){return c*a/d+b},easeInOut:function(a,b,c,d){return c*a/d+b},CLASS_NAME:"OpenLayers.Easing.Linear"},OpenLayers.Easing.Expo={easeIn:function(a,b,c,d){return 0==a?b:c*Math.pow(2,10*(a/d-1))+b},easeOut:function(a,b,c,d){return a==d?b+c:c*(1-Math.pow(2,-10*a/d))+b},easeInOut:function(a,b,c,d){return 0==a?b:a==d?b+c:(a/=d/2)<1?c/2*Math.pow(2,10*(a-1))+b:c/2*(2-Math.pow(2,-10*--a))+b},CLASS_NAME:"OpenLayers.Easing.Expo"},OpenLayers.Easing.Quad={easeIn:function(a,b,c,d){return c*(a/=d)*a+b},easeOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},CLASS_NAME:"OpenLayers.Easing.Quad"},OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1e3},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!1,autoUpdateSize:!0,eventListeners:null,panTween:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,zoomTween:null,zoomMethod:OpenLayers.Easing.Quad.easeOut,zoomDuration:20,paddingForPopups:null,layerContainerOriginPx:null,minPx:null,maxPx:null,initialize:function(a,b){1===arguments.length&&"object"==typeof a&&(b=a,a=b&&b.div),this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT),this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15),this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css",this.options=OpenLayers.Util.extend({},b),OpenLayers.Util.extend(this,b);var c=this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection;OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[c]),!this.maxExtent||this.maxExtent instanceof OpenLayers.Bounds||(this.maxExtent=new OpenLayers.Bounds(this.maxExtent)),!this.minExtent||this.minExtent instanceof OpenLayers.Bounds||(this.minExtent=new OpenLayers.Bounds(this.minExtent)),!this.restrictedExtent||this.restrictedExtent instanceof OpenLayers.Bounds||(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent)),!this.center||this.center instanceof OpenLayers.LonLat||(this.center=new OpenLayers.LonLat(this.center)),this.layers=[],this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_"),this.div=OpenLayers.Util.getElement(a),this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px"),OpenLayers.Element.addClass(this.div,"olMap");var d=this.id+"_OpenLayers_ViewPort";if(this.viewPortDiv=OpenLayers.Util.createDiv(d,null,null,null,"relative",null,"hidden"),this.viewPortDiv.style.width="100%",this.viewPortDiv.style.height="100%",this.viewPortDiv.className="olMapViewport",this.div.appendChild(this.viewPortDiv),this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0}),OpenLayers.TileManager&&null!==this.tileManager&&(this.tileManager instanceof OpenLayers.TileManager||(this.tileManager=new OpenLayers.TileManager(this.tileManager)),this.tileManager.addMap(this)),d=this.id+"_OpenLayers_Container",this.layerContainerDiv=OpenLayers.Util.createDiv(d),this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1,this.layerContainerOriginPx={x:0,y:0},this.applyTransform(),this.viewPortDiv.appendChild(this.layerContainerDiv),this.updateSize(),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),!0===this.autoUpdateSize&&(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)),this.theme){for(var e=!0,f=document.getElementsByTagName("link"),g=0,h=f.length;g<h;++g)if(OpenLayers.Util.isEquivalentUrl(f.item(g).href,this.theme)){e=!1;break}if(e){var i=document.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(i)}}null==this.controls&&(this.controls=[],null!=OpenLayers.Control&&(OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&&this.controls.push(new OpenLayers.Control.TouchNavigation),OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom),OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser),OpenLayers.Control.Attribution&&this.controls.push(new OpenLayers.Control.Attribution)));for(var g=0,h=this.controls.length;g<h;g++)this.addControlToMap(this.controls[g]);this.popups=[],this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this),OpenLayers.Event.observe(window,"unload",this.unloadDestroy),b&&b.layers&&(delete this.center,delete this.zoom,this.addLayers(b.layers),b.center&&!this.getCenter()&&this.setCenter(b.center,b.zoom)),this.panMethod&&(this.panTween=new OpenLayers.Tween(this.panMethod)),this.zoomMethod&&this.applyTransform.transform&&(this.zoomTween=new OpenLayers.Tween(this.zoomMethod))},getViewport:function(){return this.viewPortDiv},render:function(a){this.div=OpenLayers.Util.getElement(a),OpenLayers.Element.addClass(this.div,"olMap"),this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.div.appendChild(this.viewPortDiv),this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy)return!1;if(this.panTween&&(this.panTween.stop(),this.panTween=null),this.zoomTween&&(this.zoomTween.stop(),this.zoomTween=null),OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy),this.unloadDestroy=null,this.updateSizeDestroy&&OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy),this.paddingForPopups=null,null!=this.controls){for(var a=this.controls.length-1;a>=0;--a)this.controls[a].destroy();this.controls=null}if(null!=this.layers){for(var a=this.layers.length-1;a>=0;--a)this.layers[a].destroy(!1);this.layers=null}this.viewPortDiv&&this.viewPortDiv.parentNode&&this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.viewPortDiv=null,this.tileManager&&(this.tileManager.removeMap(this),this.tileManager=null),this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null),this.events.destroy(),this.events=null,this.options=null},setOptions:function(a){var b=this.minPx&&a.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,a),b&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(a,b,c){var d="function"==typeof c.test;return OpenLayers.Array.filter(this[a],function(a){return a[b]==c||d&&c.test(a[b])})},getLayersBy:function(a,b){return this.getBy("layers",a,b)},getLayersByName:function(a){return this.getLayersBy("name",a)},getLayersByClass:function(a){return this.getLayersBy("CLASS_NAME",a)},getControlsBy:function(a,b){return this.getBy("controls",a,b)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},getLayer:function(a){for(var b=null,c=0,d=this.layers.length;c<d;c++){var e=this.layers[c];if(e.id==a){b=e;break}}return b},setLayerZIndex:function(a,b){a.setZIndex(this.Z_INDEX_BASE[a.isBaseLayer?"BaseLayer":"Overlay"]+5*b)},resetLayersZIndex:function(){for(var a=0,b=this.layers.length;a<b;a++){var c=this.layers[a];this.setLayerZIndex(c,a)}},addLayer:function(a){for(var b=0,c=this.layers.length;b<c;b++)if(this.layers[b]==a)return!1;return!1!==this.events.triggerEvent("preaddlayer",{layer:a})&&(this.allOverlays&&(a.isBaseLayer=!1),a.div.className="olLayerDiv",a.div.style.overflow="",this.setLayerZIndex(a,this.layers.length),a.isFixed?this.viewPortDiv.appendChild(a.div):this.layerContainerDiv.appendChild(a.div),this.layers.push(a),a.setMap(this),a.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(a):a.setVisibility(!1):a.redraw(),this.events.triggerEvent("addlayer",{layer:a}),a.events.triggerEvent("added",{map:this,layer:a}),a.afterAdd(),!0)},addLayers:function(a){for(var b=0,c=a.length;b<c;b++)this.addLayer(a[b])},removeLayer:function(a,b){if(!1!==this.events.triggerEvent("preremovelayer",{layer:a})){if(null==b&&(b=!0),a.isFixed?this.viewPortDiv.removeChild(a.div):this.layerContainerDiv.removeChild(a.div),OpenLayers.Util.removeItem(this.layers,a),a.removeMap(this),a.map=null,this.baseLayer==a&&(this.baseLayer=null,b))for(var c=0,d=this.layers.length;c<d;c++){var e=this.layers[c];if(e.isBaseLayer||this.allOverlays){this.setBaseLayer(e);break}}this.resetLayersZIndex(),this.events.triggerEvent("removelayer",{layer:a}),a.events.triggerEvent("removed",{map:this,layer:a})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(a){return OpenLayers.Util.indexOf(this.layers,a)},setLayerIndex:function(a,b){var c=this.getLayerIndex(a);if(b<0?b=0:b>this.layers.length&&(b=this.layers.length),c!=b){this.layers.splice(c,1),this.layers.splice(b,0,a);for(var d=0,e=this.layers.length;d<e;d++)this.setLayerZIndex(this.layers[d],d);this.events.triggerEvent("changelayer",{layer:a,property:"order"}),this.allOverlays&&(0===b?this.setBaseLayer(a):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(a,b){var c=this.getLayerIndex(a)+b;this.setLayerIndex(a,c)},setBaseLayer:function(a){if(a!=this.baseLayer&&-1!=OpenLayers.Util.indexOf(this.layers,a)){var b=this.getCachedCenter(),c=OpenLayers.Util.getResolutionFromScale(this.getScale(),a.units);if(null==this.baseLayer||this.allOverlays||this.baseLayer.setVisibility(!1),this.baseLayer=a,this.allOverlays&&!this.baseLayer.visibility||(this.baseLayer.setVisibility(!0),!1===this.baseLayer.inRange&&this.baseLayer.redraw()),null!=b){var d=this.getZoomForResolution(c||this.resolution,!0);this.setCenter(b,d,!1,!0)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(a,b){this.controls.push(a),this.addControlToMap(a,b)},addControls:function(a,b){for(var c=1===arguments.length?[]:b,d=0,e=a.length;d<e;d++){var f=a[d],g=c[d]?c[d]:null;this.addControl(f,g)}},addControlToMap:function(a,b){a.outsideViewport=null!=a.div,this.displayProjection&&!a.displayProjection&&(a.displayProjection=this.displayProjection),a.setMap(this);var c=a.draw(b);c&&(a.outsideViewport||(c.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(c))),a.autoActivate&&a.activate()},getControl:function(a){for(var b=null,c=0,d=this.controls.length;c<d;c++){var e=this.controls[c];if(e.id==a){b=e;break}}return b},removeControl:function(a){a&&a==this.getControl(a.id)&&(a.div&&a.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(a.div),OpenLayers.Util.removeItem(this.controls,a))},addPopup:function(a,b){if(b)for(var c=this.popups.length-1;c>=0;--c)this.removePopup(this.popups[c]);a.map=this,this.popups.push(a);var d=a.draw();d&&(d.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(d))},removePopup:function(a){if(OpenLayers.Util.removeItem(this.popups,a),a.div)try{this.layerContainerDiv.removeChild(a.div)}catch(a){}a.map=null},getSize:function(){var a=null;return null!=this.size&&(a=this.size.clone()),a},updateSize:function(){var a=this.getCurrentSize();if(a&&!isNaN(a.h)&&!isNaN(a.w)){this.events.clearMouseCache();var b=this.getSize();if(null==b&&(this.size=b=a),!a.equals(b)){this.size=a;for(var c=0,d=this.layers.length;c<d;c++)this.layers[c].onMapResize();var e=this.getCachedCenter();if(null!=this.baseLayer&&null!=e){var f=this.getZoom();this.zoom=null,this.setCenter(e,f)}}}this.events.triggerEvent("updatesize")},getCurrentSize:function(){var a=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);return(0==a.w&&0==a.h||isNaN(a.w)&&isNaN(a.h))&&(a.w=this.div.offsetWidth,a.h=this.div.offsetHeight),(0==a.w&&0==a.h||isNaN(a.w)&&isNaN(a.h))&&(a.w=parseInt(this.div.style.width),a.h=parseInt(this.div.style.height)),a},calculateBounds:function(a,b){var c=null;if(null==a&&(a=this.getCachedCenter()),null==b&&(b=this.getResolution()),null!=a&&null!=b){var d=this.size.w*b/2,e=this.size.h*b/2;c=new OpenLayers.Bounds(a.lon-d,a.lat-e,a.lon+d,a.lat+e)}return c},getCenter:function(){var a=null,b=this.getCachedCenter();return b&&(a=b.clone()),a},getCachedCenter:function(){return!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2})),this.center},getZoom:function(){return this.zoom},pan:function(a,b,c){if(c=OpenLayers.Util.applyDefaults(c,{animate:!0,dragging:!1}),c.dragging)0==a&&0==b||this.moveByPx(a,b);else{var d=this.getViewPortPxFromLonLat(this.getCachedCenter()),e=d.add(a,b);if(this.dragging||!e.equals(d)){var f=this.getLonLatFromViewPortPx(e);c.animate?this.panTo(f):(this.moveTo(f),this.dragging&&(this.dragging=!1,this.events.triggerEvent("moveend")))}}},panTo:function(a){if(this.panTween&&this.getExtent().scale(this.panRatio).containsLonLat(a)){var b=this.getCachedCenter();if(a.equals(b))return;var c=this.getPixelFromLonLat(b),d=this.getPixelFromLonLat(a),e={x:d.x-c.x,y:d.y-c.y},f={x:0,y:0};this.panTween.start({x:0,y:0},e,this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(a){var b=a.x-f.x,c=a.y-f.y;this.moveByPx(b,c),f.x=Math.round(a.x),f.y=Math.round(a.y)},this),done:OpenLayers.Function.bind(function(b){this.moveTo(a),this.dragging=!1,this.events.triggerEvent("moveend")},this)}})}else this.setCenter(a)},setCenter:function(a,b,c,d){this.panTween&&this.panTween.stop(),this.zoomTween&&this.zoomTween.stop(),this.moveTo(a,b,{dragging:c,forceZoomChange:d})},moveByPx:function(a,b){var c=this.size.w/2,d=this.size.h/2,e=c+a,f=d+b,g=this.baseLayer.wrapDateLine,h=0,i=0;if(this.restrictedExtent&&(h=c,i=d,g=!1),a=g||e<=this.maxPx.x-h&&e>=this.minPx.x+h?Math.round(a):0,b=f<=this.maxPx.y-i&&f>=this.minPx.y+i?Math.round(b):0,a||b){this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart")),this.center=null,a&&(this.layerContainerOriginPx.x-=a,this.minPx.x-=a,this.maxPx.x-=a),b&&(this.layerContainerOriginPx.y-=b,this.minPx.y-=b,this.maxPx.y-=b),this.applyTransform();var j,k,l;for(k=0,l=this.layers.length;k<l;++k)j=this.layers[k],j.visibility&&(j===this.baseLayer||j.inRange)&&(j.moveByPx(a,b),j.events.triggerEvent("move"));this.events.triggerEvent("move")}},adjustZoom:function(a){if(this.baseLayer&&this.baseLayer.wrapDateLine){var b=this.baseLayer.resolutions,c=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(a)>c)if(this.fractionalZoom)a=this.getZoomForResolution(c);else for(var d=0|a,e=b.length;d<e;++d)if(b[d]<=c){a=d;break}}return a},getMinZoom:function(){return this.adjustZoom(0)},moveTo:function(a,b,c){null==a||a instanceof OpenLayers.LonLat||(a=new OpenLayers.LonLat(a)),c||(c={}),null!=b&&(b=parseFloat(b),this.fractionalZoom||(b=Math.round(b)));var d=b;(b=this.adjustZoom(b))!==d&&(a=this.getCenter());var e=c.dragging||this.dragging,f=c.forceZoomChange;if(this.getCachedCenter()||this.isValidLonLat(a)||(a=this.maxExtent.getCenterLonLat(),this.center=a.clone()),null!=this.restrictedExtent){null==a&&(a=this.center),null==b&&(b=this.getZoom());var g=this.getResolutionForZoom(b),h=this.calculateBounds(a,g);if(!this.restrictedExtent.containsBounds(h)){var i=this.restrictedExtent.getCenterLonLat();h.getWidth()>this.restrictedExtent.getWidth()?a=new OpenLayers.LonLat(i.lon,a.lat):h.left<this.restrictedExtent.left?a=a.add(this.restrictedExtent.left-h.left,0):h.right>this.restrictedExtent.right&&(a=a.add(this.restrictedExtent.right-h.right,0)),h.getHeight()>this.restrictedExtent.getHeight()?a=new OpenLayers.LonLat(a.lon,i.lat):h.bottom<this.restrictedExtent.bottom?a=a.add(0,this.restrictedExtent.bottom-h.bottom):h.top>this.restrictedExtent.top&&(a=a.add(0,this.restrictedExtent.top-h.top))}}var j=f||this.isValidZoomLevel(b)&&b!=this.getZoom(),k=this.isValidLonLat(a)&&!a.equals(this.center);if(j||k||e){e||this.events.triggerEvent("movestart",{zoomChanged:j}),k&&(!j&&this.center&&this.centerLayerContainer(a),this.center=a.clone());var l=j?this.getResolutionForZoom(b):this.getResolution();if(j||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter(),this.layerContainerOriginPx.x=0,this.layerContainerOriginPx.y=0,this.applyTransform();var m=this.getMaxExtent({restricted:!0}),n=m.getCenterLonLat(),o=this.center.lon-n.lon,p=n.lat-this.center.lat,q=Math.round(m.getWidth()/l),r=Math.round(m.getHeight()/l);this.minPx={x:(this.size.w-q)/2-o/l,y:(this.size.h-r)/2-p/l},this.maxPx={x:this.minPx.x+Math.round(m.getWidth()/l),y:this.minPx.y+Math.round(m.getHeight()/l)}}j&&(this.zoom=b,this.resolution=l);var s=this.getExtent();this.baseLayer.visibility&&(this.baseLayer.moveTo(s,j,c.dragging),c.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:j})),s=this.baseLayer.getExtent();for(var t=this.layers.length-1;t>=0;--t){var u=this.layers[t];if(u!==this.baseLayer&&!u.isBaseLayer){var v=u.calculateInRange();u.inRange!=v&&(u.inRange=v,v||u.display(!1),this.events.triggerEvent("changelayer",{layer:u,property:"visibility"})),v&&u.visibility&&(u.moveTo(s,j,c.dragging),c.dragging||u.events.triggerEvent("moveend",{zoomChanged:j}))}}if(this.events.triggerEvent("move"),e||this.events.triggerEvent("moveend"),j){for(var t=0,w=this.popups.length;t<w;t++)this.popups[t].updatePosition();this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(a){var b=this.getViewPortPxFromLonLat(this.layerContainerOrigin),c=this.getViewPortPxFromLonLat(a);if(null!=b&&null!=c){var d=this.layerContainerOriginPx.x,e=this.layerContainerOriginPx.y,f=Math.round(b.x-c.x),g=Math.round(b.y-c.y);this.applyTransform(this.layerContainerOriginPx.x=f,this.layerContainerOriginPx.y=g);var h=d-f,i=e-g;this.minPx.x-=h,this.maxPx.x-=h,this.minPx.y-=i,this.maxPx.y-=i}},isValidZoomLevel:function(a){return null!=a&&a>=0&&a<this.getNumZoomLevels()},isValidLonLat:function(a){var b=!1;if(null!=a){var c=this.getMaxExtent(),d=this.baseLayer.wrapDateLine&&c;b=c.containsLonLat(a,{worldBounds:d})}return b},getProjection:function(){var a=this.getProjectionObject();return a?a.getCode():null},getProjectionObject:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.projection),a},getMaxResolution:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.maxResolution),a},getMaxExtent:function(a){var b=null;return a&&a.restricted&&this.restrictedExtent?b=this.restrictedExtent:null!=this.baseLayer&&(b=this.baseLayer.maxExtent),b},getNumZoomLevels:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.numZoomLevels),a},getExtent:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.getExtent()),a},getResolution:function(){var a=null;return null!=this.baseLayer?a=this.baseLayer.getResolution():!0===this.allOverlays&&this.layers.length>0&&(a=this.layers[0].getResolution()),a},getUnits:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.units),a},getScale:function(){var a=null;if(null!=this.baseLayer){var b=this.getResolution(),c=this.baseLayer.units;a=OpenLayers.Util.getScaleFromResolution(b,c)}return a},getZoomForExtent:function(a,b){var c=null;return null!=this.baseLayer&&(c=this.baseLayer.getZoomForExtent(a,b)),c},getResolutionForZoom:function(a){var b=null;return this.baseLayer&&(b=this.baseLayer.getResolutionForZoom(a)),b},getZoomForResolution:function(a,b){var c=null;return null!=this.baseLayer&&(c=this.baseLayer.getZoomForResolution(a,b)),c},zoomTo:function(a,b){var c=this;if(c.isValidZoomLevel(a))if(c.baseLayer.wrapDateLine&&(a=c.adjustZoom(a)),c.zoomTween){var d=c.getResolution(),e=c.getResolutionForZoom(a),f={scale:1},g={scale:d/e};if(c.zoomTween.playing&&c.zoomTween.duration<3*c.zoomDuration)c.zoomTween.finish={scale:c.zoomTween.finish.scale*g.scale};else{if(!b){var h=c.getSize();b={x:h.w/2,y:h.h/2}}c.zoomTween.start(f,g,c.zoomDuration,{minFrameRate:50,callbacks:{eachStep:function(a){var d=c.layerContainerOriginPx,e=a.scale,f=(e-1)*(d.x-b.x)|0,g=(e-1)*(d.y-b.y)|0;c.applyTransform(d.x+f,d.y+g,e)},done:function(a){c.applyTransform();var d=c.getResolution()/a.scale,e=c.getZoomForResolution(d,!0);c.moveTo(c.getZoomTargetCenter(b,d),e,!0)}}})}}else{var i=b?c.getZoomTargetCenter(b,c.getResolutionForZoom(a)):null;c.setCenter(i,a)}},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(a,b){a instanceof OpenLayers.Bounds||(a=new OpenLayers.Bounds(a));var c=a.getCenterLonLat();if(this.baseLayer.wrapDateLine){var d=this.getMaxExtent();for(a=a.clone();a.right<a.left;)a.right+=d.getWidth();c=a.getCenterLonLat().wrapDateLine(d)}this.setCenter(c,this.getZoomForExtent(a,b))},zoomToMaxExtent:function(a){var b=!a||a.restricted,c=this.getMaxExtent({restricted:b});this.zoomToExtent(c)},zoomToScale:function(a,b){var c=OpenLayers.Util.getResolutionFromScale(a,this.baseLayer.units),d=this.size.w*c/2,e=this.size.h*c/2,f=this.getCachedCenter(),g=new OpenLayers.Bounds(f.lon-d,f.lat-e,f.lon+d,f.lat+e);this.zoomToExtent(g,b)},getLonLatFromViewPortPx:function(a){var b=null;return null!=this.baseLayer&&(b=this.baseLayer.getLonLatFromViewPortPx(a)),b},getViewPortPxFromLonLat:function(a){var b=null;return null!=this.baseLayer&&(b=this.baseLayer.getViewPortPxFromLonLat(a)),b},getZoomTargetCenter:function(a,b){var c=null,d=this.getSize(),e=d.w/2-a.x,f=a.y-d.h/2,g=this.getLonLatFromPixel(a);return g&&(c=new OpenLayers.LonLat(g.lon+e*b,g.lat+f*b)),c},getLonLatFromPixel:function(a){return this.getLonLatFromViewPortPx(a)},getPixelFromLonLat:function(a){var b=this.getViewPortPxFromLonLat(a);return b.x=Math.round(b.x),b.y=Math.round(b.y),b},getGeodesicPixelSize:function(a){var b=a?this.getLonLatFromPixel(a):this.getCachedCenter()||new OpenLayers.LonLat(0,0),c=this.getResolution(),d=b.add(-c/2,0),e=b.add(c/2,0),f=b.add(0,-c/2),g=b.add(0,c/2),h=new OpenLayers.Projection("EPSG:4326"),i=this.getProjectionObject()||h;return i.equals(h)||(d.transform(i,h),e.transform(i,h),f.transform(i,h),g.transform(i,h)),new OpenLayers.Size(OpenLayers.Util.distVincenty(d,e),OpenLayers.Util.distVincenty(f,g))},getViewPortPxFromLayerPx:function(a){var b=null;if(null!=a){var c=this.layerContainerOriginPx.x,d=this.layerContainerOriginPx.y;b=a.add(c,d)}return b},getLayerPxFromViewPortPx:function(a){var b=null;if(null!=a){var c=-this.layerContainerOriginPx.x,d=-this.layerContainerOriginPx.y;b=a.add(c,d),(isNaN(b.x)||isNaN(b.y))&&(b=null)}return b},getLonLatFromLayerPx:function(a){return a=this.getViewPortPxFromLayerPx(a),this.getLonLatFromViewPortPx(a)},getLayerPxFromLonLat:function(a){var b=this.getPixelFromLonLat(a);return this.getLayerPxFromViewPortPx(b)},applyTransform:function(a,b,c){c=c||1;var d=this.layerContainerOriginPx,e=1!==c;a=a||d.x,b=b||d.y;var f=this.layerContainerDiv.style,g=this.applyTransform.transform,h=this.applyTransform.template;if(void 0===g&&(g=OpenLayers.Util.vendorPrefix.style("transform"),this.applyTransform.transform=g,g)){var i=OpenLayers.Element.getStyle(this.viewPortDiv,OpenLayers.Util.vendorPrefix.css("transform"));i&&"none"===i||(h=["translate3d(",",0) ","scale3d(",",1)"],f[g]=[h[0],"0,0",h[1]].join("")),h&&~f[g].indexOf(h[0])||(h=["translate(",") ","scale(",")"]),this.applyTransform.template=h}null===g||"translate3d("!==h[0]&&!0!==e?(f.left=a+"px",f.top=b+"px",null!==g&&(f[g]="")):(!0===e&&"translate("===h[0]&&(a-=d.x,b-=d.y,f.left=d.x+"px",f.top=d.y+"px"),f[g]=[h[0],a,"px,",b,"px",h[1],h[2],c,",",c,h[3]].join(""))},CLASS_NAME:"OpenLayers.Map"}),OpenLayers.Map.TILE_WIDTH=256,OpenLayers.Map.TILE_HEIGHT=256,OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(a,b){this.metadata={},b=OpenLayers.Util.extend({},b),null!=this.alwaysInRange&&(b.alwaysInRange=this.alwaysInRange),this.addOptions(b),this.name=a,null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div),this.eventListeners instanceof Object&&this.events.on(this.eventListeners))},destroy:function(a){null==a&&(a=!0),null!=this.map&&this.map.removeLayer(this,a),this.projection=null,this.map=null,this.name=null,this.div=null,this.options=null,this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy()),this.eventListeners=null,this.events=null},clone:function(a){return null==a&&(a=new OpenLayers.Layer(this.name,this.getOptions())),OpenLayers.Util.applyDefaults(a,this),a.map=null,a},getOptions:function(){var a={};for(var b in this.options)a[b]=this[b];return a},setName:function(a){a!=this.name&&(this.name=a,null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(a,b){if(null==this.options&&(this.options={}),a&&("string"==typeof a.projection&&(a.projection=new OpenLayers.Projection(a.projection)),a.projection&&OpenLayers.Util.applyDefaults(a,OpenLayers.Projection.defaults[a.projection.getCode()]),!a.maxExtent||a.maxExtent instanceof OpenLayers.Bounds||(a.maxExtent=new OpenLayers.Bounds(a.maxExtent)),!a.minExtent||a.minExtent instanceof OpenLayers.Bounds||(a.minExtent=new OpenLayers.Bounds(a.minExtent))),OpenLayers.Util.extend(this.options,a),OpenLayers.Util.extend(this,a),this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits()),this.map){var c=this.map.getResolution(),d=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var e in a)if(a.hasOwnProperty(e)&&OpenLayers.Util.indexOf(d,e)>=0){this.initResolutions(),b&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(c),!1,!0),this.map.events.triggerEvent("changebaselayer",{layer:this}));break}}},onMapResize:function(){},redraw:function(){var a=!1;if(this.map){this.inRange=this.calculateInRange();var b=this.getExtent()
;if(b&&this.inRange&&this.visibility){this.moveTo(b,!0,!1),this.events.triggerEvent("moveend",{zoomChanged:!0}),a=!0}}return a},moveTo:function(a,b,c){var d=this.visibility;this.isBaseLayer||(d=d&&this.inRange),this.display(d)},moveByPx:function(a,b){},setMap:function(a){if(null==this.map){if(this.map=a,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.units=this.projection.getUnits()||this.units||this.map.units,this.initResolutions(),!this.isBaseLayer){this.inRange=this.calculateInRange();var b=this.visibility&&this.inRange;this.div.style.display=b?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(a){},getImageSize:function(a){return this.imageSize||this.tileSize},setTileSize:function(a){var b=a||(this.tileSize?this.tileSize:this.map.getTileSize());this.tileSize=b,this.gutter&&(this.imageSize=new OpenLayers.Size(b.w+2*this.gutter,b.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(a){a!=this.visibility&&(this.visibility=a,this.display(a),this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},display:function(a){a!=("none"!=this.div.style.display)&&(this.div.style.display=a&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var a=!1;if(this.alwaysInRange)a=!0;else if(this.map){var b=this.map.getResolution();a=b>=this.minResolution&&b<=this.maxResolution}return a},setIsBaseLayer:function(a){a!=this.isBaseLayer&&(this.isBaseLayer=a,null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){var a,b,c,d={},e=!0;for(a=0,b=this.RESOLUTION_PROPERTIES.length;a<b;a++)c=this.RESOLUTION_PROPERTIES[a],d[c]=this.options[c],e&&this.options[c]&&(e=!1);if(null==this.options.alwaysInRange&&(this.alwaysInRange=e),null==d.resolutions&&(d.resolutions=this.resolutionsFromScales(d.scales)),null==d.resolutions&&(d.resolutions=this.calculateResolutions(d)),null==d.resolutions){for(a=0,b=this.RESOLUTION_PROPERTIES.length;a<b;a++)c=this.RESOLUTION_PROPERTIES[a],d[c]=null!=this.options[c]?this.options[c]:this.map[c];null==d.resolutions&&(d.resolutions=this.resolutionsFromScales(d.scales)),null==d.resolutions&&(d.resolutions=this.calculateResolutions(d))}var f;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(f=this.options.maxResolution),this.options.minScale&&(f=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var g;if(this.options.minResolution&&"auto"!==this.options.minResolution&&(g=this.options.minResolution),this.options.maxScale&&(g=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)),d.resolutions&&(d.resolutions.sort(function(a,b){return b-a}),f||(f=d.resolutions[0]),!g)){var h=d.resolutions.length-1;g=d.resolutions[h]}if(this.resolutions=d.resolutions,this.resolutions){for(b=this.resolutions.length,this.scales=new Array(b),a=0;a<b;a++)this.scales[a]=OpenLayers.Util.getScaleFromResolution(this.resolutions[a],this.units);this.numZoomLevels=b}this.minResolution=g,g&&(this.maxScale=OpenLayers.Util.getScaleFromResolution(g,this.units)),this.maxResolution=f,f&&(this.minScale=OpenLayers.Util.getScaleFromResolution(f,this.units))},resolutionsFromScales:function(a){if(null!=a){var b,c,d;for(d=a.length,b=new Array(d),c=0;c<d;c++)b[c]=OpenLayers.Util.getResolutionFromScale(a[c],this.units);return b}},calculateResolutions:function(a){var b,c,d,e=a.maxResolution;null!=a.minScale?e=OpenLayers.Util.getResolutionFromScale(a.minScale,this.units):"auto"==e&&null!=this.maxExtent&&(b=this.map.getSize(),c=this.maxExtent.getWidth()/b.w,d=this.maxExtent.getHeight()/b.h,e=Math.max(c,d));var f=a.minResolution;if(null!=a.maxScale?f=OpenLayers.Util.getResolutionFromScale(a.maxScale,this.units):"auto"==a.minResolution&&null!=this.minExtent&&(b=this.map.getSize(),c=this.minExtent.getWidth()/b.w,d=this.minExtent.getHeight()/b.h,f=Math.max(c,d)),"number"!=typeof e&&"number"!=typeof f&&null!=this.maxExtent){var g=this.map.getTileSize();e=Math.max(this.maxExtent.getWidth()/g.w,this.maxExtent.getHeight()/g.h)}var h=a.maxZoomLevel,i=a.numZoomLevels;if("number"==typeof f&&"number"==typeof e&&void 0===i){var j=e/f;i=Math.floor(Math.log(j)/Math.log(2))+1}else void 0===i&&null!=h&&(i=h+1);if(!("number"!=typeof i||i<=0||"number"!=typeof e&&"number"!=typeof f)){var k=new Array(i),l=2;"number"==typeof f&&"number"==typeof e&&(l=Math.pow(e/f,1/(i-1)));var m;if("number"==typeof e)for(m=0;m<i;m++)k[m]=e/Math.pow(l,m);else for(m=0;m<i;m++)k[i-1-m]=f*Math.pow(l,m);return k}},getResolution:function(){var a=this.map.getZoom();return this.getResolutionForZoom(a)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(a,b){var c=this.map.getSize(),d=Math.max(a.getWidth()/c.w,a.getHeight()/c.h);return this.getZoomForResolution(d,b)},getDataExtent:function(){},getResolutionForZoom:function(a){a=Math.max(0,Math.min(a,this.resolutions.length-1));var b;if(this.map.fractionalZoom){var c=Math.floor(a),d=Math.ceil(a);b=this.resolutions[c]-(a-c)*(this.resolutions[c]-this.resolutions[d])}else b=this.resolutions[Math.round(a)];return b},getZoomForResolution:function(a,b){var c,d,e;if(this.map.fractionalZoom){var f,g=0,h=this.resolutions.length-1,i=this.resolutions[g],j=this.resolutions[h];for(d=0,e=this.resolutions.length;d<e;++d)if(f=this.resolutions[d],f>=a&&(i=f,g=d),f<=a){j=f,h=d;break}var k=i-j;c=k>0?g+(i-a)/k:g}else{var l,m=Number.POSITIVE_INFINITY;for(d=0,e=this.resolutions.length;d<e;d++)if(b){if((l=Math.abs(this.resolutions[d]-a))>m)break;m=l}else if(this.resolutions[d]<a)break;c=Math.max(0,d-1)}return c},getLonLatFromViewPortPx:function(a){var b=null,c=this.map;if(null!=a&&c.minPx){var d=c.getResolution(),e=c.getMaxExtent({restricted:!0}),f=(a.x-c.minPx.x)*d+e.left,g=(c.minPx.y-a.y)*d+e.top;b=new OpenLayers.LonLat(f,g),this.wrapDateLine&&(b=b.wrapDateLine(this.maxExtent))}return b},getViewPortPxFromLonLat:function(a,b){var c=null;if(null!=a){b=b||this.map.getResolution();var d=this.map.calculateBounds(null,b);c=new OpenLayers.Pixel(1/b*(a.lon-d.left),1/b*(d.top-a.lat))}return c},setOpacity:function(a){if(a!=this.opacity){this.opacity=a;for(var b=this.div.childNodes,c=0,d=b.length;c<d;++c){var e=b[c].firstChild||b[c],f=b[c].lastChild;f&&"iframe"===f.nodeName.toLowerCase()&&(e=f.parentNode),OpenLayers.Util.modifyDOMElement(e,null,null,null,null,null,null,a)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(a){this.div.style.zIndex=a},adjustBounds:function(a){if(this.gutter){var b=this.gutter*this.map.getResolution();a=new OpenLayers.Bounds(a.left-b,a.bottom-b,a.right+b,a.top+b)}if(this.wrapDateLine){var c={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()};a=a.wrapDateLine(this.maxExtent,c)}return a},CLASS_NAME:"OpenLayers.Layer"}),OpenLayers.Layer.SphericalMercator={getExtent:function(){return this.sphericalMercator?this.map.calculateBounds():OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply(this)},getLonLatFromViewPortPx:function(a){return OpenLayers.Layer.prototype.getLonLatFromViewPortPx.apply(this,arguments)},getViewPortPxFromLonLat:function(a){return OpenLayers.Layer.prototype.getViewPortPxFromLonLat.apply(this,arguments)},initMercatorParameters:function(){this.RESOLUTIONS=[];for(var a=0;a<=this.MAX_ZOOM_LEVEL;++a)this.RESOLUTIONS[a]=156543.03390625/Math.pow(2,a);this.units="m",this.projection=this.projection||"EPSG:900913"},forwardMercator:function(){var a=new OpenLayers.Projection("EPSG:4326"),b=new OpenLayers.Projection("EPSG:900913");return function(c,d){var e=OpenLayers.Projection.transform({x:c,y:d},a,b);return new OpenLayers.LonLat(e.x,e.y)}}(),inverseMercator:function(){var a=new OpenLayers.Projection("EPSG:4326"),b=new OpenLayers.Projection("EPSG:900913");return function(c,d){var e=OpenLayers.Projection.transform({x:c,y:d},b,a);return new OpenLayers.LonLat(e.x,e.y)}}()},OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,{smoothDragPan:!0,isBaseLayer:!0,isFixed:!0,pane:null,mapObject:null,initialize:function(a,b){OpenLayers.Layer.prototype.initialize.apply(this,arguments),null==this.pane&&(this.pane=OpenLayers.Util.createDiv(this.div.id+"_EventPane"))},destroy:function(){this.mapObject=null,this.pane=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1,this.pane.style.display=this.div.style.display,this.pane.style.width="100%",this.pane.style.height="100%","msie"==OpenLayers.BROWSER_NAME&&(this.pane.style.background="url("+OpenLayers.Util.getImageLocation("blank.gif")+")"),this.isFixed?this.map.viewPortDiv.appendChild(this.pane):this.map.layerContainerDiv.appendChild(this.pane),this.loadMapObject(),null==this.mapObject&&this.loadWarningMessage()},removeMap:function(a){this.pane&&this.pane.parentNode&&this.pane.parentNode.removeChild(this.pane),OpenLayers.Layer.prototype.removeMap.apply(this,arguments)},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";var a=this.map.getSize(),b=Math.min(a.w,300),c=Math.min(a.h,200),d=new OpenLayers.Size(b,c),e=new OpenLayers.Pixel(a.w/2,a.h/2),f=e.add(-d.w/2,-d.h/2),g=OpenLayers.Util.createDiv(this.name+"_warning",f,d,null,null,null,"auto");g.style.padding="7px",g.style.backgroundColor="yellow",g.innerHTML=this.getWarningHTML(),this.div.appendChild(g)},getWarningHTML:function(){return""},display:function(a){OpenLayers.Layer.prototype.display.apply(this,arguments),this.pane.style.display=this.div.style.display},setZIndex:function(a){OpenLayers.Layer.prototype.setZIndex.apply(this,arguments),this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveByPx:function(a,b){OpenLayers.Layer.prototype.moveByPx.apply(this,arguments),this.dragPanMapObject?this.dragPanMapObject(a,-b):this.moveTo(this.map.getCachedCenter())},moveTo:function(a,b,c){if(OpenLayers.Layer.prototype.moveTo.apply(this,arguments),null!=this.mapObject){var d=this.map.getCenter(),e=this.map.getZoom();if(null!=d){var f=this.getMapObjectCenter(),g=this.getOLLonLatFromMapObjectLonLat(f),h=this.getMapObjectZoom(),i=this.getOLZoomFromMapObjectZoom(h);if(!d.equals(g)||e!=i)if(!b&&g&&this.dragPanMapObject&&this.smoothDragPan){var j=this.map.getViewPortPxFromLonLat(g),k=this.map.getViewPortPxFromLonLat(d);this.dragPanMapObject(k.x-j.x,j.y-k.y)}else{var l=this.getMapObjectLonLatFromOLLonLat(d),m=this.getMapObjectZoomFromOLZoom(e);this.setMapObjectCenter(l,m,c)}}}},getLonLatFromViewPortPx:function(a){var b=null;if(null!=this.mapObject&&null!=this.getMapObjectCenter()){var c=this.getMapObjectPixelFromOLPixel(a),d=this.getMapObjectLonLatFromMapObjectPixel(c);b=this.getOLLonLatFromMapObjectLonLat(d)}return b},getViewPortPxFromLonLat:function(a){var b=null;if(null!=this.mapObject&&null!=this.getMapObjectCenter()){var c=this.getMapObjectLonLatFromOLLonLat(a),d=this.getMapObjectPixelFromMapObjectLonLat(c);b=this.getOLPixelFromMapObjectPixel(d)}return b},getOLLonLatFromMapObjectLonLat:function(a){var b=null;if(null!=a){var c=this.getLongitudeFromMapObjectLonLat(a),d=this.getLatitudeFromMapObjectLonLat(a);b=new OpenLayers.LonLat(c,d)}return b},getMapObjectLonLatFromOLLonLat:function(a){var b=null;return null!=a&&(b=this.getMapObjectLonLatFromLonLat(a.lon,a.lat)),b},getOLPixelFromMapObjectPixel:function(a){var b=null;if(null!=a){var c=this.getXFromMapObjectPixel(a),d=this.getYFromMapObjectPixel(a);b=new OpenLayers.Pixel(c,d)}return b},getMapObjectPixelFromOLPixel:function(a){var b=null;return null!=a&&(b=this.getMapObjectPixelFromXY(a.x,a.y)),b},CLASS_NAME:"OpenLayers.Layer.EventPane"}),OpenLayers.Layer.FixedZoomLevels=OpenLayers.Class({initialize:function(){},initResolutions:function(){for(var a=["minZoomLevel","maxZoomLevel","numZoomLevels"],b=0,c=a.length;b<c;b++){var d=a[b];this[d]=null!=this.options[d]?this.options[d]:this.map[d]}(null==this.minZoomLevel||this.minZoomLevel<this.MIN_ZOOM_LEVEL)&&(this.minZoomLevel=this.MIN_ZOOM_LEVEL);var e,f=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1;if(e=null==this.options.numZoomLevels&&null!=this.options.maxZoomLevel||null==this.numZoomLevels&&null!=this.maxZoomLevel?this.maxZoomLevel-this.minZoomLevel+1:this.numZoomLevels,this.numZoomLevels=null!=e?Math.min(e,f):f,this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1,null!=this.RESOLUTIONS){var g=0;this.resolutions=[];for(var b=this.minZoomLevel;b<=this.maxZoomLevel;b++)this.resolutions[g++]=this.RESOLUTIONS[b];this.maxResolution=this.resolutions[0],this.minResolution=this.resolutions[this.resolutions.length-1]}},getResolution:function(){if(null!=this.resolutions)return OpenLayers.Layer.prototype.getResolution.apply(this,arguments);var a=null,b=this.map.getSize(),c=this.getExtent();return null!=b&&null!=c&&(a=Math.max(c.getWidth()/b.w,c.getHeight()/b.h)),a},getExtent:function(){var a=this.map.getSize(),b=this.getLonLatFromViewPortPx({x:0,y:0}),c=this.getLonLatFromViewPortPx({x:a.w,y:a.h});return null!=b&&null!=c?new OpenLayers.Bounds(b.lon,c.lat,c.lon,b.lat):null},getZoomForResolution:function(a){if(null!=this.resolutions)return OpenLayers.Layer.prototype.getZoomForResolution.apply(this,arguments);var b=OpenLayers.Layer.prototype.getExtent.apply(this,[]);return this.getZoomForExtent(b)},getOLZoomFromMapObjectZoom:function(a){var b=null;return null!=a&&(b=a-this.minZoomLevel,this.map.baseLayer!==this&&(b=this.map.baseLayer.getZoomForResolution(this.getResolutionForZoom(b)))),b},getMapObjectZoomFromOLZoom:function(a){var b=null;return null!=a&&(b=a+this.minZoomLevel,this.map.baseLayer!==this&&(b=this.getZoomForResolution(this.map.baseLayer.getResolutionForZoom(b)))),b},CLASS_NAME:"OpenLayers.Layer.FixedZoomLevels"}),OpenLayers.Layer.Google=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:21,RESOLUTIONS:[1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.00034332275390625,.000171661376953125,858306884765625e-19,4291534423828125e-20,2145767211914062e-20,1072883605957031e-20,536441802978515e-20,268220901489257e-20,1341104507446289e-21,6.705522537231445e-7],type:null,wrapDateLine:!0,sphericalMercator:!1,version:null,initialize:function(a,b){b=b||{},b.version||(b.version="function"==typeof GMap2?"2":"3");var c=OpenLayers.Layer.Google["v"+b.version.replace(/\./g,"_")];if(!c)throw"Unsupported Google Maps API version: "+b.version;OpenLayers.Util.applyDefaults(b,c),OpenLayers.Util.applyDefaults(b,c.DEFAULTS),b.maxExtent&&(b.maxExtent=b.maxExtent.clone()),OpenLayers.Layer.EventPane.prototype.initialize.apply(this,[a,b]),OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,[a,b]),this.sphericalMercator&&(OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator),this.initMercatorParameters())},clone:function(){return new OpenLayers.Layer.Google(this.name,this.getOptions())},setVisibility:function(a){var b=null==this.opacity?1:this.opacity;OpenLayers.Layer.EventPane.prototype.setVisibility.apply(this,arguments),this.setOpacity(b)},display:function(a){this._dragging||this.setGMapVisibility(a),OpenLayers.Layer.EventPane.prototype.display.apply(this,arguments)},moveTo:function(a,b,c){this._dragging=c,OpenLayers.Layer.EventPane.prototype.moveTo.apply(this,arguments),delete this._dragging},setOpacity:function(a){if(a!==this.opacity&&(null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"}),this.opacity=a),this.getVisibility()){var b=this.getMapContainer();OpenLayers.Util.modifyDOMElement(b,null,null,null,null,null,null,a)}},destroy:function(){if(this.map){this.setGMapVisibility(!1);var a=OpenLayers.Layer.Google.cache[this.map.id];a&&a.count<=1&&this.removeGMapElements()}OpenLayers.Layer.EventPane.prototype.destroy.apply(this,arguments)},removeGMapElements:function(){var a=OpenLayers.Layer.Google.cache[this.map.id];if(a){var b=this.mapObject&&this.getMapContainer();b&&b.parentNode&&b.parentNode.removeChild(b);var c=a.termsOfUse;c&&c.parentNode&&c.parentNode.removeChild(c);var d=a.poweredBy;d&&d.parentNode&&d.parentNode.removeChild(d),this.mapObject&&window.google&&google.maps&&google.maps.event&&google.maps.event.clearListeners&&google.maps.event.clearListeners(this.mapObject,"tilesloaded")}},removeMap:function(a){this.visibility&&this.mapObject&&this.setGMapVisibility(!1);var b=OpenLayers.Layer.Google.cache[a.id];b&&(b.count<=1?(this.removeGMapElements(),delete OpenLayers.Layer.Google.cache[a.id]):--b.count),delete this.termsOfUse,delete this.poweredBy,delete this.mapObject,delete this.dragObject,OpenLayers.Layer.EventPane.prototype.removeMap.apply(this,arguments)},getOLBoundsFromMapObjectBounds:function(a){var b=null;if(null!=a){var c=a.getSouthWest(),d=a.getNorthEast();this.sphericalMercator?(c=this.forwardMercator(c.lng(),c.lat()),d=this.forwardMercator(d.lng(),d.lat())):(c=new OpenLayers.LonLat(c.lng(),c.lat()),d=new OpenLayers.LonLat(d.lng(),d.lat())),b=new OpenLayers.Bounds(c.lon,c.lat,d.lon,d.lat)}return b},getWarningHTML:function(){return OpenLayers.i18n("googleWarning")},getMapObjectCenter:function(){return this.mapObject.getCenter()},getMapObjectZoom:function(){return this.mapObject.getZoom()},getLongitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.lng(),a.lat()).lon:a.lng()},getLatitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.lng(),a.lat()).lat:a.lat()},getXFromMapObjectPixel:function(a){return a.x},getYFromMapObjectPixel:function(a){return a.y},CLASS_NAME:"OpenLayers.Layer.Google"}),OpenLayers.Layer.Google.cache={},OpenLayers.Layer.Google.v2={termsOfUse:null,poweredBy:null,dragObject:null,loadMapObject:function(){this.type||(this.type=G_NORMAL_MAP);var a,b,c,d=OpenLayers.Layer.Google.cache[this.map.id];if(d)a=d.mapObject,b=d.termsOfUse,c=d.poweredBy,++d.count;else{var e=this.map.viewPortDiv,f=document.createElement("div");f.id=this.map.id+"_GMap2Container",f.style.position="absolute",f.style.width="100%",f.style.height="100%",e.appendChild(f);try{a=new GMap2(f),b=f.lastChild,e.appendChild(b),b.style.zIndex="1100",b.style.right="",b.style.bottom="",b.className="olLayerGoogleCopyright",c=f.lastChild,e.appendChild(c),c.style.zIndex="1100",c.style.right="",c.style.bottom="",c.className="olLayerGooglePoweredBy gmnoprint"}catch(a){throw a}OpenLayers.Layer.Google.cache[this.map.id]={mapObject:a,termsOfUse:b,poweredBy:c,count:1}}this.mapObject=a,this.termsOfUse=b,this.poweredBy=c,-1===OpenLayers.Util.indexOf(this.mapObject.getMapTypes(),this.type)&&this.mapObject.addMapType(this.type),"function"==typeof a.getDragObject?this.dragObject=a.getDragObject():this.dragPanMapObject=null,!1===this.isBaseLayer&&this.setGMapVisibility("none"!==this.div.style.display)},onMapResize:function(){if(this.visibility&&this.mapObject.isLoaded())this.mapObject.checkResize();else{if(!this._resized)var a=this,b=GEvent.addListener(this.mapObject,"load",function(){GEvent.removeListener(b),delete a._resized,a.mapObject.checkResize(),a.moveTo(a.map.getCenter(),a.map.getZoom())});this._resized=!0}},setGMapVisibility:function(a){var b=OpenLayers.Layer.Google.cache[this.map.id];if(b){var c=this.mapObject.getContainer();!0===a?(this.mapObject.setMapType(this.type),c.style.display="",this.termsOfUse.style.left="",this.termsOfUse.style.display="",this.poweredBy.style.display="",b.displayed=this.id):(b.displayed===this.id&&delete b.displayed,b.displayed||(c.style.display="none",this.termsOfUse.style.display="none",this.termsOfUse.style.left="-9999px",this.poweredBy.style.display="none"))}},getMapContainer:function(){return this.mapObject.getContainer()},getMapObjectBoundsFromOLBounds:function(a){var b=null;if(null!=a){var c=this.sphericalMercator?this.inverseMercator(a.bottom,a.left):new OpenLayers.LonLat(a.bottom,a.left),d=this.sphericalMercator?this.inverseMercator(a.top,a.right):new OpenLayers.LonLat(a.top,a.right);b=new GLatLngBounds(new GLatLng(c.lat,c.lon),new GLatLng(d.lat,d.lon))}return b},setMapObjectCenter:function(a,b){this.mapObject.setCenter(a,b)},dragPanMapObject:function(a,b){this.dragObject.moveBy(new GSize(-a,b))},getMapObjectLonLatFromMapObjectPixel:function(a){return this.mapObject.fromContainerPixelToLatLng(a)},getMapObjectPixelFromMapObjectLonLat:function(a){return this.mapObject.fromLatLngToContainerPixel(a)},getMapObjectZoomFromMapObjectBounds:function(a){return this.mapObject.getBoundsZoomLevel(a)},getMapObjectLonLatFromLonLat:function(a,b){var c;if(this.sphericalMercator){var d=this.inverseMercator(a,b);c=new GLatLng(d.lat,d.lon)}else c=new GLatLng(b,a);return c},getMapObjectPixelFromXY:function(a,b){return new GPoint(a,b)}},OpenLayers.Format.WFST=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Format.WFST.DEFAULTS);var b=OpenLayers.Format.WFST["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported WFST version: "+a.version;return new b(a)},OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"},OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(a){this.stateName={},this.stateName[OpenLayers.State.INSERT]="wfs:Insert",this.stateName[OpenLayers.State.UPDATE]="wfs:Update",this.stateName[OpenLayers.State.DELETE]="wfs:Delete",OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},getSrsName:function(a,b){var c=b&&b.srsName;return c||(c=a&&a.layer?a.layer.projection.getCode():this.srsName),c},read:function(a,b){b=b||{},OpenLayers.Util.applyDefaults(b,{output:"features"}),"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var c={};return a&&this.readNode(a,c,!0),c.features&&"features"===b.output&&(c=c.features),c},readers:{wfs:{FeatureCollection:function(a,b){b.features=[],this.readChildNodes(a,b)}}},write:function(a,b){var c=this.writeNode("wfs:Transaction",{features:a,options:b}),d=this.schemaLocationAttr();return d&&this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",d),OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{wfs:{GetFeature:function(a){var b=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:a&&a.handle,outputFormat:a&&a.outputFormat,maxFeatures:a&&a.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(a)}});if("string"==typeof this.featureType)this.writeNode("Query",a,b);else for(var c=0,d=this.featureType.length;c<d;c++)a.featureType=this.featureType[c],this.writeNode("Query",a,b);return b},Transaction:function(a){a=a||{};var b,c,d=a.options||{},e=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:d.handle}}),f=a.features;if(f){!0===d.multi&&OpenLayers.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":!0===this.multiCurve?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":!0===this.multiSurface?"MultiSurface":"MultiPolygon"});var g,h;for(b=0,c=f.length;b<c;++b)h=f[b],(g=this.stateName[h.state])&&this.writeNode(g,{feature:h,options:d},e);!0===d.multi&&this.setGeometryTypes()}if(d.nativeElements)for(b=0,c=d.nativeElements.length;b<c;++b)this.writeNode("wfs:Native",d.nativeElements[b],e);return e},Native:function(a){return this.createElementNSPlus("wfs:Native",{attributes:{vendorId:a.vendorId,safeToIgnore:a.safeToIgnore},value:a.value})},Insert:function(a){var b=a.feature,c=a.options,d=this.createElementNSPlus("wfs:Insert",{attributes:{handle:c&&c.handle}});return this.srsName=this.getSrsName(b),this.writeNode("feature:_typeName",b,d),d},Update:function(a){var b=a.feature,c=a.options,d=this.createElementNSPlus("wfs:Update",{attributes:{handle:c&&c.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&d.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var e=b.modified;null===this.geometryName||e&&void 0===e.geometry||(this.srsName=this.getSrsName(b),this.writeNode("Property",{name:this.geometryName,value:b.geometry},d));for(var f in b.attributes)void 0===b.attributes[f]||e&&e.attributes&&(!e.attributes||void 0===e.attributes[f])||this.writeNode("Property",{name:f,value:b.attributes[f]},d);return this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[b.fid]}),d),d},Property:function(a){var b=this.createElementNSPlus("wfs:Property");return this.writeNode("Name",a.name,b),null!==a.value&&this.writeNode("Value",a.value,b),b},Name:function(a){return this.createElementNSPlus("wfs:Name",{value:a})},Value:function(a){var b;if(a instanceof OpenLayers.Geometry){b=this.createElementNSPlus("wfs:Value");var c=this.writeNode("feature:_geometry",a).firstChild;b.appendChild(c)}else b=this.createElementNSPlus("wfs:Value",{value:a});return b},Delete:function(a){var b=a.feature,c=a.options,d=this.createElementNSPlus("wfs:Delete",{attributes:{handle:c&&c.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});return this.featureNS&&d.setAttribute("xmlns:"+this.featurePrefix,this.featureNS),this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[b.fid]}),d),d}}},schemaLocationAttr:function(a){a=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},a);var b=OpenLayers.Util.extend({},this.schemaLocations);a.schema&&(b[a.featurePrefix]=a.schema);var c,d=[];for(var e in b)(c=this.namespaces[e])&&d.push(c+" "+b[e]);return d.join(" ")||void 0},setFilterProperty:function(a){if(a.filters)for(var b=0,c=a.filters.length;b<c;++b)OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,a.filters[b]);else a instanceof OpenLayers.Filter.Spatial&&!a.property&&(a.property=this.geometryName)},CLASS_NAME:"OpenLayers.Format.WFST.v1"});OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({_inherit:function(a,b,c){var d=parseInt(a.getAttribute("srsDimension"),10)||c&&c.srsDimension;d&&(b.srsDimension=d)},featureMembers:function(a,b){this.readChildNodes(a,b)},Curve:function(a,b){var c={points:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),b.components||(b.components=[]),b.components.push(new OpenLayers.Geometry.LineString(c.points))},segments:function(a,b){this.readChildNodes(a,b)},LineStringSegment:function(a,b){var c={};this.readChildNodes(a,c),c.points&&Array.prototype.push.apply(b.points,c.points)},pos:function(a,b){var c,d=this.getChildValue(a).replace(this.regExes.trimSpace,""),e=d.split(this.regExes.splitSpace);c=this.xy?new OpenLayers.Geometry.Point(e[0],e[1],e[2]):new OpenLayers.Geometry.Point(e[1],e[0],e[2]),b.points=[c]},posList:function(a,b){for(var c,d,e,f=this.getChildValue(a).replace(this.regExes.trimSpace,""),g=f.split(this.regExes.splitSpace),h=b.srsDimension||parseInt(a.getAttribute("srsDimension")||a.getAttribute("dimension"),10)||2,i=g.length/h,j=new Array(i),k=0,l=g.length;k<l;k+=h)c=g[k],d=g[k+1],e=2==h?void 0:g[k+2],this.xy?j[k/h]=new OpenLayers.Geometry.Point(c,d,e):j[k/h]=new OpenLayers.Geometry.Point(d,c,e);b.points=j},Surface:function(a,b){this.readChildNodes(a,b)},patches:function(a,b){this.readChildNodes(a,b)},PolygonPatch:function(a,b){this.readers.gml.Polygon.apply(this,[a,b])},exterior:function(a,b){var c={};this.readChildNodes(a,c),b.outer=c.components[0]},interior:function(a,b){var c={};this.readChildNodes(a,c),b.inner.push(c.components[0])},MultiCurve:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),c.components.length>0&&(b.components=[new OpenLayers.Geometry.MultiLineString(c.components)])},curveMember:function(a,b){this.readChildNodes(a,b)},MultiSurface:function(a,b){var c={components:[]};this.readers.gml._inherit.apply(this,[a,c,b]),this.readChildNodes(a,c),c.components.length>0&&(b.components=[new OpenLayers.Geometry.MultiPolygon(c.components)])},surfaceMember:function(a,b){this.readChildNodes(a,b)},surfaceMembers:function(a,b){this.readChildNodes(a,b)},pointMembers:function(a,b){this.readChildNodes(a,b)},lineStringMembers:function(a,b){this.readChildNodes(a,b)},polygonMembers:function(a,b){this.readChildNodes(a,b)},geometryMembers:function(a,b){this.readChildNodes(a,b)},Envelope:function(a,b){var c={points:new Array(2)};this.readChildNodes(a,c),b.components||(b.components=[]);var d=c.points[0],e=c.points[1];b.components.push(new OpenLayers.Bounds(d.x,d.y,e.x,e.y))},lowerCorner:function(a,b){var c={};this.readers.gml.pos.apply(this,[a,c]),b.points[0]=c.points[0]},upperCorner:function(a,b){var c={};this.readers.gml.pos.apply(this,[a,c]),b.points[1]=c.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(a){var b;b=OpenLayers.Util.isArray(a)?"featureMembers":"featureMember";var c=this.writeNode("gml:"+b,a);return this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(a){for(var b=this.createElementNSPlus("gml:featureMembers"),c=0,d=a.length;c<d;++c)this.writeNode("feature:_typeName",a[c],b);return b},Point:function(a){var b=this.createElementNSPlus("gml:Point");return this.writeNode("pos",a,b),b},pos:function(a){var b=this.xy?a.x+" "+a.y:a.y+" "+a.x;return this.createElementNSPlus("gml:pos",{value:b})},LineString:function(a){var b=this.createElementNSPlus("gml:LineString");return this.writeNode("posList",a.components,b),b},Curve:function(a){var b=this.createElementNSPlus("gml:Curve");return this.writeNode("segments",a,b),b},segments:function(a){var b=this.createElementNSPlus("gml:segments");return this.writeNode("LineStringSegment",a,b),b},LineStringSegment:function(a){var b=this.createElementNSPlus("gml:LineStringSegment");return this.writeNode("posList",a.components,b),b},posList:function(a){for(var b,c=a.length,d=new Array(c),e=0;e<c;++e)b=a[e],this.xy?d[e]=b.x+" "+b.y:d[e]=b.y+" "+b.x;return this.createElementNSPlus("gml:posList",{value:d.join(" ")})},Surface:function(a){var b=this.createElementNSPlus("gml:Surface");return this.writeNode("patches",a,b),b},patches:function(a){var b=this.createElementNSPlus("gml:patches");return this.writeNode("PolygonPatch",a,b),b},PolygonPatch:function(a){var b=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",a.components[0],b);for(var c=1,d=a.components.length;c<d;++c)this.writeNode("interior",a.components[c],b);return b},Polygon:function(a){var b=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",a.components[0],b);for(var c=1,d=a.components.length;c<d;++c)this.writeNode("interior",a.components[c],b);return b},exterior:function(a){var b=this.createElementNSPlus("gml:exterior");return this.writeNode("LinearRing",a,b),b},interior:function(a){var b=this.createElementNSPlus("gml:interior");return this.writeNode("LinearRing",a,b),b},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing")
;return this.writeNode("posList",a.components,b),b},MultiCurve:function(a){for(var b=this.createElementNSPlus("gml:MultiCurve"),c=a.components||[a],d=0,e=c.length;d<e;++d)this.writeNode("curveMember",c[d],b);return b},curveMember:function(a){var b=this.createElementNSPlus("gml:curveMember");return this.curve?this.writeNode("Curve",a,b):this.writeNode("LineString",a,b),b},MultiSurface:function(a){for(var b=this.createElementNSPlus("gml:MultiSurface"),c=a.components||[a],d=0,e=c.length;d<e;++d)this.writeNode("surfaceMember",c[d],b);return b},surfaceMember:function(a){var b=this.createElementNSPlus("gml:surfaceMember");return this.surface?this.writeNode("Surface",a,b):this.writeNode("Polygon",a,b),b},Envelope:function(a){var b=this.createElementNSPlus("gml:Envelope");return this.writeNode("lowerCorner",a,b),this.writeNode("upperCorner",a,b),this.srsName&&b.setAttribute("srsName",this.srsName),b},lowerCorner:function(a){var b=this.xy?a.left+" "+a.bottom:a.bottom+" "+a.left;return this.createElementNSPlus("gml:lowerCorner",{value:b})},upperCorner:function(a){var b=this.xy?a.right+" "+a.top:a.top+" "+a.right;return this.createElementNSPlus("gml:upperCorner",{value:b})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":!0===this.curve?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":!1===this.multiCurve?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":!0===this.surface?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":!1===this.multiSurface?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"}),OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[a])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a,b){var c=a.getAttribute("matchCase"),d=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!("false"===c||"0"===c)});this.readChildNodes(a,d),b.filters.push(d)},PropertyIsNotEqualTo:function(a,b){var c=a.getAttribute("matchCase"),d=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!("false"===c||"0"===c)});this.readChildNodes(a,d),b.filters.push(d)},PropertyIsLike:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(a,c);var d=a.getAttribute("wildCard"),e=a.getAttribute("singleChar"),f=a.getAttribute("escapeChar");c.value2regex(d,e,f),b.filters.push(c)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:a.matchCase}});return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:a.matchCase}});return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:a.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});return this.writeNode("PropertyName",a,b),this.writeNode("Literal",a.regex2value(),b),b},BBOX:function(a){var b=this.createElementNSPlus("ogc:BBOX");a.property&&this.writeNode("PropertyName",a,b);var c=this.writeNode("gml:Envelope",a.value);return a.projection&&c.setAttribute("srsName",a.projection),b.appendChild(c),b},SortBy:function(a){for(var b=this.createElementNSPlus("ogc:SortBy"),c=0,d=a.length;c<d;c++)this.writeNode("ogc:SortProperty",a[c],b);return b},SortProperty:function(a){var b=this.createElementNSPlus("ogc:SortProperty");return this.writeNode("ogc:PropertyName",a,b),this.writeNode("ogc:SortOrder","DESC"==a.order?"DESC":"ASC",b),b},SortOrder:function(a){return this.createElementNSPlus("ogc:SortOrder",{value:a})}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(a,b){var c=this.createElementNSPlus("ogc:"+b);if(this.writeNode("PropertyName",a,c),a.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",a.value,c);else{var d;d=a.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",a.value).firstChild:this.writeNode("gml:Envelope",a.value),a.projection&&d.setAttribute("srsName",a.projection),c.appendChild(d)}return c},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"}),OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(a){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[a]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[a])},readNode:function(a,b,c){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(a,b){b.numberOfFeatures=parseInt(a.getAttribute("numberOfFeatures")),OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(a,b){b.insertIds=[],b.success=!1,this.readChildNodes(a,b)},TransactionSummary:function(a,b){b.success=!0},InsertResults:function(a,b){this.readChildNodes(a,b)},Feature:function(a,b){var c={fids:[]};this.readChildNodes(a,c),b.insertIds.push(c.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(a){var b=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);return a&&this.setAttributes(b,{resultType:a.resultType,startIndex:a.startIndex,count:a.count}),b},Query:function(a){a=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},a);var b=a.featurePrefix,c=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(b?b+":":"")+a.featureType,srsName:a.srsName}});if(a.featureNS&&c.setAttribute("xmlns:"+b,a.featureNS),a.propertyNames)for(var d=0,e=a.propertyNames.length;d<e;d++)this.writeNode("wfs:PropertyName",{property:a.propertyNames[d]},c);return a.filter&&(OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,a.filter),this.writeNode("ogc:Filter",a.filter,c)),c},PropertyName:function(a){return this.createElementNSPlus("wfs:PropertyName",{value:a.property})}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"}),OpenLayers.Format.EncodedPolyline=OpenLayers.Class(OpenLayers.Format,{geometryType:"linestring",initialize:function(a){OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(a){var b;if("linestring"==this.geometryType)b=OpenLayers.Geometry.LineString;else if("linearring"==this.geometryType)b=OpenLayers.Geometry.LinearRing;else if("multipoint"==this.geometryType)b=OpenLayers.Geometry.MultiPoint;else if("point"!=this.geometryType&&"polygon"!=this.geometryType)return null;for(var c=this.decodeDeltas(a,2),d=c.length,e=[],f=0;f+1<d;){var g=c[f++],h=c[f++];e.push(new OpenLayers.Geometry.Point(h,g))}return"point"==this.geometryType?new OpenLayers.Feature.Vector(e[0]):"polygon"==this.geometryType?new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(e)])):new OpenLayers.Feature.Vector(new b(e))},decode:function(a,b,c){for(var d=c||1e5,e=this.decodeDeltas(a,b,d),f=e.length,g=[],h=0;h+(b-1)<f;){for(var i=[],j=0;j<b;++j)i.push(e[h++]);g.push(i)}return g},write:function(a){var b;b=a.constructor==Array?a[0]:a;var c,d=b.geometry,e=d.CLASS_NAME.split(".")[2].toLowerCase();if("point"==e)c=new Array(d);else if("linestring"==e||"linearring"==e||"multipoint"==e)c=d.components;else{if("polygon"!=e)return null;c=d.components[0].components}for(var f=[],g=c.length,h=0;h<g;++h){var i=c[h];f.push(i.y),f.push(i.x)}return this.encodeDeltas(f,2)},encode:function(a,b,c){for(var d=c||1e5,e=[],f=a.length,g=0;g<f;++g)for(var h=a[g],i=0;i<b;++i)e.push(h[i]);return this.encodeDeltas(e,b,d)},encodeDeltas:function(a,b,c){var d,e=c||1e5,f=new Array(b);for(d=0;d<b;++d)f[d]=0;for(var g=a.length,h=0;h<g;)for(d=0;d<b;++d,++h){var i=a[h],j=i-f[d];f[d]=i,a[h]=j}return this.encodeFloats(a,e)},decodeDeltas:function(a,b,c){var d,e=c||1e5,f=new Array(b);for(d=0;d<b;++d)f[d]=0;for(var g=this.decodeFloats(a,e),h=g.length,i=0;i<h;)for(d=0;d<b;++d,++i)f[d]+=g[i],g[i]=f[d];return g},encodeFloats:function(a,b){for(var c=b||1e5,d=a.length,e=0;e<d;++e)a[e]=Math.round(a[e]*c);return this.encodeSignedIntegers(a)},decodeFloats:function(a,b){for(var c=b||1e5,d=this.decodeSignedIntegers(a),e=d.length,f=0;f<e;++f)d[f]/=c;return d},encodeSignedIntegers:function(a){for(var b=a.length,c=0;c<b;++c){var d=a[c],e=d<<1;d<0&&(e=~e),a[c]=e}return this.encodeUnsignedIntegers(a)},decodeSignedIntegers:function(a){for(var b=this.decodeUnsignedIntegers(a),c=b.length,d=0;d<c;++d){var e=b[d];b[d]=1&e?~(e>>1):e>>1}return b},encodeUnsignedIntegers:function(a){for(var b="",c=a.length,d=0;d<c;++d)b+=this.encodeUnsignedInteger(a[d]);return b},decodeUnsignedIntegers:function(a){for(var b=[],c=0,d=0,e=a.length,f=0;f<e;++f){var g=a.charCodeAt(f)-63;c|=(31&g)<<d,g<32?(b.push(c),c=0,d=0):d+=5}return b},encodeFloat:function(a,b){return a=Math.round(a*(b||1e5)),this.encodeSignedInteger(a)},decodeFloat:function(a,b){return this.decodeSignedInteger(a)/(b||1e5)},encodeSignedInteger:function(a){var b=a<<1;return a<0&&(b=~b),this.encodeUnsignedInteger(b)},decodeSignedInteger:function(a){var b=this.decodeUnsignedInteger(a);return 1&b?~(b>>1):b>>1},encodeUnsignedInteger:function(a){for(var b,c="";a>=32;)b=63+(32|31&a),c+=String.fromCharCode(b),a>>=5;return b=a+63,c+=String.fromCharCode(b)},decodeUnsignedInteger:function(a){for(var b=0,c=0,d=a.length,e=0;e<d;++e){var f=a.charCodeAt(e)-63;if(b|=(31&f)<<c,f<32)break;c+=5}return b},CLASS_NAME:"OpenLayers.Format.EncodedPolyline"}),OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handlerOptions:null,handler:null,eventListeners:null,events:null,initialize:function(a){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,""),OpenLayers.Util.extend(this,a),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){if(this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null),this.eventListeners=null,this.handler&&(this.handler.destroy(),this.handler=null),this.handlers){for(var a in this.handlers)this.handlers.hasOwnProperty(a)&&"function"==typeof this.handlers[a].destroy&&this.handlers[a].destroy();this.handlers=null}this.map&&(this.map.removeControl(this),this.map=null),this.div=null},setMap:function(a){this.map=a,this.handler&&this.handler.setMap(a)},draw:function(a){return null==this.div&&(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.allowSelection||(this.div.className+=" olControlNoSelect",this.div.setAttribute("unselectable","on",0),this.div.onselectstart=OpenLayers.Function.False),""!=this.title&&(this.div.title=this.title)),null!=a&&(this.position=a.clone()),this.moveTo(this.position),this.div},moveTo:function(a){null!=a&&null!=this.div&&(this.div.style.left=a.x+"px",this.div.style.top=a.y+"px")},activate:function(){return!this.active&&(this.handler&&this.handler.activate(),this.active=!0,this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("activate"),!0)},deactivate:function(){return!!this.active&&(this.handler&&this.handler.deactivate(),this.active=!1,this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("deactivate"),!0)},CLASS_NAME:"OpenLayers.Control"}),OpenLayers.Control.TYPE_BUTTON=1,OpenLayers.Control.TYPE_TOGGLE=2,OpenLayers.Control.TYPE_TOOL=3,OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:!0,defaultControl:null,saveState:!1,allowDepress:!1,activeState:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]),this.controls=[],this.activeState={}},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick),OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var a,b=this.controls.length-1;b>=0;b--)a=this.controls[b],a.events&&a.events.un({activate:this.iconOn,deactivate:this.iconOff}),a.panel_div=null;this.activeState=null},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){for(var a,b=0,c=this.controls.length;b<c;b++)((a=this.controls[b])===this.defaultControl||this.saveState&&this.activeState[a.id])&&a.activate();return!0===this.saveState&&(this.defaultControl=null),this.redraw(),!0}return!1},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){for(var a,b=0,c=this.controls.length;b<c;b++)a=this.controls[b],this.activeState[a.id]=a.deactivate();return this.redraw(),!0}return!1},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick),this.addControlsToMap(this.controls),this.div},redraw:function(){for(var a=this.div.childNodes.length,b=a-1;b>=0;b--)this.div.removeChild(this.div.childNodes[b]);if(this.div.innerHTML="",this.active)for(var b=0,c=this.controls.length;b<c;b++)this.div.appendChild(this.controls[b].panel_div)},activateControl:function(a){if(!this.active)return!1;if(a.type==OpenLayers.Control.TYPE_BUTTON)return void a.trigger();if(a.type==OpenLayers.Control.TYPE_TOGGLE)return void(a.active?a.deactivate():a.activate());if(this.allowDepress&&a.active)a.deactivate();else{for(var b,c=0,d=this.controls.length;c<d;c++)(b=this.controls[c])==a||b.type!==OpenLayers.Control.TYPE_TOOL&&null!=b.type||b.deactivate();a.activate()}},addControls:function(a){OpenLayers.Util.isArray(a)||(a=[a]),this.controls=this.controls.concat(a);for(var b=0,c=a.length;b<c;b++){var d=a[b],e=this.createControlMarkup(d);OpenLayers.Element.addClass(e,d.displayClass+"ItemInactive"),OpenLayers.Element.addClass(e,"olButton"),""==d.title||e.title||(e.title=d.title),d.panel_div=e}this.map&&(this.addControlsToMap(a),this.redraw())},createControlMarkup:function(a){return document.createElement("div")},addControlsToMap:function(a){for(var b,c=0,d=a.length;c<d;c++)b=a[c],!0===b.autoActivate?(b.autoActivate=!1,this.map.addControl(b),b.autoActivate=!0):(this.map.addControl(b),b.deactivate()),b.events.on({activate:this.iconOn,deactivate:this.iconOff})},iconOn:function(){var a=this.panel_div,b=new RegExp("\\b("+this.displayClass+"Item)Inactive\\b");a.className=a.className.replace(b,"$1Active")},iconOff:function(){var a=this.panel_div,b=new RegExp("\\b("+this.displayClass+"Item)Active\\b");a.className=a.className.replace(b,"$1Inactive")},onButtonClick:function(a){for(var b=this.controls,c=a.buttonElement,d=b.length-1;d>=0;--d)if(b[d].panel_div===c){this.activateControl(b[d]);break}},getControlsBy:function(a,b){var c="function"==typeof b.test;return OpenLayers.Array.filter(this.controls,function(d){return d[a]==b||c&&b.test(d[a])})},getControlsByName:function(a){return this.getControlsBy("name",a)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},CLASS_NAME:"OpenLayers.Control.Panel"}),OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"}),OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomIn()},CLASS_NAME:"OpenLayers.Control.ZoomIn"}),OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomOut()},CLASS_NAME:"OpenLayers.Control.ZoomOut"}),OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control.Button,{trigger:function(){this.map&&this.map.zoomToMaxExtent()},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"}),OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]),this.addControls([new OpenLayers.Control.ZoomIn,new OpenLayers.Control.ZoomToMaxExtent,new OpenLayers.Control.ZoomOut])},CLASS_NAME:"OpenLayers.Control.ZoomPanel"}),OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(a,b,c,d){OpenLayers.Layer.prototype.initialize.apply(this,[a,d]),this.url=b,this.params||(this.params=OpenLayers.Util.extend({},c))},destroy:function(){this.url=null,this.params=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.prototype.clone.apply(this,[a])},setUrl:function(a){this.url=a},mergeNewParams:function(a){this.params=OpenLayers.Util.extend(this.params,a);var b=this.redraw();return null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"}),b},redraw:function(a){return a?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(a,b){for(var c=1,d=0,e=a.length;d<e;d++)c*=a.charCodeAt(d)*this.URL_HASH_FACTOR,c-=Math.floor(c);return b[Math.floor(c*b.length)]},getFullRequestString:function(a,b){var c=b||this.url,d=OpenLayers.Util.extend({},this.params);d=OpenLayers.Util.extend(d,a);var e=OpenLayers.Util.getParameterString(d);OpenLayers.Util.isArray(c)&&(c=this.selectUrl(e,c));var f=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c));for(var g in d)g.toUpperCase()in f&&delete d[g];return e=OpenLayers.Util.getParameterString(d),OpenLayers.Util.urlAppend(c,e)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"}),OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(a,b,c,d,e,f){this.layer=a,this.position=b.clone(),this.setBounds(c),this.url=d,e&&(this.size=e.clone()),this.id=OpenLayers.Util.createUniqueID("Tile_"),OpenLayers.Util.extend(this,f),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners)},unload:function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("unload"))},destroy:function(){this.layer=null,this.bounds=null,this.size=null,this.position=null,this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.eventListeners=null,this.events=null},draw:function(a){a||this.clear();var b=this.shouldDraw();return b&&!a&&!1===this.events.triggerEvent("beforedraw")&&(b=null),b},shouldDraw:function(){var a=!1,b=this.layer.maxExtent;if(b){var c=this.layer.map,d=c.baseLayer.wrapDateLine&&c.getMaxExtent();this.bounds.intersectsBounds(b,{inclusive:!1,worldBounds:d})&&(a=!0)}return a||this.layer.displayOutsideMaxExtent},setBounds:function(a){if(a=a.clone(),this.layer.map.baseLayer.wrapDateLine){var b=this.layer.map.getMaxExtent(),c=this.layer.map.getResolution();a=a.wrapDateLine(b,{leftTolerance:c,rightTolerance:c})}this.bounds=a},moveTo:function(a,b,c){null==c&&(c=!0),this.setBounds(a),this.position=b.clone(),c&&this.draw()},clear:function(a){},CLASS_NAME:"OpenLayers.Tile"}),OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(a,b,c,d,e,f){OpenLayers.Tile.prototype.initialize.apply(this,arguments),this.url=d,this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack(),(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack)&&(this.frame=document.createElement("div"),this.frame.style.position="absolute",this.frame.style.overflow="hidden"),null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){this.imgDiv&&(this.clear(),this.imgDiv=null,this.frame=null),this.asyncRequestId=null,OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var a=OpenLayers.Tile.prototype.draw.apply(this,arguments);return a?(this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position)),this.isLoading?this._loadEvent="reload":(this.isLoading=!0,this._loadEvent="loadstart"),this.renderTile(),this.positionTile()):!1===a&&this.unload(),a},renderTile:function(){if(this.layer.async){var a=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(b){a==this.asyncRequestId&&(this.url=b,this.initImage())},this)}else this.url=this.layer.getURL(this.bounds),this.initImage()},positionTile:function(){var a=this.getTile().style,b=this.frame?this.size:this.layer.getImageSize(this.bounds),c=1;this.layer instanceof OpenLayers.Layer.Grid&&(c=this.layer.getServerResolution()/this.layer.map.getResolution()),a.left=this.position.x+"px",a.top=this.position.y+"px",a.width=Math.round(c*b.w)+"px",a.height=Math.round(c*b.h)+"px"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var a=this.imgDiv;if(a){var b=this.getTile();b.parentNode===this.layer.div&&this.layer.div.removeChild(b),this.setImgSrc(),!0===this.layerAlphaHack&&(a.style.filter=""),OpenLayers.Element.removeClass(a,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=OpenLayers.Tile.Image.IMAGE.cloneNode(!1);var a=this.imgDiv.style;if(this.frame){var b=0,c=0;this.layer.gutter&&(b=this.layer.gutter/this.layer.tileSize.w*100,c=this.layer.gutter/this.layer.tileSize.h*100),a.left=-b+"%",a.top=-c+"%",a.width=2*b+100+"%",a.height=2*c+100+"%"}a.visibility="hidden",a.opacity=0,this.layer.opacity<1&&(a.filter="alpha(opacity="+100*this.layer.opacity+")"),a.position="absolute",this.layerAlphaHack&&(a.paddingTop=a.height,a.height="0",a.width="100%"),this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},setImage:function(a){this.imgDiv=a},initImage:function(){if(!this.url&&!this.imgDiv)return void(this.isLoading=!1);this.events.triggerEvent("beforeload"),this.layer.div.appendChild(this.getTile()),this.events.triggerEvent(this._loadEvent);var a=this.getImage(),b=a.getAttribute("src")||"";this.url&&OpenLayers.Util.isEquivalentUrl(b,this.url)?this._loadTimeout=window.setTimeout(OpenLayers.Function.bind(this.onImageLoad,this),0):(this.stopLoading(),this.crossOriginKeyword&&a.removeAttribute("crossorigin"),OpenLayers.Event.observe(a,"load",OpenLayers.Function.bind(this.onImageLoad,this)),OpenLayers.Event.observe(a,"error",OpenLayers.Function.bind(this.onImageError,this)),this.imageReloadAttempts=0,this.setImgSrc(this.url))},setImgSrc:function(a){var b=this.imgDiv;a?(b.style.visibility="hidden",b.style.opacity=0,this.crossOriginKeyword&&("data:"!==a.substr(0,5)?b.setAttribute("crossorigin",this.crossOriginKeyword):b.removeAttribute("crossorigin")),b.src=a):(this.stopLoading(),this.imgDiv=null,b.parentNode&&b.parentNode.removeChild(b))},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var a;return this.frame?(a=this.frame.cloneNode(!1),a.appendChild(this.imgDiv)):a=this.imgDiv,this.imgDiv=null,a}},onImageLoad:function(){var a=this.imgDiv;this.stopLoading(),a.style.visibility="inherit",a.style.opacity=this.layer.opacity,this.isLoading=!1,this.canvasContext=null,this.events.triggerEvent("loadend"),!0===this.layerAlphaHack&&(a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a.src+"', sizingMethod='scale')")},onImageError:function(){var a=this.imgDiv;null!=a.src&&(this.imageReloadAttempts++,this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.layer.getURL(this.bounds)):(OpenLayers.Element.addClass(a,"olImageLoadError"),this.events.triggerEvent("loaderror"),this.onImageLoad()))},stopLoading:function(){OpenLayers.Event.stopObservingElement(this.imgDiv),window.clearTimeout(this._loadTimeout),delete this._loadTimeout},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var a=document.createElement("canvas");a.width=this.size.w,a.height=this.size.h,this.canvasContext=a.getContext("2d"),this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"}),OpenLayers.Tile.Image.IMAGE=function(){var a=new Image;return a.className="olTileImage",a.galleryImg="no",a}(),OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:"resize",numLoadingTiles:0,serverResolutions:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,gridLayout:null,rowSign:null,transitionendEvents:["transitionend","webkitTransitionEnd","otransitionend","oTransitionEnd"],initialize:function(a,b,c,d){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments),this.grid=[],this._removeBackBuffer=OpenLayers.Function.bind(this.removeBackBuffer,this),this.initProperties(),this.rowSign="t"===this.tileOriginCorner.substr(0,1)?1:-1},initProperties:function(){void 0===this.options.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500),void 0===this.options.className&&(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid")},setMap:function(a){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,a),OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(a){this.removeBackBuffer()},destroy:function(){this.removeBackBuffer(),this.clearGrid(),this.grid=null,this.tileSize=null,OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var a=0,b=this.grid.length;a<b;a++)for(var c=this.grid[a],d=0,e=c.length;d<e;d++){var f=c[d];this.destroyTile(f)}this.grid=[],this.gridResolution=null,this.gridLayout=null}},addOptions:function(a,b){var c=void 0!==a.singleTile&&a.singleTile!==this.singleTile;OpenLayers.Layer.HTTPRequest.prototype.addOptions.apply(this,arguments),this.map&&c&&(this.initProperties(),this.clearGrid(),this.tileSize=this.options.tileSize,this.setTileSize(),this.moveTo(null,!0))},clone:function(a){return null==a&&(a=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[a]),null!=this.tileSize&&(a.tileSize=this.tileSize.clone()),a.grid=[],a.gridResolution=null,a.backBuffer=null,a.backBufferTimerId=null,a.loading=!1,a.numLoadingTiles=0,a},moveTo:function(a,b,c){if(OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments),null!=(a=a||this.map.getExtent())){var d=!this.grid.length||b,e=this.getTilesBounds(),f=this.map.getResolution();this.getServerResolution(f);this.singleTile?(d||!c&&!e.containsBounds(a))&&(b&&"resize"!==this.transitionEffect&&this.removeBackBuffer(),b&&"resize"!==this.transitionEffect||this.applyBackBuffer(f),this.initSingleTile(a)):(d=d||!e.intersectsBounds(a,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()}),d?(!b||"resize"!==this.transitionEffect&&this.gridResolution!==f||this.applyBackBuffer(f),this.initGriddedTiles(a)):this.moveGriddedTiles())}},getTileData:function(a){var b=null,c=a.lon,d=a.lat,e=this.grid.length;if(this.map&&e){var f=this.map.getResolution(),g=this.tileSize.w,h=this.tileSize.h,i=this.grid[0][0].bounds,j=i.left,k=i.top;if(c<j&&this.map.baseLayer.wrapDateLine){var l=this.map.getMaxExtent().getWidth();c+=l*Math.ceil((j-c)/l)}var m=(c-j)/(f*g),n=(k-d)/(f*h),o=Math.floor(m),p=Math.floor(n);if(p>=0&&p<e){var q=this.grid[p][o];q&&(b={tile:q,i:Math.floor((m-o)*g),j:Math.floor((n-p)*h)})}}return b},destroyTile:function(a){this.removeTileMonitoringHooks(a),a.destroy()},getServerResolution:function(a){var b=Number.POSITIVE_INFINITY;if(a=a||this.map.getResolution(),this.serverResolutions&&-1===OpenLayers.Util.indexOf(this.serverResolutions,a)){var c,d,e,f;for(c=this.serverResolutions.length-1;c>=0&&(e=this.serverResolutions[c],!((d=Math.abs(e-a))>b));c--)b=d,f=e;a=f}return a},getServerZoom:function(){var a=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,a):this.map.getZoomForResolution(a)+(this.zoomOffset||0)},applyBackBuffer:function(a){null!==this.backBufferTimerId&&this.removeBackBuffer();var b=this.backBuffer;if(!b){if(!(b=this.createBackBuffer()))return;a===this.gridResolution?this.div.insertBefore(b,this.div.firstChild):this.map.baseLayer.div.parentNode.insertBefore(b,this.map.baseLayer.div),this.backBuffer=b;var c=this.grid[0][0].bounds;this.backBufferLonLat={lon:c.left,lat:c.top},this.backBufferResolution=this.gridResolution}for(var d,e=this.backBufferResolution/a,f=b.childNodes,g=f.length-1;g>=0;--g)d=f[g],d.style.top=(e*d._i*d._h|0)+"px",d.style.left=(e*d._j*d._w|0)+"px",d.style.width=Math.round(e*d._w)+"px",d.style.height=Math.round(e*d._h)+"px";var h=this.getViewPortPxFromLonLat(this.backBufferLonLat,a),i=this.map.layerContainerOriginPx.x,j=this.map.layerContainerOriginPx.y;b.style.left=Math.round(h.x-i)+"px",b.style.top=Math.round(h.y-j)+"px"},createBackBuffer:function(){var a;if(this.grid.length>0){a=document.createElement("div"),a.id=this.div.id+"_bb",a.className="olBackBuffer",a.style.position="absolute";var b=this.map;a.style.zIndex="resize"===this.transitionEffect?this.getZIndex()-1:b.Z_INDEX_BASE.BaseLayer-(b.getNumLayers()-b.getLayerIndex(this));for(var c=0,d=this.grid.length;c<d;c++)for(var e=0,f=this.grid[c].length;e<f;e++){var g=this.grid[c][e],h=this.grid[c][e].createBackBuffer();h&&(h._i=c,h._j=e,h._w=g.size.w,h._h=g.size.h,h.id=g.id+"_bb",a.appendChild(h))}}return a},removeBackBuffer:function(){if(this._transitionElement){for(var a=this.transitionendEvents.length-1;a>=0;--a)OpenLayers.Event.stopObserving(this._transitionElement,this.transitionendEvents[a],this._removeBackBuffer);delete this._transitionElement}this.backBuffer&&(this.backBuffer.parentNode&&this.backBuffer.parentNode.removeChild(this.backBuffer),this.backBuffer=null,this.backBufferResolution=null,null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null))},moveByPx:function(a,b){this.singleTile||this.moveGriddedTiles()},setTileSize:function(a){this.singleTile&&(a=this.map.getSize(),a.h=parseInt(a.h*this.ratio,10),
a.w=parseInt(a.w*this.ratio,10)),OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[a])},getTilesBounds:function(){var a=null,b=this.grid.length;if(b){var c=this.grid[b-1][0].bounds,d=this.grid[0].length*c.getWidth(),e=this.grid.length*c.getHeight();a=new OpenLayers.Bounds(c.left,c.bottom,c.left+d,c.bottom+e)}return a},initSingleTile:function(a){this.events.triggerEvent("retile");var b=a.getCenterLonLat(),c=a.getWidth()*this.ratio,d=a.getHeight()*this.ratio,e=new OpenLayers.Bounds(b.lon-c/2,b.lat-d/2,b.lon+c/2,b.lat+d/2),f=this.map.getLayerPxFromLonLat({lon:e.left,lat:e.top});this.grid.length||(this.grid[0]=[]);var g=this.grid[0][0];g?g.moveTo(e,f):(g=this.addTile(e,f),this.addTileMonitoringHooks(g),g.draw(),this.grid[0][0]=g),this.removeExcessTiles(1,1),this.gridResolution=this.getServerResolution()},calculateGridLayout:function(a,b,c){var d=c*this.tileSize.w,e=c*this.tileSize.h,f=a.left-b.lon,g=Math.floor(f/d)-this.buffer,h=this.rowSign,i=h*(b.lat-a.top+e);return{tilelon:d,tilelat:e,startcol:g,startrow:Math[~h?"floor":"ceil"](i/e)-this.buffer*h}},getTileOrigin:function(){var a=this.tileOrigin;if(!a){var b=this.getMaxExtent(),c={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner];a=new OpenLayers.LonLat(b[c[0]],b[c[1]])}return a},getTileBoundsForGridIndex:function(a,b){var c=this.getTileOrigin(),d=this.gridLayout,e=d.tilelon,f=d.tilelat,g=d.startcol,h=d.startrow,i=this.rowSign;return new OpenLayers.Bounds(c.lon+(g+b)*e,c.lat-(h+a*i)*f*i,c.lon+(g+b+1)*e,c.lat-(h+(a-1)*i)*f*i)},initGriddedTiles:function(a){this.events.triggerEvent("retile");var b=this.map.getSize(),c=this.getTileOrigin(),d=this.map.getResolution(),e=this.getServerResolution(),f=d/e,g={w:this.tileSize.w/f,h:this.tileSize.h/f},h=Math.ceil(b.h/g.h)+2*this.buffer+1,i=Math.ceil(b.w/g.w)+2*this.buffer+1,j=this.calculateGridLayout(a,c,e);this.gridLayout=j;var k=j.tilelon,l=j.tilelat,m=this.map.layerContainerOriginPx.x,n=this.map.layerContainerOriginPx.y,o=this.getTileBoundsForGridIndex(0,0),p=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(o.left,o.top));p.x=Math.round(p.x)-m,p.y=Math.round(p.y)-n;var q=[],r=this.map.getCenter(),s=0;do{var t=this.grid[s];t||(t=[],this.grid.push(t));var u=0;do{o=this.getTileBoundsForGridIndex(s,u);var v=p.clone();v.x=v.x+u*Math.round(g.w),v.y=v.y+s*Math.round(g.h);var w=t[u];w?w.moveTo(o,v,!1):(w=this.addTile(o,v),this.addTileMonitoringHooks(w),t.push(w));var x=o.getCenterLonLat();q.push({tile:w,distance:Math.pow(x.lon-r.lon,2)+Math.pow(x.lat-r.lat,2)}),u+=1}while(o.right<=a.right+k*this.buffer||u<i);s+=1}while(o.bottom>=a.bottom-l*this.buffer||s<h);this.removeExcessTiles(s,u);var d=this.getServerResolution();this.gridResolution=d,q.sort(function(a,b){return a.distance-b.distance});for(var y=0,z=q.length;y<z;++y)q[y].tile.draw()},getMaxExtent:function(){return this.maxExtent},addTile:function(a,b){var c=new this.tileClass(this,b,a,null,this.tileSize,this.tileOptions);return this.events.triggerEvent("addtile",{tile:c}),c},addTileMonitoringHooks:function(a){a.onLoadStart=function(){!1===this.loading&&(this.loading=!0,this.events.triggerEvent("loadstart")),this.events.triggerEvent("tileloadstart",{tile:a}),this.numLoadingTiles++,!this.singleTile&&this.backBuffer&&this.gridResolution===this.backBufferResolution&&OpenLayers.Element.addClass(a.getTile(),"olTileReplacing")},a.onLoadEnd=function(b){this.numLoadingTiles--;var c="unload"===b.type;if(this.events.triggerEvent("tileloaded",{tile:a,aborted:c}),!this.singleTile&&!c&&this.backBuffer&&this.gridResolution===this.backBufferResolution){var d=a.getTile();if("none"===OpenLayers.Element.getStyle(d,"display")){var e=document.getElementById(a.id+"_bb");e&&e.parentNode.removeChild(e)}OpenLayers.Element.removeClass(d,"olTileReplacing")}if(0===this.numLoadingTiles){if(this.backBuffer)if(0===this.backBuffer.childNodes.length)this.removeBackBuffer();else{this._transitionElement=c?this.div.lastChild:a.imgDiv;for(var f=this.transitionendEvents,g=f.length-1;g>=0;--g)OpenLayers.Event.observe(this._transitionElement,f[g],this._removeBackBuffer);this.backBufferTimerId=window.setTimeout(this._removeBackBuffer,this.removeBackBufferDelay)}this.loading=!1,this.events.triggerEvent("loadend")}},a.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:a})},a.events.on({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,loaderror:a.onLoadError,scope:this})},removeTileMonitoringHooks:function(a){a.unload(),a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,loaderror:a.onLoadError,scope:this})},moveGriddedTiles:function(){for(var a=this.buffer+1;;){var b=this.grid[0][0],c={x:b.position.x+this.map.layerContainerOriginPx.x,y:b.position.y+this.map.layerContainerOriginPx.y},d=this.getServerResolution()/this.map.getResolution(),e={w:Math.round(this.tileSize.w*d),h:Math.round(this.tileSize.h*d)};if(c.x>-e.w*(a-1))this.shiftColumn(!0,e);else if(c.x<-e.w*a)this.shiftColumn(!1,e);else if(c.y>-e.h*(a-1))this.shiftRow(!0,e);else{if(!(c.y<-e.h*a))break;this.shiftRow(!1,e)}}},shiftRow:function(a,b){var c=this.grid,d=a?0:c.length-1,e=a?-1:1,f=this.rowSign;this.gridLayout.startrow+=e*f;for(var g=c[d],h=c[a?"pop":"shift"](),i=0,j=h.length;i<j;i++){var k=h[i],l=g[i].position.clone();l.y+=b.h*e,k.moveTo(this.getTileBoundsForGridIndex(d,i),l)}c[a?"unshift":"push"](h)},shiftColumn:function(a,b){var c=this.grid,d=a?0:c[0].length-1,e=a?-1:1;this.gridLayout.startcol+=e;for(var f=0,g=c.length;f<g;f++){var h=c[f],i=h[d].position.clone(),j=h[a?"pop":"shift"]();i.x+=b.w*e,j.moveTo(this.getTileBoundsForGridIndex(f,d),i),h[a?"unshift":"push"](j)}},removeExcessTiles:function(a,b){for(var c,d;this.grid.length>a;){var e=this.grid.pop();for(c=0,d=e.length;c<d;c++){var f=e[c];this.destroyTile(f)}}for(c=0,d=this.grid.length;c<d;c++)for(;this.grid[c].length>b;){var e=this.grid[c],f=e.pop();this.destroyTile(f)}},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(a){var b=this.maxExtent,c=this.getResolution(),d=c*this.tileSize.w,e=c*this.tileSize.h,f=this.getLonLatFromViewPortPx(a),g=b.left+d*Math.floor((f.lon-b.left)/d),h=b.bottom+e*Math.floor((f.lat-b.bottom)/e);return new OpenLayers.Bounds(g,h,g+d,h+e)},CLASS_NAME:"OpenLayers.Layer.Grid"}),OpenLayers.Format.ArcXML=OpenLayers.Class(OpenLayers.Format.XML,{fontStyleKeys:["antialiasing","blockout","font","fontcolor","fontsize","fontstyle","glowing","interval","outline","printmode","shadow","transparency"],request:null,response:null,initialize:function(a){if(this.request=new OpenLayers.Format.ArcXML.Request,this.response=new OpenLayers.Format.ArcXML.Response,a)if("feature"==a.requesttype){this.request.get_image=null;var b=this.request.get_feature.query;this.addCoordSys(b.featurecoordsys,a.featureCoordSys),this.addCoordSys(b.filtercoordsys,a.filterCoordSys),a.polygon?(b.isspatial=!0,b.spatialfilter.polygon=a.polygon):a.envelope&&(b.isspatial=!0,b.spatialfilter.envelope={minx:0,miny:0,maxx:0,maxy:0},this.parseEnvelope(b.spatialfilter.envelope,a.envelope))}else if("image"==a.requesttype){this.request.get_feature=null;var c=this.request.get_image.properties;this.parseEnvelope(c.envelope,a.envelope),this.addLayers(c.layerlist,a.layers),this.addImageSize(c.imagesize,a.tileSize),this.addCoordSys(c.featurecoordsys,a.featureCoordSys),this.addCoordSys(c.filtercoordsys,a.filterCoordSys)}else this.request=null;OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},parseEnvelope:function(a,b){b&&4==b.length&&(a.minx=b[0],a.miny=b[1],a.maxx=b[2],a.maxy=b[3])},addLayers:function(a,b){for(var c=0,d=b.length;c<d;c++)a.push(b[c])},addImageSize:function(a,b){null!==b&&(a.width=b.w,a.height=b.h,a.printwidth=b.w,a.printheight=b.h)},addCoordSys:function(a,b){"string"==typeof b?(a.id=parseInt(b),a.string=b):"object"==typeof b&&null!==b.proj?(a.id=b.proj.srsProjNumber,a.string=b.proj.srsCode):a=b},iserror:function(a){var b=null;if(a){a=OpenLayers.Format.XML.prototype.read.apply(this,[a]);var c=a.documentElement.getElementsByTagName("ERROR");b=null!==c&&c.length>0}else b=""!==this.response.error;return b},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=null;if(a&&a.documentElement&&(b="ARCXML"==a.documentElement.nodeName?a.documentElement:a.documentElement.getElementsByTagName("ARCXML")[0]),!b||"parsererror"===b.firstChild.nodeName){var c,d;try{c=a.firstChild.nodeValue,d=a.firstChild.childNodes[1].firstChild.nodeValue}catch(a){}throw{message:"Error parsing the ArcXML request",error:c,source:d}}return this.parseResponse(b)},write:function(a){a||(a=this.request);var b=this.createElementNS("","ARCXML");b.setAttribute("version","1.1");var c=this.createElementNS("","REQUEST");if(null!=a.get_image){var d=this.createElementNS("","GET_IMAGE");c.appendChild(d);var e=this.createElementNS("","PROPERTIES");d.appendChild(e);var f=a.get_image.properties;if(null!=f.featurecoordsys){var g=this.createElementNS("","FEATURECOORDSYS");e.appendChild(g),0===f.featurecoordsys.id?g.setAttribute("string",f.featurecoordsys.string):g.setAttribute("id",f.featurecoordsys.id)}if(null!=f.filtercoordsys){var h=this.createElementNS("","FILTERCOORDSYS");e.appendChild(h),0===f.filtercoordsys.id?h.setAttribute("string",f.filtercoordsys.string):h.setAttribute("id",f.filtercoordsys.id)}if(null!=f.envelope){var i=this.createElementNS("","ENVELOPE");e.appendChild(i),i.setAttribute("minx",f.envelope.minx),i.setAttribute("miny",f.envelope.miny),i.setAttribute("maxx",f.envelope.maxx),i.setAttribute("maxy",f.envelope.maxy)}var j=this.createElementNS("","IMAGESIZE");if(e.appendChild(j),j.setAttribute("height",f.imagesize.height),j.setAttribute("width",f.imagesize.width),f.imagesize.height==f.imagesize.printheight&&f.imagesize.width==f.imagesize.printwidth||(j.setAttribute("printheight",f.imagesize.printheight),j.setArrtibute("printwidth",f.imagesize.printwidth)),null!=f.background){var k=this.createElementNS("","BACKGROUND");e.appendChild(k),k.setAttribute("color",f.background.color.r+","+f.background.color.g+","+f.background.color.b),null!==f.background.transcolor&&k.setAttribute("transcolor",f.background.transcolor.r+","+f.background.transcolor.g+","+f.background.transcolor.b)}if(null!=f.layerlist&&f.layerlist.length>0){var l=this.createElementNS("","LAYERLIST");e.appendChild(l);for(var m=0;m<f.layerlist.length;m++){var n=this.createElementNS("","LAYERDEF");if(l.appendChild(n),n.setAttribute("id",f.layerlist[m].id),n.setAttribute("visible",f.layerlist[m].visible),"object"==typeof f.layerlist[m].query){var o=f.layerlist[m].query;if(o.where.length<0)continue;var p=null;p="boolean"==typeof o.spatialfilter&&o.spatialfilter?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY"),p.setAttribute("where",o.where),"number"==typeof o.accuracy&&o.accuracy>0&&p.setAttribute("accuracy",o.accuracy),"number"==typeof o.featurelimit&&o.featurelimit<2e3&&p.setAttribute("featurelimit",o.featurelimit),"string"==typeof o.subfields&&"#ALL#"!=o.subfields&&p.setAttribute("subfields",o.subfields),"string"==typeof o.joinexpression&&o.joinexpression.length>0&&p.setAttribute("joinexpression",o.joinexpression),"string"==typeof o.jointables&&o.jointables.length>0&&p.setAttribute("jointables",o.jointables),n.appendChild(p)}"object"==typeof f.layerlist[m].renderer&&this.addRenderer(n,f.layerlist[m].renderer)}}}else if(null!=a.get_feature){var d=this.createElementNS("","GET_FEATURES");if(d.setAttribute("outputmode","newxml"),d.setAttribute("checkesc","true"),a.get_feature.geometry?d.setAttribute("geometry",a.get_feature.geometry):d.setAttribute("geometry","false"),a.get_feature.compact&&d.setAttribute("compact",a.get_feature.compact),"number"==a.get_feature.featurelimit&&d.setAttribute("featurelimit",a.get_feature.featurelimit),d.setAttribute("globalenvelope","true"),c.appendChild(d),null!=a.get_feature.layer&&a.get_feature.layer.length>0){var q=this.createElementNS("","LAYER");q.setAttribute("id",a.get_feature.layer),d.appendChild(q)}var r=a.get_feature.query;if(null!=r){var s=null;if(s=r.isspatial?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY"),d.appendChild(s),"number"==typeof r.accuracy&&s.setAttribute("accuracy",r.accuracy),null!=r.featurecoordsys){var t=this.createElementNS("","FEATURECOORDSYS");0==r.featurecoordsys.id?t.setAttribute("string",r.featurecoordsys.string):t.setAttribute("id",r.featurecoordsys.id),s.appendChild(t)}if(null!=r.filtercoordsys){var u=this.createElementNS("","FILTERCOORDSYS");0===r.filtercoordsys.id?u.setAttribute("string",r.filtercoordsys.string):u.setAttribute("id",r.filtercoordsys.id),s.appendChild(u)}if(r.buffer>0){var v=this.createElementNS("","BUFFER");v.setAttribute("distance",r.buffer),s.appendChild(v)}if(r.isspatial){var w=this.createElementNS("","SPATIALFILTER");if(w.setAttribute("relation",r.spatialfilter.relation),s.appendChild(w),r.spatialfilter.envelope){var x=this.createElementNS("","ENVELOPE");x.setAttribute("minx",r.spatialfilter.envelope.minx),x.setAttribute("miny",r.spatialfilter.envelope.miny),x.setAttribute("maxx",r.spatialfilter.envelope.maxx),x.setAttribute("maxy",r.spatialfilter.envelope.maxy),w.appendChild(x)}else"object"==typeof r.spatialfilter.polygon&&w.appendChild(this.writePolygonGeometry(r.spatialfilter.polygon))}null!=r.where&&r.where.length>0&&s.setAttribute("where",r.where)}}return b.appendChild(c),OpenLayers.Format.XML.prototype.write.apply(this,[b])},addGroupRenderer:function(a,b){var c=this.createElementNS("","GROUPRENDERER");a.appendChild(c);for(var d=0;d<b.length;d++){var e=b[d];this.addRenderer(c,e)}},addRenderer:function(a,b){if(OpenLayers.Util.isArray(b))this.addGroupRenderer(a,b);else{var c=this.createElementNS("",b.type.toUpperCase()+"RENDERER");a.appendChild(c),"VALUEMAPRENDERER"==c.tagName?this.addValueMapRenderer(c,b):"VALUEMAPLABELRENDERER"==c.tagName?this.addValueMapLabelRenderer(c,b):"SIMPLELABELRENDERER"==c.tagName?this.addSimpleLabelRenderer(c,b):"SCALEDEPENDENTRENDERER"==c.tagName&&this.addScaleDependentRenderer(c,b)}},addScaleDependentRenderer:function(a,b){"string"!=typeof b.lower&&"number"!=typeof b.lower||a.setAttribute("lower",b.lower),"string"!=typeof b.upper&&"number"!=typeof b.upper||a.setAttribute("upper",b.upper),this.addRenderer(a,b.renderer)},addValueMapLabelRenderer:function(a,b){if(a.setAttribute("lookupfield",b.lookupfield),a.setAttribute("labelfield",b.labelfield),"object"==typeof b.exacts)for(var c=0,d=b.exacts.length;c<d;c++){var e=b.exacts[c],f=this.createElementNS("","EXACT");if("string"==typeof e.value&&f.setAttribute("value",e.value),"string"==typeof e.label&&f.setAttribute("label",e.label),"string"==typeof e.method&&f.setAttribute("method",e.method),a.appendChild(f),"object"==typeof e.symbol){var g=null;if("text"==e.symbol.type&&(g=this.createElementNS("","TEXTSYMBOL")),null!=g){for(var h=this.fontStyleKeys,i=0,j=h.length;i<j;i++){var k=h[i];e.symbol[k]&&g.setAttribute(k,e.symbol[k])}f.appendChild(g)}}}},addValueMapRenderer:function(a,b){if(a.setAttribute("lookupfield",b.lookupfield),"object"==typeof b.ranges)for(var c=0,d=b.ranges.length;c<d;c++){var e=b.ranges[c],f=this.createElementNS("","RANGE");if(f.setAttribute("lower",e.lower),f.setAttribute("upper",e.upper),a.appendChild(f),"object"==typeof e.symbol){var g=null;"simplepolygon"==e.symbol.type&&(g=this.createElementNS("","SIMPLEPOLYGONSYMBOL")),null!=g&&("string"==typeof e.symbol.boundarycolor&&g.setAttribute("boundarycolor",e.symbol.boundarycolor),"string"==typeof e.symbol.fillcolor&&g.setAttribute("fillcolor",e.symbol.fillcolor),"number"==typeof e.symbol.filltransparency&&g.setAttribute("filltransparency",e.symbol.filltransparency),f.appendChild(g))}}else if("object"==typeof b.exacts)for(var h=0,i=b.exacts.length;h<i;h++){var j=b.exacts[h],k=this.createElementNS("","EXACT");if("string"==typeof j.value&&k.setAttribute("value",j.value),"string"==typeof j.label&&k.setAttribute("label",j.label),"string"==typeof j.method&&k.setAttribute("method",j.method),a.appendChild(k),"object"==typeof j.symbol){var g=null;"simplemarker"==j.symbol.type&&(g=this.createElementNS("","SIMPLEMARKERSYMBOL")),null!=g&&("string"==typeof j.symbol.antialiasing&&g.setAttribute("antialiasing",j.symbol.antialiasing),"string"==typeof j.symbol.color&&g.setAttribute("color",j.symbol.color),"string"==typeof j.symbol.outline&&g.setAttribute("outline",j.symbol.outline),"string"==typeof j.symbol.overlap&&g.setAttribute("overlap",j.symbol.overlap),"string"==typeof j.symbol.shadow&&g.setAttribute("shadow",j.symbol.shadow),"number"==typeof j.symbol.transparency&&g.setAttribute("transparency",j.symbol.transparency),"string"==typeof j.symbol.usecentroid&&g.setAttribute("usecentroid",j.symbol.usecentroid),"number"==typeof j.symbol.width&&g.setAttribute("width",j.symbol.width),k.appendChild(g))}}},addSimpleLabelRenderer:function(a,b){a.setAttribute("field",b.field);for(var c=["featureweight","howmanylabels","labelbufferratio","labelpriorities","labelweight","linelabelposition","rotationalangles"],d=0,e=c.length;d<e;d++){var f=c[d];b[f]&&a.setAttribute(f,b[f])}if("text"==b.symbol.type){var g=b.symbol,h=this.createElementNS("","TEXTSYMBOL");a.appendChild(h);for(var c=this.fontStyleKeys,d=0,e=c.length;d<e;d++){var f=c[d];g[f]&&h.setAttribute(f,b[f])}}},writePolygonGeometry:function(a){if(!(a instanceof OpenLayers.Geometry.Polygon))throw{message:"Cannot write polygon geometry to ArcXML with an "+a.CLASS_NAME+" object.",geometry:a};for(var b=this.createElementNS("","POLYGON"),c=0,d=a.components.length;c<d;c++){for(var e=a.components[c],f=this.createElementNS("","RING"),g=0,h=e.components.length;g<h;g++){var i=e.components[g],j=this.createElementNS("","POINT");j.setAttribute("x",i.x),j.setAttribute("y",i.y),f.appendChild(j)}b.appendChild(f)}return b},parseResponse:function(a){if("string"==typeof a){a=(new OpenLayers.Format.XML).read(a)}var b=new OpenLayers.Format.ArcXML.Response,c=a.getElementsByTagName("ERROR");if(null!=c&&c.length>0)b.error=this.getChildValue(c,"Unknown error.");else{var d=a.getElementsByTagName("RESPONSE");if(null==d||0==d.length)return b.error="No RESPONSE tag found in ArcXML response.",b;var e=d[0].firstChild.nodeName;if("#text"==e&&(e=d[0].firstChild.nextSibling.nodeName),"IMAGE"==e){var f=a.getElementsByTagName("ENVELOPE"),g=a.getElementsByTagName("OUTPUT");if(null==f||0==f.length)b.error="No ENVELOPE tag found in ArcXML response.";else if(null==g||0==g.length)b.error="No OUTPUT tag found in ArcXML response.";else{var h=this.parseAttributes(f[0]),i=this.parseAttributes(g[0]);"string"==typeof i.type?b.image={envelope:h,output:{type:i.type,data:this.getChildValue(g[0])}}:b.image={envelope:h,output:i}}}else if("FEATURES"==e){var j=d[0].getElementsByTagName("FEATURES"),k=j[0].getElementsByTagName("FEATURECOUNT");if(b.features.featurecount=k[0].getAttribute("count"),b.features.featurecount>0){var l=j[0].getElementsByTagName("ENVELOPE");b.features.envelope=this.parseAttributes(l[0],"number");for(var m=j[0].getElementsByTagName("FEATURE"),n=0;n<m.length;n++){for(var o=new OpenLayers.Feature.Vector,p=m[n].getElementsByTagName("FIELD"),q=0;q<p.length;q++){var r=p[q].getAttribute("name"),s=p[q].getAttribute("value");o.attributes[r]=s}var t=m[n].getElementsByTagName("POLYGON");if(t.length>0){for(var u=t[0].getElementsByTagName("RING"),v=[],w=0;w<u.length;w++){var x=[];x.push(this.parsePointGeometry(u[w]));for(var y=u[w].getElementsByTagName("HOLE"),z=0;z<y.length;z++)x.push(this.parsePointGeometry(y[z]));y=null,v.push(new OpenLayers.Geometry.Polygon(x)),x=null}u=null,1==v.length?o.geometry=v[0]:o.geometry=new OpenLayers.Geometry.MultiPolygon(v)}b.features.feature.push(o)}}}else b.error="Unidentified response type."}return b},parseAttributes:function(a,b){for(var c={},d=0;d<a.attributes.length;d++)c[a.attributes[d].nodeName]="number"==b?parseFloat(a.attributes[d].nodeValue):a.attributes[d].nodeValue;return c},parsePointGeometry:function(a){var b=[],c=a.getElementsByTagName("COORDS");if(c.length>0){var d=this.getChildValue(c[0]);d=d.split(/;/);for(var e=0;e<d.length;e++){var f=d[e].split(/ /);b.push(new OpenLayers.Geometry.Point(f[0],f[1]))}c=null}else{var g=a.getElementsByTagName("POINT");if(g.length>0)for(var h=0;h<g.length;h++)b.push(new OpenLayers.Geometry.Point(parseFloat(g[h].getAttribute("x")),parseFloat(g[h].getAttribute("y"))));g=null}return new OpenLayers.Geometry.LinearRing(b)},CLASS_NAME:"OpenLayers.Format.ArcXML"}),OpenLayers.Format.ArcXML.Request=OpenLayers.Class({initialize:function(a){var b={get_image:{properties:{background:null,draw:!0,envelope:{minx:0,miny:0,maxx:0,maxy:0},featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},imagesize:{height:0,width:0,dpi:96,printheight:0,printwidth:0,scalesymbols:!1},layerlist:[],output:{baseurl:"",legendbaseurl:"",legendname:"",legendpath:"",legendurl:"",name:"",path:"",type:"jpg",url:""}}},get_feature:{layer:"",query:{isspatial:!1,featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},buffer:0,where:"",spatialfilter:{relation:"envelope_intersection",envelope:null}}},environment:{separators:{cs:" ",ts:";"}},layer:[],workspaces:[]};return OpenLayers.Util.extend(this,b)},CLASS_NAME:"OpenLayers.Format.ArcXML.Request"}),OpenLayers.Format.ArcXML.Response=OpenLayers.Class({initialize:function(a){var b={image:{envelope:null,output:""},features:{featurecount:0,envelope:null,feature:[]},error:""};return OpenLayers.Util.extend(this,b)},CLASS_NAME:"OpenLayers.Format.ArcXML.Response"}),OpenLayers.Layer.ArcIMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{ClientVersion:"9.2",ServiceName:""},featureCoordSys:"4326",filterCoordSys:"4326",layers:null,async:!0,name:"ArcIMS",isBaseLayer:!0,DEFAULT_OPTIONS:{tileSize:new OpenLayers.Size(512,512),featureCoordSys:"4326",filterCoordSys:"4326",layers:null,isBaseLayer:!0,async:!0,name:"ArcIMS"},initialize:function(a,b,c){this.tileSize=new OpenLayers.Size(512,512),this.params=OpenLayers.Util.applyDefaults({ServiceName:c.serviceName},this.DEFAULT_PARAMS),this.options=OpenLayers.Util.applyDefaults(c,this.DEFAULT_OPTIONS),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,b,this.params,c]),this.transparent&&(this.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.format&&(this.format=OpenLayers.Util.alphaHack()?"image/gif":"image/png")),null===this.options.layers&&(this.options.layers=[])},getURL:function(a){var b="";a=this.adjustBounds(a);var c=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:a.toArray(),tileSize:this.tileSize})),d=new OpenLayers.Request.POST({url:this.getFullRequestString(),data:c.write(),async:!1});if(null!=d){var e=d.responseXML;e&&e.documentElement||(e=d.responseText);var f=new OpenLayers.Format.ArcXML,g=f.read(e);b=this.getUrlOrImage(g.image.output)}return b},getURLasync:function(a,b,c){a=this.adjustBounds(a);var d=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:a.toArray(),tileSize:this.tileSize}));OpenLayers.Request.POST({url:this.getFullRequestString(),async:!0,data:d.write(),callback:function(a){var d=a.responseXML;d&&d.documentElement||(d=a.responseText);var e=new OpenLayers.Format.ArcXML,f=e.read(d);b.call(c,this.getUrlOrImage(f.image.output))},scope:this})},getUrlOrImage:function(a){var b="";return a.url?b=a.url:a.data&&(b="data:image/"+a.type+";base64,"+a.data),b},setLayerQuery:function(a,b){for(var c=0;c<this.options.layers.length;c++)if(a==this.options.layers[c].id)return void(this.options.layers[c].query=b);this.options.layers.push({id:a,visible:!0,query:b})},getFeatureInfo:function(a,b,c){var d=c.buffer||1,e=c.callback||function(){},f=c.scope||window,g={};OpenLayers.Util.extend(g,this.options),g.requesttype="feature",a instanceof OpenLayers.LonLat?(g.polygon=null,g.envelope=[a.lon-d,a.lat-d,a.lon+d,a.lat+d]):a instanceof OpenLayers.Geometry.Polygon&&(g.envelope=null,g.polygon=a);var h=new OpenLayers.Format.ArcXML(g);if(OpenLayers.Util.extend(h.request.get_feature,c),h.request.get_feature.layer=b.id,"number"==typeof b.query.accuracy)h.request.get_feature.query.accuracy=b.query.accuracy;else{var i=this.map.getCenter(),j=this.map.getViewPortPxFromLonLat(i);j.x++;var k=this.map.getLonLatFromPixel(j);h.request.get_feature.query.accuracy=k.lon-i.lon}h.request.get_feature.query.where=b.query.where,h.request.get_feature.query.spatialfilter.relation="area_intersection",OpenLayers.Request.POST({url:this.getFullRequestString({CustomService:"Query"}),data:h.write(),callback:function(a){var b=h.parseResponse(a.responseText);h.iserror()?e.call(f,null):e.call(f,b.features)}})},clone:function(a){return null==a&&(a=new OpenLayers.Layer.ArcIMS(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},CLASS_NAME:"OpenLayers.Layer.ArcIMS"}),OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(a,b){b.exceptionReport={version:a.getAttribute("version"),language:a.getAttribute("xml:lang"),exceptions:[]},this.readChildNodes(a,b.exceptionReport)},AllowedValues:function(a,b){b.allowedValues={},this.readChildNodes(a,b.allowedValues)},AnyValue:function(a,b){b.anyValue=!0},DataType:function(a,b){b.dataType=this.getChildValue(a)},Range:function(a,b){b.range={},this.readChildNodes(a,b.range)},MinimumValue:function(a,b){b.minValue=this.getChildValue(a)},MaximumValue:function(a,b){b.maxValue=this.getChildValue(a)},Identifier:function(a,b){b.identifier=this.getChildValue(a)},SupportedCRS:function(a,b){b.supportedCRS=this.getChildValue(a)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Util.applyDefaults({Range:function(a){var b=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":a.closure}});return this.writeNode("ows:MinimumValue",a.minValue,b),this.writeNode("ows:MaximumValue",a.maxValue,b),b},MinimumValue:function(a){return this.createElementNSPlus("ows:MinimumValue",{value:a})},MaximumValue:function(a){return this.createElementNSPlus("ows:MaximumValue",{value:a})},Value:function(a){return this.createElementNSPlus("ows:Value",{value:a})}},OpenLayers.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"}),OpenLayers.Format.WCSGetCoverage=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.1.2",schemaLocation:"http://www.opengis.net/wcs/1.1 http://schemas.opengis.net/wcs/1.1/wcsGetCoverage.xsd",write:function(a){var b=this.writeNode("wcs:GetCoverage",a);return this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{wcs:{GetCoverage:function(a){var b=this.createElementNSPlus("wcs:GetCoverage",{attributes:{version:a.version||this.VERSION,service:"WCS"}});return this.writeNode("ows:Identifier",a.identifier,b),this.writeNode("wcs:DomainSubset",a.domainSubset,b),this.writeNode("wcs:Output",a.output,b),b},DomainSubset:function(a){var b=this.createElementNSPlus("wcs:DomainSubset",{});return this.writeNode("ows:BoundingBox",a.boundingBox,b),a.temporalSubset&&this.writeNode("wcs:TemporalSubset",a.temporalSubset,b),b},TemporalSubset:function(a){for(var b=this.createElementNSPlus("wcs:TemporalSubset",{}),c=0,d=a.timePeriods.length;c<d;++c)this.writeNode("wcs:TimePeriod",a.timePeriods[c],b);return b},TimePeriod:function(a){var b=this.createElementNSPlus("wcs:TimePeriod",{});return this.writeNode("wcs:BeginPosition",a.begin,b),this.writeNode("wcs:EndPosition",a.end,b),a.resolution&&this.writeNode("wcs:TimeResolution",a.resolution,b),b},BeginPosition:function(a){return this.createElementNSPlus("wcs:BeginPosition",{value:a})},EndPosition:function(a){return this.createElementNSPlus("wcs:EndPosition",{value:a})},TimeResolution:function(a){return this.createElementNSPlus("wcs:TimeResolution",{value:a})},Output:function(a){var b=this.createElementNSPlus("wcs:Output",{attributes:{format:a.format,store:a.store}});return a.gridCRS&&this.writeNode("wcs:GridCRS",a.gridCRS,b),b},GridCRS:function(a){var b=this.createElementNSPlus("wcs:GridCRS",{});return this.writeNode("wcs:GridBaseCRS",a.baseCRS,b),a.type&&this.writeNode("wcs:GridType",a.type,b),a.origin&&this.writeNode("wcs:GridOrigin",a.origin,b),this.writeNode("wcs:GridOffsets",a.offsets,b),a.CS&&this.writeNode("wcs:GridCS",a.CS,b),b},GridBaseCRS:function(a){return this.createElementNSPlus("wcs:GridBaseCRS",{value:a})},GridOrigin:function(a){return this.createElementNSPlus("wcs:GridOrigin",{value:a})},GridType:function(a){return this.createElementNSPlus("wcs:GridType",{value:a})},GridOffsets:function(a){return this.createElementNSPlus("wcs:GridOffsets",{value:a})},GridCS:function(a){return this.createElementNSPlus("wcs:GridCS",{value:a})}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.WCSGetCoverage"}),OpenLayers.Format.WPSExecute=OpenLayers.Class(OpenLayers.Format.XML,OpenLayers.Format.Filter.v1_1_0,{namespaces:{ows:"http://www.opengis.net/ows/1.1",gml:"http://www.opengis.net/gml",wps:"http://www.opengis.net/wps/1.0.0",wfs:"http://www.opengis.net/wfs",ogc:"http://www.opengis.net/ogc",wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",schemaLocationAttr:function(a){},write:function(a){var b;window.ActiveXObject?(b=new ActiveXObject("Microsoft.XMLDOM"),this.xmldom=b):b=document.implementation.createDocument("","",null);var c=this.writeNode("wps:Execute",a,b);return this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[c])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},writers:{wps:{Execute:function(a){var b=this.createElementNSPlus("wps:Execute",{attributes:{version:this.VERSION,service:"WPS"}});return this.writeNode("ows:Identifier",a.identifier,b),this.writeNode("wps:DataInputs",a.dataInputs,b),this.writeNode("wps:ResponseForm",a.responseForm,b),b},ResponseForm:function(a){var b=this.createElementNSPlus("wps:ResponseForm",{});return a.rawDataOutput&&this.writeNode("wps:RawDataOutput",a.rawDataOutput,b),a.responseDocument&&this.writeNode("wps:ResponseDocument",a.responseDocument,b),b},ResponseDocument:function(a){var b=this.createElementNSPlus("wps:ResponseDocument",{attributes:{storeExecuteResponse:a.storeExecuteResponse,lineage:a.lineage,status:a.status}});if(a.outputs)for(var c=0,d=a.outputs.length;c<d;c++)this.writeNode("wps:Output",a.outputs[c],b);return b},Output:function(a){var b=this.createElementNSPlus("wps:Output",{attributes:{asReference:a.asReference,mimeType:a.mimeType,encoding:a.encoding,schema:a.schema}});return this.writeNode("ows:Identifier",a.identifier,b),this.writeNode("ows:Title",a.title,b),this.writeNode("ows:Abstract",a.abstract,b),b},RawDataOutput:function(a){var b=this.createElementNSPlus("wps:RawDataOutput",{attributes:{mimeType:a.mimeType,encoding:a.encoding,schema:a.schema}});return this.writeNode("ows:Identifier",a.identifier,b),b},DataInputs:function(a){for(var b=this.createElementNSPlus("wps:DataInputs",{}),c=0,d=a.length;c<d;++c)this.writeNode("wps:Input",a[c],b)
;return b},Input:function(a){var b=this.createElementNSPlus("wps:Input",{});return this.writeNode("ows:Identifier",a.identifier,b),a.title&&this.writeNode("ows:Title",a.title,b),a.data&&this.writeNode("wps:Data",a.data,b),a.reference&&this.writeNode("wps:Reference",a.reference,b),a.boundingBoxData&&this.writeNode("wps:BoundingBoxData",a.boundingBoxData,b),b},Data:function(a){var b=this.createElementNSPlus("wps:Data",{});return a.literalData?this.writeNode("wps:LiteralData",a.literalData,b):a.complexData?this.writeNode("wps:ComplexData",a.complexData,b):a.boundingBoxData&&this.writeNode("ows:BoundingBox",a.boundingBoxData,b),b},LiteralData:function(a){return this.createElementNSPlus("wps:LiteralData",{attributes:{uom:a.uom},value:a.value})},ComplexData:function(a){var b=this.createElementNSPlus("wps:ComplexData",{attributes:{mimeType:a.mimeType,encoding:a.encoding,schema:a.schema}}),c=a.value;return"string"==typeof c?b.appendChild(this.getXMLDoc().createCDATASection(a.value)):b.appendChild(c),b},Reference:function(a){var b=this.createElementNSPlus("wps:Reference",{attributes:{mimeType:a.mimeType,"xlink:href":a.href,method:a.method,encoding:a.encoding,schema:a.schema}});return a.body&&this.writeNode("wps:Body",a.body,b),b},BoundingBoxData:function(a,b){this.writers.ows.BoundingBox.apply(this,[a,b,"wps:BoundingBoxData"])},Body:function(a){var b=this.createElementNSPlus("wps:Body",{});return a.wcs?this.writeNode("wcs:GetCoverage",a.wcs,b):a.wfs?(this.featureType=a.wfs.featureType,this.version=a.wfs.version,this.writeNode("wfs:GetFeature",a.wfs,b)):this.writeNode("wps:Execute",a,b),b}},wcs:OpenLayers.Format.WCSGetCoverage.prototype.writers.wcs,wfs:OpenLayers.Format.WFST.v1_1_0.prototype.writers.wfs,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},readers:{wps:{ExecuteResponse:function(a,b){b.executeResponse={lang:a.getAttribute("lang"),statusLocation:a.getAttribute("statusLocation"),serviceInstance:a.getAttribute("serviceInstance"),service:a.getAttribute("service")},this.readChildNodes(a,b.executeResponse)},Process:function(a,b){b.process={},this.readChildNodes(a,b.process)},Status:function(a,b){b.status={creationTime:a.getAttribute("creationTime")},this.readChildNodes(a,b.status)},ProcessSucceeded:function(a,b){b.processSucceeded=!0},ProcessOutputs:function(a,b){b.processOutputs=[],this.readChildNodes(a,b.processOutputs)},Output:function(a,b){var c={};this.readChildNodes(a,c),b.push(c)},Reference:function(a,b){b.reference={href:a.getAttribute("href"),mimeType:a.getAttribute("mimeType"),encoding:a.getAttribute("encoding"),schema:a.getAttribute("schema")}},Data:function(a,b){b.data={},this.readChildNodes(a,b)},LiteralData:function(a,b){b.literalData={dataType:a.getAttribute("dataType"),uom:a.getAttribute("uom"),value:this.getChildValue(a)}},ComplexData:function(a,b){if(b.complexData={mimeType:a.getAttribute("mimeType"),schema:a.getAttribute("schema"),encoding:a.getAttribute("encoding"),value:""},this.isSimpleContent(a)){var c;for(c=a.firstChild;c;c=c.nextSibling)switch(c.nodeType){case 3:case 4:b.complexData.value+=c.nodeValue}}else for(c=a.firstChild;c;c=c.nextSibling)1==c.nodeType&&(b.complexData.value=c)},BoundingBox:function(a,b){b.boundingBoxData={dimensions:a.getAttribute("dimensions"),crs:a.getAttribute("crs")},this.readChildNodes(a,b.boundingBoxData)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSExecute"}),OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(a){OpenLayers.Util.extend(this,a),this.options=a,this.active=!1},destroy:function(){this.deactivate(),this.layer=null,this.options=null},setLayer:function(a){this.layer=a},activate:function(){return!this.active&&(this.active=!0,!0)},deactivate:function(){return!!this.active&&(this.active=!1,!0)},CLASS_NAME:"OpenLayers.Strategy"}),OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,{filter:null,cache:null,caching:!1,activate:function(){var a=OpenLayers.Strategy.prototype.activate.apply(this,arguments);return a&&(this.cache=[],this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this})),a},deactivate:function(){return this.cache=null,this.layer&&this.layer.events&&this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this}),OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(a){if(!this.caching&&this.filter){var b=a.features;a.features=[];for(var c,d=0,e=b.length;d<e;++d)c=b[d],this.filter.evaluate(c)?a.features.push(c):this.cache.push(c)}},handleRemove:function(a){this.caching||(this.cache=[])},setFilter:function(a){this.filter=a;var b=this.cache;if(this.cache=[],this.handleAdd({features:this.layer.features}),this.cache.length>0&&(this.caching=!0,this.layer.removeFeatures(this.cache.slice()),this.caching=!1),b.length>0){var c={features:b};this.handleAdd(c),c.features.length>0&&(this.caching=!0,this.layer.addFeatures(c.features),this.caching=!1)}},CLASS_NAME:"OpenLayers.Strategy.Filter"}),OpenLayers.Format.XLS=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",stringifyOutput:!0,CLASS_NAME:"OpenLayers.Format.XLS"}),OpenLayers.Format.XLS.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xls:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},xy:!0,defaultPrefix:"xls",schemaLocation:null,read:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c={};return this.readChildNodes(a,c),c},readers:{xls:{XLS:function(a,b){b.version=a.getAttribute("version"),this.readChildNodes(a,b)},Response:function(a,b){this.readChildNodes(a,b)},GeocodeResponse:function(a,b){b.responseLists=[],this.readChildNodes(a,b)},GeocodeResponseList:function(a,b){var c={features:[],numberOfGeocodedAddresses:parseInt(a.getAttribute("numberOfGeocodedAddresses"))};b.responseLists.push(c),this.readChildNodes(a,c)},GeocodedAddress:function(a,b){var c=new OpenLayers.Feature.Vector;b.features.push(c),this.readChildNodes(a,c),c.geometry=c.components[0]},GeocodeMatchCode:function(a,b){b.attributes.matchCode={accuracy:parseFloat(a.getAttribute("accuracy")),matchType:a.getAttribute("matchType")}},Address:function(a,b){var c={countryCode:a.getAttribute("countryCode"),addressee:a.getAttribute("addressee"),street:[],place:[]};b.attributes.address=c,this.readChildNodes(a,c)},freeFormAddress:function(a,b){b.freeFormAddress=this.getChildValue(a)},StreetAddress:function(a,b){this.readChildNodes(a,b)},Building:function(a,b){b.building={number:a.getAttribute("number"),subdivision:a.getAttribute("subdivision"),buildingName:a.getAttribute("buildingName")}},Street:function(a,b){b.street.push(this.getChildValue(a))},Place:function(a,b){b.place[a.getAttribute("type")]=this.getChildValue(a)},PostalCode:function(a,b){b.postalCode=this.getChildValue(a)}},gml:OpenLayers.Format.GML.v3.prototype.readers.gml},write:function(a){return this.writers.xls.XLS.apply(this,[a])},writers:{xls:{XLS:function(a){var b=this.createElementNSPlus("xls:XLS",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});return this.writeNode("RequestHeader",a.header,b),this.writeNode("Request",a,b),b},RequestHeader:function(a){return this.createElementNSPlus("xls:RequestHeader")},Request:function(a){var b=this.createElementNSPlus("xls:Request",{attributes:{methodName:"GeocodeRequest",requestID:a.requestID||"",version:this.VERSION}});return this.writeNode("GeocodeRequest",a.addresses,b),b},GeocodeRequest:function(a){for(var b=this.createElementNSPlus("xls:GeocodeRequest"),c=0,d=a.length;c<d;c++)this.writeNode("Address",a[c],b);return b},Address:function(a){var b=this.createElementNSPlus("xls:Address",{attributes:{countryCode:a.countryCode}});return a.freeFormAddress?this.writeNode("freeFormAddress",a.freeFormAddress,b):(a.street&&this.writeNode("StreetAddress",a,b),a.municipality&&this.writeNode("Municipality",a.municipality,b),a.countrySubdivision&&this.writeNode("CountrySubdivision",a.countrySubdivision,b),a.postalCode&&this.writeNode("PostalCode",a.postalCode,b)),b},freeFormAddress:function(a){return this.createElementNSPlus("freeFormAddress",{value:a})},StreetAddress:function(a){var b=this.createElementNSPlus("xls:StreetAddress");a.building&&this.writeNode(b,"Building",a.building);var c=a.street;OpenLayers.Util.isArray(c)||(c=[c]);for(var d=0,e=c.length;d<e;d++)this.writeNode("Street",c[d],b);return b},Building:function(a){return this.createElementNSPlus("xls:Building",{attributes:{number:a.number,subdivision:a.subdivision,buildingName:a.buildingName}})},Street:function(a){return this.createElementNSPlus("xls:Street",{value:a})},Municipality:function(a){return this.createElementNSPlus("xls:Place",{attributes:{type:"Municipality"},value:a})},CountrySubdivision:function(a){return this.createElementNSPlus("xls:Place",{attributes:{type:"CountrySubdivision"},value:a})},PostalCode:function(a){return this.createElementNSPlus("xls:PostalCode",{value:a})}}},CLASS_NAME:"OpenLayers.Format.XLS.v1"}),OpenLayers.Format.XLS.v1_1_0=OpenLayers.Class(OpenLayers.Format.XLS.v1,{VERSION:"1.1",schemaLocation:"http://www.opengis.net/xls http://schemas.opengis.net/ols/1.1.0/LocationUtilityService.xsd",CLASS_NAME:"OpenLayers.Format.XLS.v1_1_0"}),OpenLayers.Format.XLS.v1_1=OpenLayers.Format.XLS.v1_1_0,OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!0,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(a,b,c,d,e){this.url=b,this.extent=c,this.maxExtent=c,this.size=d,OpenLayers.Layer.prototype.initialize.apply(this,[a,e]),this.aspectRatio=this.extent.getHeight()/this.size.h/(this.extent.getWidth()/this.size.w)},destroy:function(){this.tile&&(this.removeTileMonitoringHooks(this.tile),this.tile.destroy(),this.tile=null),OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions())),a=OpenLayers.Layer.prototype.clone.apply(this,[a])},setMap:function(a){null==this.options.maxResolution&&(this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w),OpenLayers.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(a,b,c){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var d=null==this.tile;if(b||d){this.setTileSize();var e=this.map.getLayerPxFromLonLat({lon:this.extent.left,lat:this.extent.top});d?(this.tile=new OpenLayers.Tile.Image(this,e,this.extent,null,this.tileSize),this.addTileMonitoringHooks(this.tile)):(this.tile.size=this.tileSize.clone(),this.tile.position=e.clone()),this.tile.draw()}},setTileSize:function(){var a=this.extent.getWidth()/this.map.getResolution(),b=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(a,b)},addTileMonitoringHooks:function(a){a.onLoadStart=function(){this.events.triggerEvent("loadstart")},a.events.register("loadstart",this,a.onLoadStart),a.onLoadEnd=function(){this.events.triggerEvent("loadend")},a.events.register("loadend",this,a.onLoadEnd),a.events.register("unload",this,a.onLoadEnd)},removeTileMonitoringHooks:function(a){a.unload(),a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this})},setUrl:function(a){this.url=a,this.tile.draw()},getURL:function(a){return this.url},CLASS_NAME:"OpenLayers.Layer.Image"}),OpenLayers.Strategy.Save=OpenLayers.Class(OpenLayers.Strategy,{events:null,auto:!1,timer:null,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a]),this.events=new OpenLayers.Events(this)},activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);return a&&this.auto&&("number"==typeof this.auto?this.timer=window.setInterval(OpenLayers.Function.bind(this.save,this),1e3*this.auto):this.layer.events.on({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})),a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);return a&&this.auto&&("number"==typeof this.auto?window.clearInterval(this.timer):this.layer.events.un({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})),a},triggerSave:function(a){var b=a.feature;b.state!==OpenLayers.State.INSERT&&b.state!==OpenLayers.State.UPDATE&&b.state!==OpenLayers.State.DELETE||this.save([a.feature])},save:function(a){a||(a=this.layer.features),this.events.triggerEvent("start",{features:a});var b=this.layer.projection,c=this.layer.map.getProjectionObject();if(!c.equals(b)){for(var d,e,f=a.length,g=new Array(f),h=0;h<f;++h)d=a[h],e=d.clone(),e.fid=d.fid,e.state=d.state,d.url&&(e.url=d.url),e._original=d,e.geometry.transform(c,b),g[h]=e;a=g}this.layer.protocol.commit(a,{callback:this.onCommit,scope:this})},onCommit:function(a){var b={response:a};if(a.success()){for(var c,d,e=a.reqFeatures,f=[],g=a.insertIds||[],h=0,i=0,j=e.length;i<j;++i)d=e[i],d=d._original||d,(c=d.state)&&(c==OpenLayers.State.DELETE?f.push(d):c==OpenLayers.State.INSERT&&(d.fid=g[h],++h),d.state=null);f.length>0&&this.layer.destroyFeatures(f),this.events.triggerEvent("success",b)}else this.events.triggerEvent("fail",b)},CLASS_NAME:"OpenLayers.Strategy.Save"}),OpenLayers.Events.featureclick=OpenLayers.Class({cache:null,map:null,provides:["featureclick","nofeatureclick","featureover","featureout"],initialize:function(a){if(this.target=a,a.object instanceof OpenLayers.Map)this.setMap(a.object);else{if(!(a.object instanceof OpenLayers.Layer.Vector))throw"Listeners for '"+this.provides.join("', '")+"' events can only be registered for OpenLayers.Layer.Vector or OpenLayers.Map instances";a.object.map?this.setMap(a.object.map):a.object.events.register("added",this,function(b){this.setMap(a.object.map)})}for(var b=this.provides.length-1;b>=0;--b)a.extensions[this.provides[b]]=!0},setMap:function(a){this.map=a,this.cache={},a.events.register("mousedown",this,this.start,{extension:!0}),a.events.register("mouseup",this,this.onClick,{extension:!0}),a.events.register("touchstart",this,this.start,{extension:!0}),a.events.register("touchmove",this,this.cancel,{extension:!0}),a.events.register("touchend",this,this.onClick,{extension:!0}),a.events.register("mousemove",this,this.onMousemove,{extension:!0})},start:function(a){this.startEvt=a},cancel:function(a){delete this.startEvt},onClick:function(a){if(this.startEvt&&("touchend"===a.type||OpenLayers.Event.isLeftClick(a))){var b=this.getFeatures(this.startEvt);delete this.startEvt;for(var c,d,e={},f=0,g=b.length;f<g&&(c=b[f],d=c.layer,e[d.id]=!0,!1!==this.triggerEvent("featureclick",{feature:c}));++f);for(f=0,g=this.map.layers.length;f<g;++f)(d=this.map.layers[f])instanceof OpenLayers.Layer.Vector&&!e[d.id]&&this.triggerEvent("nofeatureclick",{layer:d})}},onMousemove:function(a){delete this.startEvt;for(var b,c=this.getFeatures(a),d={},e=[],f=0,g=c.length;f<g;++f)b=c[f],d[b.id]=b,this.cache[b.id]||e.push(b);var h=[];for(var i in this.cache)b=this.cache[i],b.layer&&b.layer.map?d[b.id]||h.push(b):delete this.cache[i];for(f=0,g=e.length;f<g&&(b=e[f],this.cache[b.id]=b,!1!==this.triggerEvent("featureover",{feature:b}));++f);for(f=0,g=h.length;f<g&&(b=h[f],delete this.cache[b.id],!1!==this.triggerEvent("featureout",{feature:b}));++f);},triggerEvent:function(a,b){var c=b.feature?b.feature.layer:b.layer,d=this.target.object;if(d instanceof OpenLayers.Map||d===c)return this.target.triggerEvent(a,b)},getFeatures:function(a){var b,c,d,e,f,g=a.clientX,h=a.clientY,i=[],j=[],k=[];for(e=this.map.layers.length-1;e>=0;--e)if(b=this.map.layers[e],"none"!==b.div.style.display)if(b.renderer instanceof OpenLayers.Renderer.Elements){if(b instanceof OpenLayers.Layer.Vector)for(c=document.elementFromPoint(g,h);c&&c._featureId;)d=b.getFeatureById(c._featureId),d?(i.push(d),c.style.display="none",j.push(c),c=document.elementFromPoint(g,h)):c=!1;k.push(b),b.div.style.display="none"}else b.renderer instanceof OpenLayers.Renderer.Canvas&&(d=b.renderer.getFeatureIdFromEvent(a))&&(i.push(d),k.push(b));for(e=0,f=j.length;e<f;++e)j[e].style.display="";for(e=k.length-1;e>=0;--e)k[e].div.style.display="block";return i},destroy:function(){for(var a=this.provides.length-1;a>=0;--a)delete this.target.extensions[this.provides[a]];this.map.events.un({mousemove:this.onMousemove,mousedown:this.start,mouseup:this.onClick,touchstart:this.start,touchmove:this.cancel,touchend:this.onClick,scope:this}),delete this.cache,delete this.map,delete this.target}}),OpenLayers.Events.nofeatureclick=OpenLayers.Events.featureclick,OpenLayers.Events.featureover=OpenLayers.Events.featureclick,OpenLayers.Events.featureout=OpenLayers.Events.featureclick,OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,{defaultDesc:"No description available",extractWaypoints:!0,extractTracks:!0,extractRoutes:!0,extractAttributes:!0,namespaces:{gpx:"http://www.topografix.com/GPX/1/1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",creator:"OpenLayers",initialize:function(a){this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=[];if(this.extractTracks)for(var c=a.getElementsByTagName("trk"),d=0,e=c.length;d<e;d++){var f={};this.extractAttributes&&(f=this.parseAttributes(c[d]));for(var g=this.getElementsByTagNameNS(c[d],c[d].namespaceURI,"trkseg"),h=0,i=g.length;h<i;h++){var j=this.extractSegment(g[h],"trkpt");b.push(new OpenLayers.Feature.Vector(j,f))}}if(this.extractRoutes)for(var k=a.getElementsByTagName("rte"),l=0,m=k.length;l<m;l++){var f={};this.extractAttributes&&(f=this.parseAttributes(k[l]));var n=this.extractSegment(k[l],"rtept");b.push(new OpenLayers.Feature.Vector(n,f))}if(this.extractWaypoints)for(var o=a.getElementsByTagName("wpt"),p=0,e=o.length;p<e;p++){var f={};this.extractAttributes&&(f=this.parseAttributes(o[p]));var q=new OpenLayers.Geometry.Point(o[p].getAttribute("lon"),o[p].getAttribute("lat"));b.push(new OpenLayers.Feature.Vector(q,f))}if(this.internalProjection&&this.externalProjection)for(var r=0,s=b.length;r<s;r++)b[r].geometry.transform(this.externalProjection,this.internalProjection);return b},extractSegment:function(a,b){for(var c=this.getElementsByTagNameNS(a,a.namespaceURI,b),d=[],e=0,f=c.length;e<f;e++)d.push(new OpenLayers.Geometry.Point(c[e].getAttribute("lon"),c[e].getAttribute("lat")));return new OpenLayers.Geometry.LineString(d)},parseAttributes:function(a){for(var b,c,d={},e=a.firstChild;e;)1==e.nodeType&&e.firstChild&&(b=e.firstChild,3!=b.nodeType&&4!=b.nodeType||"trkseg"!=(c=e.prefix?e.nodeName.split(":")[1]:e.nodeName)&&"rtept"!=c&&(d[c]=b.nodeValue)),e=e.nextSibling;return d},write:function(a,b){a=OpenLayers.Util.isArray(a)?a:[a];var c=this.createElementNS(this.namespaces.gpx,"gpx");c.setAttribute("version","1.1"),c.setAttribute("creator",this.creator),this.setAttributes(c,{"xsi:schemaLocation":this.schemaLocation}),b&&"object"==typeof b&&c.appendChild(this.buildMetadataNode(b));for(var d=0,e=a.length;d<e;d++)c.appendChild(this.buildFeatureNode(a[d]));return OpenLayers.Format.XML.prototype.write.apply(this,[c])},buildMetadataNode:function(a){for(var b=["name","desc","author"],c=this.createElementNS(this.namespaces.gpx,"metadata"),d=0;d<b.length;d++){var e=b[d];if(a[e]){var f=this.createElementNS(this.namespaces.gpx,e);f.appendChild(this.createTextNode(a[e])),c.appendChild(f)}}return c},buildFeatureNode:function(a){var b=a.geometry;if(b=b.clone(),this.internalProjection&&this.externalProjection&&b.transform(this.internalProjection,this.externalProjection),"OpenLayers.Geometry.Point"==b.CLASS_NAME){var c=this.buildWptNode(b);return this.appendAttributesNode(c,a),c}var d=this.createElementNS(this.namespaces.gpx,"trk");this.appendAttributesNode(d,a);var e=this.buildTrkSegNode(b);e=OpenLayers.Util.isArray(e)?e:[e];for(var f=0,g=e.length;f<g;f++)d.appendChild(e[f]);return d},buildTrkSegNode:function(a){var b,c,d,e,f;if("OpenLayers.Geometry.LineString"==a.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==a.CLASS_NAME){for(b=this.createElementNS(this.namespaces.gpx,"trkseg"),c=0,d=a.components.length;c<d;c++)e=a.components[c],b.appendChild(this.buildTrkPtNode(e));return b}for(f=[],c=0,d=a.components.length;c<d;c++)f.push(this.buildTrkSegNode(a.components[c]));return f},buildTrkPtNode:function(a){var b=this.createElementNS(this.namespaces.gpx,"trkpt");return b.setAttribute("lon",a.x),b.setAttribute("lat",a.y),b},buildWptNode:function(a){var b=this.createElementNS(this.namespaces.gpx,"wpt");return b.setAttribute("lon",a.x),b.setAttribute("lat",a.y),b},appendAttributesNode:function(a,b){var c=this.createElementNS(this.namespaces.gpx,"name");c.appendChild(this.createTextNode(b.attributes.name||b.id)),a.appendChild(c);var d=this.createElementNS(this.namespaces.gpx,"desc");d.appendChild(this.createTextNode(b.attributes.description||this.defaultDesc)),a.appendChild(d)},CLASS_NAME:"OpenLayers.Format.GPX"}),OpenLayers.Format.WFSDescribeFeatureType=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g},namespaces:{xsd:"http://www.w3.org/2001/XMLSchema"},readers:{xsd:{schema:function(a,b){var c,d,e=[],f={},g={complexTypes:e,customTypes:f};this.readChildNodes(a,g);var h,i,j=a.attributes;for(c=0,d=j.length;c<d;++c)h=j[c],i=h.name,0===i.indexOf("xmlns")?this.setNamespace(i.split(":")[1]||"",h.value):b[i]=h.value;b.featureTypes=e,b.targetPrefix=this.namespaceAlias[b.targetNamespace];var k,l;for(c=0,d=e.length;c<d;++c)k=e[c],l=f[k.typeName],f[k.typeName]&&(k.typeName=l.name)},complexType:function(a,b){var c={typeName:a.getAttribute("name")};this.readChildNodes(a,c),b.complexTypes.push(c)},complexContent:function(a,b){this.readChildNodes(a,b)},extension:function(a,b){this.readChildNodes(a,b)},sequence:function(a,b){var c={elements:[]};this.readChildNodes(a,c),b.properties=c.elements},element:function(a,b){var c;if(b.elements){for(var d,e={},f=a.attributes,g=0,h=f.length;g<h;++g)d=f[g],e[d.name]=d.value;c=e.type,c||(c={},this.readChildNodes(a,c),e.restriction=c,e.type=c.base);var i=c.base||c;e.localType=i.split(":").pop(),b.elements.push(e),this.readChildNodes(a,e)}if(b.complexTypes){c=a.getAttribute("type");var j=c.split(":").pop();b.customTypes[j]={name:a.getAttribute("name"),type:c}}},annotation:function(a,b){b.annotation={},this.readChildNodes(a,b.annotation)},appinfo:function(a,b){b.appinfo||(b.appinfo=[]),b.appinfo.push(this.getChildValue(a))},documentation:function(a,b){b.documentation||(b.documentation=[]);var c=this.getChildValue(a);b.documentation.push({lang:a.getAttribute("xml:lang"),textContent:c.replace(this.regExes.trimSpace,"")})},simpleType:function(a,b){this.readChildNodes(a,b)},restriction:function(a,b){b.base=a.getAttribute("base"),this.readRestriction(a,b)}}},readRestriction:function(a,b){for(var c,d,e,f=a.childNodes,g=0,h=f.length;g<h;++g)c=f[g],1==c.nodeType&&(d=c.nodeName.split(":").pop(),e=c.getAttribute("value"),b[d]?("string"==typeof b[d]&&(b[d]=[b[d]]),b[d].push(e)):b[d]=e)},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};if("ExceptionReport"===a.nodeName.split(":").pop()){var c=new OpenLayers.Format.OGCExceptionReport;b.error=c.read(a)}else this.readNode(a,b);return b},CLASS_NAME:"OpenLayers.Format.WFSDescribeFeatureType"}),OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(a,b){this.container=OpenLayers.Util.getElement(a),OpenLayers.Util.extend(this,b)},destroy:function(){this.container=null,this.extent=null,this.size=null,this.resolution=null,this.map=null},supported:function(){return!1},setExtent:function(a,b){if(this.extent=a.clone(),this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var c=a.getWidth()/this.map.getExtent().getWidth(),a=a.scale(1/c);this.extent=a.wrapDateLine(this.map.getMaxExtent()).scale(c)}return b&&(this.resolution=null),!0},setSize:function(a){this.size=a.clone(),this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution(),this.resolution},drawFeature:function(a,b){if(null==b&&(b=a.style),a.geometry){var c=a.geometry.getBounds();if(c){var d;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(d=this.map.getMaxExtent()),c.intersectsBounds(this.extent,{worldBounds:d})?this.calculateFeatureDx(c,d):b={display:"none"};var e=this.drawGeometry(a.geometry,b,a.id);if("none"!=b.display&&b.label&&!1!==e){var f=a.geometry.getCentroid();if(b.labelXOffset||b.labelYOffset){var g=isNaN(b.labelXOffset)?0:b.labelXOffset,h=isNaN(b.labelYOffset)?0:b.labelYOffset,i=this.getResolution();f.move(g*i,h*i)}this.drawText(a.id,b,f)}else this.removeText(a.id);return e}}},calculateFeatureDx:function(a,b){if(this.featureDx=0,b){var c=b.getWidth(),d=(this.extent.left+this.extent.right)/2,e=(a.left+a.right)/2,f=Math.round((e-d)/c);this.featureDx=f*c}},drawGeometry:function(a,b,c){},drawText:function(a,b,c){},removeText:function(a){},clear:function(){},getFeatureIdFromEvent:function(a){},eraseFeatures:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0,c=a.length;b<c;++b){var d=a[b];this.eraseGeometry(d.geometry,d.id),this.removeText(d.id)}},eraseGeometry:function(a,b){},moveRoot:function(a){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(a){var b=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);return!1===a.stroke&&(delete b.strokeWidth,delete b.strokeColor),!1===a.fill&&delete b.fillColor,OpenLayers.Util.extend(b,a),b},CLASS_NAME:"OpenLayers.Renderer"}),OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"},OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]},OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(a,b){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.root=document.createElement("canvas"),this.container.appendChild(this.root),this.canvas=this.root.getContext("2d"),this.features={},this.hitDetection&&(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))},setExtent:function(){return OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),!1},eraseGeometry:function(a,b){this.eraseFeatures(this.features[b][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(a){this.size=a.clone();var b=this.root;if(b.style.width=a.w+"px",b.style.height=a.h+"px",b.width=a.w,b.height=a.h,this.resolution=null,this.hitDetection){var c=this.hitCanvas;c.style.width=a.w+"px",c.style.height=a.h+"px",c.width=a.w,c.height=a.h}},drawFeature:function(a,b){var c;if(a.geometry){b=this.applyDefaultSymbolizer(b||a.style);var d,e=a.geometry.getBounds();this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(d=this.map.getMaxExtent());var f=e&&e.intersectsBounds(this.extent,{worldBounds:d});c="none"!==b.display&&!!e&&f,c?this.features[a.id]=[a,b]:delete this.features[a.id],this.pendingRedraw=!0}return this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1),c},drawGeometry:function(a,b,c){var d=a.CLASS_NAME;if("OpenLayers.Geometry.Collection"!=d&&"OpenLayers.Geometry.MultiPoint"!=d&&"OpenLayers.Geometry.MultiLineString"!=d&&"OpenLayers.Geometry.MultiPolygon"!=d)switch(a.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(a,b,c);break;case"OpenLayers.Geometry.LineString":this.drawLineString(a,b,c);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(a,b,c);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(a,b,c)}else for(var e=0;e<a.components.length;e++)this.drawGeometry(a.components[e],b,c)},drawExternalGraphic:function(a,b,c){var d=new Image,e=b.title||b.graphicTitle;e&&(d.title=e);var f=b.graphicWidth||b.graphicHeight,g=b.graphicHeight||b.graphicWidth;f=f||2*b.pointRadius,g=g||2*b.pointRadius;var h=void 0!=b.graphicXOffset?b.graphicXOffset:-.5*f,i=void 0!=b.graphicYOffset?b.graphicYOffset:-.5*g,j=b.graphicOpacity||b.fillOpacity,k=function(){if(this.features[c]){var b=this.getLocalXY(a),e=b[0],k=b[1];if(!isNaN(e)&&!isNaN(k)){var l=e+h|0,m=k+i|0,n=this.canvas;n.globalAlpha=j;var o=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);n.drawImage(d,l*o,m*o,f*o,g*o),this.hitDetection&&(this.setHitContextStyle("fill",c),this.hitContext.fillRect(l,m,f,g))}}};d.onload=OpenLayers.Function.bind(k,this),d.src=b.externalGraphic},drawNamedSymbol:function(a,b,c){var d,e,f,g,h,i,j,k,l,m=Math.PI/180,n=OpenLayers.Renderer.symbol[b.graphicName];if(!n)throw new Error(b.graphicName+" is not a valid symbol name");if(n.length&&!(n.length<2)){var o=this.getLocalXY(a),p=o[0],q=o[1];if(!isNaN(p)&&!isNaN(q)){if(this.canvas.lineCap="round",this.canvas.lineJoin="round",this.hitDetection&&(this.hitContext.lineCap="round",this.hitContext.lineJoin="round"),b.graphicName in this.cachedSymbolBounds)i=this.cachedSymbolBounds[b.graphicName];else{for(i=new OpenLayers.Bounds,h=0;h<n.length;h+=2)i.extend(new OpenLayers.LonLat(n[h],n[h+1]));this.cachedSymbolBounds[b.graphicName]=i}if(this.canvas.save(),this.hitDetection&&this.hitContext.save(),this.canvas.translate(p,q),this.hitDetection&&this.hitContext.translate(p,q),k=m*b.rotation,isNaN(k)||(this.canvas.rotate(k),this.hitDetection&&this.hitContext.rotate(k)),j=2*b.pointRadius/Math.max(i.getWidth(),i.getHeight()),this.canvas.scale(j,j),this.hitDetection&&this.hitContext.scale(j,j),f=i.getCenterLonLat().lon,g=i.getCenterLonLat().lat,this.canvas.translate(-f,-g),this.hitDetection&&this.hitContext.translate(-f,-g),l=b.strokeWidth,b.strokeWidth=l/j,!1!==b.fill){for(this.setCanvasStyle("fill",b),this.canvas.beginPath(),h=0;h<n.length;h+=2)d=n[h],e=n[h+1],0==h&&this.canvas.moveTo(d,e),this.canvas.lineTo(d,e);if(this.canvas.closePath(),this.canvas.fill(),this.hitDetection){for(this.setHitContextStyle("fill",c,b),this.hitContext.beginPath(),h=0;h<n.length;h+=2)d=n[h],e=n[h+1],0==h&&this.canvas.moveTo(d,e),this.hitContext.lineTo(d,e);this.hitContext.closePath(),this.hitContext.fill()}}if(!1!==b.stroke){for(this.setCanvasStyle("stroke",b),this.canvas.beginPath(),h=0;h<n.length;h+=2)d=n[h],e=n[h+1],0==h&&this.canvas.moveTo(d,e),this.canvas.lineTo(d,e);if(this.canvas.closePath(),this.canvas.stroke(),this.hitDetection){for(this.setHitContextStyle("stroke",c,b,j),this.hitContext.beginPath(),h=0;h<n.length;h+=2)d=n[h],e=n[h+1],0==h&&this.hitContext.moveTo(d,e),this.hitContext.lineTo(d,e);this.hitContext.closePath(),this.hitContext.stroke()}}b.strokeWidth=l,this.canvas.restore(),this.hitDetection&&this.hitContext.restore(),this.setCanvasStyle("reset")}}},setCanvasStyle:function(a,b){"fill"===a?(this.canvas.globalAlpha=b.fillOpacity,this.canvas.fillStyle=b.fillColor):"stroke"===a?(this.canvas.globalAlpha=b.strokeOpacity,this.canvas.strokeStyle=b.strokeColor,this.canvas.lineWidth=b.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)},featureIdToHex:function(a){var b=Number(a.split("_").pop())+1;b>=16777216&&(this.hitOverflow=b-16777215,b=b%16777216+1);var c="000000"+b.toString(16),d=c.length;return c="#"+c.substring(d-6,d)},setHitContextStyle:function(a,b,c,d){
var e=this.featureIdToHex(b);"fill"==a?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=e):"stroke"==a?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=e,void 0===d?this.hitContext.lineWidth=c.strokeWidth+2:isNaN(d)||(this.hitContext.lineWidth=c.strokeWidth+2/d)):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(a,b,c){if(!1!==b.graphic)if(b.externalGraphic)this.drawExternalGraphic(a,b,c);else if(b.graphicName&&"circle"!=b.graphicName)this.drawNamedSymbol(a,b,c);else{var d=this.getLocalXY(a),e=d[0],f=d[1];if(!isNaN(e)&&!isNaN(f)){var g=2*Math.PI,h=b.pointRadius;!1!==b.fill&&(this.setCanvasStyle("fill",b),this.canvas.beginPath(),this.canvas.arc(e,f,h,0,g,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle("fill",c,b),this.hitContext.beginPath(),this.hitContext.arc(e,f,h,0,g,!0),this.hitContext.fill())),!1!==b.stroke&&(this.setCanvasStyle("stroke",b),this.canvas.beginPath(),this.canvas.arc(e,f,h,0,g,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle("stroke",c,b),this.hitContext.beginPath(),this.hitContext.arc(e,f,h,0,g,!0),this.hitContext.stroke()),this.setCanvasStyle("reset"))}}},drawLineString:function(a,b,c){b=OpenLayers.Util.applyDefaults({fill:!1},b),this.drawLinearRing(a,b,c)},drawLinearRing:function(a,b,c){!1!==b.fill&&(this.setCanvasStyle("fill",b),this.renderPath(this.canvas,a,b,c,"fill"),this.hitDetection&&(this.setHitContextStyle("fill",c,b),this.renderPath(this.hitContext,a,b,c,"fill"))),!1!==b.stroke&&(this.setCanvasStyle("stroke",b),this.renderPath(this.canvas,a,b,c,"stroke"),this.hitDetection&&(this.setHitContextStyle("stroke",c,b),this.renderPath(this.hitContext,a,b,c,"stroke"))),this.setCanvasStyle("reset")},renderPath:function(a,b,c,d,e){var f=b.components,g=f.length;a.beginPath();var h=this.getLocalXY(f[0]),i=h[0],j=h[1];if(!isNaN(i)&&!isNaN(j)){a.moveTo(h[0],h[1]);for(var k=1;k<g;++k){var l=this.getLocalXY(f[k]);a.lineTo(l[0],l[1])}"fill"===e?a.fill():a.stroke()}},drawPolygon:function(a,b,c){var d=a.components,e=d.length;this.drawLinearRing(d[0],b,c);for(var f=1;f<e;++f)this.canvas.globalCompositeOperation="destination-out",this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(d[f],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},b),c),this.canvas.globalCompositeOperation="source-over",this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(d[f],OpenLayers.Util.applyDefaults({fill:!1},b),c)},drawText:function(a,b){var c=this.getLocalXY(a);this.setCanvasStyle("reset"),this.canvas.fillStyle=b.fontColor,this.canvas.globalAlpha=b.fontOpacity||1;var d=[b.fontStyle?b.fontStyle:"normal","normal",b.fontWeight?b.fontWeight:"normal",b.fontSize?b.fontSize:"1em",b.fontFamily?b.fontFamily:"sans-serif"].join(" "),e=b.label.split("\n"),f=e.length;if(this.canvas.fillText){this.canvas.font=d,this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[b.labelAlign[0]]||"center",this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[b.labelAlign[1]]||"middle";var g=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[1]];null==g&&(g=-.5);var h=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;c[1]+=h*g*(f-1);for(var i=0;i<f;i++)b.labelOutlineWidth&&(this.canvas.save(),this.canvas.globalAlpha=b.labelOutlineOpacity||b.fontOpacity||1,this.canvas.strokeStyle=b.labelOutlineColor,this.canvas.lineWidth=b.labelOutlineWidth,this.canvas.strokeText(e[i],c[0],c[1]+h*i+1),this.canvas.restore()),this.canvas.fillText(e[i],c[0],c[1]+h*i)}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=d;var j=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[0]];null==j&&(j=-.5);var g=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[1]];null==g&&(g=-.5);var h=this.canvas.mozMeasureText("xx");c[1]+=h*(1+g*f);for(var i=0;i<f;i++){var k=c[0]+j*this.canvas.mozMeasureText(e[i]),l=c[1]+i*h;this.canvas.translate(k,l),this.canvas.mozDrawText(e[i]),this.canvas.translate(-k,-l)}}this.setCanvasStyle("reset")},getLocalXY:function(a){var b=this.getResolution(),c=this.extent;return[(a.x-this.featureDx)/b+-c.left/b,c.top/b-a.y/b]},clear:function(){var a=this.root.height,b=this.root.width;this.canvas.clearRect(0,0,b,a),this.features={},this.hitDetection&&this.hitContext.clearRect(0,0,b,a)},getFeatureIdFromEvent:function(a){var b,c;if(this.hitDetection&&"none"!==this.root.style.display&&!this.map.dragging){var d=a.xy,e=0|d.x,f=0|d.y,g=this.hitContext.getImageData(e,f,1,1).data;if(255===g[3]){var h=g[2]+256*(g[1]+256*g[0]);if(h){b="OpenLayers_Feature_Vector_"+(h-1+this.hitOverflow);try{c=this.features[b][0]}catch(a){}}}}return c},eraseFeatures:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0;b<a.length;++b)delete this.features[a[b].id];this.redraw()},redraw:function(){if(!this.locked){var a=this.root.height,b=this.root.width;this.canvas.clearRect(0,0,b,a),this.hitDetection&&this.hitContext.clearRect(0,0,b,a);var c,d,e,f=[],g=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent();for(var h in this.features)this.features.hasOwnProperty(h)&&(c=this.features[h][0],d=c.geometry,this.calculateFeatureDx(d.getBounds(),g),e=this.features[h][1],this.drawGeometry(d,e,c.id),e.label&&f.push([c,e]));for(var i,j=0,k=f.length;j<k;++j)i=f[j],this.drawText(i[0].geometry.getCentroid(),i[1])}},CLASS_NAME:"OpenLayers.Renderer.Canvas"}),OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"},OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1},OpenLayers.Renderer.Canvas.drawImageScaleFactor=null,OpenLayers.Format.OSM=OpenLayers.Class(OpenLayers.Format.XML,{checkTags:!1,interestingTagsExclude:null,areaTags:null,initialize:function(a){var b={interestingTagsExclude:["source","source_ref","source:ref","history","attribution","created_by"],areaTags:["area","building","leisure","tourism","ruins","historic","landuse","military","natural","sport"]};b=OpenLayers.Util.extend(b,a);for(var c={},d=0;d<b.interestingTagsExclude.length;d++)c[b.interestingTagsExclude[d]]=!0;b.interestingTagsExclude=c;for(var e={},d=0;d<b.areaTags.length;d++)e[b.areaTags[d]]=!0;b.areaTags=e,this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));for(var b=this.getNodes(a),c=this.getWays(a),d=new Array(c.length),e=0;e<c.length;e++){for(var f=new Array(c[e].nodes.length),g=this.isWayArea(c[e])?1:0,h=0;h<c[e].nodes.length;h++){var i=b[c[e].nodes[h]],j=new OpenLayers.Geometry.Point(i.lon,i.lat);j.osm_id=parseInt(c[e].nodes[h]),f[h]=j,i.used=!0}var k=null;k=g?new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.LinearRing(f)):new OpenLayers.Geometry.LineString(f),this.internalProjection&&this.externalProjection&&k.transform(this.externalProjection,this.internalProjection);var l=new OpenLayers.Feature.Vector(k,c[e].tags);l.osm_id=parseInt(c[e].id),l.fid="way."+l.osm_id,d[e]=l}for(var m in b){var i=b[m];if(!i.used||this.checkTags){var n=null;if(this.checkTags){var o=this.getTags(i.node,!0);if(i.used&&!o[1])continue;n=o[0]}else n=this.getTags(i.node);var l=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(i.lon,i.lat),n);this.internalProjection&&this.externalProjection&&l.geometry.transform(this.externalProjection,this.internalProjection),l.osm_id=parseInt(m),l.fid="node."+l.osm_id,d.push(l)}i.node=null}return d},getNodes:function(a){for(var b=a.getElementsByTagName("node"),c={},d=0;d<b.length;d++){var e=b[d];c[e.getAttribute("id")]={lat:e.getAttribute("lat"),lon:e.getAttribute("lon"),node:e}}return c},getWays:function(a){for(var b=a.getElementsByTagName("way"),c=[],d=0;d<b.length;d++){var e=b[d],f={id:e.getAttribute("id")};f.tags=this.getTags(e);var g=e.getElementsByTagName("nd");f.nodes=new Array(g.length);for(var h=0;h<g.length;h++)f.nodes[h]=g[h].getAttribute("ref");c.push(f)}return c},getTags:function(a,b){for(var c=a.getElementsByTagName("tag"),d={},e=!1,f=0;f<c.length;f++){var g=c[f].getAttribute("k");d[g]=c[f].getAttribute("v"),b&&(this.interestingTagsExclude[g]||(e=!0))}return b?[d,e]:d},isWayArea:function(a){var b=!1,c=!1;if(a.nodes[0]==a.nodes[a.nodes.length-1]&&(b=!0),this.checkTags)for(var d in a.tags)if(this.areaTags[d]){c=!0;break}return b&&(!this.checkTags||c)},write:function(a){OpenLayers.Util.isArray(a)||(a=[a]),this.osm_id=1,this.created_nodes={};var b=this.createElementNS(null,"osm");b.setAttribute("version","0.5"),b.setAttribute("generator","OpenLayers "+OpenLayers.VERSION_NUMBER);for(var c=a.length-1;c>=0;c--)for(var d=this.createFeatureNodes(a[c]),e=0;e<d.length;e++)b.appendChild(d[e]);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureNodes:function(a){var b=[],c=a.geometry.CLASS_NAME,d=c.substring(c.lastIndexOf(".")+1);d=d.toLowerCase();var e=this.createXML[d];return e&&(b=e.apply(this,[a])),b},createXML:{point:function(a){var b=null,c=a.geometry?a.geometry:a;this.internalProjection&&this.externalProjection&&(c=c.clone(),c.transform(this.internalProjection,this.externalProjection));var d=!1;if(a.osm_id?(b=a.osm_id,this.created_nodes[b]&&(d=!0)):(b=-this.osm_id,this.osm_id++),d)e=this.created_nodes[b];else var e=this.createElementNS(null,"node");return this.created_nodes[b]=e,e.setAttribute("id",b),e.setAttribute("lon",c.x),e.setAttribute("lat",c.y),a.attributes&&this.serializeTags(a,e),this.setState(a,e),d?[]:[e]},linestring:function(a){var b,c=[],d=a.geometry;a.osm_id?b=a.osm_id:(b=-this.osm_id,this.osm_id++);var e=this.createElementNS(null,"way");e.setAttribute("id",b);for(var f=0;f<d.components.length;f++){var g=this.createXML.point.apply(this,[d.components[f]]);if(g.length){g=g[0];var h=g.getAttribute("id");c.push(g)}else h=d.components[f].osm_id,g=this.created_nodes[h];this.setState(a,g);var i=this.createElementNS(null,"nd");i.setAttribute("ref",h),e.appendChild(i)}return this.serializeTags(a,e),c.push(e),c},polygon:function(a){var b=OpenLayers.Util.extend({area:"yes"},a.attributes),c=new OpenLayers.Feature.Vector(a.geometry.components[0],b);return c.osm_id=a.osm_id,this.createXML.linestring.apply(this,[c])}},serializeTags:function(a,b){for(var c in a.attributes){var d=this.createElementNS(null,"tag");d.setAttribute("k",c),d.setAttribute("v",a.attributes[c]),b.appendChild(d)}},setState:function(a,b){if(a.state){var c=null;switch(a.state){case OpenLayers.State.UPDATE:c="modify";case OpenLayers.State.DELETE:c="delete"}c&&b.setAttribute("action",c)}},CLASS_NAME:"OpenLayers.Format.OSM"}),OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(a,b,c){(c&&c.sphericalMercator||this.sphericalMercator)&&(c=OpenLayers.Util.extend({projection:"EPSG:900913",numZoomLevels:19},c)),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a||this.name,b||this.url,{},c])},clone:function(a){return null==a&&(a=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){var b=this.getXYZ(a),c=this.url;if(OpenLayers.Util.isArray(c)){var d=""+b.x+b.y+b.z;c=this.selectUrl(d,c)}return OpenLayers.String.format(c,b)},getXYZ:function(a){var b=this.getServerResolution(),c=Math.round((a.left-this.maxExtent.left)/(b*this.tileSize.w)),d=Math.round((this.maxExtent.top-a.top)/(b*this.tileSize.h)),e=this.getServerZoom();if(this.wrapDateLine){var f=Math.pow(2,e);c=(c%f+f)%f}return{x:c,y:d,z:e}},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.XYZ"}),OpenLayers.Layer.Bing=OpenLayers.Class(OpenLayers.Layer.XYZ,{key:null,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135,.29858214169740677,.14929107084870338,.07464553542435169],attributionTemplate:'<span class="olBingAttribution ${type}"><div><a target="_blank" href="http://www.bing.com/maps/"><img src="${logo}" /></a></div>${copyrights}<a style="white-space: nowrap" target="_blank" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a></span>',metadata:null,protocolRegex:/^http:/i,type:"Road",culture:"en-US",metadataParams:null,tileOptions:null,protocol:~window.location.href.indexOf("http")?"":"http:",initialize:function(a){a=OpenLayers.Util.applyDefaults({sphericalMercator:!0},a);var b=a.name||"Bing "+(a.type||this.type),c=[b,null,a];OpenLayers.Layer.XYZ.prototype.initialize.apply(this,c),this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options.tileOptions),this.loadMetadata()},loadMetadata:function(){this._callbackId="_callback_"+this.id.replace(/\./g,"_"),window[this._callbackId]=OpenLayers.Function.bind(OpenLayers.Layer.Bing.processMetadata,this);var a=OpenLayers.Util.applyDefaults({key:this.key,jsonp:this._callbackId,include:"ImageryProviders"},this.metadataParams),b=this.protocol+"//dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.type+"?"+OpenLayers.Util.getParameterString(a),c=document.createElement("script");c.type="text/javascript",c.src=b,c.id=this._callbackId,document.getElementsByTagName("head")[0].appendChild(c)},initLayer:function(){var a=this.metadata.resourceSets[0].resources[0],b=a.imageUrl.replace("{quadkey}","${quadkey}");b=b.replace("{culture}",this.culture),b=b.replace(this.protocolRegex,this.protocol),this.url=[];for(var c=0;c<a.imageUrlSubdomains.length;++c)this.url.push(b.replace("{subdomain}",a.imageUrlSubdomains[c]));this.addOptions({maxResolution:Math.min(this.serverResolutions[a.zoomMin],this.maxResolution||Number.POSITIVE_INFINITY),numZoomLevels:Math.min(a.zoomMax+1-a.zoomMin,this.numZoomLevels)},!0),this.isBaseLayer||this.redraw(),this.updateAttribution()},getURL:function(a){if(this.url){for(var b=this.getXYZ(a),c=b.x,d=b.y,e=b.z,f=[],g=e;g>0;--g){var h="0",i=1<<g-1;0!=(c&i)&&h++,0!=(d&i)&&(h++,h++),f.push(h)}var j=f.join(""),k=this.selectUrl(""+c+d+e,this.url);return OpenLayers.String.format(k,{quadkey:j})}},updateAttribution:function(){var a=this.metadata;if(a.resourceSets&&this.map&&this.map.center){var b,c,d,e,f,g,h,i=a.resourceSets[0].resources[0],j=this.map.getExtent().transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326")),k=i.imageryProviders||[],l=OpenLayers.Util.indexOf(this.serverResolutions,this.getServerResolution()),m="";for(c=0,d=k.length;c<d;++c)for(b=k[c],e=0,f=b.coverageAreas.length;e<f;++e)h=b.coverageAreas[e],g=OpenLayers.Bounds.fromArray(h.bbox,!0),j.intersectsBounds(g)&&l<=h.zoomMax&&l>=h.zoomMin&&(m+=b.attribution+" ");var n=a.brandLogoUri.replace(this.protocolRegex,this.protocol);this.attribution=OpenLayers.String.format(this.attributionTemplate,{type:this.type.toLowerCase(),logo:n,copyrights:m}),this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"attribution"})}},setMap:function(){OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments),this.map.events.register("moveend",this,this.updateAttribution)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.Bing(this.options)),a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])},destroy:function(){this.map&&this.map.events.unregister("moveend",this,this.updateAttribution),OpenLayers.Layer.XYZ.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.Bing"}),OpenLayers.Layer.Bing.processMetadata=function(a){this.metadata=a,this.initLayer();var b=document.getElementById(this._callbackId);b.parentNode.removeChild(b),window[this._callbackId]=void 0,delete this._callbackId},OpenLayers.Format.SOSGetFeatureOfInterest=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",sa:"http://www.opengis.net/sampling/1.0",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosAll.xsd",defaultPrefix:"sos",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={features:[]};this.readNode(a,b);for(var c=[],d=0,e=b.features.length;d<e;d++){var f=b.features[d];this.internalProjection&&this.externalProjection&&f.components[0]&&f.components[0].transform(this.externalProjection,this.internalProjection);var g=new OpenLayers.Feature.Vector(f.components[0],f.attributes);c.push(g)}return c},readers:{sa:{SamplingPoint:function(a,b){if(!b.attributes){var c={attributes:{}};b.features.push(c),b=c}b.attributes.id=this.getAttributeNS(a,this.namespaces.gml,"id"),this.readChildNodes(a,b)},position:function(a,b){this.readChildNodes(a,b)}},gml:OpenLayers.Util.applyDefaults({FeatureCollection:function(a,b){this.readChildNodes(a,b)},featureMember:function(a,b){var c={attributes:{}};b.features.push(c),this.readChildNodes(a,c)},name:function(a,b){b.attributes.name=this.getChildValue(a)},pos:function(a,b){this.externalProjection||(this.externalProjection=new OpenLayers.Projection(a.getAttribute("srsName"))),OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[a,b])}},OpenLayers.Format.GML.v3.prototype.readers.gml)},writers:{sos:{GetFeatureOfInterest:function(a){for(var b=this.createElementNSPlus("GetFeatureOfInterest",{attributes:{version:this.VERSION,service:"SOS","xsi:schemaLocation":this.schemaLocation}}),c=0,d=a.fois.length;c<d;c++)this.writeNode("FeatureOfInterestId",{foi:a.fois[c]},b);return b},FeatureOfInterestId:function(a){return this.createElementNSPlus("FeatureOfInterestId",{value:a.foi})}}},CLASS_NAME:"OpenLayers.Format.SOSGetFeatureOfInterest"}),OpenLayers.Format.SOSGetObservation=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows",gml:"http://www.opengis.net/gml",sos:"http://www.opengis.net/sos/1.0",ogc:"http://www.opengis.net/ogc",om:"http://www.opengis.net/om/1.0",sa:"http://www.opengis.net/sampling/1.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosGetObservation.xsd",defaultPrefix:"sos",read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={measurements:[],observations:[]};return this.readNode(a,b),b},write:function(a){var b=this.writeNode("sos:GetObservation",a);return b.setAttribute("xmlns:om",this.namespaces.om),b.setAttribute("xmlns:ogc",this.namespaces.ogc),this.setAttributeNS(b,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[b])},readers:{om:{ObservationCollection:function(a,b){b.id=this.getAttributeNS(a,this.namespaces.gml,"id"),this.readChildNodes(a,b)},member:function(a,b){this.readChildNodes(a,b)},Measurement:function(a,b){var c={};b.measurements.push(c),this.readChildNodes(a,c)},Observation:function(a,b){var c={};b.observations.push(c),this.readChildNodes(a,c)},samplingTime:function(a,b){var c={};b.samplingTime=c,this.readChildNodes(a,c)},observedProperty:function(a,b){b.observedProperty=this.getAttributeNS(a,this.namespaces.xlink,"href"),this.readChildNodes(a,b)},procedure:function(a,b){b.procedure=this.getAttributeNS(a,this.namespaces.xlink,"href"),this.readChildNodes(a,b)},featureOfInterest:function(a,b){var c={features:[]};b.fois=[],b.fois.push(c),this.readChildNodes(a,c);for(var d=[],e=0,f=c.features.length;e<f;e++){var g=c.features[e];d.push(new OpenLayers.Feature.Vector(g.components[0],g.attributes))}c.features=d},result:function(a,b){var c={};b.result=c,""!==this.getChildValue(a)?(c.value=this.getChildValue(a),c.uom=a.getAttribute("uom")):this.readChildNodes(a,c)}},sa:OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.sa,gml:OpenLayers.Util.applyDefaults({TimeInstant:function(a,b){var c={};b.timeInstant=c,this.readChildNodes(a,c)},timePosition:function(a,b){b.timePosition=this.getChildValue(a)}},OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.gml)},writers:{sos:{GetObservation:function(a){var b=this.createElementNSPlus("GetObservation",{attributes:{version:this.VERSION,service:"SOS"}});this.writeNode("offering",a,b),a.eventTime&&this.writeNode("eventTime",a,b);for(var c in a.procedures)this.writeNode("procedure",a.procedures[c],b);for(var d in a.observedProperties)this.writeNode("observedProperty",a.observedProperties[d],b);return a.foi&&this.writeNode("featureOfInterest",a.foi,b),this.writeNode("responseFormat",a,b),a.resultModel&&this.writeNode("resultModel",a,b),a.responseMode&&this.writeNode("responseMode",a,b),b},featureOfInterest:function(a){var b=this.createElementNSPlus("featureOfInterest");return this.writeNode("ObjectID",a.objectId,b),b},ObjectID:function(a){return this.createElementNSPlus("ObjectID",{value:a})},responseFormat:function(a){return this.createElementNSPlus("responseFormat",{value:a.responseFormat})},procedure:function(a){return this.createElementNSPlus("procedure",{value:a})},offering:function(a){return this.createElementNSPlus("offering",{value:a.offering})},observedProperty:function(a){return this.createElementNSPlus("observedProperty",{value:a})},eventTime:function(a){var b=this.createElementNSPlus("eventTime");return"latest"===a.eventTime&&this.writeNode("ogc:TM_Equals",a,b),b},resultModel:function(a){return this.createElementNSPlus("resultModel",{value:a.resultModel})},responseMode:function(a){return this.createElementNSPlus("responseMode",{value:a.responseMode})}},ogc:{TM_Equals:function(a){var b=this.createElementNSPlus("ogc:TM_Equals");return this.writeNode("ogc:PropertyName",{property:"urn:ogc:data:time:iso8601"},b),"latest"===a.eventTime&&this.writeNode("gml:TimeInstant",{value:"latest"},b),b},PropertyName:function(a){return this.createElementNSPlus("ogc:PropertyName",{value:a.property})}},gml:{TimeInstant:function(a){var b=this.createElementNSPlus("gml:TimeInstant");return this.writeNode("gml:timePosition",a,b),b},timePosition:function(a){return this.createElementNSPlus("gml:timePosition",{value:a.value})}}},CLASS_NAME:"OpenLayers.Format.SOSGetObservation"}),OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,touch:!1,initialize:function(a,b,c){OpenLayers.Util.extend(this,c),this.control=a,this.callbacks=b;var d=this.map||a.map;d&&this.setMap(d),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(a){this.map=a},checkModifiers:function(a){return null==this.keyMask||((a.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(a.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(a.altKey?OpenLayers.Handler.MOD_ALT:0)|(a.metaKey?OpenLayers.Handler.MOD_META:0))==this.keyMask},activate:function(){if(this.active)return!1;for(var a=OpenLayers.Events.prototype.BROWSER_EVENTS,b=0,c=a.length;b<c;b++)this[a[b]]&&this.register(a[b],this[a[b]]);return this.active=!0,!0},deactivate:function(){if(!this.active)return!1;for(var a=OpenLayers.Events.prototype.BROWSER_EVENTS,b=0,c=a.length;b<c;b++)this[a[b]]&&this.unregister(a[b],this[a[b]]);return this.touch=!1,this.active=!1,!0},startTouch:function(){if(!this.touch){this.touch=!0;for(var a=["mousedown","mouseup","mousemove","click","dblclick","mouseout"],b=0,c=a.length;b<c;b++)this[a[b]]&&this.unregister(a[b],this[a[b]])}},callback:function(a,b){a&&this.callbacks[a]&&this.callbacks[a].apply(this.control,b)},register:function(a,b){this.map.events.registerPriority(a,this,b),this.map.events.registerPriority(a,this,this.setEvent)},unregister:function(a,b){this.map.events.unregister(a,this,b),this.map.events.unregister(a,this,this.setEvent)},setEvent:function(a){return this.evt=a,!0},destroy:function(){this.deactivate(),this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"}),OpenLayers.Handler.MOD_NONE=0,OpenLayers.Handler.MOD_SHIFT=1,OpenLayers.Handler.MOD_CTRL=2,OpenLayers.Handler.MOD_ALT=4,OpenLayers.Handler.MOD_META=8,OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,interval:0,maxDelta:Number.POSITIVE_INFINITY,delta:0,cumulative:!0,initialize:function(a,b,c){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.wheelListener=null},onWheelEvent:function(a){if(this.map&&this.checkModifiers(a)){for(var b=!1,c=!1,d=!1,e=OpenLayers.Event.element(a);null!=e&&!d&&!b;){if(!b)try{var f;if(e.currentStyle)f=e.currentStyle.overflow;else{f=document.defaultView.getComputedStyle(e,null).getPropertyValue("overflow")}b=f&&"auto"==f||"scroll"==f}catch(a){}if(!c&&!(c=OpenLayers.Element.hasClass(e,"olScrollable")))for(var g=0,h=this.map.layers.length;g<h;g++){var i=this.map.layers[g];if(e==i.div||e==i.pane){c=!0;break}}d=e==this.map.div,e=e.parentNode}if(!b&&d){if(c){var j=0;if(a.wheelDelta?(j=a.wheelDelta,j%160==0&&(j*=.75),j/=120):a.detail&&(j=-a.detail/Math.abs(a.detail)),this.delta+=j,window.clearTimeout(this._timeoutId),this.interval&&Math.abs(this.delta)<this.maxDelta){var k=OpenLayers.Util.extend({},a);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(k)},this),this.interval)}else this.wheelZoom(a)}OpenLayers.Event.stop(a)}}},wheelZoom:function(a){var b=this.delta;this.delta=0,b&&(a.xy=this.map.events.getMousePosition(a),b<0?this.callback("down",[a,this.cumulative?Math.max(-this.maxDelta,b):-1]):this.callback("up",[a,this.cumulative?Math.min(this.maxDelta,b):1]))},activate:function(a){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var b=this.wheelListener;return OpenLayers.Event.observe(window,"DOMMouseScroll",b),OpenLayers.Event.observe(window,"mousewheel",b),OpenLayers.Event.observe(document,"mousewheel",b),!0}return!1},deactivate:function(a){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var b=this.wheelListener;return OpenLayers.Event.stopObserving(window,"DOMMouseScroll",b),OpenLayers.Event.stopObserving(window,"mousewheel",b),OpenLayers.Event.stopObserving(document,"mousewheel",b),!0}return!1},CLASS_NAME:"OpenLayers.Handler.MouseWheel"}),OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:!1,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(a){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[a]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[a])},readNode:function(a,b,c){return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(a,b){b.insertIds=[],b.success=!1,this.readChildNodes(a,b)},InsertResult:function(a,b){var c={fids:[]};this.readChildNodes(a,c),b.insertIds=b.insertIds.concat(c.fids)},TransactionResult:function(a,b){this.readChildNodes(a,b)},Status:function(a,b){this.readChildNodes(a,b)},SUCCESS:function(a,b){b.success=!0}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(a){a=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},a);var b=a.featurePrefix,c=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(b?b+":":"")+a.featureType}});if(a.srsNameInQuery&&a.srsName&&c.setAttribute("srsName",a.srsName),a.featureNS&&c.setAttribute("xmlns:"+b,a.featureNS),a.propertyNames)for(var d=0,e=a.propertyNames.length;d<e;d++)this.writeNode("ogc:PropertyName",{property:a.propertyNames[d]},c);return a.filter&&(this.setFilterProperty(a.filter),this.writeNode("ogc:Filter",a.filter,c)),c}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"}),OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(a){this.compare=a?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER,this.clear()},insert:function(a){this.exists(a)&&this.remove(a);var b=a.id;this.determineZIndex(a);for(var c,d=-1,e=this.order.length;e-d>1;){c=parseInt((d+e)/2);this.compare(this,a,OpenLayers.Util.getElement(this.order[c]))>0?d=c:e=c}return this.order.splice(e,0,b),this.indices[b]=this.getZIndex(a),this.getNextElement(e)},remove:function(a){var b=a.id,c=OpenLayers.Util.indexOf(this.order,b);if(c>=0)if(this.order.splice(c,1),delete this.indices[b],this.order.length>0){var d=this.order[this.order.length-1];this.maxZIndex=this.indices[d]}else this.maxZIndex=0},clear:function(){this.order=[],this.indices={},this.maxZIndex=0},exists:function(a){return null!=this.indices[a.id]},getZIndex:function(a){return a._style.graphicZIndex},determineZIndex:function(a){var b=a._style.graphicZIndex;null==b?(b=this.maxZIndex,a._style.graphicZIndex=b):b>this.maxZIndex&&(this.maxZIndex=b)},getNextElement:function(a){var b=a+1;if(b<this.order.length){var c=OpenLayers.Util.getElement(this.order[b]);return void 0==c&&(c=this.getNextElement(b)),c}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"}),OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(a,b,c){var d=a.getZIndex(b),e=0;if(c){e=d-a.getZIndex(c)}return e},Z_ORDER_DRAWING_ORDER:function(a,b,c){var d=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(a,b,c);return c&&0==d&&(d=1),d},Z_ORDER_Y_ORDER:function(a,b,c){var d=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(a,b,c);if(c&&0===d){var e=c._boundsBottom-b._boundsBottom;d=0===e?1:e}return d}},OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(a,b){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.rendererRoot=this.createRenderRoot(),this.root=this.createRoot("_root"),this.vectorRoot=this.createRoot("_vroot"),this.textRoot=this.createRoot("_troot"),this.root.appendChild(this.vectorRoot),this.root.appendChild(this.textRoot),this.rendererRoot.appendChild(this.root),this.container.appendChild(this.rendererRoot),b&&(b.zIndexing||b.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(b.yOrdering))},destroy:function(){this.clear(),this.rendererRoot=null,this.root=null,this.xmlns=null,OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var a,b=this.vectorRoot;if(b)for(;a=b.firstChild;)b.removeChild(a);if(b=this.textRoot)for(;a=b.firstChild;)b.removeChild(a);this.indexer&&this.indexer.clear()},setExtent:function(a,b){var c=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),d=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var e,f=a.getWidth()/this.map.getExtent().getWidth(),a=a.scale(1/f),g=this.map.getMaxExtent();g.right>a.left&&g.right<a.right?e=!0:g.left>a.left&&g.left<a.right&&(e=!1),(e!==this.rightOfDateLine||b)&&(c=!1,this.xOffset=!0===e?g.getWidth()/d:0),this.rightOfDateLine=e}return c
},getNodeType:function(a,b){},drawGeometry:function(a,b,c){var d=a.CLASS_NAME,e=!0;if("OpenLayers.Geometry.Collection"==d||"OpenLayers.Geometry.MultiPoint"==d||"OpenLayers.Geometry.MultiLineString"==d||"OpenLayers.Geometry.MultiPolygon"==d){for(var f=0,g=a.components.length;f<g;f++)e=this.drawGeometry(a.components[f],b,c)&&e;return e}e=!1;var h=!1;if("none"!=b.display&&(b.backgroundGraphic?this.redrawBackgroundNode(a.id,a,b,c):h=!0,e=this.redrawNode(a.id,a,b,c)),0==e){var i=document.getElementById(a.id);i&&(i._style.backgroundGraphic&&(h=!0),i.parentNode.removeChild(i))}if(h){var i=document.getElementById(a.id+this.BACKGROUND_ID_SUFFIX);i&&i.parentNode.removeChild(i)}return e},redrawNode:function(a,b,c,d){c=this.applyDefaultSymbolizer(c);var e=this.nodeFactory(a,this.getNodeType(b,c));e._featureId=d,e._boundsBottom=b.getBounds().bottom,e._geometryClass=b.CLASS_NAME,e._style=c;var f=this.drawGeometryNode(e,b,c);if(!1===f)return!1;if(e=f.node,this.indexer){var g=this.indexer.insert(e);g?this.vectorRoot.insertBefore(e,g):this.vectorRoot.appendChild(e)}else e.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(e);return this.postDraw(e),f.complete},redrawBackgroundNode:function(a,b,c,d){var e=OpenLayers.Util.extend({},c);return e.externalGraphic=e.backgroundGraphic,e.graphicXOffset=e.backgroundXOffset,e.graphicYOffset=e.backgroundYOffset,e.graphicZIndex=e.backgroundGraphicZIndex,e.graphicWidth=e.backgroundWidth||e.graphicWidth,e.graphicHeight=e.backgroundHeight||e.graphicHeight,e.backgroundGraphic=null,e.backgroundXOffset=null,e.backgroundYOffset=null,e.backgroundGraphicZIndex=null,this.redrawNode(a+this.BACKGROUND_ID_SUFFIX,b,e,null)},drawGeometryNode:function(a,b,c){c=c||a._style;var d,e={isFilled:void 0===c.fill||c.fill,isStroked:void 0===c.stroke?!!c.strokeWidth:c.stroke};switch(b.CLASS_NAME){case"OpenLayers.Geometry.Point":!1===c.graphic&&(e.isFilled=!1,e.isStroked=!1),d=this.drawPoint(a,b);break;case"OpenLayers.Geometry.LineString":e.isFilled=!1,d=this.drawLineString(a,b);break;case"OpenLayers.Geometry.LinearRing":d=this.drawLinearRing(a,b);break;case"OpenLayers.Geometry.Polygon":d=this.drawPolygon(a,b);break;case"OpenLayers.Geometry.Rectangle":d=this.drawRectangle(a,b)}return a._options=e,0!=d&&{node:this.setStyle(a,c,e,b),complete:d}},postDraw:function(a){},drawPoint:function(a,b){},drawLineString:function(a,b){},drawLinearRing:function(a,b){},drawPolygon:function(a,b){},drawRectangle:function(a,b){},drawCircle:function(a,b){},removeText:function(a){var b=document.getElementById(a+this.LABEL_ID_SUFFIX);b&&this.textRoot.removeChild(b);var c=document.getElementById(a+this.LABEL_OUTLINE_SUFFIX);c&&this.textRoot.removeChild(c)},getFeatureIdFromEvent:function(a){var b=a.target,c=b&&b.correspondingUseElement;return(c||(b||a.srcElement))._featureId},eraseGeometry:function(a,b){if("OpenLayers.Geometry.MultiPoint"==a.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==a.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==a.CLASS_NAME||"OpenLayers.Geometry.Collection"==a.CLASS_NAME)for(var c=0,d=a.components.length;c<d;c++)this.eraseGeometry(a.components[c],b);else{var e=OpenLayers.Util.getElement(a.id);if(e&&e.parentNode&&(e.geometry&&(e.geometry.destroy(),e.geometry=null),e.parentNode.removeChild(e),this.indexer&&this.indexer.remove(e),e._style.backgroundGraphic)){var f=a.id+this.BACKGROUND_ID_SUFFIX,g=OpenLayers.Util.getElement(f);g&&g.parentNode&&g.parentNode.removeChild(g)}}},nodeFactory:function(a,b){var c=OpenLayers.Util.getElement(a);return c?this.nodeTypeCompare(c,b)||(c.parentNode.removeChild(c),c=this.nodeFactory(a,b)):c=this.createNode(b,a),c},nodeTypeCompare:function(a,b){},createNode:function(a,b){},moveRoot:function(a){var b=this.root;a.root.parentNode==this.rendererRoot&&(b=a.root),b.parentNode.removeChild(b),a.rendererRoot.appendChild(b)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(a){return"circle"!=a&&!!a},CLASS_NAME:"OpenLayers.Renderer.Elements"}),OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,getParameters:function(a){a=a||window.location.href;var b=OpenLayers.Util.getParameters(a),c=a.indexOf("#");return c>0&&(a="?"+a.substring(c+1,a.length),OpenLayers.Util.extend(b,OpenLayers.Util.getParameters(a))),b},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var b=0,c=this.map.controls.length;b<c;b++){var d=this.map.controls[b];if(d!=this&&"OpenLayers.Control.ArgParser"==d.CLASS_NAME){d.displayProjection!=this.displayProjection&&(this.displayProjection=d.displayProjection);break}}if(b==this.map.controls.length){var e=this.getParameters();e.layers&&(this.layers=e.layers,this.map.events.register("addlayer",this,this.configureLayers),this.configureLayers()),e.lat&&e.lon&&(this.center=new OpenLayers.LonLat(parseFloat(e.lon),parseFloat(e.lat)),e.zoom&&(this.zoom=parseFloat(e.zoom)),this.map.events.register("changebaselayer",this,this.setCenter),this.setCenter())}},setCenter:function(){this.map.baseLayer&&(this.map.events.unregister("changebaselayer",this,this.setCenter),this.displayProjection&&this.center.transform(this.displayProjection,this.map.getProjectionObject()),this.map.setCenter(this.center,this.zoom))},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var a=0,b=this.layers.length;a<b;a++){var c=this.map.layers[a],d=this.layers.charAt(a);"B"==d?this.map.setBaseLayer(c):"T"!=d&&"F"!=d||c.setVisibility("T"==d)}}},CLASS_NAME:"OpenLayers.Control.ArgParser"}),OpenLayers.Control.Permalink=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,anchor:!1,base:"",displayProjection:null,initialize:function(a,b,c){null===a||"object"!=typeof a||OpenLayers.Util.isElement(a)?(OpenLayers.Control.prototype.initialize.apply(this,[c]),this.element=OpenLayers.Util.getElement(a),this.base=b||document.location.href):(c=a,this.base=document.location.href,OpenLayers.Control.prototype.initialize.apply(this,[c]),null!=this.element&&(this.element=OpenLayers.Util.getElement(this.element)))},destroy:function(){this.element&&this.element.parentNode==this.div&&(this.div.removeChild(this.element),this.element=null),this.map&&this.map.events.unregister("moveend",this,this.updateLink),OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var b=0,c=this.map.controls.length;b<c;b++){var d=this.map.controls[b];if(d.CLASS_NAME==this.argParserClass.CLASS_NAME){d.displayProjection!=this.displayProjection&&(this.displayProjection=d.displayProjection);break}}b==this.map.controls.length&&this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||this.anchor||(this.element=document.createElement("a"),this.element.innerHTML=OpenLayers.i18n("Permalink"),this.element.href="",this.div.appendChild(this.element)),this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,changebaselayer:this.updateLink,scope:this}),this.updateLink(),this.div},updateLink:function(){var a=this.anchor?"#":"?",b=this.base,c=null;-1!=b.indexOf("#")&&0==this.anchor&&(c=b.substring(b.indexOf("#"),b.length)),-1!=b.indexOf(a)&&(b=b.substring(0,b.indexOf(a))),b=b.split("#")[0]+a+OpenLayers.Util.getParameterString(this.createParams()),c&&(b+=c),this.anchor&&!this.element?window.location.href=b:this.element.href=b},createParams:function(a,b,c){a=a||this.map.getCenter();var d=OpenLayers.Util.getParameters(this.base);if(a){d.zoom=b||this.map.getZoom();var e=a.lat,f=a.lon;if(this.displayProjection){var g=OpenLayers.Projection.transform({x:f,y:e},this.map.getProjectionObject(),this.displayProjection);f=g.x,e=g.y}d.lat=Math.round(1e5*e)/1e5,d.lon=Math.round(1e5*f)/1e5,c=c||this.map.layers,d.layers="";for(var h=0,i=c.length;h<i;h++){var j=c[h];j.isBaseLayer?d.layers+=j==this.map.baseLayer?"B":"0":d.layers+=j.getVisibility()?"T":"F"}}return d},CLASS_NAME:"OpenLayers.Control.Permalink"}),OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(a,b,c){var d=[];d.push(a,b,{},c),OpenLayers.Layer.Grid.prototype.initialize.apply(this,d)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.TMS(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){a=this.adjustBounds(a);var b=this.getServerResolution(),c=Math.round((a.left-this.tileOrigin.lon)/(b*this.tileSize.w)),d=Math.round((a.bottom-this.tileOrigin.lat)/(b*this.tileSize.h)),e=this.getServerZoom(),f=this.serviceVersion+"/"+this.layername+"/"+e+"/"+c+"/"+d+"."+this.type,g=this.url;return OpenLayers.Util.isArray(g)&&(g=this.selectUrl(f,g)),g+f},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.TMS"}),OpenLayers.Format.WCSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",CLASS_NAME:"OpenLayers.Format.WCSCapabilities"}),OpenLayers.Format.WCSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,splitSpace:/\s+/},defaultPrefix:"wcs",read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1"}),OpenLayers.Format.WCSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WCSCapabilities.v1,{namespaces:{wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},errorProperty:"service",readers:{wcs:{WCS_Capabilities:function(a,b){this.readChildNodes(a,b)},Service:function(a,b){b.service={},this.readChildNodes(a,b.service)},name:function(a,b){b.name=this.getChildValue(a)},label:function(a,b){b.label=this.getChildValue(a)},keywords:function(a,b){b.keywords=[],this.readChildNodes(a,b.keywords)},keyword:function(a,b){b.push(this.getChildValue(a))},responsibleParty:function(a,b){b.responsibleParty={},this.readChildNodes(a,b.responsibleParty)},individualName:function(a,b){b.individualName=this.getChildValue(a)},organisationName:function(a,b){b.organisationName=this.getChildValue(a)},positionName:function(a,b){b.positionName=this.getChildValue(a)},contactInfo:function(a,b){b.contactInfo={},this.readChildNodes(a,b.contactInfo)},phone:function(a,b){b.phone={},this.readChildNodes(a,b.phone)},voice:function(a,b){b.voice=this.getChildValue(a)},facsimile:function(a,b){b.facsimile=this.getChildValue(a)},address:function(a,b){b.address={},this.readChildNodes(a,b.address)},deliveryPoint:function(a,b){b.deliveryPoint=this.getChildValue(a)},city:function(a,b){b.city=this.getChildValue(a)},postalCode:function(a,b){b.postalCode=this.getChildValue(a)},country:function(a,b){b.country=this.getChildValue(a)},electronicMailAddress:function(a,b){b.electronicMailAddress=this.getChildValue(a)},fees:function(a,b){b.fees=this.getChildValue(a)},accessConstraints:function(a,b){b.accessConstraints=this.getChildValue(a)},ContentMetadata:function(a,b){b.contentMetadata=[],this.readChildNodes(a,b.contentMetadata)},CoverageOfferingBrief:function(a,b){var c={};this.readChildNodes(a,c),b.push(c)},name:function(a,b){b.name=this.getChildValue(a)},label:function(a,b){b.label=this.getChildValue(a)},lonLatEnvelope:function(a,b){var c=this.getElementsByTagNameNS(a,"http://www.opengis.net/gml","pos");if(2==c.length){var d={},e={};OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[c[0],d]),OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[c[1],e]),b.lonLatEnvelope={},b.lonLatEnvelope.srsName=a.getAttribute("srsName"),b.lonLatEnvelope.min=d.points[0],b.lonLatEnvelope.max=e.points[0]}}}},CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1_0_0"}),OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){var a=OpenLayers.Strategy.prototype.activate.apply(this,arguments);return a&&(this.layer.events.on({refresh:this.load,scope:this}),1==this.layer.visibility||this.preload?this.load():this.layer.events.on({visibilitychanged:this.load,scope:this})),a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);return a&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this}),a},load:function(a){var b=this.layer;b.events.triggerEvent("loadstart",{filter:b.filter}),b.protocol.read(OpenLayers.Util.applyDefaults({callback:this.merge,filter:b.filter,scope:this},a)),b.events.un({visibilitychanged:this.load,scope:this})},merge:function(a){var b=this.layer;b.destroyFeatures();var c=a.features;if(c&&c.length>0){var d=b.projection,e=b.map.getProjectionObject();if(!e.equals(d))for(var f,g=0,h=c.length;g<h;++g)(f=c[g].geometry)&&f.transform(d,e);b.addFeatures(c)}b.events.triggerEvent("loadend",{response:a})},CLASS_NAME:"OpenLayers.Strategy.Fixed"}),OpenLayers.Control.Zoom=OpenLayers.Class(OpenLayers.Control,{zoomInText:"+",zoomInId:"olZoomInLink",zoomOutText:"â",zoomOutId:"olZoomOutLink",draw:function(){var a=OpenLayers.Control.prototype.draw.apply(this),b=this.getOrCreateLinks(a),c=b.zoomIn,d=b.zoomOut,e=this.map.events;return d.parentNode!==a&&(e=this.events,e.attachToElement(d.parentNode)),e.register("buttonclick",this,this.onZoomClick),this.zoomInLink=c,this.zoomOutLink=d,a},getOrCreateLinks:function(a){var b=document.getElementById(this.zoomInId),c=document.getElementById(this.zoomOutId);return b||(b=document.createElement("a"),b.href="#zoomIn",b.appendChild(document.createTextNode(this.zoomInText)),b.className="olControlZoomIn",a.appendChild(b)),OpenLayers.Element.addClass(b,"olButton"),c||(c=document.createElement("a"),c.href="#zoomOut",c.appendChild(document.createTextNode(this.zoomOutText)),c.className="olControlZoomOut",a.appendChild(c)),OpenLayers.Element.addClass(c,"olButton"),{zoomIn:b,zoomOut:c}},onZoomClick:function(a){var b=a.buttonElement;b===this.zoomInLink?this.map.zoomIn():b===this.zoomOutLink&&this.map.zoomOut()},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onZoomClick),delete this.zoomInLink,delete this.zoomOutLink,OpenLayers.Control.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Control.Zoom"}),OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(a,b){if(this.styles={default:new OpenLayers.Style(OpenLayers.Feature.Vector.style.default),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),delete:new OpenLayers.Style(OpenLayers.Feature.Vector.style.delete)},a instanceof OpenLayers.Style)this.styles.default=a,this.styles.select=a,this.styles.temporary=a,this.styles.delete=a;else if("object"==typeof a)for(var c in a)if(a[c]instanceof OpenLayers.Style)this.styles[c]=a[c];else{if("object"!=typeof a[c]){this.styles.default=new OpenLayers.Style(a),this.styles.select=new OpenLayers.Style(a),this.styles.temporary=new OpenLayers.Style(a),this.styles.delete=new OpenLayers.Style(a);break}this.styles[c]=new OpenLayers.Style(a[c])}OpenLayers.Util.extend(this,b)},destroy:function(){for(var a in this.styles)this.styles[a].destroy();this.styles=null},createSymbolizer:function(a,b){a||(a=new OpenLayers.Feature.Vector),this.styles[b]||(b="default"),a.renderIntent=b;var c={};return this.extendDefault&&"default"!=b&&(c=this.styles.default.createSymbolizer(a)),OpenLayers.Util.extend(c,this.styles[b].createSymbolizer(a))},addUniqueValueRules:function(a,b,c,d){var e=[];for(var f in c)e.push(new OpenLayers.Rule({symbolizer:c[f],context:d,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:b,value:f})}));this.styles[a].addRules(e)},CLASS_NAME:"OpenLayers.StyleMap"}),OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(a,b){if(OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.renderer&&this.renderer.supported()||this.assignRenderer(),this.renderer&&this.renderer.supported()||(this.renderer=null,this.displayError()),this.styleMap||(this.styleMap=new OpenLayers.StyleMap),this.features=[],this.selectedFeatures=[],this.unrenderedFeatures={},this.strategies)for(var c=0,d=this.strategies.length;c<d;c++)this.strategies[c].setLayer(this)},destroy:function(){if(this.strategies){var a,b,c;for(b=0,c=this.strategies.length;b<c;b++)a=this.strategies[b],a.autoDestroy&&a.destroy();this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=null),this.destroyFeatures(),this.features=null,this.selectedFeatures=null,this.unrenderedFeatures=null,this.renderer&&this.renderer.destroy(),this.renderer=null,this.geometryType=null,this.drawn=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){null==a&&(a=new OpenLayers.Layer.Vector(this.name,this.getOptions())),a=OpenLayers.Layer.prototype.clone.apply(this,[a]);for(var b=this.features,c=b.length,d=new Array(c),e=0;e<c;++e)d[e]=b[e].clone();return a.features=d,a},refresh:function(a){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",a)},assignRenderer:function(){for(var a=0,b=this.renderers.length;a<b;a++){var c=this.renderers[a],d="function"==typeof c?c:OpenLayers.Renderer[c];if(d&&d.prototype.supported()){this.renderer=new d(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(a){if(OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.renderer){this.renderer.map=this.map;var b=this.map.getSize();b.w=b.w*this.ratio,b.h=b.h*this.ratio,this.renderer.setSize(b)}else this.map.removeLayer(this)},afterAdd:function(){if(this.strategies){var a,b,c;for(b=0,c=this.strategies.length;b<c;b++)a=this.strategies[b],a.autoActivate&&a.activate()}},removeMap:function(a){if(this.drawn=!1,this.strategies){var b,c,d;for(c=0,d=this.strategies.length;c<d;c++)b=this.strategies[c],b.autoActivate&&b.deactivate()}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var a=this.map.getSize();a.w=a.w*this.ratio,a.h=a.h*this.ratio,this.renderer.setSize(a)},moveTo:function(a,b,c){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var d=!0;if(!c){this.renderer.root.style.visibility="hidden";var e=this.map.getSize(),f=e.w,g=e.h,h=f/2*this.ratio-f/2,i=g/2*this.ratio-g/2;h+=this.map.layerContainerOriginPx.x,h=-Math.round(h),i+=this.map.layerContainerOriginPx.y,i=-Math.round(i),this.div.style.left=h+"px",this.div.style.top=i+"px";var j=this.map.getExtent().scale(this.ratio);if(d=this.renderer.setExtent(j,b),this.renderer.root.style.visibility="visible",!0===OpenLayers.IS_GECKO&&(this.div.scrollLeft=this.div.scrollLeft),!b&&d)for(var k in this.unrenderedFeatures){var l=this.unrenderedFeatures[k];this.drawFeature(l)}}if(!this.drawn||b||!d){this.drawn=!0;for(var l,k=0,m=this.features.length;k<m;k++)this.renderer.locked=k!==m-1,l=this.features[k],this.drawFeature(l)}},display:function(a){OpenLayers.Layer.prototype.display.apply(this,arguments);var b=this.div.style.display;b!=this.renderer.root.style.display&&(this.renderer.root.style.display=b)},addFeatures:function(a,b){OpenLayers.Util.isArray(a)||(a=[a]);var c=!b||!b.silent;if(c){var d={features:a};if(!1===this.events.triggerEvent("beforefeaturesadded",d))return;a=d.features}for(var e=[],f=0,g=a.length;f<g;f++){f!=a.length-1?this.renderer.locked=!0:this.renderer.locked=!1;var h=a[f];if(this.geometryType&&!(h.geometry instanceof this.geometryType))throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME);if(h.layer=this,!h.style&&this.style&&(h.style=OpenLayers.Util.extend({},this.style)),c){if(!1===this.events.triggerEvent("beforefeatureadded",{feature:h}))continue;this.preFeatureInsert(h)}e.push(h),this.features.push(h),this.drawFeature(h),c&&(this.events.triggerEvent("featureadded",{feature:h}),this.onFeatureInsert(h))}c&&this.events.triggerEvent("featuresadded",{features:e})},removeFeatures:function(a,b){if(a&&0!==a.length){if(a===this.features)return this.removeAllFeatures(b);OpenLayers.Util.isArray(a)||(a=[a]),a===this.selectedFeatures&&(a=a.slice());var c=!b||!b.silent;c&&this.events.triggerEvent("beforefeaturesremoved",{features:a});for(var d=a.length-1;d>=0;d--){0!=d&&a[d-1].geometry?this.renderer.locked=!0:this.renderer.locked=!1;var e=a[d];delete this.unrenderedFeatures[e.id],c&&this.events.triggerEvent("beforefeatureremoved",{feature:e}),this.features=OpenLayers.Util.removeItem(this.features,e),e.layer=null,e.geometry&&this.renderer.eraseFeatures(e),-1!=OpenLayers.Util.indexOf(this.selectedFeatures,e)&&OpenLayers.Util.removeItem(this.selectedFeatures,e),c&&this.events.triggerEvent("featureremoved",{feature:e})}c&&this.events.triggerEvent("featuresremoved",{features:a})}},removeAllFeatures:function(a){var b=!a||!a.silent,c=this.features;b&&this.events.triggerEvent("beforefeaturesremoved",{features:c});for(var d,e=c.length-1;e>=0;e--)d=c[e],b&&this.events.triggerEvent("beforefeatureremoved",{feature:d}),d.layer=null,b&&this.events.triggerEvent("featureremoved",{feature:d});this.renderer.clear(),this.features=[],this.unrenderedFeatures={},this.selectedFeatures=[],b&&this.events.triggerEvent("featuresremoved",{features:c})},destroyFeatures:function(a,b){if(void 0==a&&(a=this.features),a){this.removeFeatures(a,b);for(var c=a.length-1;c>=0;c--)a[c].destroy()}},drawFeature:function(a,b){if(this.drawn){if("object"!=typeof b){b||a.state!==OpenLayers.State.DELETE||(b="delete");var c=b||a.renderIntent;b=a.style||this.style,b||(b=this.styleMap.createSymbolizer(a,c))}var d=this.renderer.drawFeature(a,b);!1===d||null===d?this.unrenderedFeatures[a.id]=a:delete this.unrenderedFeatures[a.id]}},eraseFeatures:function(a){this.renderer.eraseFeatures(a)},getFeatureFromEvent:function(a){if(!this.renderer)throw new Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.");var b=null,c=this.renderer.getFeatureIdFromEvent(a);return c&&(b="string"==typeof c?this.getFeatureById(c):c),b},getFeatureBy:function(a,b){for(var c=null,d=0,e=this.features.length;d<e;++d)if(this.features[d][a]==b){c=this.features[d];break}return c},getFeatureById:function(a){return this.getFeatureBy("id",a)},getFeatureByFid:function(a){return this.getFeatureBy("fid",a)},getFeaturesByAttribute:function(a,b){var c,d,e=this.features.length,f=[];for(c=0;c<e;c++)(d=this.features[c])&&d.attributes&&d.attributes[a]===b&&f.push(d);return f},onFeatureInsert:function(a){},preFeatureInsert:function(a){},getDataExtent:function(){var a=null,b=this.features;if(b&&b.length>0)for(var c=null,d=0,e=b.length;d<e;d++)(c=b[d].geometry)&&(null===a&&(a=new OpenLayers.Bounds),a.extend(c.getBounds()));return a},CLASS_NAME:"OpenLayers.Layer.Vector"}),OpenLayers.Layer.PointTrack=OpenLayers.Class(OpenLayers.Layer.Vector,{dataFrom:null,styleFrom:null,addNodes:function(a,b){if(a.length<2)throw new Error("At least two point features have to be added to create a line from");for(var c,d,e,f=new Array(a.length-1),g=0,h=a.length;g<h;g++){if(c=a[g],e=c.geometry){if("OpenLayers.Geometry.Point"!=e.CLASS_NAME)throw new TypeError("Only features with point geometries are supported.")}else{var i=c.lonlat;e=new OpenLayers.Geometry.Point(i.lon,i.lat)}if(g>0){var j=null!=this.dataFrom?a[g+this.dataFrom].data||a[g+this.dataFrom].attributes:null,k=null!=this.styleFrom?a[g+this.styleFrom].style:null,l=new OpenLayers.Geometry.LineString([d,e]);f[g-1]=new OpenLayers.Feature.Vector(l,j,k)}d=e}this.addFeatures(f,b)},CLASS_NAME:"OpenLayers.Layer.PointTrack"}),OpenLayers.Layer.PointTrack.SOURCE_NODE=-1,OpenLayers.Layer.PointTrack.TARGET_NODE=0,OpenLayers.Layer.PointTrack.dataFrom={SOURCE_NODE:-1,TARGET_NODE:0},OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(a){a=a||{},OpenLayers.Util.extend(this,a),this.options=a},mergeWithDefaultFilter:function(a){return a&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,a]}):a||this.defaultFilter||void 0},destroy:function(){this.options=null,this.format=null},read:function(a){a=a||{},a.filter=this.mergeWithDefaultFilter(a.filter)},create:function(){},update:function(){},delete:function(){},commit:function(){},abort:function(a){},createCallback:function(a,b,c){return OpenLayers.Function.bind(function(){a.apply(this,[b,c])},this)},CLASS_NAME:"OpenLayers.Protocol"}),OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(a){OpenLayers.Util.extend(this,a)},success:function(){return this.code>0},CLASS_NAME:"OpenLayers.Protocol.Response"}),OpenLayers.Protocol.Response.SUCCESS=1,OpenLayers.Protocol.Response.FAILURE=0,OpenLayers.Protocol.WFS=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Protocol.WFS.DEFAULTS);var b=OpenLayers.Protocol.WFS["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported WFS version: "+a.version;return new b(a)},OpenLayers.Protocol.WFS.fromWMSLayer=function(a,b){var c,d,e=a.params.LAYERS,f=(OpenLayers.Util.isArray(e)?e[0]:e).split(":");f.length>1&&(d=f[0]),c=f.pop();var g={url:a.url,featureType:c,featurePrefix:d,srsName:a.projection&&a.projection.getCode()||a.map&&a.map.getProjectionObject().getCode(),version:"1.1.0"};return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(b,g))},OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"},OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,markers:null,drawn:!1,initialize:function(a,b){OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.markers=[]},destroy:function(){this.clearMarkers(),this.markers=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(a){if(a!=this.opacity){this.opacity=a;for(var b=0,c=this.markers.length;b<c;b++)this.markers[b].setOpacity(this.opacity)}},moveTo:function(a,b,c){if(OpenLayers.Layer.prototype.moveTo.apply(this,arguments),b||!this.drawn){for(var d=0,e=this.markers.length;d<e;d++)this.drawMarker(this.markers[d]);this.drawn=!0}},addMarker:function(a){this.markers.push(a),this.opacity<1&&a.setOpacity(this.opacity),this.map&&this.map.getExtent()&&(a.map=this.map,this.drawMarker(a))},removeMarker:function(a){this.markers&&this.markers.length&&(OpenLayers.Util.removeItem(this.markers,a),a.erase())},clearMarkers:function(){if(null!=this.markers)for(;this.markers.length>0;)this.removeMarker(this.markers[0])},drawMarker:function(a){var b=this.map.getLayerPxFromLonLat(a.lonlat);if(null==b)a.display(!1);else if(a.isDrawn())a.icon&&a.icon.moveTo(b);else{var c=a.draw(b);this.div.appendChild(c)}},getDataExtent:function(){var a=null;if(this.markers&&this.markers.length>0)for(var a=new OpenLayers.Bounds,b=0,c=this.markers.length;b<c;b++){var d=this.markers[b];a.extend(d.lonlat)}return a},CLASS_NAME:"OpenLayers.Layer.Markers"}),OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control.Button,{slideFactor:50,slideRatio:null,direction:null,initialize:function(a,b){this.direction=a,this.CLASS_NAME+=this.direction,OpenLayers.Control.prototype.initialize.apply(this,[b])},trigger:function(){if(this.map){var a=OpenLayers.Function.bind(function(a){return this.slideRatio?this.map.getSize()[a]*this.slideRatio:this.slideFactor},this);switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-a("h"));break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,a("h"));break;case OpenLayers.Control.Pan.WEST:this.map.pan(-a("w"),0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(a("w"),0)}}},CLASS_NAME:"OpenLayers.Control.Pan"}),OpenLayers.Control.Pan.NORTH="North",OpenLayers.Control.Pan.SOUTH="South",OpenLayers.Control.Pan.EAST="East",OpenLayers.Control.Pan.WEST="West",OpenLayers.Format.CSWGetDomain=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Format.CSWGetDomain.DEFAULTS);var b=OpenLayers.Format.CSWGetDomain["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported CSWGetDomain version: "+a.version;return new b(a)},OpenLayers.Format.CSWGetDomain.DEFAULTS={version:"2.0.2"},OpenLayers.Format.CSWGetDomain.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",PropertyName:null,ParameterName:null,read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},readers:{csw:{GetDomainResponse:function(a,b){this.readChildNodes(a,b)},DomainValues:function(a,b){OpenLayers.Util.isArray(b.DomainValues)||(b.DomainValues=[]);for(var c=a.attributes,d={},e=0,f=c.length;e<f;++e)d[c[e].name]=c[e].nodeValue;this.readChildNodes(a,d),b.DomainValues.push(d)},PropertyName:function(a,b){b.PropertyName=this.getChildValue(a)},ParameterName:function(a,b){b.ParameterName=this.getChildValue(a)},ListOfValues:function(a,b){OpenLayers.Util.isArray(b.ListOfValues)||(b.ListOfValues=[]),this.readChildNodes(a,b.ListOfValues)},Value:function(a,b){for(var c=a.attributes,d={},e=0,f=c.length;e<f;++e)d[c[e].name]=c[e].nodeValue;d.value=this.getChildValue(a),b.push({Value:d})},ConceptualScheme:function(a,b){b.ConceptualScheme={},this.readChildNodes(a,b.ConceptualScheme)},Name:function(a,b){b.Name=this.getChildValue(a)},Document:function(a,b){b.Document=this.getChildValue(a)},Authority:function(a,b){b.Authority=this.getChildValue(a)},RangeOfValues:function(a,b){b.RangeOfValues={},this.readChildNodes(a,b.RangeOfValues)},MinValue:function(a,b){for(var c=a.attributes,d={},e=0,f=c.length;e<f;++e)d[c[e].name]=c[e].nodeValue;d.value=this.getChildValue(a),b.MinValue=d},MaxValue:function(a,b){for(var c=a.attributes,d={},e=0,f=c.length;e<f;++e)d[c[e].name]=c[e].nodeValue;d.value=this.getChildValue(a),b.MaxValue=d}}},write:function(a){var b=this.writeNode("csw:GetDomain",a);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{csw:{GetDomain:function(a){var b=this.createElementNSPlus("csw:GetDomain",{attributes:{service:"CSW",version:this.version}});return a.PropertyName||this.PropertyName?this.writeNode("csw:PropertyName",a.PropertyName||this.PropertyName,b):(a.ParameterName||this.ParameterName)&&this.writeNode("csw:ParameterName",a.ParameterName||this.ParameterName,b),this.readChildNodes(b,a),b},PropertyName:function(a){return this.createElementNSPlus("csw:PropertyName",{value:a})},ParameterName:function(a){return this.createElementNSPlus("csw:ParameterName",{value:a})}}},CLASS_NAME:"OpenLayers.Format.CSWGetDomain.v2_0_2"}),OpenLayers.Format.ArcXML.Features=OpenLayers.Class(OpenLayers.Format.XML,{read:function(a){return(new OpenLayers.Format.ArcXML).read(a).features.feature}}),OpenLayers.Control.Snapping=OpenLayers.Class(OpenLayers.Control,{DEFAULTS:{tolerance:10,node:!0,edge:!0,vertex:!0},greedy:!0,precedence:["node","vertex","edge"],resolution:null,geoToleranceCache:null,layer:null,feature:null,point:null,
initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]),this.options=a||{},this.options.layer&&this.setLayer(this.options.layer);var b=OpenLayers.Util.extend({},this.options.defaults);this.defaults=OpenLayers.Util.applyDefaults(b,this.DEFAULTS),this.setTargets(this.options.targets),0===this.targets.length&&this.layer&&this.addTargetLayer(this.layer),this.geoToleranceCache={}},setLayer:function(a){this.active?(this.deactivate(),this.layer=a,this.activate()):this.layer=a},setTargets:function(a){if(this.targets=[],a&&a.length)for(var b,c=0,d=a.length;c<d;++c)b=a[c],b instanceof OpenLayers.Layer.Vector?this.addTargetLayer(b):this.addTarget(b)},addTargetLayer:function(a){this.addTarget({layer:a})},addTarget:function(a){a=OpenLayers.Util.applyDefaults(a,this.defaults),a.nodeTolerance=a.nodeTolerance||a.tolerance,a.vertexTolerance=a.vertexTolerance||a.tolerance,a.edgeTolerance=a.edgeTolerance||a.tolerance,this.targets.push(a)},removeTargetLayer:function(a){for(var b,c=this.targets.length-1;c>=0;--c)b=this.targets[c],b.layer===a&&this.removeTarget(b)},removeTarget:function(a){return OpenLayers.Util.removeItem(this.targets,a)},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);return a&&this.layer&&this.layer.events&&this.layer.events.on({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this}),a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);return a&&this.layer&&this.layer.events&&this.layer.events.un({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this}),this.feature=null,this.point=null,a},onSketchModified:function(a){this.feature=a.feature,this.considerSnapping(a.vertex,a.vertex)},onVertexModified:function(a){this.feature=a.feature;var b=this.layer.map.getLonLatFromViewPortPx(a.pixel);this.considerSnapping(a.vertex,new OpenLayers.Geometry.Point(b.lon,b.lat))},considerSnapping:function(a,b){for(var c,d,e={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null},f=!1,g=0,h=this.targets.length;g<h;++g)if(d=this.targets[g],c=this.testTarget(d,b)){if(this.greedy){e=c,e.target=d,f=!0;break}(c.rank<e.rank||c.rank===e.rank&&c.dist<e.dist)&&(e=c,e.target=d,f=!0)}if(f){!1!==this.events.triggerEvent("beforesnap",{point:a,x:e.x,y:e.y,distance:e.dist,layer:e.target.layer,snapType:this.precedence[e.rank]})?(a.x=e.x,a.y=e.y,this.point=a,this.events.triggerEvent("snap",{point:a,snapType:this.precedence[e.rank],layer:e.target.layer,distance:e.dist})):f=!1}this.point&&!f&&(a.x=b.x,a.y=b.y,this.point=null,this.events.triggerEvent("unsnap",{point:a}))},testTarget:function(a,b){var c=this.layer.map.getResolution();if("minResolution"in a&&c<a.minResolution)return null;if("maxResolution"in a&&c>=a.maxResolution)return null;for(var d,e,f,g,h,i,j,k={node:this.getGeoTolerance(a.nodeTolerance,c),vertex:this.getGeoTolerance(a.vertexTolerance,c),edge:this.getGeoTolerance(a.edgeTolerance,c)},l=Math.max(k.node,k.vertex,k.edge),m={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY},n=!1,o=a.layer.features,p=this.precedence.length,q=new OpenLayers.LonLat(b.x,b.y),r=0,s=o.length;r<s;++r)if((d=o[r])!==this.feature&&!d._sketch&&d.state!==OpenLayers.State.DELETE&&(!a.filter||a.filter.evaluate(d))&&d.atPoint(q,l,l))for(var t=0,u=Math.min(m.rank+1,p);t<u;++t)if(e=this.precedence[t],a[e])if("edge"===e){if(h=d.geometry.distanceTo(b,{details:!0}),(i=h.distance)<=k[e]&&i<m.dist){m={rank:t,dist:i,x:h.x0,y:h.y0},n=!0;break}}else{f=d.geometry.getVertices("node"===e),j=!1;for(var v=0,w=f.length;v<w;++v)g=f[v],(i=g.distanceTo(b))<=k[e]&&(t<m.rank||t===m.rank&&i<m.dist)&&(m={rank:t,dist:i,x:g.x,y:g.y},n=!0,j=!0);if(j)break}return n?m:null},getGeoTolerance:function(a,b){b!==this.resolution&&(this.resolution=b,this.geoToleranceCache={});var c=this.geoToleranceCache[a];return void 0===c&&(c=a*b,this.geoToleranceCache[a]=c),c},destroy:function(){this.active&&this.deactivate(),delete this.layer,delete this.targets,OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Snapping"}),OpenLayers.Layer.Boxes=OpenLayers.Class(OpenLayers.Layer.Markers,{drawMarker:function(a){var b=this.map.getLayerPxFromLonLat({lon:a.bounds.left,lat:a.bounds.top}),c=this.map.getLayerPxFromLonLat({lon:a.bounds.right,lat:a.bounds.bottom});if(null==c||null==b)a.display(!1);else{var d=a.draw(b,{w:Math.max(1,c.x-b.x),h:Math.max(1,c.y-b.y)});a.drawn||(this.div.appendChild(d),a.drawn=!0)}},removeMarker:function(a){OpenLayers.Util.removeItem(this.markers,a),null!=a.div&&a.div.parentNode==this.div&&this.div.removeChild(a.div)},CLASS_NAME:"OpenLayers.Layer.Boxes"}),OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",profile:null,CLASS_NAME:"OpenLayers.Format.WMSCapabilities"}),OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=a;a&&9==a.nodeType&&(a=a.documentElement);var c={};if(this.readNode(a,c),void 0===c.service){var d=new OpenLayers.Format.OGCExceptionReport;c.error=d.read(b)}return c},readers:{wms:{Service:function(a,b){b.service={},this.readChildNodes(a,b.service)},Name:function(a,b){b.name=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b.abstract=this.getChildValue(a)},BoundingBox:function(a,b){var c={};c.bbox=[parseFloat(a.getAttribute("minx")),parseFloat(a.getAttribute("miny")),parseFloat(a.getAttribute("maxx")),parseFloat(a.getAttribute("maxy"))];var d={x:parseFloat(a.getAttribute("resx")),y:parseFloat(a.getAttribute("resy"))};return isNaN(d.x)&&isNaN(d.y)||(c.res=d),c},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},ContactInformation:function(a,b){b.contactInformation={},this.readChildNodes(a,b.contactInformation)},ContactPersonPrimary:function(a,b){b.personPrimary={},this.readChildNodes(a,b.personPrimary)},ContactPerson:function(a,b){b.person=this.getChildValue(a)},ContactOrganization:function(a,b){b.organization=this.getChildValue(a)},ContactPosition:function(a,b){b.position=this.getChildValue(a)},ContactAddress:function(a,b){b.contactAddress={},this.readChildNodes(a,b.contactAddress)},AddressType:function(a,b){b.type=this.getChildValue(a)},Address:function(a,b){b.address=this.getChildValue(a)},City:function(a,b){b.city=this.getChildValue(a)},StateOrProvince:function(a,b){b.stateOrProvince=this.getChildValue(a)},PostCode:function(a,b){b.postcode=this.getChildValue(a)},Country:function(a,b){b.country=this.getChildValue(a)},ContactVoiceTelephone:function(a,b){b.phone=this.getChildValue(a)},ContactFacsimileTelephone:function(a,b){b.fax=this.getChildValue(a)},ContactElectronicMailAddress:function(a,b){b.email=this.getChildValue(a)},Fees:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.fees=c)},AccessConstraints:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.accessConstraints=c)},Capability:function(a,b){b.capability={nestedLayers:[],layers:[]},this.readChildNodes(a,b.capability)},Request:function(a,b){b.request={},this.readChildNodes(a,b.request)},GetCapabilities:function(a,b){b.getcapabilities={formats:[]},this.readChildNodes(a,b.getcapabilities)},Format:function(a,b){OpenLayers.Util.isArray(b.formats)?b.formats.push(this.getChildValue(a)):b.format=this.getChildValue(a)},DCPType:function(a,b){this.readChildNodes(a,b)},HTTP:function(a,b){this.readChildNodes(a,b)},Get:function(a,b){b.get={},this.readChildNodes(a,b.get),b.href||(b.href=b.get.href)},Post:function(a,b){b.post={},this.readChildNodes(a,b.post),b.href||(b.href=b.get.href)},GetMap:function(a,b){b.getmap={formats:[]},this.readChildNodes(a,b.getmap)},GetFeatureInfo:function(a,b){b.getfeatureinfo={formats:[]},this.readChildNodes(a,b.getfeatureinfo)},Exception:function(a,b){b.exception={formats:[]},this.readChildNodes(a,b.exception)},Layer:function(a,b){var c,d;b.capability?(d=b.capability,c=b):d=b;var e=a.getAttributeNode("queryable"),f=e&&e.specified?a.getAttribute("queryable"):null;e=a.getAttributeNode("cascaded");var g=e&&e.specified?a.getAttribute("cascaded"):null;e=a.getAttributeNode("opaque");var h=e&&e.specified?a.getAttribute("opaque"):null,i=a.getAttribute("noSubsets"),j=a.getAttribute("fixedWidth"),k=a.getAttribute("fixedHeight"),l=c||{},m=OpenLayers.Util.extend,n={nestedLayers:[],styles:c?[].concat(c.styles):[],srs:c?m({},l.srs):{},metadataURLs:[],bbox:c?m({},l.bbox):{},llbbox:l.llbbox,dimensions:c?m({},l.dimensions):{},authorityURLs:c?m({},l.authorityURLs):{},identifiers:{},keywords:[],queryable:f&&""!==f?"1"===f||"true"===f:l.queryable||!1,cascaded:null!==g?parseInt(g):l.cascaded||0,opaque:h?"1"===h||"true"===h:l.opaque||!1,noSubsets:null!==i?"1"===i||"true"===i:l.noSubsets||!1,fixedWidth:null!=j?parseInt(j):l.fixedWidth||0,fixedHeight:null!=k?parseInt(k):l.fixedHeight||0,minScale:l.minScale,maxScale:l.maxScale,attribution:l.attribution};if(b.nestedLayers.push(n),n.capability=d,this.readChildNodes(a,n),delete n.capability,n.name){var o=n.name.split(":"),p=d.request,q=p.getfeatureinfo;o.length>0&&(n.prefix=o[0]),d.layers.push(n),void 0===n.formats&&(n.formats=p.getmap.formats),void 0===n.infoFormats&&q&&(n.infoFormats=q.formats)}},Attribution:function(a,b){b.attribution={},this.readChildNodes(a,b.attribution)},LogoURL:function(a,b){b.logo={width:a.getAttribute("width"),height:a.getAttribute("height")},this.readChildNodes(a,b.logo)},Style:function(a,b){var c={};b.styles.push(c),this.readChildNodes(a,c)},LegendURL:function(a,b){var c={width:a.getAttribute("width"),height:a.getAttribute("height")};b.legend=c,this.readChildNodes(a,c)},MetadataURL:function(a,b){var c={type:a.getAttribute("type")};b.metadataURLs.push(c),this.readChildNodes(a,c)},DataURL:function(a,b){b.dataURL={},this.readChildNodes(a,b.dataURL)},FeatureListURL:function(a,b){b.featureListURL={},this.readChildNodes(a,b.featureListURL)},AuthorityURL:function(a,b){var c=a.getAttribute("name"),d={};this.readChildNodes(a,d),b.authorityURLs[c]=d.href},Identifier:function(a,b){var c=a.getAttribute("authority");b.identifiers[c]=this.getChildValue(a)},KeywordList:function(a,b){this.readChildNodes(a,b)},SRS:function(a,b){b.srs[this.getChildValue(a)]=!0}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"}),OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(a,b){this.readChildNodes(a,b)},Keyword:function(a,b){b.keywords&&b.keywords.push(this.getChildValue(a))},DescribeLayer:function(a,b){b.describelayer={formats:[]},this.readChildNodes(a,b.describelayer)},GetLegendGraphic:function(a,b){b.getlegendgraphic={formats:[]},this.readChildNodes(a,b.getlegendgraphic)},GetStyles:function(a,b){b.getstyles={formats:[]},this.readChildNodes(a,b.getstyles)},PutStyles:function(a,b){b.putstyles={formats:[]},this.readChildNodes(a,b.putstyles)},UserDefinedSymbolization:function(a,b){var c={supportSLD:1==parseInt(a.getAttribute("SupportSLD")),userLayer:1==parseInt(a.getAttribute("UserLayer")),userStyle:1==parseInt(a.getAttribute("UserStyle")),remoteWFS:1==parseInt(a.getAttribute("RemoteWFS"))};b.userSymbols=c},LatLonBoundingBox:function(a,b){b.llbbox=[parseFloat(a.getAttribute("minx")),parseFloat(a.getAttribute("miny")),parseFloat(a.getAttribute("maxx")),parseFloat(a.getAttribute("maxy"))]},BoundingBox:function(a,b){var c=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[a,b]);c.srs=a.getAttribute("SRS"),b.bbox[c.srs]=c},ScaleHint:function(a,b){var c=a.getAttribute("min"),d=a.getAttribute("max"),e=Math.pow(2,.5),f=OpenLayers.INCHES_PER_UNIT.m;0!=c&&(b.maxScale=parseFloat((c/e*f*OpenLayers.DOTS_PER_INCH).toPrecision(13))),d!=Number.POSITIVE_INFINITY&&(b.minScale=parseFloat((d/e*f*OpenLayers.DOTS_PER_INCH).toPrecision(13)))},Dimension:function(a,b){var c=a.getAttribute("name").toLowerCase(),d={name:c,units:a.getAttribute("units"),unitsymbol:a.getAttribute("unitSymbol")};b.dimensions[d.name]=d},Extent:function(a,b){var c=a.getAttribute("name").toLowerCase();if(c in b.dimensions){var d=b.dimensions[c];d.nearestVal="1"===a.getAttribute("nearestValue"),d.multipleVal="1"===a.getAttribute("multipleValues"),d.current="1"===a.getAttribute("current"),d.default=a.getAttribute("default")||"";var e=this.getChildValue(a);d.values=e.split(",")}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"}),OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(a,b){for(var c=this.getChildValue(a),d=c.split(/ +/),e=0,f=d.length;e<f;e++)b.srs[d[e]]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"}),OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);return a&&(this.layer.events.on({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),this.update()),a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);return a&&this.layer.events.un({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),a},update:function(a){var b=this.getMapBounds();null!==b&&(a&&a.force||this.layer.visibility&&this.layer.calculateInRange()&&this.invalidBounds(b))&&(this.calculateBounds(b),this.resolution=this.layer.map.getResolution(),this.triggerRead(a))},getMapBounds:function(){if(null===this.layer.map)return null;var a=this.layer.map.getExtent();return a&&!this.layer.projection.equals(this.layer.map.getProjectionObject())&&(a=a.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection)),a},invalidBounds:function(a){a||(a=this.getMapBounds());var b=!this.bounds||!this.bounds.containsBounds(a);if(!b&&this.resFactor){var c=this.resolution/this.layer.map.getResolution();b=c>=this.resFactor||c<=1/this.resFactor}return b},calculateBounds:function(a){a||(a=this.getMapBounds());var b=a.getCenterLonLat(),c=a.getWidth()*this.ratio,d=a.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(b.lon-c/2,b.lat-d/2,b.lon+c/2,b.lat+d/2)},triggerRead:function(a){!this.response||a&&!0===a.noAbort||(this.layer.protocol.abort(this.response),this.layer.events.triggerEvent("loadend"));var b={filter:this.createFilter()};this.layer.events.triggerEvent("loadstart",b),this.response=this.layer.protocol.read(OpenLayers.Util.applyDefaults({filter:b.filter,callback:this.merge,scope:this},a))},createFilter:function(){var a=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});return this.layer.filter&&(a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,a]})),a},merge:function(a){if(this.layer.destroyFeatures(),a.success()){var b=a.features;if(b&&b.length>0){var c=this.layer.projection,d=this.layer.map.getProjectionObject();if(!d.equals(c))for(var e,f=0,g=b.length;f<g;++f)(e=b[f].geometry)&&e.transform(c,d);this.layer.addFeatures(b)}}else this.bounds=null;this.response=null,this.layer.events.triggerEvent("loadend",{response:a})},CLASS_NAME:"OpenLayers.Strategy.BBOX"}),OpenLayers.Format.SLD.v1_0_0_GeoServer=OpenLayers.Class(OpenLayers.Format.SLD.v1_0_0,{version:"1.0.0",profile:"GeoServer",readers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.priority=c)},VendorOption:function(a,b){b.vendorOptions||(b.vendorOptions={}),b.vendorOptions[a.getAttribute("name")]=this.getChildValue(a)},TextSymbolizer:function(a,b){OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld.TextSymbolizer.apply(this,arguments);var c=this.multipleSymbolizers?b.symbolizers[b.symbolizers.length-1]:b.symbolizer.Text;void 0===c.graphic&&(c.graphic=!1)}},OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.readers),writers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(a){return this.writers.sld._OGCExpression.call(this,"sld:Priority",a)},VendorOption:function(a){return this.createElementNSPlus("sld:VendorOption",{attributes:{name:a.name},value:a.value})},TextSymbolizer:function(a){var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers,c=b.sld.TextSymbolizer.apply(this,arguments);return!1!==a.graphic&&(a.externalGraphic||a.graphicName)&&this.writeNode("Graphic",a,c),"priority"in a&&this.writeNode("Priority",a.priority,c),this.addVendorOptions(c,a)},PointSymbolizer:function(a){var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers,c=b.sld.PointSymbolizer.apply(this,arguments);return this.addVendorOptions(c,a)},LineSymbolizer:function(a){var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers,c=b.sld.LineSymbolizer.apply(this,arguments);return this.addVendorOptions(c,a)},PolygonSymbolizer:function(a){var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers,c=b.sld.PolygonSymbolizer.apply(this,arguments);return this.addVendorOptions(c,a)}},OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.writers),addVendorOptions:function(a,b){if(b.vendorOptions)for(var c in b.vendorOptions)this.writeNode("VendorOption",{name:c,value:b.vendorOptions[c]},a);return a},CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0_GeoServer"}),OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,lastTouchPx:null,initialize:function(a,b,c){c&&c.layerOptions&&c.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style.default,{})),OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var a=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);return this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,a),this.map.addLayer(this.layer),!0},createFeature:function(a){var b=this.layer.getLonLatFromViewPortPx(a),c=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(c),this.callback("create",[this.point.geometry,this.point]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){return!!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.cancel(),null!=this.layer.map&&(this.destroyFeature(!0),this.layer.destroy(!1)),this.layer=null,!0)},destroyFeature:function(a){!this.layer||!a&&this.persist||this.layer.destroyFeatures(),this.point=null},destroyPersistedFeature:function(){var a=this.layer;a&&a.features.length>1&&this.layer.features[0].destroy()},finalize:function(a){var b=a?"cancel":"done";this.mouseDown=!1,this.lastDown=null,this.lastUp=null,this.lastTouchPx=null,this.callback(b,[this.geometryClone()]),this.destroyFeature(a)},cancel:function(){this.finalize(!0)},click:function(a){return OpenLayers.Event.stop(a),!1},dblclick:function(a){return OpenLayers.Event.stop(a),!1},modifyFeature:function(a){this.point||this.createFeature(a);var b=this.layer.getLonLatFromViewPortPx(a);this.point.geometry.x=b.lon,this.point.geometry.y=b.lat,this.callback("modify",[this.point.geometry,this.point,!1]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var a=this.point&&this.point.geometry;return a&&this.multi&&(a=new OpenLayers.Geometry.MultiPoint([a])),a},geometryClone:function(){var a=this.getGeometry();return a&&a.clone()},mousedown:function(a){return this.down(a)},touchstart:function(a){return this.startTouch(),this.lastTouchPx=a.xy,this.down(a)},mousemove:function(a){return this.move(a)},touchmove:function(a){return this.lastTouchPx=a.xy,this.move(a)},mouseup:function(a){return this.up(a)},touchend:function(a){return a.xy=this.lastTouchPx,this.up(a)},down:function(a){return this.mouseDown=!0,this.lastDown=a.xy,this.touch||this.modifyFeature(a.xy),this.stoppedDown=this.stopDown,!this.stopDown},move:function(a){return this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(a.xy),!0},up:function(a){return this.mouseDown=!1,this.stoppedDown=this.stopDown,!this.checkModifiers(a)||(!(!this.lastUp||!this.lastUp.equals(a.xy))||(!this.lastDown||!this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)||(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.finalize(),!this.stopUp)))},mouseout:function(a){OpenLayers.Util.mouseLeft(a,this.map.viewPortDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(a,b,c){var d=!0;if(null!=c&&a&&b){a.distanceTo(b)>c&&(d=!1)}return d},CLASS_NAME:"OpenLayers.Handler.Point"}),OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(a){var b=this.layer.getLonLatFromViewPortPx(a),c=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(c),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(a){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,a),this.line=null},destroyPersistedFeature:function(){var a=this.layer;a&&a.features.length>2&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(a){this.layer.removeFeatures([this.point]);var b=this.layer.getLonLatFromViewPortPx(a);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat)),this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length),this.layer.addFeatures([this.point]),this.callback("point",[this.point.geometry,this.getGeometry()]),this.callback("modify",[this.point.geometry,this.getSketch()]),this.drawFeature(),delete this.redoStack},insertXY:function(a,b){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(a,b),this.getCurrentPointIndex()),this.drawFeature(),delete this.redoStack},insertDeltaXY:function(a,b){var c=this.getCurrentPointIndex()-1,d=this.line.geometry.components[c];!d||isNaN(d.x)||isNaN(d.y)||this.insertXY(d.x+a,d.y+b)},insertDirectionLength:function(a,b){a*=Math.PI/180;var c=b*Math.cos(a),d=b*Math.sin(a);this.insertDeltaXY(c,d)},insertDeflectionLength:function(a,b){var c=this.getCurrentPointIndex()-1;if(c>0){var d=this.line.geometry.components[c],e=this.line.geometry.components[c-1],f=Math.atan2(d.y-e.y,d.x-e.x);this.insertDirectionLength(180*f/Math.PI+a,b)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var a=this.line.geometry,b=a.components,c=this.getCurrentPointIndex()-1,d=b[c],e=a.removeComponent(d);if(e){if(this.touch&&c>0){b=a.components;var f=b[c-1],g=this.getCurrentPointIndex(),h=b[g];h.x=f.x,h.y=f.y}this.redoStack||(this.redoStack=[]),this.redoStack.push(d),this.drawFeature()}return e},redo:function(){var a=this.redoStack&&this.redoStack.pop();return a&&(this.line.geometry.addComponent(a,this.getCurrentPointIndex()),this.drawFeature()),!!a},freehandMode:function(a){return this.freehandToggle&&a[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(a,b){this.line||this.createFeature(a);var c=this.layer.getLonLatFromViewPortPx(a);this.point.geometry.x=c.lon,this.point.geometry.y=c.lat,this.callback("modify",[this.point.geometry,this.getSketch(),b]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var a=this.line&&this.line.geometry;return a&&this.multi&&(a=new OpenLayers.Geometry.MultiLineString([a])),a},touchstart:function(a){return this.timerId&&this.passesTolerance(this.lastTouchPx,a.xy,this.doubleTouchTolerance)?(this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1):(this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300),OpenLayers.Handler.Point.prototype.touchstart.call(this,a))},down:function(a){var b=this.stopDown;return this.freehandMode(a)&&(b=!0,this.touch&&(this.modifyFeature(a.xy,!!this.lastUp),OpenLayers.Event.stop(a))),this.touch||this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)||this.modifyFeature(a.xy,!!this.lastUp),this.mouseDown=!0,this.lastDown=a.xy,this.stoppedDown=b,!b},move:function(a){return this.stoppedDown&&this.freehandMode(a)?(this.persist&&this.destroyPersistedFeature(),this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices?(this.removePoint(),this.finalize()):this.addPoint(a.xy),!1):(this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(a.xy,!!this.lastUp),!0)},up:function(a){return!this.mouseDown||this.lastUp&&this.lastUp.equals(a.xy)||(this.stoppedDown&&this.freehandMode(a)?(this.persist&&this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),null==this.lastUp&&this.persist&&this.destroyPersistedFeature(),this.addPoint(a.xy),this.lastUp=a.xy,this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry())),this.stoppedDown=this.stopDown,this.mouseDown=!1,!this.stopUp},finishGeometry:function(){var a=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[a]),this.removePoint(),this.finalize()},dblclick:function(a){return this.freehandMode(a)||this.finishGeometry(),!1},CLASS_NAME:"OpenLayers.Handler.Path"}),OpenLayers.Spherical=OpenLayers.Spherical||{},OpenLayers.Spherical.DEFAULT_RADIUS=6378137,OpenLayers.Spherical.computeDistanceBetween=function(a,b,c){var d=c||OpenLayers.Spherical.DEFAULT_RADIUS,e=Math.sin(Math.PI*(b.lon-a.lon)/360),f=Math.sin(Math.PI*(b.lat-a.lat)/360),g=f*f+e*e*Math.cos(Math.PI*a.lat/180)*Math.cos(Math.PI*b.lat/180);return 2*d*Math.atan2(Math.sqrt(g),Math.sqrt(1-g))},OpenLayers.Spherical.computeHeading=function(a,b){var c=Math.sin(Math.PI*(a.lon-b.lon)/180)*Math.cos(Math.PI*b.lat/180),d=Math.cos(Math.PI*a.lat/180)*Math.sin(Math.PI*b.lat/180)-Math.sin(Math.PI*a.lat/180)*Math.cos(Math.PI*b.lat/180)*Math.cos(Math.PI*(a.lon-b.lon)/180);return 180*Math.atan2(c,d)/Math.PI},OpenLayers.Control.CacheWrite=OpenLayers.Class(OpenLayers.Control,{layers:null,imageFormat:"image/png",quotaRegEx:/quota/i,setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);var b,c=this.layers||a.layers;for(b=c.length-1;b>=0;--b)this.addLayer({layer:c[b]});this.layers||a.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})},addLayer:function(a){a.layer.events.on({tileloadstart:this.makeSameOrigin,tileloaded:this.onTileLoaded,scope:this})},removeLayer:function(a){a.layer.events.un({tileloadstart:this.makeSameOrigin,tileloaded:this.onTileLoaded,scope:this})},makeSameOrigin:function(a){if(this.active){var b=a.tile;if(b instanceof OpenLayers.Tile.Image&&!b.crossOriginKeyword&&"data:"!==b.url.substr(0,5)){var c=OpenLayers.Request.makeSameOrigin(b.url,OpenLayers.ProxyHost);OpenLayers.Control.CacheWrite.urlMap[c]=b.url,b.url=c}}},onTileLoaded:function(a){this.active&&!a.aborted&&a.tile instanceof OpenLayers.Tile.Image&&"data:"!==a.tile.url.substr(0,5)&&(this.cache({tile:a.tile}),delete OpenLayers.Control.CacheWrite.urlMap[a.tile.url])},cache:function(a){if(window.localStorage){var b=a.tile;try{var c=b.getCanvasContext();if(c){var d=OpenLayers.Control.CacheWrite.urlMap,e=d[b.url]||b.url;window.localStorage.setItem("olCache_"+e,c.canvas.toDataURL(this.imageFormat))}}catch(a){var f=a.name||a.message;f&&this.quotaRegEx.test(f)?this.events.triggerEvent("cachefull",{tile:b}):OpenLayers.Console.error(a.toString())}}},destroy:function(){if(this.layers||this.map){var a,b=this.layers||this.map.layers;for(a=b.length-1;a>=0;--a)this.removeLayer({layer:b[a]})}this.map&&this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheWrite"}),OpenLayers.Control.CacheWrite.clearCache=function(){if(window.localStorage){var a,b;for(a=window.localStorage.length-1;a>=0;--a)b=window.localStorage.key(a),"olCache_"===b.substr(0,8)&&window.localStorage.removeItem(b)}},OpenLayers.Control.CacheWrite.urlMap={},OpenLayers.Format.WMC=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"1.1.0",layerToContext:function(a){var b=this.getParser(),c={queryable:a.queryable,visibility:a.visibility,name:a.params.LAYERS,title:a.name,abstract:a.metadata.abstract,dataURL:a.metadata.dataURL,metadataURL:a.metadataURL,server:{version:a.params.VERSION,url:a.url},maxExtent:a.maxExtent,transparent:a.params.TRANSPARENT,numZoomLevels:a.numZoomLevels,units:a.units,isBaseLayer:a.isBaseLayer,opacity:1==a.opacity?void 0:a.opacity,displayInLayerSwitcher:a.displayInLayerSwitcher,singleTile:a.singleTile,tileSize:a.singleTile||!a.tileSize?void 0:{width:a.tileSize.w,height:a.tileSize.h},minScale:a.options.resolutions||a.options.scales||a.options.maxResolution||a.options.minScale?a.minScale:void 0,maxScale:a.options.resolutions||a.options.scales||a.options.minResolution||a.options.maxScale?a.maxScale:void 0,formats:[],styles:[],srs:a.srs,dimensions:a.dimensions};if(a.metadata.servertitle&&(c.server.title=a.metadata.servertitle),a.metadata.formats&&a.metadata.formats.length>0)for(var d=0,e=a.metadata.formats.length;d<e;d++){var f=a.metadata.formats[d];c.formats.push({value:f.value,current:f.value==a.params.FORMAT})}else c.formats.push({value:a.params.FORMAT,current:!0});if(a.metadata.styles&&a.metadata.styles.length>0)for(var d=0,e=a.metadata.styles.length;d<e;d++){var g=a.metadata.styles[d];g.href==a.params.SLD||g.body==a.params.SLD_BODY||g.name==a.params.STYLES?g.current=!0:g.current=!1,c.styles.push(g)}else c.styles.push({href:a.params.SLD,body:a.params.SLD_BODY,name:a.params.STYLES||b.defaultStyleName,title:b.defaultStyleTitle,current:!0});return c},toContext:function(a){var b={},c=a.layers;if("OpenLayers.Map"==a.CLASS_NAME){var d=a.metadata||{};b.size=a.getSize(),b.bounds=a.getExtent(),b.projection=a.projection,b.title=a.title,b.keywords=d.keywords,b.abstract=d.abstract,b.logo=d.logo,b.descriptionURL=d.descriptionURL,b.contactInformation=d.contactInformation,b.maxExtent=a.maxExtent}else OpenLayers.Util.applyDefaults(b,a),void 0!=b.layers&&delete b.layers;if(void 0==b.layersContext&&(b.layersContext=[]),void 0!=c&&OpenLayers.Util.isArray(c))for(var e=0,f=c.length;e<f;e++){var g=c[e];g instanceof OpenLayers.Layer.WMS&&b.layersContext.push(this.layerToContext(g))}return b},CLASS_NAME:"OpenLayers.Format.WMC"}),OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",
getNamespacePrefix:function(a){var b=null;if(null==a)b=this.namespaces[this.defaultPrefix];else for(b in this.namespaces)if(this.namespaces[b]==a)break;return b},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=a.documentElement;this.rootPrefix=b.prefix;var c={version:b.getAttribute("version")};return this.runChildNodes(c,b),c},runChildNodes:function(a,b){for(var c,d,e,f,g=b.childNodes,h=0,i=g.length;h<i;++h)c=g[h],1==c.nodeType&&(e=this.getNamespacePrefix(c.namespaceURI),f=c.nodeName.split(":").pop(),(d=this["read_"+e+"_"+f])&&d.apply(this,[a,c]))},read_wmc_General:function(a,b){this.runChildNodes(a,b)},read_wmc_BoundingBox:function(a,b){a.projection=b.getAttribute("SRS"),a.bounds=new OpenLayers.Bounds(b.getAttribute("minx"),b.getAttribute("miny"),b.getAttribute("maxx"),b.getAttribute("maxy"))},read_wmc_LayerList:function(a,b){a.layersContext=[],this.runChildNodes(a,b)},read_wmc_Layer:function(a,b){var c={visibility:"1"!=b.getAttribute("hidden"),queryable:"1"==b.getAttribute("queryable"),formats:[],styles:[],metadata:{}};this.runChildNodes(c,b),a.layersContext.push(c)},read_wmc_Extension:function(a,b){this.runChildNodes(a,b)},read_ol_units:function(a,b){a.units=this.getChildValue(b)},read_ol_maxExtent:function(a,b){var c=new OpenLayers.Bounds(b.getAttribute("minx"),b.getAttribute("miny"),b.getAttribute("maxx"),b.getAttribute("maxy"));a.maxExtent=c},read_ol_transparent:function(a,b){a.transparent=this.getChildValue(b)},read_ol_numZoomLevels:function(a,b){a.numZoomLevels=parseInt(this.getChildValue(b))},read_ol_opacity:function(a,b){a.opacity=parseFloat(this.getChildValue(b))},read_ol_singleTile:function(a,b){a.singleTile="true"==this.getChildValue(b)},read_ol_tileSize:function(a,b){var c={width:b.getAttribute("width"),height:b.getAttribute("height")};a.tileSize=c},read_ol_isBaseLayer:function(a,b){a.isBaseLayer="true"==this.getChildValue(b)},read_ol_displayInLayerSwitcher:function(a,b){a.displayInLayerSwitcher="true"==this.getChildValue(b)},read_wmc_Server:function(a,b){a.version=b.getAttribute("version"),a.url=this.getOnlineResource_href(b),a.metadata.servertitle=b.getAttribute("title")},read_wmc_FormatList:function(a,b){this.runChildNodes(a,b)},read_wmc_Format:function(a,b){var c={value:this.getChildValue(b)};"1"==b.getAttribute("current")&&(c.current=!0),a.formats.push(c)},read_wmc_StyleList:function(a,b){this.runChildNodes(a,b)},read_wmc_Style:function(a,b){var c={};this.runChildNodes(c,b),"1"==b.getAttribute("current")&&(c.current=!0),a.styles.push(c)},read_wmc_SLD:function(a,b){this.runChildNodes(a,b)},read_sld_StyledLayerDescriptor:function(a,b){var c=OpenLayers.Format.XML.prototype.write.apply(this,[b]);a.body=c},read_sld_FeatureTypeStyle:function(a,b){var c=OpenLayers.Format.XML.prototype.write.apply(this,[b]);a.body=c},read_wmc_OnlineResource:function(a,b){a.href=this.getAttributeNS(b,this.namespaces.xlink,"href")},read_wmc_Name:function(a,b){var c=this.getChildValue(b);c&&(a.name=c)},read_wmc_Title:function(a,b){var c=this.getChildValue(b);c&&(a.title=c)},read_wmc_MetadataURL:function(a,b){a.metadataURL=this.getOnlineResource_href(b)},read_wmc_KeywordList:function(a,b){a.keywords=[],this.runChildNodes(a.keywords,b)},read_wmc_Keyword:function(a,b){a.push(this.getChildValue(b))},read_wmc_Abstract:function(a,b){var c=this.getChildValue(b);c&&(a.abstract=c)},read_wmc_LogoURL:function(a,b){a.logo={width:b.getAttribute("width"),height:b.getAttribute("height"),format:b.getAttribute("format"),href:this.getOnlineResource_href(b)}},read_wmc_DescriptionURL:function(a,b){a.descriptionURL=this.getOnlineResource_href(b)},read_wmc_ContactInformation:function(a,b){var c={};this.runChildNodes(c,b),a.contactInformation=c},read_wmc_ContactPersonPrimary:function(a,b){var c={};this.runChildNodes(c,b),a.personPrimary=c},read_wmc_ContactPerson:function(a,b){var c=this.getChildValue(b);c&&(a.person=c)},read_wmc_ContactOrganization:function(a,b){var c=this.getChildValue(b);c&&(a.organization=c)},read_wmc_ContactPosition:function(a,b){var c=this.getChildValue(b);c&&(a.position=c)},read_wmc_ContactAddress:function(a,b){var c={};this.runChildNodes(c,b),a.contactAddress=c},read_wmc_AddressType:function(a,b){var c=this.getChildValue(b);c&&(a.type=c)},read_wmc_Address:function(a,b){var c=this.getChildValue(b);c&&(a.address=c)},read_wmc_City:function(a,b){var c=this.getChildValue(b);c&&(a.city=c)},read_wmc_StateOrProvince:function(a,b){var c=this.getChildValue(b);c&&(a.stateOrProvince=c)},read_wmc_PostCode:function(a,b){var c=this.getChildValue(b);c&&(a.postcode=c)},read_wmc_Country:function(a,b){var c=this.getChildValue(b);c&&(a.country=c)},read_wmc_ContactVoiceTelephone:function(a,b){var c=this.getChildValue(b);c&&(a.phone=c)},read_wmc_ContactFacsimileTelephone:function(a,b){var c=this.getChildValue(b);c&&(a.fax=c)},read_wmc_ContactElectronicMailAddress:function(a,b){var c=this.getChildValue(b);c&&(a.email=c)},read_wmc_DataURL:function(a,b){a.dataURL=this.getOnlineResource_href(b)},read_wmc_LegendURL:function(a,b){var c={width:b.getAttribute("width"),height:b.getAttribute("height"),format:b.getAttribute("format"),href:this.getOnlineResource_href(b)};a.legend=c},read_wmc_DimensionList:function(a,b){a.dimensions={},this.runChildNodes(a.dimensions,b)},read_wmc_Dimension:function(a,b){var c=b.getAttribute("name").toLowerCase(),d={name:c,units:b.getAttribute("units")||"",unitSymbol:b.getAttribute("unitSymbol")||"",userValue:b.getAttribute("userValue")||"",nearestValue:"1"===b.getAttribute("nearestValue"),multipleValues:"1"===b.getAttribute("multipleValues"),current:"1"===b.getAttribute("current"),default:b.getAttribute("default")||""},e=this.getChildValue(b);d.values=e.split(","),a[d.name]=d},write:function(a,b){var c=this.createElementDefaultNS("ViewContext");return this.setAttributes(c,{version:this.VERSION,id:b&&"string"==typeof b.id?b.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")}),this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),c.appendChild(this.write_wmc_General(a)),c.appendChild(this.write_wmc_LayerList(a)),OpenLayers.Format.XML.prototype.write.apply(this,[c])},createElementDefaultNS:function(a,b,c){var d=this.createElementNS(this.namespaces[this.defaultPrefix],a);return b&&d.appendChild(this.createTextNode(b)),c&&this.setAttributes(d,c),d},setAttributes:function(a,b){var c;for(var d in b)c=b[d].toString(),c.match(/[A-Z]/)?this.setAttributeNS(a,null,d,c):a.setAttribute(d,c)},write_wmc_General:function(a){var b=this.createElementDefaultNS("General");a.size&&b.appendChild(this.createElementDefaultNS("Window",null,{width:a.size.w,height:a.size.h}));var c=a.bounds;return b.appendChild(this.createElementDefaultNS("BoundingBox",null,{minx:c.left.toPrecision(18),miny:c.bottom.toPrecision(18),maxx:c.right.toPrecision(18),maxy:c.top.toPrecision(18),SRS:a.projection})),b.appendChild(this.createElementDefaultNS("Title",a.title)),a.keywords&&b.appendChild(this.write_wmc_KeywordList(a.keywords)),a.abstract&&b.appendChild(this.createElementDefaultNS("Abstract",a.abstract)),a.logo&&b.appendChild(this.write_wmc_URLType("LogoURL",a.logo.href,a.logo)),a.descriptionURL&&b.appendChild(this.write_wmc_URLType("DescriptionURL",a.descriptionURL)),a.contactInformation&&b.appendChild(this.write_wmc_ContactInformation(a.contactInformation)),b.appendChild(this.write_ol_MapExtension(a)),b},write_wmc_KeywordList:function(a){for(var b=this.createElementDefaultNS("KeywordList"),c=0,d=a.length;c<d;c++)b.appendChild(this.createElementDefaultNS("Keyword",a[c]));return b},write_wmc_ContactInformation:function(a){var b=this.createElementDefaultNS("ContactInformation");return a.personPrimary&&b.appendChild(this.write_wmc_ContactPersonPrimary(a.personPrimary)),a.position&&b.appendChild(this.createElementDefaultNS("ContactPosition",a.position)),a.contactAddress&&b.appendChild(this.write_wmc_ContactAddress(a.contactAddress)),a.phone&&b.appendChild(this.createElementDefaultNS("ContactVoiceTelephone",a.phone)),a.fax&&b.appendChild(this.createElementDefaultNS("ContactFacsimileTelephone",a.fax)),a.email&&b.appendChild(this.createElementDefaultNS("ContactElectronicMailAddress",a.email)),b},write_wmc_ContactPersonPrimary:function(a){var b=this.createElementDefaultNS("ContactPersonPrimary");return a.person&&b.appendChild(this.createElementDefaultNS("ContactPerson",a.person)),a.organization&&b.appendChild(this.createElementDefaultNS("ContactOrganization",a.organization)),b},write_wmc_ContactAddress:function(a){var b=this.createElementDefaultNS("ContactAddress");return a.type&&b.appendChild(this.createElementDefaultNS("AddressType",a.type)),a.address&&b.appendChild(this.createElementDefaultNS("Address",a.address)),a.city&&b.appendChild(this.createElementDefaultNS("City",a.city)),a.stateOrProvince&&b.appendChild(this.createElementDefaultNS("StateOrProvince",a.stateOrProvince)),a.postcode&&b.appendChild(this.createElementDefaultNS("PostCode",a.postcode)),a.country&&b.appendChild(this.createElementDefaultNS("Country",a.country)),b},write_ol_MapExtension:function(a){var b=this.createElementDefaultNS("Extension"),c=a.maxExtent;if(c){var d=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(d,{minx:c.left.toPrecision(18),miny:c.bottom.toPrecision(18),maxx:c.right.toPrecision(18),maxy:c.top.toPrecision(18)}),b.appendChild(d)}return b},write_wmc_LayerList:function(a){for(var b=this.createElementDefaultNS("LayerList"),c=0,d=a.layersContext.length;c<d;++c)b.appendChild(this.write_wmc_Layer(a.layersContext[c]));return b},write_wmc_Layer:function(a){var b=this.createElementDefaultNS("Layer",null,{queryable:a.queryable?"1":"0",hidden:a.visibility?"0":"1"});return b.appendChild(this.write_wmc_Server(a)),b.appendChild(this.createElementDefaultNS("Name",a.name)),b.appendChild(this.createElementDefaultNS("Title",a.title)),a.abstract&&b.appendChild(this.createElementDefaultNS("Abstract",a.abstract)),a.dataURL&&b.appendChild(this.write_wmc_URLType("DataURL",a.dataURL)),a.metadataURL&&b.appendChild(this.write_wmc_URLType("MetadataURL",a.metadataURL)),b},write_wmc_LayerExtension:function(a){var b=this.createElementDefaultNS("Extension"),c=a.maxExtent,d=this.createElementNS(this.namespaces.ol,"ol:maxExtent");if(this.setAttributes(d,{minx:c.left.toPrecision(18),miny:c.bottom.toPrecision(18),maxx:c.right.toPrecision(18),maxy:c.top.toPrecision(18)}),b.appendChild(d),a.tileSize&&!a.singleTile){var e=this.createElementNS(this.namespaces.ol,"ol:tileSize");this.setAttributes(e,a.tileSize),b.appendChild(e)}for(var f,g=["transparent","numZoomLevels","units","isBaseLayer","opacity","displayInLayerSwitcher","singleTile"],h=0,i=g.length;h<i;++h)(f=this.createOLPropertyNode(a,g[h]))&&b.appendChild(f);return b},createOLPropertyNode:function(a,b){var c=null;return null!=a[b]&&(c=this.createElementNS(this.namespaces.ol,"ol:"+b),c.appendChild(this.createTextNode(a[b].toString()))),c},write_wmc_Server:function(a){var b=a.server,c=this.createElementDefaultNS("Server"),d={service:"OGC:WMS",version:b.version};return b.title&&(d.title=b.title),this.setAttributes(c,d),c.appendChild(this.write_wmc_OnlineResource(b.url)),c},write_wmc_URLType:function(a,b,c){var d=this.createElementDefaultNS(a);if(d.appendChild(this.write_wmc_OnlineResource(b)),c)for(var e=["width","height","format"],f=0;f<e.length;f++)e[f]in c&&d.setAttribute(e[f],c[e[f]]);return d},write_wmc_DimensionList:function(a){var b=this.createElementDefaultNS("DimensionList");for(var c in a.dimensions){var d={},e=a.dimensions[c];for(var f in e)"boolean"==typeof e[f]?d[f]=Number(e[f]):d[f]=e[f];var g="";d.values&&(g=d.values.join(","),delete d.values),b.appendChild(this.createElementDefaultNS("Dimension",g,d))}return b},write_wmc_FormatList:function(a){for(var b=this.createElementDefaultNS("FormatList"),c=0,d=a.formats.length;c<d;c++){var e=a.formats[c];b.appendChild(this.createElementDefaultNS("Format",e.value,e.current&&1==e.current?{current:"1"}:null))}return b},write_wmc_StyleList:function(a){var b=this.createElementDefaultNS("StyleList"),c=a.styles;if(c&&OpenLayers.Util.isArray(c))for(var d,e=0,f=c.length;e<f;e++){var g=c[e],h=this.createElementDefaultNS("Style",null,g.current&&1==g.current?{current:"1"}:null);if(g.href){d=this.createElementDefaultNS("SLD"),g.name&&d.appendChild(this.createElementDefaultNS("Name",g.name)),g.title&&d.appendChild(this.createElementDefaultNS("Title",g.title)),g.legend&&d.appendChild(this.write_wmc_URLType("LegendURL",g.legend.href,g.legend));var i=this.write_wmc_OnlineResource(g.href);d.appendChild(i),h.appendChild(d)}else if(g.body){d=this.createElementDefaultNS("SLD"),g.name&&d.appendChild(this.createElementDefaultNS("Name",g.name)),g.title&&d.appendChild(this.createElementDefaultNS("Title",g.title)),g.legend&&d.appendChild(this.write_wmc_URLType("LegendURL",g.legend.href,g.legend));var j=OpenLayers.Format.XML.prototype.read.apply(this,[g.body]),k=j.documentElement;d.ownerDocument&&d.ownerDocument.importNode&&(k=d.ownerDocument.importNode(k,!0)),d.appendChild(k),h.appendChild(d)}else h.appendChild(this.createElementDefaultNS("Name",g.name)),h.appendChild(this.createElementDefaultNS("Title",g.title)),g.abstract&&h.appendChild(this.createElementDefaultNS("Abstract",g.abstract)),g.legend&&h.appendChild(this.write_wmc_URLType("LegendURL",g.legend.href,g.legend));b.appendChild(h)}return b},write_wmc_OnlineResource:function(a){var b=this.createElementDefaultNS("OnlineResource");return this.setAttributeNS(b,this.namespaces.xlink,"xlink:type","simple"),this.setAttributeNS(b,this.namespaces.xlink,"xlink:href",a),b},getOnlineResource_href:function(a){var b={},c=a.getElementsByTagName("OnlineResource");return c.length>0&&this.read_wmc_OnlineResource(b,c[0]),b.href},CLASS_NAME:"OpenLayers.Format.WMC.v1"}),OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{slideFactor:50,slideRatio:null,initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]);var a={slideFactor:this.slideFactor,slideRatio:this.slideRatio};this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST,a)])},CLASS_NAME:"OpenLayers.Control.PanPanel"}),OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",template:"${layers}",destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this}),this.updateAttribution(),this.div},updateAttribution:function(){var a=[];if(this.map&&this.map.layers){for(var b=0,c=this.map.layers.length;b<c;b++){var d=this.map.layers[b];d.attribution&&d.getVisibility()&&-1===OpenLayers.Util.indexOf(a,d.attribution)&&a.push(d.attribution)}this.div.innerHTML=OpenLayers.String.format(this.template,{layers:a.join(this.separator)})}},CLASS_NAME:"OpenLayers.Control.Attribution"}),OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(a){OpenLayers.Util.extend(this,a)},begin:function(){OpenLayers.Animation.stop(this.timerId),this.timerId=void 0,this.points=[]},update:function(a){this.points.unshift({xy:a,tick:(new Date).getTime()}),this.points.length>this.nbPoints&&this.points.pop()},end:function(a){for(var b,c,d=(new Date).getTime(),e=0,f=this.points.length;e<f&&(c=this.points[e],!(d-c.tick>this.delay));e++)b=c;if(b){var g=(new Date).getTime()-b.tick,h=Math.sqrt(Math.pow(a.x-b.xy.x,2)+Math.pow(a.y-b.xy.y,2)),i=h/g;if(!(0==i||i<this.threshold)){var j=Math.asin((a.y-b.xy.y)/h);return b.xy.x<=a.x&&(j=Math.PI-j),{speed:i,theta:j}}}},move:function(a,b){var c=a.speed,d=Math.cos(a.theta),e=-Math.sin(a.theta),f=(new Date).getTime(),g=0,h=0,i=function(){if(null!=this.timerId){var a=(new Date).getTime()-f,i=-this.deceleration*Math.pow(a,2)/2+c*a,j=i*d,k=i*e,l={};l.end=!1;-this.deceleration*a+c<=0&&(OpenLayers.Animation.stop(this.timerId),this.timerId=null,l.end=!0),l.x=j-g,l.y=k-h,g=j,h=k,b(l.x,l.y,l.end)}};this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(i,this))},CLASS_NAME:"OpenLayers.Kinetic"}),OpenLayers.Layer.GeoRSS=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:!0,initialize:function(a,b,c){OpenLayers.Layer.Markers.prototype.initialize.apply(this,[a,c]),this.location=b,this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments),this.clearFeatures(),this.features=null},loadRSS:function(){this.loaded||(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,scope:this}),this.loaded=!0)},moveTo:function(a,b,c){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments),this.visibility&&!this.loaded&&this.loadRSS()},parseData:function(a){var b=a.responseXML;if(b&&b.documentElement||(b=OpenLayers.Format.XML.prototype.read(a.responseText)),this.useFeedTitle){var c=null;try{c=b.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue}catch(a){c=b.getElementsByTagName("title")[0].firstChild.nodeValue}c&&this.setName(c)}var d={};OpenLayers.Util.extend(d,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(d.externalProjection=this.projection,d.internalProjection=this.map.getProjectionObject());for(var e=new OpenLayers.Format.GeoRSS(d),f=e.read(b),g=0,h=f.length;g<h;g++){var i={},j=f[g];if(j.geometry){var k=j.attributes.title?j.attributes.title:"Untitled",l=j.attributes.description?j.attributes.description:"No description.",m=j.attributes.link?j.attributes.link:"",n=j.geometry.getBounds().getCenterLonLat();if(i.icon=null==this.icon?OpenLayers.Marker.defaultIcon():this.icon.clone(),i.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120),k||l){i.title=k,i.description=l;var o='<div class="olLayerGeoRSSClose">[x]</div>';o+='<div class="olLayerGeoRSSTitle">',m&&(o+='<a class="link" href="'+m+'" target="_blank">'),o+=k,m&&(o+="</a>"),o+="</div>",o+='<div style="" class="olLayerGeoRSSDescription">',o+=l,o+="</div>",i.popupContentHTML=o}var j=new OpenLayers.Feature(this,n,i);this.features.push(j);var p=j.createMarker();p.events.register("click",j,this.markerClick),this.addMarker(p)}}this.events.triggerEvent("loadend")},markerClick:function(a){var b=this==this.layer.selectedFeature;this.layer.selectedFeature=b?null:this;for(var c=0,d=this.layer.map.popups.length;c<d;c++)this.layer.map.removePopup(this.layer.map.popups[c]);if(!b){var e=this.createPopup();OpenLayers.Event.observe(e.div,"click",OpenLayers.Function.bind(function(){for(var a=0,b=this.layer.map.popups.length;a<b;a++)this.layer.map.removePopup(this.layer.map.popups[a])},this)),this.layer.map.addPopup(e)}OpenLayers.Event.stop(a)},clearFeatures:function(){if(null!=this.features)for(;this.features.length>0;){var a=this.features[0];OpenLayers.Util.removeItem(this.features,a),a.destroy()}},CLASS_NAME:"OpenLayers.Layer.GeoRSS"}),OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(a,b){this.readChildNodes(a,b)},LayerLimit:function(a,b){b.layerLimit=parseInt(this.getChildValue(a))},MaxWidth:function(a,b){b.maxWidth=parseInt(this.getChildValue(a))},MaxHeight:function(a,b){b.maxHeight=parseInt(this.getChildValue(a))},BoundingBox:function(a,b){var c=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[a,b]);c.srs=a.getAttribute("CRS"),b.bbox[c.srs]=c},CRS:function(a,b){this.readers.wms.SRS.apply(this,[a,b])},EX_GeographicBoundingBox:function(a,b){b.llbbox=[],this.readChildNodes(a,b.llbbox)},westBoundLongitude:function(a,b){b[0]=this.getChildValue(a)},eastBoundLongitude:function(a,b){b[2]=this.getChildValue(a)},southBoundLatitude:function(a,b){b[1]=this.getChildValue(a)},northBoundLatitude:function(a,b){b[3]=this.getChildValue(a)},MinScaleDenominator:function(a,b){b.maxScale=parseFloat(this.getChildValue(a)).toPrecision(16)},MaxScaleDenominator:function(a,b){b.minScale=parseFloat(this.getChildValue(a)).toPrecision(16)},Dimension:function(a,b){var c=a.getAttribute("name").toLowerCase(),d={name:c,units:a.getAttribute("units"),unitsymbol:a.getAttribute("unitSymbol"),nearestVal:"1"===a.getAttribute("nearestValue"),multipleVal:"1"===a.getAttribute("multipleValues"),default:a.getAttribute("default")||"",current:"1"===a.getAttribute("current"),values:this.getChildValue(a).split(",")};b.dimensions[d.name]=d},Keyword:function(a,b){var c={value:this.getChildValue(a),vocabulary:a.getAttribute("vocabulary")};b.keywords&&b.keywords.push(c)}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(a,b){this.readers.wms.UserDefinedSymbolization.apply(this,[a,b]),b.userSymbols.inlineFeature=1==parseInt(a.getAttribute("InlineFeature")),b.userSymbols.remoteWCS=1==parseInt(a.getAttribute("RemoteWCS"))},DescribeLayer:function(a,b){this.readers.wms.DescribeLayer.apply(this,[a,b])},GetLegendGraphic:function(a,b){this.readers.wms.GetLegendGraphic.apply(this,[a,b])}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"}),OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function(){"number"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,initialize:function(a,b,c,d,e,f){null==a&&(a=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")),this.id=a,this.lonlat=b,this.contentSize=null!=c?c:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT),null!=d&&(this.contentHTML=d),this.backgroundColor=OpenLayers.Popup.COLOR,this.opacity=OpenLayers.Popup.OPACITY,this.border=OpenLayers.Popup.BORDER,this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden"),this.div.className=this.displayClass;var g=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(g,null,null,null,"relative",null,"hidden");var a=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(a,null,this.contentSize.clone(),null,"relative"),this.contentDiv.className=this.contentDisplayClass,this.groupDiv.appendChild(this.contentDiv),this.div.appendChild(this.groupDiv),e&&this.addCloseBox(f),this.registerEvents()},destroy:function(){this.id=null,this.lonlat=null,this.size=null,this.contentHTML=null,this.backgroundColor=null,this.opacity=null,this.border=null,this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide),this.events.destroy(),this.events=null,this.closeDiv&&(OpenLayers.Event.stopObservingElement(this.closeDiv),this.groupDiv.removeChild(this.closeDiv)),this.closeDiv=null,this.div.removeChild(this.groupDiv),this.groupDiv=null,null!=this.map&&this.map.removePopup(this),this.map=null,this.div=null,this.autoSize=null,this.minSize=null,this.maxSize=null,this.padding=null,this.panMapIfOutOfView=null},draw:function(a){return null==a&&null!=this.lonlat&&null!=this.map&&(a=this.map.getLayerPxFromLonLat(this.lonlat)),this.closeOnMove&&this.map.events.register("movestart",this,this.hide),this.disableFirefoxOverflowHack||"firefox"!=OpenLayers.BROWSER_NAME||(this.map.events.register("movestart",this,function(){var a=document.defaultView.getComputedStyle(this.contentDiv,null),b=a.getPropertyValue("overflow");"hidden"!=b&&(this.contentDiv._oldOverflow=b,this.contentDiv.style.overflow="hidden")}),this.map.events.register("moveend",this,function(){var a=this.contentDiv._oldOverflow;a&&(this.contentDiv.style.overflow=a,this.contentDiv._oldOverflow=null)})),this.moveTo(a),this.autoSize||this.size||this.setSize(this.contentSize),this.setBackgroundColor(),this.setOpacity(),this.setBorder(),this.setContentHTML(),this.panMapIfOutOfView&&this.panIntoView(),this.div},updatePosition:function(){if(this.lonlat&&this.map){var a=this.map.getLayerPxFromLonLat(this.lonlat);a&&this.moveTo(a)}},moveTo:function(a){null!=a&&null!=this.div&&(this.div.style.left=a.x+"px",this.div.style.top=a.y+"px")},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){this.visible()?this.hide():this.show()},show:function(){this.div.style.display="",this.panMapIfOutOfView&&this.panIntoView()},hide:function(){this.div.style.display="none"},setSize:function(a){this.size=a.clone();var b=this.getContentDivPadding(),c=b.left+b.right,d=b.top+b.bottom;if(this.fixPadding(),c+=this.padding.left+this.padding.right,d+=this.padding.top+this.padding.bottom,this.closeDiv){c+=parseInt(this.closeDiv.style.width)+b.right}this.size.w+=c,this.size.h+=d,"msie"==OpenLayers.BROWSER_NAME&&(this.contentSize.w+=b.left+b.right,this.contentSize.h+=b.bottom+b.top),null!=this.div&&(this.div.style.width=this.size.w+"px",this.div.style.height=this.size.h+"px"),null!=this.contentDiv&&(this.contentDiv.style.width=a.w+"px",this.contentDiv.style.height=a.h+"px")},updateSize:function(){var a="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",b=this.map?this.map.div:document.body,c=OpenLayers.Util.getRenderedDimensions(a,null,{displayClass:this.displayClass,containerElement:b}),d=this.getSafeContentSize(c),e=null;if(d.equals(c))e=c;else{var f={w:d.w<c.w?d.w:null,h:d.h<c.h?d.h:null};if(f.w&&f.h)e=d;else{var g=OpenLayers.Util.getRenderedDimensions(a,f,{displayClass:this.contentDisplayClass,containerElement:b});if("hidden"!=OpenLayers.Element.getStyle(this.contentDiv,"overflow")&&g.equals(d)){var h=OpenLayers.Util.getScrollbarWidth();f.w?g.h+=h:g.w+=h}e=this.getSafeContentSize(g)}}this.setSize(e)},setBackgroundColor:function(a){void 0!=a&&(this.backgroundColor=a),null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(a){void 0!=a&&(this.opacity=a),null!=this.div&&(this.div.style.opacity=this.opacity,this.div.style.filter="alpha(opacity="+100*this.opacity+")")},setBorder:function(a){void 0!=a&&(this.border=a),null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(a){null!=a&&(this.contentHTML=a),null!=this.contentDiv&&null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML&&(this.contentDiv.innerHTML=this.contentHTML,this.autoSize&&(this.registerImageListeners(),this.updateSize()))},registerImageListeners:function(){for(var a=function(){null!==this.popup.id&&(this.popup.updateSize(),this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView(),OpenLayers.Event.stopObserving(this.img,"load",this.img._onImgLoad))},b=this.contentDiv.getElementsByTagName("img"),c=0,d=b.length;c<d;c++){var e=b[c];if(0==e.width||0==e.height){var f={popup:this,img:e};e._onImgLoad=OpenLayers.Function.bind(a,f),OpenLayers.Event.observe(e,"load",e._onImgLoad)}}},getSafeContentSize:function(a){var b=a.clone(),c=this.getContentDivPadding(),d=c.left+c.right,e=c.top+c.bottom;if(this.fixPadding(),d+=this.padding.left+this.padding.right,e+=this.padding.top+this.padding.bottom,this.closeDiv){d+=parseInt(this.closeDiv.style.width)+c.right}if(this.minSize&&(b.w=Math.max(b.w,this.minSize.w-d),b.h=Math.max(b.h,this.minSize.h-e)),this.maxSize&&(b.w=Math.min(b.w,this.maxSize.w-d),b.h=Math.min(b.h,this.maxSize.h-e)),this.map&&this.map.size){var f=0,g=0;if(this.keepInMap&&!this.panMapIfOutOfView){var h=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":f=h.x,g=this.map.size.h-h.y;break;case"tl":f=this.map.size.w-h.x,g=this.map.size.h-h.y;break;case"bl":f=this.map.size.w-h.x,g=h.y;break;case"br":f=h.x,g=h.y;break;default:f=h.x,g=this.map.size.h-h.y}}var i=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-e-g,j=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-d-f;b.w=Math.min(b.w,j),b.h=Math.min(b.h,i)}return b},getContentDivPadding:function(){var a=this._contentDivPadding;return a||(null==this.div.parentNode&&(this.div.style.display="none",document.body.appendChild(this.div)),a=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top")),this._contentDivPadding=a,this.div.parentNode==document.body&&(document.body.removeChild(this.div),this.div.style.display="")),a},addCloseBox:function(a){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,{w:17,h:17}),this.closeDiv.className="olPopupCloseBox";var b=this.getContentDivPadding();this.closeDiv.style.right=b.right+"px",this.closeDiv.style.top=b.top+"px",this.groupDiv.appendChild(this.closeDiv);var c=a||function(a){this.hide(),OpenLayers.Event.stop(a)};OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(c,this)),OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(c,this))},panIntoView:function(){var a=this.map.getSize(),b=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),c=b.clone();b.x<this.map.paddingForPopups.left?c.x=this.map.paddingForPopups.left:b.x+this.size.w>a.w-this.map.paddingForPopups.right&&(c.x=a.w-this.map.paddingForPopups.right-this.size.w),b.y<this.map.paddingForPopups.top?c.y=this.map.paddingForPopups.top:b.y+this.size.h>a.h-this.map.paddingForPopups.bottom&&(c.y=a.h-this.map.paddingForPopups.bottom-this.size.h);var d=b.x-c.x,e=b.y-c.y;this.map.pan(d,e)},registerEvents:function(){function a(a){OpenLayers.Event.stop(a,!0)}this.events=new OpenLayers.Events(this,this.div,null,!0),this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:a,scope:this})},onmousedown:function(a){this.mousedown=!0,OpenLayers.Event.stop(a,!0)},onmousemove:function(a){this.mousedown&&OpenLayers.Event.stop(a,!0)},onmouseup:function(a){this.mousedown&&(this.mousedown=!1,OpenLayers.Event.stop(a,!0))},onclick:function(a){OpenLayers.Event.stop(a,!0)},onmouseout:function(a){this.mousedown=!1},ondblclick:function(a){OpenLayers.Event.stop(a,!0)},CLASS_NAME:"OpenLayers.Popup"}),OpenLayers.Popup.WIDTH=200,OpenLayers.Popup.HEIGHT=200,OpenLayers.Popup.COLOR="white",OpenLayers.Popup.OPACITY=1,OpenLayers.Popup.BORDER="0px",OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:!0,anchor:null,initialize:function(a,b,c,d,e,f,g){var h=[a,b,c,d,f,g];OpenLayers.Popup.prototype.initialize.apply(this,h),this.anchor=null!=e?e:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.anchor=null,this.relativePosition=null,OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition(),OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(a){var b=this.relativePosition;this.relativePosition=this.calculateRelativePosition(a),OpenLayers.Popup.prototype.moveTo.call(this,this.calculateNewPx(a)),this.relativePosition!=b&&this.updateRelativePosition()},setSize:function(a){
if(OpenLayers.Popup.prototype.setSize.apply(this,arguments),this.lonlat&&this.map){var b=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(b)}},calculateRelativePosition:function(a){var b=this.map.getLonLatFromLayerPx(a),c=this.map.getExtent(),d=c.determineQuadrant(b);return OpenLayers.Bounds.oppositeQuadrant(d)},updateRelativePosition:function(){},calculateNewPx:function(a){var b=a.offset(this.anchor.offset),c=this.size||this.contentSize,d="t"==this.relativePosition.charAt(0);b.y+=d?-c.h:this.anchor.size.h;var e="l"==this.relativePosition.charAt(1);return b.x+=e?-c.w:this.anchor.size.w,b},CLASS_NAME:"OpenLayers.Popup.Anchored"}),OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:!1,positionBlocks:null,blocks:null,fixedRelativePosition:!1,initialize:function(a,b,c,d,e,f,g){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments),this.fixedRelativePosition&&(this.updateRelativePosition(),this.calculateRelativePosition=function(a){return this.relativePosition}),this.contentDiv.style.position="absolute",this.contentDiv.style.zIndex=1,f&&(this.closeDiv.style.zIndex=1),this.groupDiv.style.position="absolute",this.groupDiv.style.top="0px",this.groupDiv.style.left="0px",this.groupDiv.style.height="100%",this.groupDiv.style.width="100%"},destroy:function(){this.imageSrc=null,this.imageSize=null,this.isAlphaImage=null,this.fixedRelativePosition=!1,this.positionBlocks=null;for(var a=0;a<this.blocks.length;a++){var b=this.blocks[a];b.image&&b.div.removeChild(b.image),b.image=null,b.div&&this.groupDiv.removeChild(b.div),b.div=null}this.blocks=null,OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(a){},setBorder:function(){},setOpacity:function(a){},setSize:function(a){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments),this.updateBlocks()},updateRelativePosition:function(){if(this.padding=this.positionBlocks[this.relativePosition].padding,this.closeDiv){var a=this.getContentDivPadding();this.closeDiv.style.right=a.right+this.padding.right+"px",this.closeDiv.style.top=a.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(a){var b=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);return b=b.offset(this.positionBlocks[this.relativePosition].offset)},createBlocks:function(){this.blocks=[];var a=null;for(var b in this.positionBlocks){a=b;break}for(var c=this.positionBlocks[a],d=0;d<c.blocks.length;d++){var e={};this.blocks.push(e);var f=this.id+"_FrameDecorationDiv_"+d;e.div=OpenLayers.Util.createDiv(f,null,null,null,"absolute",null,"hidden",null);var g=this.id+"_FrameDecorationImg_"+d,h=this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;e.image=h(g,null,this.imageSize,this.imageSrc,"absolute",null,null,null),e.div.appendChild(e.image),this.groupDiv.appendChild(e.div)}},updateBlocks:function(){if(this.blocks||this.createBlocks(),this.size&&this.relativePosition){for(var a=this.positionBlocks[this.relativePosition],b=0;b<a.blocks.length;b++){var c=a.blocks[b],d=this.blocks[b],e=c.anchor.left,f=c.anchor.bottom,g=c.anchor.right,h=c.anchor.top,i=isNaN(c.size.w)?this.size.w-(g+e):c.size.w,j=isNaN(c.size.h)?this.size.h-(f+h):c.size.h;d.div.style.width=(i<0?0:i)+"px",d.div.style.height=(j<0?0:j)+"px",d.div.style.left=null!=e?e+"px":"",d.div.style.bottom=null!=f?f+"px":"",d.div.style.right=null!=g?g+"px":"",d.div.style.top=null!=h?h+"px":"",d.image.style.left=c.position.x+"px",d.image.style.top=c.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px",this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"}),OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(a,b,c){if(OpenLayers.Handler.prototype.initialize.apply(this,arguments),!0===this.documentDrag){var d=this;this._docMove=function(a){d.mousemove({xy:{x:a.clientX,y:a.clientY},element:document})},this._docUp=function(a){d.mouseup({xy:{x:a.clientX,y:a.clientY}})}}},dragstart:function(a){var b=!0;return this.dragging=!1,this.checkModifiers(a)&&(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))?(this.started=!0,this.start=a.xy,this.last=a.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(a),this.callback("down",[a.xy]),OpenLayers.Event.preventDefault(a),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,b=!this.stopDown):(this.started=!1,this.start=null,this.last=null),b},dragmove:function(a){return this.lastMoveEvt=a,!this.started||this.timeoutId||a.xy.x==this.last.x&&a.xy.y==this.last.y||(!0===this.documentDrag&&this.documentEvents&&(a.element===document?(this.adjustXY(a),this.setEvent(a)):this.removeDocumentEvents()),this.interval>0&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(a),this.callback("move",[a.xy]),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart,document.onselectstart=OpenLayers.Function.False),this.last=a.xy),!0},dragend:function(a){if(this.started){!0===this.documentDrag&&this.documentEvents&&(this.adjustXY(a),this.removeDocumentEvents());var b=this.start!=this.last;this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.up(a),this.callback("up",[a.xy]),b&&this.callback("done",[a.xy]),document.onselectstart=this.oldOnselectstart}return!0},down:function(a){},move:function(a){},up:function(a){},out:function(a){},mousedown:function(a){return this.dragstart(a)},touchstart:function(a){return this.startTouch(),this.dragstart(a)},mousemove:function(a){return this.dragmove(a)},touchmove:function(a){return this.dragmove(a)},removeTimeout:function(){this.timeoutId=null,this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(a){return this.dragend(a)},touchend:function(a){return a.xy=this.last,this.dragend(a)},mouseout:function(a){if(this.started&&OpenLayers.Util.mouseLeft(a,this.map.viewPortDiv))if(!0===this.documentDrag)this.addDocumentEvents();else{var b=this.start!=this.last;this.started=!1,this.dragging=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.out(a),this.callback("out",[]),b&&this.callback("done",[a.xy]),document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}return!0},click:function(a){return this.start==this.last},activate:function(){var a=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragging=!1,a=!0),a},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.started=!1,this.dragging=!1,this.start=null,this.last=null,a=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")),a},adjustXY:function(a){var b=OpenLayers.Util.pagePosition(this.map.viewPortDiv);a.xy.x-=b[0],a.xy.y-=b[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown"),this.documentEvents=!0,OpenLayers.Event.observe(document,"mousemove",this._docMove),OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown"),this.documentEvents=!1,OpenLayers.Event.stopObserving(document,"mousemove",this._docMove),OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"}),OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(a,b,c){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.dragHandler&&(this.dragHandler.destroy(),this.dragHandler=null)},setMap:function(a){OpenLayers.Handler.prototype.setMap.apply(this,arguments),this.dragHandler&&this.dragHandler.setMap(a)},startBox:function(a){this.callback("start",[]),this.zoomBox=OpenLayers.Util.createDiv("zoomBox",{x:-9999,y:-9999}),this.zoomBox.className=this.boxDivClassName,this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.viewPortDiv.appendChild(this.zoomBox),OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(a){var b=this.dragHandler.start.x,c=this.dragHandler.start.y,d=Math.abs(b-a.x),e=Math.abs(c-a.y),f=this.getBoxOffsets();this.zoomBox.style.width=d+f.width+1+"px",this.zoomBox.style.height=e+f.height+1+"px",this.zoomBox.style.left=(a.x<b?b-d-f.left:b-f.left)+"px",this.zoomBox.style.top=(a.y<c?c-e-f.top:c-f.top)+"px"},endBox:function(a){var b;if(Math.abs(this.dragHandler.start.x-a.x)>5||Math.abs(this.dragHandler.start.y-a.y)>5){var c=this.dragHandler.start,d=Math.min(c.y,a.y),e=Math.max(c.y,a.y),f=Math.min(c.x,a.x),g=Math.max(c.x,a.x);b=new OpenLayers.Bounds(f,e,g,d)}else b=this.dragHandler.start.clone();this.removeBox(),this.callback("done",[b])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox),this.zoomBox=null,this.boxOffsets=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){return!!OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragHandler.activate(),!0)},deactivate:function(){return!!OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.dragHandler.deactivate()&&this.zoomBox&&this.removeBox(),!0)},getBoxOffsets:function(){if(!this.boxOffsets){var a=document.createElement("div");a.style.position="absolute",a.style.border="1px solid black",a.style.width="3px",document.body.appendChild(a);var b=3==a.clientWidth;document.body.removeChild(a);var c=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width")),d=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width")),e=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width")),f=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:c,right:d,top:e,bottom:f,width:!1===b?c+d:0,height:!1===b?e+f:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"}),OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:!1,keyMask:null,alwaysZoom:!1,zoomOnClick:!0,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(a){if(a instanceof OpenLayers.Bounds){var b,c=a.getCenterPixel();if(this.out){var d=a.right-a.left,e=a.bottom-a.top,f=Math.min(this.map.size.h/e,this.map.size.w/d),g=this.map.getExtent(),h=this.map.getLonLatFromPixel(c),i=h.lon-g.getWidth()/2*f,j=h.lon+g.getWidth()/2*f,k=h.lat-g.getHeight()/2*f,l=h.lat+g.getHeight()/2*f;b=new OpenLayers.Bounds(i,k,j,l)}else{var m=this.map.getLonLatFromPixel({x:a.left,y:a.bottom}),n=this.map.getLonLatFromPixel({x:a.right,y:a.top});b=new OpenLayers.Bounds(m.lon,m.lat,n.lon,n.lat)}var o=this.map.getZoom(),p=this.map.getSize(),q={x:p.w/2,y:p.h/2},r=this.map.getZoomForExtent(b),s=this.map.getResolution(),t=this.map.getResolutionForZoom(r);if(s==t)this.map.setCenter(this.map.getLonLatFromPixel(c));else{var u={x:(s*c.x-t*q.x)/(s-t),y:(s*c.y-t*q.y)/(s-t)};this.map.zoomTo(r,u)}o==this.map.getZoom()&&1==this.alwaysZoom&&this.map.zoomTo(o+(this.out?-1:1))}else this.zoomOnClick&&(this.out?this.map.zoomTo(this.map.getZoom()-1,a):this.map.zoomTo(this.map.getZoom()+1,a))},CLASS_NAME:"OpenLayers.Control.ZoomBox"}),OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:0,documentDrag:!1,kinetic:null,enableKinetic:!0,kineticInterval:10,draw:function(){if(this.enableKinetic&&OpenLayers.Kinetic){var a={interval:this.kineticInterval};"object"==typeof this.enableKinetic&&(a=OpenLayers.Util.extend(a,this.enableKinetic)),this.kinetic=new OpenLayers.Kinetic(a)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(a){this.kinetic&&this.kinetic.update(a),this.panned=!0,this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:!0,animate:!1})},panMapDone:function(a){if(this.panned){var b=null;if(this.kinetic&&(b=this.kinetic.end(a)),this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:!!b,animate:!1}),b){var c=this;this.kinetic.move(b,function(a,b,d){c.map.pan(a,b,{dragging:!d,animate:!1})})}this.panned=!1}},CLASS_NAME:"OpenLayers.Control.DragPan"}),OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,double:!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(a){return this.startTouch(),this.down=this.getEventInfo(a),this.last=this.getEventInfo(a),!0},touchmove:function(a){return this.last=this.getEventInfo(a),!0},touchend:function(a){return this.down&&(a.xy=this.last.xy,a.lastTouches=this.last.touches,this.handleSingle(a),this.down=null),!0},mousedown:function(a){return this.down=this.getEventInfo(a),this.last=this.getEventInfo(a),!0},mouseup:function(a){var b=!0;return this.checkModifiers(a)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(a)&&(b=this.rightclick(a)),b},rightclick:function(a){if(this.passesTolerance(a)){if(null!=this.rightclickTimerId)return this.clearTimer(),this.callback("dblrightclick",[a]),!this.stopDouble;var b=this.double?OpenLayers.Util.extend({},a):this.callback("rightclick",[a]),c=OpenLayers.Function.bind(this.delayedRightCall,this,b);this.rightclickTimerId=window.setTimeout(c,this.delay)}return!this.stopSingle},delayedRightCall:function(a){this.rightclickTimerId=null,a&&this.callback("rightclick",[a])},click:function(a){return this.last||(this.last=this.getEventInfo(a)),this.handleSingle(a),!this.stopSingle},dblclick:function(a){return this.handleDouble(a),!this.stopDouble},handleDouble:function(a){this.passesDblclickTolerance(a)&&(this.double&&this.callback("dblclick",[a]),this.clearTimer())},handleSingle:function(a){if(this.passesTolerance(a))if(null!=this.timerId)this.last.touches&&1===this.last.touches.length&&(this.double&&OpenLayers.Event.preventDefault(a),this.handleDouble(a)),this.last.touches&&2===this.last.touches.length||this.clearTimer();else{this.first=this.getEventInfo(a);var b=this.single?OpenLayers.Util.extend({},a):null;this.queuePotentialClick(b)}},queuePotentialClick:function(a){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay)},passesTolerance:function(a){var b=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(b=this.pixelTolerance>=this.down.xy.distanceTo(a.xy))&&this.touch&&this.down.touches.length===this.last.touches.length)for(var c=0,d=this.down.touches.length;c<d;++c)if(this.getTouchDistance(this.down.touches[c],this.last.touches[c])>this.pixelTolerance){b=!1;break}return b},getTouchDistance:function(a,b){return Math.sqrt(Math.pow(a.clientX-b.clientX,2)+Math.pow(a.clientY-b.clientY,2))},passesDblclickTolerance:function(a){var b=!0;return this.down&&this.first&&(b=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance),b},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),null!=this.rightclickTimerId&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(a){this.timerId=null,a&&this.callback("click",[a])},getEventInfo:function(a){var b;if(a.touches){var c=a.touches.length;b=new Array(c);for(var d,e=0;e<c;e++)d=a.touches[e],b[e]={clientX:d.olClientX,clientY:d.olClientY}}return{xy:a.xy,touches:b}},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),this.down=null,this.first=null,this.last=null,a=!0),a},CLASS_NAME:"OpenLayers.Handler.Click"}),OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,initialize:function(a){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.zoomBox&&this.zoomBox.destroy(),this.zoomBox=null,this.pinchZoom&&this.pinchZoom.destroy(),this.pinchZoom=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.dragPan.activate(),this.zoomWheelEnabled&&this.handlers.wheel.activate(),this.handlers.click.activate(),this.zoomBoxEnabled&&this.zoomBox.activate(),this.pinchZoom&&this.pinchZoom.activate(),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.pinchZoom&&this.pinchZoom.deactivate(),this.zoomBox.deactivate(),this.dragPan.deactivate(),this.handlers.click.deactivate(),this.handlers.wheel.deactivate(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);var a={click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},b={double:!0,stopDouble:!0};this.handlers.click=new OpenLayers.Handler.Click(this,a,b),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask}),this.dragPan.draw(),this.zoomBox.draw();var c=this.map.fractionalZoom?{}:{cumulative:!1,interval:50,maxDelta:6};this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},OpenLayers.Util.extend(c,this.mouseWheelOptions)),OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions)))},defaultClick:function(a){a.lastTouches&&2==a.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(a){this.map.zoomTo(this.map.zoom+1,a.xy)},defaultDblRightClick:function(a){this.map.zoomTo(this.map.zoom-1,a.xy)},wheelChange:function(a,b){this.map.fractionalZoom||(b=Math.round(b));var c=this.map.getZoom(),d=c+b;d=Math.max(d,0),(d=Math.min(d,this.map.getNumZoomLevels()))!==c&&this.map.zoomTo(d,a.xy)},wheelUp:function(a,b){this.wheelChange(a,b||1)},wheelDown:function(a,b){this.wheelChange(a,b||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1,this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0,this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1,this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0,this.active&&this.handlers.wheel.activate()},CLASS_NAME:"OpenLayers.Control.Navigation"}),OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{},initialize:function(a,b,c,d){var e=[];c=OpenLayers.Util.upperCaseObject(c),parseFloat(c.VERSION)>=1.3&&!c.EXCEPTIONS&&(c.EXCEPTIONS="INIMAGE"),e.push(a,b,c,d),OpenLayers.Layer.Grid.prototype.initialize.apply(this,e),OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),!this.noMagic&&this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()&&(null!=d&&d.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"))},clone:function(a){return null==a&&(a=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},reverseAxisOrder:function(){var a=this.projection.getCode();return parseFloat(this.params.VERSION)>=1.3&&!!(this.yx[a]||OpenLayers.Projection.defaults[a]&&OpenLayers.Projection.defaults[a].yx)},getURL:function(a){a=this.adjustBounds(a);var b=this.getImageSize(),c={},d=this.reverseAxisOrder();return c.BBOX=this.encodeBBOX?a.toBBOX(null,d):a.toArray(d),c.WIDTH=b.w,c.HEIGHT=b.h,this.getFullRequestString(c)},mergeNewParams:function(a){var b=OpenLayers.Util.upperCaseObject(a),c=[b];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,c)},getFullRequestString:function(a,b){var c=this.map.getProjectionObject(),d=this.projection&&this.projection.equals(c)?this.projection.getCode():c.getCode(),e="none"==d?null:d;return parseFloat(this.params.VERSION)>=1.3?this.params.CRS=e:this.params.SRS=e,"boolean"==typeof this.params.TRANSPARENT&&(a.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"),OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"}),OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(a,b,c,d){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(a){a=this.adjustBounds(a);var b=this.map.getResolution(),c=Math.round(1e4*this.map.getScale())/1e4,d=Math.round(a.left/b),e=-Math.round(a.top/b);return this.getFullRequestString({t:e,l:d,s:c})},calculateGridLayout:function(a,b,c){var d=c*this.tileSize.w,e=c*this.tileSize.h,f=a.left,g=Math.floor(f/d)-this.buffer,h=a.top;return{tilelon:d,tilelat:e,startcol:g,startrow:Math.floor(h/e)+this.buffer}},getTileBoundsForGridIndex:function(a,b){var c=(this.getTileOrigin(),this.gridLayout),d=c.tilelon,e=c.tilelat,f=(c.startcol+b)*d,g=(c.startrow-a)*e;return new OpenLayers.Bounds(f,g,f+d,g+e)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]),null!=this.tileSize&&(a.tileSize=this.tileSize.clone()),a.grid=[],a},getTileBounds:function(a){var b=this.getResolution(),c=b*this.tileSize.w,d=b*this.tileSize.h,e=this.getLonLatFromViewPortPx(a),f=c*Math.floor(e.lon/c),g=d*Math.floor(e.lat/d);return new OpenLayers.Bounds(f,g,f+c,g+d)},CLASS_NAME:"OpenLayers.Layer.KaMap"}),OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(a){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a])},read_sld_MinScaleDenominator:function(a,b){var c=parseFloat(this.getChildValue(b));c>0&&(a.maxScale=c)},read_sld_MaxScaleDenominator:function(a,b){a.minScale=parseFloat(this.getChildValue(b))},read_wmc_SRS:function(a,b){"srs"in a||(a.srs={}),a.srs[this.getChildValue(b)]=!0},write_wmc_Layer:function(a){var b=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[a]);if(a.maxScale){var c=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator");c.appendChild(this.createTextNode(a.maxScale.toPrecision(16))),b.appendChild(c)}if(a.minScale){var d=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator");d.appendChild(this.createTextNode(a.minScale.toPrecision(16))),b.appendChild(d)}if(a.srs)for(var e in a.srs)b.appendChild(this.createElementDefaultNS("SRS",e));return b.appendChild(this.write_wmc_FormatList(a)),b.appendChild(this.write_wmc_StyleList(a)),a.dimensions&&b.appendChild(this.write_wmc_DimensionList(a)),b.appendChild(this.write_wmc_LayerExtension(a)),b},CLASS_NAME:"OpenLayers.Format.WMC.v1_1_0"}),OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e3,translationParameters:null,symbolMetrics:null,initialize:function(a){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){var a="http://www.w3.org/TR/SVG11/feature#";return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(a+"SVG","1.1")||document.implementation.hasFeature(a+"BasicStructure","1.1"))},inValidRange:function(a,b,c){var d=a+(c?0:this.translationParameters.x),e=b+(c?0:this.translationParameters.y);return d>=-this.MAX_PIXEL&&d<=this.MAX_PIXEL&&e>=-this.MAX_PIXEL&&e<=this.MAX_PIXEL},setExtent:function(a,b){var c=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),d=this.getResolution(),e=-a.left/d,f=a.top/d;if(b){this.left=e,this.top=f;var g="0 0 "+this.size.w+" "+this.size.h;return this.rendererRoot.setAttributeNS(null,"viewBox",g),this.translate(this.xOffset,0),!0}var h=this.translate(e-this.left+this.xOffset,f-this.top);return h||this.setExtent(a,!0),c&&h},translate:function(a,b){if(this.inValidRange(a,b,!0)){var c="";return(a||b)&&(c="translate("+a+","+b+")"),this.root.setAttributeNS(null,"transform",c),this.translationParameters={x:a,y:b},!0}return!1},setSize:function(a){OpenLayers.Renderer.prototype.setSize.apply(this,arguments),this.rendererRoot.setAttributeNS(null,"width",this.size.w),this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(a,b){var c=null;switch(a.CLASS_NAME){case"OpenLayers.Geometry.Point":c=b.externalGraphic?"image":this.isComplexSymbol(b.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":c="rect";break;case"OpenLayers.Geometry.LineString":c="polyline";break;case"OpenLayers.Geometry.LinearRing":c="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":c="path"}return c},setStyle:function(a,b,c){b=b||a._style,c=c||a._options;var d=b.title||b.graphicTitle;if(d){a.setAttributeNS(null,"title",d);var e=a.getElementsByTagName("title");if(e.length>0)e[0].firstChild.textContent=d;else{var f=this.nodeFactory(null,"title");f.textContent=d,a.appendChild(f)}}var g,h=parseFloat(a.getAttributeNS(null,"r")),i=1;if("OpenLayers.Geometry.Point"==a._geometryClass&&h){if(a.style.visibility="",!1===b.graphic)a.style.visibility="hidden";else if(b.externalGraphic){g=this.getPosition(a),b.graphicWidth&&b.graphicHeight&&a.setAttributeNS(null,"preserveAspectRatio","none");var j=b.graphicWidth||b.graphicHeight,k=b.graphicHeight||b.graphicWidth;j=j||2*b.pointRadius,k=k||2*b.pointRadius;var l=void 0!=b.graphicXOffset?b.graphicXOffset:-.5*j,m=void 0!=b.graphicYOffset?b.graphicYOffset:-.5*k,n=b.graphicOpacity||b.fillOpacity;a.setAttributeNS(null,"x",(g.x+l).toFixed()),a.setAttributeNS(null,"y",(g.y+m).toFixed()),a.setAttributeNS(null,"width",j),a.setAttributeNS(null,"height",k),a.setAttributeNS(this.xlinkns,"xlink:href",b.externalGraphic),a.setAttributeNS(null,"style","opacity: "+n),a.onclick=OpenLayers.Event.preventDefault}else if(this.isComplexSymbol(b.graphicName)){var o=3*b.pointRadius,p=2*o,q=this.importSymbol(b.graphicName);g=this.getPosition(a),i=3*this.symbolMetrics[q.id][0]/p;var r=a.parentNode,s=a.nextSibling;r&&r.removeChild(a),a.firstChild&&a.removeChild(a.firstChild),a.appendChild(q.firstChild.cloneNode(!0)),a.setAttributeNS(null,"viewBox",q.getAttributeNS(null,"viewBox")),a.setAttributeNS(null,"width",p),a.setAttributeNS(null,"height",p),a.setAttributeNS(null,"x",g.x-o),a.setAttributeNS(null,"y",g.y-o),s?r.insertBefore(a,s):r&&r.appendChild(a)}else a.setAttributeNS(null,"r",b.pointRadius);var t=b.rotation;if((void 0!==t||void 0!==a._rotation)&&g)if(a._rotation=t,t|=0,"svg"!==a.nodeName)a.setAttributeNS(null,"transform","rotate("+t+" "+g.x+" "+g.y+")");else{var u=this.symbolMetrics[q.id];a.firstChild.setAttributeNS(null,"transform","rotate("+t+" "+u[1]+" "+u[2]+")")}}return c.isFilled?(a.setAttributeNS(null,"fill",b.fillColor),a.setAttributeNS(null,"fill-opacity",b.fillOpacity)):a.setAttributeNS(null,"fill","none"),c.isStroked?(a.setAttributeNS(null,"stroke",b.strokeColor),a.setAttributeNS(null,"stroke-opacity",b.strokeOpacity),a.setAttributeNS(null,"stroke-width",b.strokeWidth*i),a.setAttributeNS(null,"stroke-linecap",b.strokeLinecap||"round"),a.setAttributeNS(null,"stroke-linejoin","round"),b.strokeDashstyle&&a.setAttributeNS(null,"stroke-dasharray",this.dashStyle(b,i))):a.setAttributeNS(null,"stroke","none"),b.pointerEvents&&a.setAttributeNS(null,"pointer-events",b.pointerEvents),null!=b.cursor&&a.setAttributeNS(null,"cursor",b.cursor),a},dashStyle:function(a,b){var c=a.strokeWidth*b,d=a.strokeDashstyle;switch(d){case"solid":return"none";case"dot":return[1,4*c].join();case"dash":return[4*c,4*c].join();case"dashdot":return[4*c,4*c,1,4*c].join();case"longdash":return[8*c,4*c].join();case"longdashdot":return[8*c,4*c,1,4*c].join();default:return OpenLayers.String.trim(d).replace(/\s+/g,",")}},createNode:function(a,b){var c=document.createElementNS(this.xmlns,a);return b&&c.setAttributeNS(null,"id",b),c},nodeTypeCompare:function(a,b){return b==a.nodeName},createRenderRoot:function(){var a=this.nodeFactory(this.container.id+"_svgRoot","svg");return a.style.display="block",a},createRoot:function(a){return this.nodeFactory(this.container.id+a,"g")},createDefs:function(){var a=this.nodeFactory(this.container.id+"_defs","defs");return this.rendererRoot.appendChild(a),a},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(a,b,c){var d=this.getResolution(),e=(b.x-this.featureDx)/d+this.left,f=this.top-b.y/d;return!!this.inValidRange(e,f)&&(a.setAttributeNS(null,"cx",e),a.setAttributeNS(null,"cy",f),a.setAttributeNS(null,"r",c),a)},drawLineString:function(a,b){var c=this.getComponentsString(b.components);return!!c.path&&(a.setAttributeNS(null,"points",c.path),c.complete?a:null)},drawLinearRing:function(a,b){var c=this.getComponentsString(b.components);return!!c.path&&(a.setAttributeNS(null,"points",c.path),c.complete?a:null)},drawPolygon:function(a,b){for(var c,d,e="",f=!0,g=!0,h=0,i=b.components.length;h<i;h++)e+=" M",c=this.getComponentsString(b.components[h].components," "),d=c.path,d?(e+=" "+d,g=c.complete&&g):f=!1;return e+=" z",!!f&&(a.setAttributeNS(null,"d",e),a.setAttributeNS(null,"fill-rule","evenodd"),g?a:null)},drawRectangle:function(a,b){var c=this.getResolution(),d=(b.x-this.featureDx)/c+this.left,e=this.top-b.y/c;return!!this.inValidRange(d,e)&&(a.setAttributeNS(null,"x",d),a.setAttributeNS(null,"y",e),a.setAttributeNS(null,"width",b.width/c),a.setAttributeNS(null,"height",b.height/c),a)},drawText:function(a,b,c){var d=!!b.labelOutlineWidth;if(d){var e=OpenLayers.Util.extend({},b);e.fontColor=e.labelOutlineColor,e.fontStrokeColor=e.labelOutlineColor,e.fontStrokeWidth=b.labelOutlineWidth,b.labelOutlineOpacity&&(e.fontOpacity=b.labelOutlineOpacity),delete e.labelOutlineWidth,this.drawText(a,e,c)}var f=this.getResolution(),g=(c.x-this.featureDx)/f+this.left,h=c.y/f-this.top,i=d?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,j=this.nodeFactory(a+i,"text");j.setAttributeNS(null,"x",g),j.setAttributeNS(null,"y",-h),b.fontColor&&j.setAttributeNS(null,"fill",b.fontColor),b.fontStrokeColor&&j.setAttributeNS(null,"stroke",b.fontStrokeColor),b.fontStrokeWidth&&j.setAttributeNS(null,"stroke-width",b.fontStrokeWidth),b.fontOpacity&&j.setAttributeNS(null,"opacity",b.fontOpacity),b.fontFamily&&j.setAttributeNS(null,"font-family",b.fontFamily),b.fontSize&&j.setAttributeNS(null,"font-size",b.fontSize),b.fontWeight&&j.setAttributeNS(null,"font-weight",b.fontWeight),b.fontStyle&&j.setAttributeNS(null,"font-style",b.fontStyle),!0===b.labelSelect?(j.setAttributeNS(null,"pointer-events","visible"),j._featureId=a):j.setAttributeNS(null,"pointer-events","none");var k=b.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign
;j.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[k[0]]||"middle"),!0===OpenLayers.IS_GECKO&&j.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[k[1]]||"central");for(var l=b.label.split("\n"),m=l.length;j.childNodes.length>m;)j.removeChild(j.lastChild);for(var n=0;n<m;n++){var o=this.nodeFactory(a+i+"_tspan_"+n,"tspan");if(!0===b.labelSelect&&(o._featureId=a,o._geometry=c,o._geometryClass=c.CLASS_NAME),!1===OpenLayers.IS_GECKO&&o.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[k[1]]||"-35%"),o.setAttribute("x",g),0==n){var p=OpenLayers.Renderer.SVG.LABEL_VFACTOR[k[1]];null==p&&(p=-.5),o.setAttribute("dy",p*(m-1)+"em")}else o.setAttribute("dy","1em");o.textContent=""===l[n]?" ":l[n],o.parentNode||j.appendChild(o)}j.parentNode||this.textRoot.appendChild(j)},getComponentsString:function(a,b){for(var c,d,e=[],f=!0,g=a.length,h=[],i=0;i<g;i++)d=a[i],e.push(d),c=this.getShortString(d),c?h.push(c):(i>0&&this.getShortString(a[i-1])&&h.push(this.clipLine(a[i],a[i-1])),i<g-1&&this.getShortString(a[i+1])&&h.push(this.clipLine(a[i],a[i+1])),f=!1);return{path:h.join(b||","),complete:f}},clipLine:function(a,b){if(b.equals(a))return"";var c,d=this.getResolution(),e=this.MAX_PIXEL-this.translationParameters.x,f=this.MAX_PIXEL-this.translationParameters.y,g=(b.x-this.featureDx)/d+this.left,h=this.top-b.y/d,i=(a.x-this.featureDx)/d+this.left,j=this.top-a.y/d;return(i<-e||i>e)&&(c=(j-h)/(i-g),i=i<0?-e:e,j=h+(i-g)*c),(j<-f||j>f)&&(c=(i-g)/(j-h),j=j<0?-f:f,i=g+(j-h)*c),i+","+j},getShortString:function(a){var b=this.getResolution(),c=(a.x-this.featureDx)/b+this.left,d=this.top-a.y/b;return!!this.inValidRange(c,d)&&c+","+d},getPosition:function(a){return{x:parseFloat(a.getAttributeNS(null,"cx")),y:parseFloat(a.getAttributeNS(null,"cy"))}},importSymbol:function(a){this.defs||(this.defs=this.createDefs());var b=this.container.id+"-"+a,c=document.getElementById(b);if(null!=c)return c;var d=OpenLayers.Renderer.symbol[a];if(!d)throw new Error(a+" is not a valid symbol name");var e=this.nodeFactory(b,"symbol"),f=this.nodeFactory(null,"polygon");e.appendChild(f);for(var g,h,i=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),j=[],k=0;k<d.length;k+=2)g=d[k],h=d[k+1],i.left=Math.min(i.left,g),i.bottom=Math.min(i.bottom,h),i.right=Math.max(i.right,g),i.top=Math.max(i.top,h),j.push(g,",",h);f.setAttributeNS(null,"points",j.join(" "));var l=i.getWidth(),m=i.getHeight(),n=[i.left-l,i.bottom-m,3*l,3*m];return e.setAttributeNS(null,"viewBox",n.join(" ")),this.symbolMetrics[b]=[Math.max(l,m),i.getCenterLonLat().lon,i.getCenterLonLat().lat],this.defs.appendChild(e),e},getFeatureIdFromEvent:function(a){var b=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!b){var c=a.target;b=c.parentNode&&c!=this.rendererRoot?c.parentNode._featureId:void 0}return b},CLASS_NAME:"OpenLayers.Renderer.SVG"}),OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"},OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"},OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1},OpenLayers.Renderer.SVG.preventDefault=function(a){OpenLayers.Event.preventDefault(a)},OpenLayers.Format.WMSDescribeLayer=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer"}),OpenLayers.Format.WMSDescribeLayer.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSDescribeLayer,{initialize:function(a){OpenLayers.Format.WMSDescribeLayer.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));for(var b,c,d=a.documentElement,e=d.childNodes,f={layerDescriptions:[]},g=0;g<e.length;++g)if(b=e[g],"LayerDescription"==(c=b.nodeName)){var h=b.getAttribute("name"),i="",j="",k="";b.getAttribute("owsType")?(i=b.getAttribute("owsType"),j=b.getAttribute("owsURL")):""!=b.getAttribute("wfs")?(i="WFS",j=b.getAttribute("wfs")):""!=b.getAttribute("wcs")&&(i="WCS",j=b.getAttribute("wcs"));var l=b.getElementsByTagName("Query");l.length>0&&((k=l[0].getAttribute("typeName"))||(k=l[0].getAttribute("typename")));var m={layerName:h,owsType:i,owsURL:j,typeName:k};f.layerDescriptions.push(m),f.length=f.layerDescriptions.length,f[f.length-1]=m}else if("ServiceException"==c){var n=new OpenLayers.Format.OGCExceptionReport;return{error:n.read(a)}}return f},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer.v1_1_1"}),OpenLayers.Format.WMSDescribeLayer.v1_1_0=OpenLayers.Format.WMSDescribeLayer.v1_1_1,OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),!this.eTop){this.eTop=document.createElement("div"),this.eTop.className=this.displayClass+"Top";this.topInUnits.length;this.div.appendChild(this.eTop),""==this.topOutUnits||""==this.topInUnits?this.eTop.style.visibility="hidden":this.eTop.style.visibility="visible",this.eBottom=document.createElement("div"),this.eBottom.className=this.displayClass+"Bottom",this.div.appendChild(this.eBottom),""==this.bottomOutUnits||""==this.bottomInUnits?this.eBottom.style.visibility="hidden":this.eBottom.style.visibility="visible"}return this.map.events.register("moveend",this,this.update),this.update(),this.div},getBarLen:function(a){var b=parseInt(Math.log(a)/Math.log(10)),c=Math.pow(10,b),d=parseInt(a/c);return(d>5?5:d>2?2:1)*c},update:function(){var a=this.map.getResolution();if(a){var b=this.map.getUnits(),c=OpenLayers.INCHES_PER_UNIT,d=this.maxWidth*a*c[b],e=1;if(!0===this.geodesic){e=(this.map.getGeodesicPixelSize().w||1e-6)*this.maxWidth/(d/c.km),d*=e}var f,g;d>1e5?(f=this.topOutUnits,g=this.bottomOutUnits):(f=this.topInUnits,g=this.bottomInUnits);var h=d/c[f],i=d/c[g],j=this.getBarLen(h),k=this.getBarLen(i);h=j/c[b]*c[f],i=k/c[b]*c[g];var l=h/a/e,m=i/a/e;"visible"==this.eBottom.style.visibility&&(this.eBottom.style.width=Math.round(m)+"px",this.eBottom.innerHTML=k+" "+g),"visible"==this.eTop.style.visibility&&(this.eTop.style.width=Math.round(l)+"px",this.eTop.innerHTML=j+" "+f)}},CLASS_NAME:"OpenLayers.Control.ScaleLine"}),OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(a){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y),OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick),this.removeButtons(),this.buttons=null,this.position=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments),this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(a){OpenLayers.Control.prototype.draw.apply(this,arguments),a=this.position,this.buttons=[];var b={w:18,h:18},c=new OpenLayers.Pixel(a.x+b.w/2,a.y);return this._addButton("panup","north-mini.png",c,b),a.y=c.y+b.h,this._addButton("panleft","west-mini.png",a,b),this._addButton("panright","east-mini.png",a.add(b.w,0),b),this._addButton("pandown","south-mini.png",c.add(0,2*b.h),b),this._addButton("zoomin","zoom-plus-mini.png",c.add(0,3*b.h+5),b),this._addButton("zoomworld","zoom-world-mini.png",c.add(0,4*b.h+5),b),this._addButton("zoomout","zoom-minus-mini.png",c.add(0,5*b.h+5),b),this.div},_addButton:function(a,b,c,d){var e=OpenLayers.Util.getImageLocation(b),f=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+a,c,d,e,"absolute");return f.style.cursor="pointer",this.div.appendChild(f),f.action=a,f.className="olButton",this.buttons.push(f),f},_removeButton:function(a){this.div.removeChild(a),OpenLayers.Util.removeItem(this.buttons,a)},removeButtons:function(){for(var a=this.buttons.length-1;a>=0;--a)this._removeButton(this.buttons[a])},onButtonClick:function(a){switch(a.buttonElement.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent()}},getSlideFactor:function(a){return this.slideRatio?this.map.getSize()[a]*this.slideRatio:this.slideFactor},CLASS_NAME:"OpenLayers.Control.PanZoom"}),OpenLayers.Control.PanZoom.X=4,OpenLayers.Control.PanZoom.Y=4,OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(a,b,c,d){this.url=a,this.size=b||{w:20,h:20},this.offset=c||{x:-this.size.w/2,y:-this.size.h/2},this.calculateOffset=d;var e=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(e)},destroy:function(){this.erase(),OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild),this.imageDiv.innerHTML="",this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(a){null!=a&&(this.size=a),this.draw()},setUrl:function(a){null!=a&&(this.url=a),this.draw()},draw:function(a){return OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute"),this.moveTo(a),this.imageDiv},erase:function(){null!=this.imageDiv&&null!=this.imageDiv.parentNode&&OpenLayers.Element.remove(this.imageDiv)},setOpacity:function(a){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,a)},moveTo:function(a){null!=a&&(this.px=a),null!=this.imageDiv&&(null==this.px?this.display(!1):(this.calculateOffset&&(this.offset=this.calculateOffset(this.size)),OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})))},display:function(a){this.imageDiv.style.display=a?"":"none"},isDrawn:function(){return this.imageDiv&&this.imageDiv.parentNode&&11!=this.imageDiv.parentNode.nodeType},CLASS_NAME:"OpenLayers.Icon"}),OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(a,b){this.lonlat=a;var c=b||OpenLayers.Marker.defaultIcon();null==this.icon?this.icon=c:(this.icon.url=c.url,this.icon.size=c.size,this.icon.offset=c.offset,this.icon.calculateOffset=c.calculateOffset),this.events=new OpenLayers.Events(this,this.icon.imageDiv)},destroy:function(){this.erase(),this.map=null,this.events.destroy(),this.events=null,null!=this.icon&&(this.icon.destroy(),this.icon=null)},draw:function(a){return this.icon.draw(a)},erase:function(){null!=this.icon&&this.icon.erase()},moveTo:function(a){null!=a&&null!=this.icon&&this.icon.moveTo(a),this.lonlat=this.map.getLonLatFromLayerPx(a)},isDrawn:function(){return this.icon&&this.icon.isDrawn()},onScreen:function(){var a=!1;if(this.map){a=this.map.getExtent().containsLonLat(this.lonlat)}return a},inflate:function(a){this.icon&&this.icon.setSize({w:this.icon.size.w*a,h:this.icon.size.h*a})},setOpacity:function(a){this.icon.setOpacity(a)},setUrl:function(a){this.icon.setUrl(a)},display:function(a){this.icon.display(a)},CLASS_NAME:"OpenLayers.Marker"}),OpenLayers.Marker.defaultIcon=function(){return new OpenLayers.Icon(OpenLayers.Util.getImageLocation("marker.png"),{w:21,h:25},{x:-10.5,y:-25})},OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!1,panIcons:!0,forceFixedZoomLevel:!1,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function(){this._removeZoomBar(),this.map.events.un({changebaselayer:this.redraw,updatesize:this.redraw,scope:this}),OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments),delete this.mouseDragStart,delete this.zoomStart},setMap:function(a){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments),this.map.events.on({changebaselayer:this.redraw,updatesize:this.redraw,scope:this})},redraw:function(){null!=this.div&&(this.removeButtons(),this._removeZoomBar()),this.draw()},draw:function(a){OpenLayers.Control.prototype.draw.apply(this,arguments),a=this.position.clone(),this.buttons=[];var b={w:18,h:18};if(this.panIcons){var c=new OpenLayers.Pixel(a.x+b.w/2,a.y),d=b.w;this.zoomWorldIcon&&(c=new OpenLayers.Pixel(a.x+b.w,a.y)),this._addButton("panup","north-mini.png",c,b),a.y=c.y+b.h,this._addButton("panleft","west-mini.png",a,b),this.zoomWorldIcon&&(this._addButton("zoomworld","zoom-world-mini.png",a.add(b.w,0),b),d*=2),this._addButton("panright","east-mini.png",a.add(d,0),b),this._addButton("pandown","south-mini.png",c.add(0,2*b.h),b),this._addButton("zoomin","zoom-plus-mini.png",c.add(0,3*b.h+5),b),c=this._addZoomBar(c.add(0,4*b.h+5)),this._addButton("zoomout","zoom-minus-mini.png",c,b)}else this._addButton("zoomin","zoom-plus-mini.png",a,b),c=this._addZoomBar(a.add(0,b.h)),this._addButton("zoomout","zoom-minus-mini.png",c,b),this.zoomWorldIcon&&(c=c.add(0,b.h+3),this._addButton("zoomworld","zoom-world-mini.png",c,b));return this.div},_addZoomBar:function(a){var b=OpenLayers.Util.getImageLocation("slider.png"),c=this.id+"_"+this.map.id,d=this.map.getMinZoom(),e=this.map.getNumZoomLevels()-1-this.map.getZoom(),f=OpenLayers.Util.createAlphaImageDiv(c,a.add(-1,e*this.zoomStopHeight),{w:20,h:9},b,"absolute");f.style.cursor="move",this.slider=f,this.sliderEvents=new OpenLayers.Events(this,f,null,!0,{includeXY:!0}),this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});var g={w:this.zoomStopWidth,h:this.zoomStopHeight*(this.map.getNumZoomLevels()-d)},b=OpenLayers.Util.getImageLocation("zoombar.png"),h=null;if(OpenLayers.Util.alphaHack()){var c=this.id+"_"+this.map.id;h=OpenLayers.Util.createAlphaImageDiv(c,a,{w:g.w,h:this.zoomStopHeight},b,"absolute",null,"crop"),h.style.height=g.h+"px"}else h=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,a,g,b);return h.style.cursor="pointer",h.className="olButton",this.zoombarDiv=h,this.div.appendChild(h),this.startTop=parseInt(h.style.top),this.div.appendChild(f),this.map.events.register("zoomend",this,this.moveZoomBar),a=a.add(0,this.zoomStopHeight*(this.map.getNumZoomLevels()-d))},_removeZoomBar:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp}),this.sliderEvents.destroy(),this.div.removeChild(this.zoombarDiv),this.zoombarDiv=null,this.div.removeChild(this.slider),this.slider=null,this.map.events.unregister("zoomend",this,this.moveZoomBar)},onButtonClick:function(a){if(OpenLayers.Control.PanZoom.prototype.onButtonClick.apply(this,arguments),a.buttonElement===this.zoombarDiv){var b=a.buttonXY.y/this.zoomStopHeight;!this.forceFixedZoomLevel&&this.map.fractionalZoom||(b=Math.floor(b));var c=this.map.getNumZoomLevels()-1-b;c=Math.min(Math.max(c,0),this.map.getNumZoomLevels()-1),this.map.zoomTo(c)}},passEventToSlider:function(a){this.sliderEvents.handleBrowserEvent(a)},zoomBarDown:function(a){(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))&&(this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this}),this.mouseDragStart=a.xy.clone(),this.zoomStart=a.xy.clone(),this.div.style.cursor="move",this.zoombarDiv.offsets=null,OpenLayers.Event.stop(a))},zoomBarDrag:function(a){if(null!=this.mouseDragStart){var b=this.mouseDragStart.y-a.xy.y,c=OpenLayers.Util.pagePosition(this.zoombarDiv);if(a.clientY-c[1]>0&&a.clientY-c[1]<parseInt(this.zoombarDiv.style.height)-2){var d=parseInt(this.slider.style.top)-b;this.slider.style.top=d+"px",this.mouseDragStart=a.xy.clone()}this.deltaY=this.zoomStart.y-a.xy.y,OpenLayers.Event.stop(a)}},zoomBarUp:function(a){if((OpenLayers.Event.isLeftClick(a)||"touchend"===a.type)&&this.mouseDragStart){this.div.style.cursor="",this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var b=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(b+=this.deltaY/this.zoomStopHeight,b=Math.min(Math.max(b,0),this.map.getNumZoomLevels()-1)):(b+=this.deltaY/this.zoomStopHeight,b=Math.max(Math.round(b),0)),this.map.zoomTo(b),this.mouseDragStart=null,this.zoomStart=null,this.deltaY=0,OpenLayers.Event.stop(a)}},moveZoomBar:function(){var a=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=a+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"}),OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify)}(),read:function(json,filter){function walk(a,b){if(b&&"object"==typeof b)for(var c in b)b.hasOwnProperty(c)&&(b[c]=walk(c,b[c]));return filter(a,b)}var object;if(this.nativeJSON)object=JSON.parse(json,filter);else try{/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(object=eval("("+json+")"),"function"==typeof filter&&(object=walk("",object)))}catch(a){}return this.keepData&&(this.data=object),object},write:function(a,b){this.pretty=!!b;var c=null,d=typeof a;if(this.serialize[d])try{c=!this.pretty&&this.nativeJSON?JSON.stringify(a):this.serialize[d].apply(this,[a])}catch(a){OpenLayers.Console.error("Trouble serializing: "+a)}return c},writeIndent:function(){var a=[];if(this.pretty)for(var b=0;b<this.level;++b)a.push(this.indent);return a.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(a){if(null==a)return"null";if(a.constructor==Date)return this.serialize.date.apply(this,[a]);if(a.constructor==Array)return this.serialize.array.apply(this,[a]);var b=["{"];this.level+=1;var c,d,e,f=!1;for(c in a)a.hasOwnProperty(c)&&(d=OpenLayers.Format.JSON.prototype.write.apply(this,[c,this.pretty]),e=OpenLayers.Format.JSON.prototype.write.apply(this,[a[c],this.pretty]),null!=d&&null!=e&&(f&&b.push(","),b.push(this.writeNewline(),this.writeIndent(),d,":",this.writeSpace(),e),f=!0));return this.level-=1,b.push(this.writeNewline(),this.writeIndent(),"}"),b.join("")},array:function(a){var b,c=["["];this.level+=1;for(var d=0,e=a.length;d<e;++d)null!=(b=OpenLayers.Format.JSON.prototype.write.apply(this,[a[d],this.pretty]))&&(d>0&&c.push(","),c.push(this.writeNewline(),this.writeIndent(),b));return this.level-=1,c.push(this.writeNewline(),this.writeIndent(),"]"),c.join("")},string:function(a){var b={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(a)?'"'+a.replace(/([\x00-\x1f\\"])/g,function(a,c){var d=b[c];return d||(d=c.charCodeAt(),"\\u00"+Math.floor(d/16).toString(16)+(d%16).toString(16))})+'"':'"'+a+'"'},number:function(a){return isFinite(a)?String(a):"null"},boolean:function(a){return String(a)},date:function(a){function b(a){return a<10?"0"+a:a}return'"'+a.getFullYear()+"-"+b(a.getMonth()+1)+"-"+b(a.getDate())+"T"+b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"}),OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(a,b,c){b=b||"FeatureCollection";var d=null,e=null;if(e="string"==typeof a?OpenLayers.Format.JSON.prototype.read.apply(this,[a,c]):a){if("string"!=typeof e.type)OpenLayers.Console.error("Bad GeoJSON - no type: "+a);else if(this.isValidType(e,b))switch(b){case"Geometry":try{d=this.parseGeometry(e)}catch(a){OpenLayers.Console.error(a)}break;case"Feature":try{d=this.parseFeature(e),d.type="Feature"}catch(a){OpenLayers.Console.error(a)}break;case"FeatureCollection":switch(d=[],e.type){case"Feature":try{d.push(this.parseFeature(e))}catch(a){d=null,OpenLayers.Console.error(a)}break;case"FeatureCollection":for(var f=0,g=e.features.length;f<g;++f)try{d.push(this.parseFeature(e.features[f]))}catch(a){d=null,OpenLayers.Console.error(a)}break;default:try{var h=this.parseGeometry(e);d.push(new OpenLayers.Feature.Vector(h))}catch(a){d=null,OpenLayers.Console.error(a)}}}}else OpenLayers.Console.error("Bad JSON: "+a);return d},isValidType:function(a,b){var c=!1;switch(b){case"Geometry":-1==OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],a.type)?OpenLayers.Console.error("Unsupported geometry type: "+a.type):c=!0;break;case"FeatureCollection":c=!0;break;default:a.type==b?c=!0:OpenLayers.Console.error("Cannot convert types from "+a.type+" to "+b)}return c},parseFeature:function(a){var b,c,d,e;d=a.properties?a.properties:{},e=a.geometry&&a.geometry.bbox||a.bbox;try{c=this.parseGeometry(a.geometry)}catch(a){throw a}return b=new OpenLayers.Feature.Vector(c,d),e&&(b.bounds=OpenLayers.Bounds.fromArray(e)),a.id&&(b.fid=a.id),b},parseGeometry:function(a){if(null==a)return null;var b,c=!1;if("GeometryCollection"==a.type){if(!OpenLayers.Util.isArray(a.geometries))throw"GeometryCollection must have geometries array: "+a;for(var d=a.geometries.length,e=new Array(d),f=0;f<d;++f)e[f]=this.parseGeometry.apply(this,[a.geometries[f]]);b=new OpenLayers.Geometry.Collection(e),c=!0}else{if(!OpenLayers.Util.isArray(a.coordinates))throw"Geometry must have coordinates array: "+a;if(!this.parseCoords[a.type.toLowerCase()])throw"Unsupported geometry type: "+a.type;try{b=this.parseCoords[a.type.toLowerCase()].apply(this,[a.coordinates])}catch(a){throw a}}return this.internalProjection&&this.externalProjection&&!c&&b.transform(this.externalProjection,this.internalProjection),b},parseCoords:{point:function(a){if(0==this.ignoreExtraDims&&2!=a.length)throw"Only 2D points are supported: "+a;return new OpenLayers.Geometry.Point(a[0],a[1])},multipoint:function(a){for(var b=[],c=null,d=0,e=a.length;d<e;++d){try{c=this.parseCoords.point.apply(this,[a[d]])}catch(a){throw a}b.push(c)}return new OpenLayers.Geometry.MultiPoint(b)},linestring:function(a){for(var b=[],c=null,d=0,e=a.length;d<e;++d){try{c=this.parseCoords.point.apply(this,[a[d]])}catch(a){throw a}b.push(c)}return new OpenLayers.Geometry.LineString(b)},multilinestring:function(a){for(var b=[],c=null,d=0,e=a.length;d<e;++d){try{c=this.parseCoords.linestring.apply(this,[a[d]])}catch(a){throw a}b.push(c)}return new OpenLayers.Geometry.MultiLineString(b)},polygon:function(a){for(var b,c,d=[],e=0,f=a.length;e<f;++e){try{c=this.parseCoords.linestring.apply(this,[a[e]])}catch(a){throw a}b=new OpenLayers.Geometry.LinearRing(c.components),d.push(b)}return new OpenLayers.Geometry.Polygon(d)},multipolygon:function(a){for(var b=[],c=null,d=0,e=a.length;d<e;++d){try{c=this.parseCoords.polygon.apply(this,[a[d]])}catch(a){throw a}b.push(c)}return new OpenLayers.Geometry.MultiPolygon(b)},box:function(a){if(2!=a.length)throw"GeoJSON box coordinates must have 2 elements";return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(a[0][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[0][1])])])}},write:function(a,b){var c={type:null};if(OpenLayers.Util.isArray(a)){c.type="FeatureCollection";var d=a.length;c.features=new Array(d);for(var e=0;e<d;++e){var f=a[e];if(!f instanceof OpenLayers.Feature.Vector){throw"FeatureCollection only supports collections of features: "+f}c.features[e]=this.extract.feature.apply(this,[f])}}else 0==a.CLASS_NAME.indexOf("OpenLayers.Geometry")?c=this.extract.geometry.apply(this,[a]):a instanceof OpenLayers.Feature.Vector&&(c=this.extract.feature.apply(this,[a]),a.layer&&a.layer.projection&&(c.crs=this.createCRSObject(a)));return OpenLayers.Format.JSON.prototype.write.apply(this,[c,b])},createCRSObject:function(a){var b=a.layer.projection.toString(),c={};if(b.match(/epsg:/i)){var d=parseInt(b.substring(b.indexOf(":")+1));c=4326==d?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+d}}}return c},extract:{feature:function(a){var b=this.extract.geometry.apply(this,[a.geometry]),c={type:"Feature",properties:a.attributes,geometry:b};return null!=a.fid&&(c.id=a.fid),c},geometry:function(a){if(null==a)return null;this.internalProjection&&this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var b=a.CLASS_NAME.split(".")[2],c=this.extract[b.toLowerCase()].apply(this,[a]);return"Collection"==b?{type:"GeometryCollection",geometries:c}:{type:b,coordinates:c}},point:function(a){return[a.x,a.y]},multipoint:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b},linestring:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b},multilinestring:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.linestring.apply(this,[a.components[c]]));return b},polygon:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.linestring.apply(this,[a.components[c]]));return b},multipolygon:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.polygon.apply(this,[a.components[c]]));return b},collection:function(a){for(var b=a.components.length,c=new Array(b),d=0;d<b;++d)c[d]=this.extract.geometry.apply(this,[a.components[d]]);return c}},CLASS_NAME:"OpenLayers.Format.GeoJSON"}),OpenLayers.Strategy.Paging=OpenLayers.Class(OpenLayers.Strategy,{features:null,length:10,num:null,paging:!1,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);return a&&this.layer.events.on({beforefeaturesadded:this.cacheFeatures,scope:this}),a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);return a&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,scope:this})),a},cacheFeatures:function(a){this.paging||(this.clearCache(),this.features=a.features,this.pageNext(a))},clearCache:function(){if(this.features)for(var a=0;a<this.features.length;++a)this.features[a].destroy();this.features=null,this.num=null},pageCount:function(){var a=this.features?this.features.length:0;return Math.ceil(a/this.length)},pageNum:function(){return this.num},pageLength:function(a){return a&&a>0&&(this.length=a),this.length},pageNext:function(a){var b=!1;if(this.features){null===this.num&&(this.num=-1);var c=(this.num+1)*this.length;b=this.page(c,a)}return b},pagePrevious:function(){var a=!1;if(this.features){null===this.num&&(this.num=this.pageCount());var b=(this.num-1)*this.length;a=this.page(b)}return a},page:function(a,b){var c=!1;if(this.features&&a>=0&&a<this.features.length){var d=Math.floor(a/this.length);if(d!=this.num){this.paging=!0;var e=this.features.slice(a,a+this.length);this.layer.removeFeatures(this.layer.features),this.num=d,b&&b.features?b.features=e:this.layer.addFeatures(e),this.paging=!1,c=!0}}return c},CLASS_NAME:"OpenLayers.Strategy.Paging"}),OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(a){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(a){var b,c,d;a=a.replace(/[\n\r]/g," ");var e=this.regExes.typeStr.exec(a);if(e&&(c=e[1].toLowerCase(),d=e[2],this.parse[c]&&(b=this.parse[c].apply(this,[d])),this.internalProjection&&this.externalProjection))if(b&&"OpenLayers.Feature.Vector"==b.CLASS_NAME)b.geometry.transform(this.externalProjection,this.internalProjection);else if(b&&"geometrycollection"!=c&&"object"==typeof b)for(var f=0,g=b.length;f<g;f++){var h=b[f];h.geometry.transform(this.externalProjection,this.internalProjection)}return b},write:function(a){var b,c,d;a.constructor==Array?(b=a,d=!0):(b=[a],d=!1);var e=[];d&&e.push("GEOMETRYCOLLECTION(");for(var f=0,g=b.length;f<g;++f)d&&f>0&&e.push(","),c=b[f].geometry,e.push(this.extractGeometry(c));return d&&e.push(")"),e.join("")},extractGeometry:function(a){var b=a.CLASS_NAME.split(".")[2].toLowerCase();return this.extract[b]?(this.internalProjection&&this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection)),("collection"==b?"GEOMETRYCOLLECTION":b.toUpperCase())+"("+this.extract[b].apply(this,[a])+")"):null},extract:{point:function(a){return a.x+" "+a.y},multipoint:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push("("+this.extract.point.apply(this,[a.components[c]])+")");return b.join(",")},linestring:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b.join(",")},multilinestring:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push("("+this.extract.linestring.apply(this,[a.components[c]])+")");return b.join(",")},polygon:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push("("+this.extract.linestring.apply(this,[a.components[c]])+")");return b.join(",")},multipolygon:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push("("+this.extract.polygon.apply(this,[a.components[c]])+")");return b.join(",")},collection:function(a){for(var b=[],c=0,d=a.components.length;c<d;++c)b.push(this.extractGeometry.apply(this,[a.components[c]]));return b.join(",")}},parse:{point:function(a){var b=OpenLayers.String.trim(a).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b[0],b[1]))},multipoint:function(a){for(var b,c=OpenLayers.String.trim(a).split(","),d=[],e=0,f=c.length;e<f;++e)b=c[e].replace(this.regExes.trimParens,"$1"),d.push(this.parse.point.apply(this,[b]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(d))},linestring:function(a){for(var b=OpenLayers.String.trim(a).split(","),c=[],d=0,e=b.length;d<e;++d)c.push(this.parse.point.apply(this,[b[d]]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(c))},multilinestring:function(a){for(var b,c=OpenLayers.String.trim(a).split(this.regExes.parenComma),d=[],e=0,f=c.length;e<f;++e)b=c[e].replace(this.regExes.trimParens,"$1"),d.push(this.parse.linestring.apply(this,[b]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(d))},polygon:function(a){for(var b,c,d,e=OpenLayers.String.trim(a).split(this.regExes.parenComma),f=[],g=0,h=e.length;g<h;++g)b=e[g].replace(this.regExes.trimParens,"$1"),c=this.parse.linestring.apply(this,[b]).geometry,d=new OpenLayers.Geometry.LinearRing(c.components),f.push(d);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(f))},multipolygon:function(a){for(var b,c=OpenLayers.String.trim(a).split(this.regExes.doubleParenComma),d=[],e=0,f=c.length;e<f;++e)b=c[e].replace(this.regExes.trimParens,"$1"),d.push(this.parse.polygon.apply(this,[b]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(d))},geometrycollection:function(a){a=a.replace(/,\s*([A-Za-z])/g,"|$1");for(var b=OpenLayers.String.trim(a).split("|"),c=[],d=0,e=b.length;d<e;++d)c.push(OpenLayers.Format.WKT.prototype.read.apply(this,[b[d]]));return c}},CLASS_NAME:"OpenLayers.Format.WKT"}),OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,multi:!1,featureAdded:function(){},initialize:function(a,b,c){OpenLayers.Control.prototype.initialize.apply(this,[c]),this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(a,b){
this.layer.events.triggerEvent("sketchmodified",{vertex:a,feature:b})},create:function(a,b){this.layer.events.triggerEvent("sketchstarted",{vertex:a,feature:b})}},this.callbacks),this.layer=a,this.handlerOptions=this.handlerOptions||{},this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:a.renderers,rendererOptions:a.rendererOptions}),"multi"in this.handlerOptions||(this.handlerOptions.multi=this.multi);var d=this.layer.styleMap&&this.layer.styleMap.styles.temporary;d&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({default:d})})),this.handler=new b(this,this.callbacks,this.handlerOptions)},drawFeature:function(a){var b=new OpenLayers.Feature.Vector(a);!1!==this.layer.events.triggerEvent("sketchcomplete",{feature:b})&&(b.state=OpenLayers.State.INSERT,this.layer.addFeatures([b]),this.featureAdded(b),this.events.triggerEvent("featureadded",{feature:b}))},insertXY:function(a,b){this.handler&&this.handler.line&&this.handler.insertXY(a,b)},insertDeltaXY:function(a,b){this.handler&&this.handler.line&&this.handler.insertDeltaXY(a,b)},insertDirectionLength:function(a,b){this.handler&&this.handler.line&&this.handler.insertDirectionLength(a,b)},insertDeflectionLength:function(a,b){this.handler&&this.handler.line&&this.handler.insertDeflectionLength(a,b)},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"}),OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(a){var b=this.layer.getLonLatFromViewPortPx(a),c=new OpenLayers.Geometry.Point(b.lon,b.lat);this.point=new OpenLayers.Feature.Vector(c),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry])),this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(a){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier])for(var b,c,d=this.point.geometry,e=this.control.layer.features,f=e.length-1;f>=0;--f)if(((b=e[f].geometry)instanceof OpenLayers.Geometry.Polygon||b instanceof OpenLayers.Geometry.MultiPolygon)&&b.intersects(d)){c=e[f],this.control.layer.removeFeatures([c],{silent:!0}),this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology),c.geometry.addComponent(this.line.geometry),this.polygon=c,this.drawingHole=!0;break}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(a){var b=a.vertex,c=this.line.geometry.components;if(!this.polygon.geometry.intersects(b)){var d=c[c.length-3];b.x=d.x,b.y=d.y}},finishGeometry:function(){var a=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[a]),this.removePoint(),this.finalize()},finalizeInteriorRing:function(){var a=this.line.geometry,b=0!==a.getArea();if(b){for(var c=this.polygon.geometry.components,d=c.length-2;d>=0;--d)if(a.intersects(c[d])){b=!1;break}if(b){a:for(var d=c.length-2;d>0;--d)for(var e=c[d].components,f=0,g=e.length;f<g;++f)if(a.containsPoint(e[f])){b=!1;break a}}}return b?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(a),this.restoreFeature(),!1},cancel:function(){return this.drawingHole&&(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0)),OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(a){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology),this.layer.removeFeatures([this.polygon],{silent:!0}),this.control.layer.addFeatures([this.polygon],{silent:!0}),this.drawingHole=!1,a||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(a){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,a),this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var a=this.polygon&&this.polygon.geometry;return a&&this.multi&&(a=new OpenLayers.Geometry.MultiPolygon([a])),a},CLASS_NAME:"OpenLayers.Handler.Polygon"}),OpenLayers.Control.EditingToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{citeCompliant:!1,initialize:function(a,b){OpenLayers.Control.Panel.prototype.initialize.apply(this,[b]),this.addControls([new OpenLayers.Control.Navigation]);var c=[new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Point,{displayClass:"olControlDrawFeaturePoint",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Path,{displayClass:"olControlDrawFeaturePath",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon",handlerOptions:{citeCompliant:this.citeCompliant}})];this.addControls(c)},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);return null===this.defaultControl&&(this.defaultControl=this.controls[0]),a},CLASS_NAME:"OpenLayers.Control.EditingToolbar"}),OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(a){var b;"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var c=a.documentElement;if(c){var d=this["read_"+c.nodeName];b=d?d.call(this,c):new OpenLayers.Format.GML(this.options?this.options:{}).read(a)}else b=a;return b},read_msGMLOutput:function(a){var b=[],c=this.getSiblingNodesByTagCriteria(a,this.layerIdentifier);if(c)for(var d=0,e=c.length;d<e;++d){var f=c[d],g=f.nodeName;f.prefix&&(g=g.split(":")[1]);var g=g.replace(this.layerIdentifier,""),h=this.getSiblingNodesByTagCriteria(f,this.featureIdentifier);if(h)for(var i=0;i<h.length;i++){var j=h[i],k=this.parseGeometry(j),l=this.parseAttributes(j),m=new OpenLayers.Feature.Vector(k.geometry,l,null);m.bounds=k.bounds,m.type=g,b.push(m)}}return b},read_FeatureInfoResponse:function(a){for(var b=[],c=this.getElementsByTagNameNS(a,"*","FIELDS"),d=0,e=c.length;d<e;d++){var f,g=c[d],h={},i=g.attributes.length;if(i>0)for(f=0;f<i;f++){var j=g.attributes[f];h[j.nodeName]=j.nodeValue}else{var k=g.childNodes;for(f=0,i=k.length;f<i;++f){var l=k[f];3!=l.nodeType&&(h[l.getAttribute("name")]=l.getAttribute("value"))}}b.push(new OpenLayers.Feature.Vector(null,h,null))}return b},getSiblingNodesByTagCriteria:function(a,b){var c,d,e,f,g,h=[];if(a&&a.hasChildNodes()){c=a.childNodes,e=c.length;for(var i=0;i<e;i++){for(g=c[i];g&&1!=g.nodeType;)g=g.nextSibling,i++;d=g?g.nodeName:"",d.length>0&&d.indexOf(b)>-1?h.push(g):(f=this.getSiblingNodesByTagCriteria(g,b),f.length>0&&(0==h.length?h=f:h.push(f)))}}return h},parseAttributes:function(a){var b={};if(1==a.nodeType)for(var c=a.childNodes,d=c.length,e=0;e<d;++e){var f=c[e];if(1==f.nodeType){var g=f.childNodes,h=f.prefix?f.nodeName.split(":")[1]:f.nodeName;if(0==g.length)b[h]=null;else if(1==g.length){var i=g[0];if(3==i.nodeType||4==i.nodeType){var j=i.nodeValue.replace(this.regExes.trimSpace,"");b[h]=j}}}}return b},parseGeometry:function(a){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);var b,c=this.gmlFormat.parseFeature(a),d=null;return c&&(b=c.geometry&&c.geometry.clone(),d=c.bounds&&c.bounds.clone(),c.destroy()),{geometry:b,bounds:d}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"}),OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a]),a.format||(this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions))),!a.geometryName&&parseFloat(this.format.version)>1&&this.setGeometryName(null)},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){OpenLayers.Protocol.prototype.read.apply(this,arguments),a=OpenLayers.Util.extend({},a),OpenLayers.Util.applyDefaults(a,this.options||{});var b=new OpenLayers.Protocol.Response({requestType:"read"}),c=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",a)]);return b.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,b,a),params:a.params,headers:a.headers,data:c}),b},setFeatureType:function(a){this.featureType=a,this.format.featureType=a},setGeometryName:function(a){this.geometryName=a,this.format.geometryName=a},handleRead:function(a,b){if(b=OpenLayers.Util.extend({},b),OpenLayers.Util.applyDefaults(b,this.options),b.callback){var c=a.priv;if(c.status>=200&&c.status<300){var d=this.parseResponse(c,b.readOptions);d&&!1!==d.success?(b.readOptions&&"object"==b.readOptions.output?OpenLayers.Util.extend(a,d):a.features=d,a.code=OpenLayers.Protocol.Response.SUCCESS):(a.code=OpenLayers.Protocol.Response.FAILURE,a.error=d)}else a.code=OpenLayers.Protocol.Response.FAILURE;b.callback.call(b.scope,a)}},parseResponse:function(a,b){var c=a.responseXML;if(c&&c.documentElement||(c=a.responseText),!c||c.length<=0)return null;var d=null!==this.readFormat?this.readFormat.read(c):this.format.read(c,b);if(!this.featureNS){var e=this.readFormat||this.format;this.featureNS=e.featureNS,e.autoConfig=!1,this.geometryName||this.setGeometryName(e.geometryName)}return d},commit:function(a,b){b=OpenLayers.Util.extend({},b),OpenLayers.Util.applyDefaults(b,this.options);var c=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:a});return c.priv=OpenLayers.Request.POST({url:b.url,headers:b.headers,data:this.format.write(a,b),callback:this.createCallback(this.handleCommit,c,b)}),c},handleCommit:function(a,b){if(b.callback){var c=a.priv,d=c.responseXML;d&&d.documentElement||(d=c.responseText);var e=this.format.read(d)||{};a.insertIds=e.insertIds||[],e.success?a.code=OpenLayers.Protocol.Response.SUCCESS:(a.code=OpenLayers.Protocol.Response.FAILURE,a.error=e),b.callback.call(b.scope,a)}},filterDelete:function(a,b){b=OpenLayers.Util.extend({},b),OpenLayers.Util.applyDefaults(b,this.options);var c=(new OpenLayers.Protocol.Response({requestType:"commit"}),this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}})),d=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(b.featureNS?this.featurePrefix+":":"")+b.featureType}});b.featureNS&&d.setAttribute("xmlns:"+this.featurePrefix,b.featureNS);var e=this.format.writeNode("ogc:Filter",a);d.appendChild(e),c.appendChild(d);var f=OpenLayers.Format.XML.prototype.write.apply(this.format,[c]);return OpenLayers.Request.POST({url:this.url,callback:b.callback||function(){},data:f})},abort:function(a){a&&a.priv.abort()},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"}),OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{in:"click",out:"clickout"},mousemove:{in:"over",out:"out"},dblclick:{in:"dblclick",out:null},mousedown:{in:null,out:null},mouseup:{in:null,out:null},touchstart:{in:"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(a,b,c,d){OpenLayers.Handler.prototype.initialize.apply(this,[a,c,d]),this.layer=b},touchstart:function(a){return this.startTouch(),!!OpenLayers.Event.isMultiTouch(a)||this.mousedown(a)},touchmove:function(a){OpenLayers.Event.preventDefault(a)},mousedown:function(a){return(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))&&(this.down=a.xy),!this.handle(a)||!this.stopDown},mouseup:function(a){return this.up=a.xy,!this.handle(a)||!this.stopUp},click:function(a){return!this.handle(a)||!this.stopClick},mousemove:function(a){return!this.callbacks.over&&!this.callbacks.out||(this.handle(a),!0)},dblclick:function(a){return!this.handle(a)},geometryTypeMatches:function(a){return null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME)>-1},handle:function(a){this.feature&&!this.feature.layer&&(this.feature=null);var b=a.type,c=!1,d=!!this.feature,e="click"==b||"dblclick"==b||"touchstart"==b;if(this.feature=this.layer.getFeatureFromEvent(a),this.feature&&!this.feature.layer&&(this.feature=null),this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null),this.feature){"touchstart"===b&&OpenLayers.Event.preventDefault(a);var f=this.feature!=this.lastFeature;this.geometryTypeMatches(this.feature)?(d&&f?(this.lastFeature&&this.triggerCallback(b,"out",[this.lastFeature]),this.triggerCallback(b,"in",[this.feature])):d&&!e||this.triggerCallback(b,"in",[this.feature]),this.lastFeature=this.feature,c=!0):(this.lastFeature&&(d&&f||e)&&this.triggerCallback(b,"out",[this.lastFeature]),this.feature=null)}else this.lastFeature&&(d||e)&&this.triggerCallback(b,"out",[this.lastFeature]);return c},triggerCallback:function(a,b,c){var d=this.EVENTMAP[a][b];if(d)if("click"==a&&this.up&&this.down){var e=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));e<=this.clickTolerance&&this.callback(d,c),this.up=this.down=null}else this.callback(d,c)},activate:function(){var a=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),a=!0),a},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.feature=null,this.lastFeature=null,this.down=null,this.up=null,this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),a=!0),a},handleMapEvents:function(a){"removelayer"!=a.type&&"order"!=a.property||this.moveLayerToTop()},moveLayerToTop:function(){var a=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(a)},moveLayerBack:function(){var a=this.layer.getZIndex()-1;a>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(a):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"}),OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:!1,layers:null,display:function(){},getFeatureFromEvent:function(a){for(var b,c=this.layers,d=0;d<c.length;d++)if(b=c[d].getFeatureFromEvent(a))return b},setMap:function(a){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments),this.collectRoots(),a.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(a){a.events.unregister("changelayer",this,this.handleChangeLayer),this.resetRoots(),OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){for(var a,b=0;b<this.map.layers.length;++b)a=this.map.layers[b],-1!=OpenLayers.Util.indexOf(this.layers,a)&&a.renderer.moveRoot(this.renderer)},resetRoots:function(){for(var a,b=0;b<this.layers.length;++b)a=this.layers[b],this.renderer&&a.renderer.getRenderLayerId()==this.id&&this.renderer.moveRoot(a.renderer)},handleChangeLayer:function(a){var b=a.layer;"order"==a.property&&-1!=OpenLayers.Util.indexOf(this.layers,b)&&(this.resetRoots(),this.collectRoots())},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"}),OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),null===this.scope&&(this.scope=this),this.initLayer(a);var c={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(c.over=this.overFeature,c.out=this.outFeature),this.callbacks=OpenLayers.Util.extend(c,this.callbacks),this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})},this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"}))},initLayer:function(a){OpenLayers.Util.isArray(a)?(this.layers=a,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:a})):this.layer=a},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.layers&&this.layer.destroy()},activate:function(){return this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate()),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.active&&(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer)),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(a){var b,c,d,e,f=this.layers||[this.layer];for(d=0;d<f.length;++d)if(b=f[d],e=0,null!=b.selectedFeatures)for(;b.selectedFeatures.length>e;)c=b.selectedFeatures[e],a&&a.except==c?++e:this.unselect(c)},clickFeature:function(a){if(!this.hover){OpenLayers.Util.indexOf(a.layer.selectedFeatures,a)>-1?this.toggleSelect()?this.unselect(a):this.multipleSelect()||this.unselectAll({except:a}):(this.multipleSelect()||this.unselectAll({except:a}),this.select(a))}},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(a){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(a){var b=a.layer;this.hover&&(this.highlightOnly?this.highlight(a):-1==OpenLayers.Util.indexOf(b.selectedFeatures,a)&&this.select(a))},outFeature:function(a){if(this.hover)if(this.highlightOnly){if(a._lastHighlighter==this.id)if(a._prevHighlighter&&a._prevHighlighter!=this.id){delete a._lastHighlighter;var b=this.map.getControl(a._prevHighlighter);b&&b.highlight(a)}else this.unhighlight(a)}else this.unselect(a)},highlight:function(a){var b=a.layer;if(!1!==this.events.triggerEvent("beforefeaturehighlighted",{feature:a})){a._prevHighlighter=a._lastHighlighter,a._lastHighlighter=this.id;var c=this.selectStyle||this.renderIntent;b.drawFeature(a,c),this.events.triggerEvent("featurehighlighted",{feature:a})}},unhighlight:function(a){var b=a.layer;void 0==a._prevHighlighter?delete a._lastHighlighter:a._prevHighlighter==this.id?delete a._prevHighlighter:(a._lastHighlighter=a._prevHighlighter,delete a._prevHighlighter),b.drawFeature(a,a.style||a.layer.style||"default"),this.events.triggerEvent("featureunhighlighted",{feature:a})},select:function(a){var b=this.onBeforeSelect.call(this.scope,a),c=a.layer;!1!==b&&!1!==(b=c.events.triggerEvent("beforefeatureselected",{feature:a}))&&(c.selectedFeatures.push(a),this.highlight(a),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=c.selectedFeatures[0]),c.events.triggerEvent("featureselected",{feature:a}),this.onSelect.call(this.scope,a))},unselect:function(a){var b=a.layer;this.unhighlight(a),OpenLayers.Util.removeItem(b.selectedFeatures,a),b.events.triggerEvent("featureunselected",{feature:a}),this.onUnselect.call(this.scope,a)},selectBox:function(a){if(a instanceof OpenLayers.Bounds){var b=this.map.getLonLatFromPixel({x:a.left,y:a.bottom}),c=this.map.getLonLatFromPixel({x:a.right,y:a.top}),d=new OpenLayers.Bounds(b.lon,b.lat,c.lon,c.lat);this.multipleSelect()||this.unselectAll();var e=this.multiple;this.multiple=!0;var f=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:f});for(var g,h=0;h<f.length;++h){g=f[h];for(var i=0,j=g.features.length;i<j;++i){var k=g.features[i];k.getVisibility()&&((null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,k.geometry.CLASS_NAME)>-1)&&d.toGeometry().intersects(k.geometry)&&-1==OpenLayers.Util.indexOf(g.selectedFeatures,k)&&this.select(k))}}this.multiple=e,this.events.triggerEvent("boxselectionend",{layers:f})}},setMap:function(a){this.handlers.feature.setMap(a),this.box&&this.handlers.box.setMap(a),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(a){var b=this.active;this.unselectAll(),this.deactivate(),this.layers&&(this.layer.destroy(),this.layers=null),this.initLayer(a),this.handlers.feature.layer=this.layer,b&&this.activate()},CLASS_NAME:"OpenLayers.Control.SelectFeature"}),OpenLayers.Protocol.CSW=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Protocol.CSW.DEFAULTS);var b=OpenLayers.Protocol.CSW["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported CSW version: "+a.version;return new b(a)},OpenLayers.Protocol.CSW.DEFAULTS={version:"2.0.2"},OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.1.0",initialize:function(a){OpenLayers.Protocol.WFS.v1.prototype.initialize.apply(this,arguments),this.outputFormat&&!this.readFormat&&("gml2"==this.outputFormat.toLowerCase()?this.readFormat=new OpenLayers.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName}):"json"==this.outputFormat.toLowerCase()&&(this.readFormat=new OpenLayers.Format.GeoJSON))},CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"}),OpenLayers.Format.WMTSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":!0},createLayer:function(a,b){if(!("layer"in b))throw new Error("Missing property 'layer' in configuration.");for(var c,d=a.contents,e=(d.layers,0),f=d.layers.length;e<f;++e)if(d.layers[e].identifier===b.layer){c=d.layers[e];break}if(!c)throw new Error("Layer not found");var g=b.format;!g&&c.formats&&c.formats.length&&(g=c.formats[0]);var h;if(b.matrixSet?h=d.tileMatrixSets[b.matrixSet]:c.tileMatrixSetLinks.length>=1&&(h=d.tileMatrixSets[c.tileMatrixSetLinks[0].tileMatrixSet]),!h)throw new Error("matrixSet not found");for(var i,e=0,f=c.styles.length;e<f&&(i=c.styles[e],!i.isDefault);++e);var j=b.requestEncoding;if(!j&&(j="KVP",a.operationsMetadata.GetTile.dcp.http)){var k=a.operationsMetadata.GetTile.dcp.http;if(k.get[0].constraints){var l=k.get[0].constraints,m=l.GetEncoding.allowedValues;m.KVP||!m.REST&&!m.RESTful||(j="REST")}}var n=[],o=b.params||{};delete b.params;for(var p=0,q=c.dimensions.length;p<q;p++){var r=c.dimensions[p];n.push(r.identifier),o.hasOwnProperty(r.identifier)||(o[r.identifier]=r.default)}var s=b.projection||h.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"),t=b.units||("EPSG:4326"===s?"degrees":"m"),u=[];for(var v in h.matrixIds)h.matrixIds.hasOwnProperty(v)&&u.push(28e-5*h.matrixIds[v].scaleDenominator/OpenLayers.METERS_PER_INCH/OpenLayers.INCHES_PER_UNIT[t]);var w;if("REST"===j&&c.resourceUrls){w=[];for(var x,y=(c.resourceUrls,0),z=c.resourceUrls.length;y<z;++y)x=c.resourceUrls[y],x.format===g&&"tile"===x.resourceType&&w.push(x.template)}else{var A=a.operationsMetadata.GetTile.dcp.http.get;w=[];for(var B,e=0,f=A.length;e<f;e++)(!(B=A[e].constraints)||B&&B.GetEncoding.allowedValues[j])&&w.push(A[e].url)}return new OpenLayers.Layer.WMTS(OpenLayers.Util.applyDefaults(b,{url:w,requestEncoding:j,name:c.title,style:i.identifier,format:g,matrixIds:h.matrixIds,matrixSet:h.identifier,projection:s,units:t,resolutions:!1===b.isBaseLayer?void 0:u,serverResolutions:u,tileFullExtent:h.bounds,dimensions:n,params:o}))},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities"}),OpenLayers.Layer.Google.v3={DEFAULTS:{sphericalMercator:!0,projection:"EPSG:900913"},animationEnabled:!0,loadMapObject:function(){this.type||(this.type=google.maps.MapTypeId.ROADMAP);var a,b=OpenLayers.Layer.Google.cache[this.map.id];if(b)a=b.mapObject,++b.count;else{var c=this.map.getCenter(),d=document.createElement("div");d.className="olForeignContainer",d.style.width="100%",d.style.height="100%",a=new google.maps.Map(d,{center:c?new google.maps.LatLng(c.lat,c.lon):new google.maps.LatLng(0,0),zoom:this.map.getZoom()||0,mapTypeId:this.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1});var e=document.createElement("div");e.style.width="100%",e.style.height="100%",a.controls[google.maps.ControlPosition.TOP_LEFT].push(e),b={googleControl:e,mapObject:a,count:1},OpenLayers.Layer.Google.cache[this.map.id]=b}this.mapObject=a,this.setGMapVisibility(this.visibility)},onMapResize:function(){this.visibility&&google.maps.event.trigger(this.mapObject,"resize")},setGMapVisibility:function(a){var b=OpenLayers.Layer.Google.cache[this.map.id],c=this.map;if(b){for(var d,e=this.type,f=c.layers,g=f.length-1;g>=0;--g)if((d=f[g])instanceof OpenLayers.Layer.Google&&!0===d.visibility&&!0===d.inRange){e=d.type,a=!0;break}var h=this.mapObject.getDiv();if(!0===a){if(h.parentNode!==c.div)if(b.rendered)c.div.appendChild(h),b.googleControl.appendChild(c.viewPortDiv),google.maps.event.trigger(this.mapObject,"resize");else{var i=this;google.maps.event.addListenerOnce(this.mapObject,"tilesloaded",function(){b.rendered=!0,i.setGMapVisibility(i.getVisibility()),i.moveTo(i.map.getCenter())})}this.mapObject.setMapTypeId(e)}else b.googleControl.hasChildNodes()&&(c.div.appendChild(c.viewPortDiv),c.div.removeChild(h))}},getMapContainer:function(){return this.mapObject.getDiv()},getMapObjectBoundsFromOLBounds:function(a){var b=null;if(null!=a){var c=this.sphericalMercator?this.inverseMercator(a.bottom,a.left):new OpenLayers.LonLat(a.bottom,a.left),d=this.sphericalMercator?this.inverseMercator(a.top,a.right):new OpenLayers.LonLat(a.top,a.right);b=new google.maps.LatLngBounds(new google.maps.LatLng(c.lat,c.lon),new google.maps.LatLng(d.lat,d.lon))}return b},getMapObjectLonLatFromMapObjectPixel:function(a){var b=this.map.getSize(),c=this.getLongitudeFromMapObjectLonLat(this.mapObject.center),d=this.getLatitudeFromMapObjectLonLat(this.mapObject.center),e=this.map.getResolution(),f=a.x-b.w/2,g=a.y-b.h/2,h=new OpenLayers.LonLat(c+f*e,d-g*e);return this.wrapDateLine&&(h=h.wrapDateLine(this.maxExtent)),this.getMapObjectLonLatFromLonLat(h.lon,h.lat)},getMapObjectPixelFromMapObjectLonLat:function(a){var b=this.getLongitudeFromMapObjectLonLat(a),c=this.getLatitudeFromMapObjectLonLat(a),d=this.map.getResolution(),e=this.map.getExtent();return this.getMapObjectPixelFromXY(1/d*(b-e.left),1/d*(e.top-c))},setMapObjectCenter:function(a,b){if(!1===this.animationEnabled&&b!=this.mapObject.zoom){var c=this.getMapContainer();google.maps.event.addListenerOnce(this.mapObject,"idle",function(){c.style.visibility=""}),c.style.visibility="hidden"}this.mapObject.setOptions({center:a,zoom:b})},getMapObjectZoomFromMapObjectBounds:function(a){return this.mapObject.getBoundsZoomLevel(a)},getMapObjectLonLatFromLonLat:function(a,b){var c;if(this.sphericalMercator){var d=this.inverseMercator(a,b);c=new google.maps.LatLng(d.lat,d.lon)}else c=new google.maps.LatLng(b,a);return c},getMapObjectPixelFromXY:function(a,b){return new google.maps.Point(a,b)}},OpenLayers.Format.WPSDescribeProcess=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{wps:"http://www.opengis.net/wps/1.0.0",ows:"http://www.opengis.net/ows/1.1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",defaultPrefix:"wps",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},readers:{wps:{ProcessDescriptions:function(a,b){b.processDescriptions={},this.readChildNodes(a,b.processDescriptions)},ProcessDescription:function(a,b){var c=this.getAttributeNS(a,this.namespaces.wps,"processVersion"),d={processVersion:c,statusSupported:"true"===a.getAttribute("statusSupported"),storeSupported:"true"===a.getAttribute("storeSupported")};this.readChildNodes(a,d),b[d.identifier]=d},DataInputs:function(a,b){b.dataInputs=[],this.readChildNodes(a,b.dataInputs)},ProcessOutputs:function(a,b){b.processOutputs=[],this.readChildNodes(a,b.processOutputs)},Output:function(a,b){var c={};this.readChildNodes(a,c),b.push(c)},ComplexOutput:function(a,b){b.complexOutput={},this.readChildNodes(a,b.complexOutput)},LiteralOutput:function(a,b){b.literalOutput={},this.readChildNodes(a,b.literalOutput)},Input:function(a,b){var c={maxOccurs:parseInt(a.getAttribute("maxOccurs")),minOccurs:parseInt(a.getAttribute("minOccurs"))};this.readChildNodes(a,c),b.push(c)},BoundingBoxData:function(a,b){b.boundingBoxData={},this.readChildNodes(a,b.boundingBoxData)},CRS:function(a,b){b.CRSs||(b.CRSs={}),b.CRSs[this.getChildValue(a)]=!0},LiteralData:function(a,b){b.literalData={},this.readChildNodes(a,b.literalData)},ComplexData:function(a,b){b.complexData={},this.readChildNodes(a,b.complexData)},Default:function(a,b){b.default={},this.readChildNodes(a,b.default)},Supported:function(a,b){b.supported={},this.readChildNodes(a,b.supported)},Format:function(a,b){var c={};this.readChildNodes(a,c),b.formats||(b.formats={}),b.formats[c.mimeType]=!0},MimeType:function(a,b){b.mimeType=this.getChildValue(a)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSDescribeProcess"}),OpenLayers.WPSProcess=OpenLayers.Class({client:null,server:null,identifier:null,description:null,localWPS:"http://geoserver/wps",formats:null,chained:0,executeCallbacks:null,initialize:function(a){OpenLayers.Util.extend(this,a),this.executeCallbacks=[],this.formats={"application/wkt":new OpenLayers.Format.WKT,"application/json":new OpenLayers.Format.GeoJSON}},describe:function(a){if(a=a||{},this.description){if(a.callback){var b=this.description;window.setTimeout(function(){a.callback.call(a.scope,b)},0)}}else this.client.describeProcess(this.server,this.identifier,function(b){this.description||this.parseDescription(b),a.callback&&a.callback.call(a.scope,this.description)},this)},configure:function(a){return this.describe({callback:function(){var b,c,d,e=this.description,f=a.inputs;for(c=0,d=e.dataInputs.length;c<d;++c)b=e.dataInputs[c],this.setInputData(b,f[b.identifier]);a.callback&&a.callback.call(a.scope)},scope:this}),this},execute:function(a){this.configure({inputs:a.inputs,callback:function(){var b=this,c=this.getOutputIndex(b.description.processOutputs,a.output);b.setResponseForm({outputIndex:c}),function d(){if(OpenLayers.Util.removeItem(b.executeCallbacks,d),0!==b.chained)return void b.executeCallbacks.push(d);OpenLayers.Request.POST({url:b.client.servers[b.server].url,data:(new OpenLayers.Format.WPSExecute).write(b.description),success:function(d){
var e=b.description.processOutputs[c],f=b.findMimeType(e.complexOutput.supported.formats),g=b.formats[f].read(d.responseText);if(g instanceof OpenLayers.Feature.Vector&&(g=[g]),a.success){var h={};h[a.output||"result"]=g,a.success.call(a.scope,h)}},scope:b})}()},scope:this})},output:function(a){return new OpenLayers.WPSProcess.ChainLink({process:this,output:a})},parseDescription:function(a){var b=this.client.servers[this.server];this.description=(new OpenLayers.Format.WPSDescribeProcess).read(b.processDescription[this.identifier]).processDescriptions[this.identifier]},setInputData:function(a,b){if(delete a.data,delete a.reference,b instanceof OpenLayers.WPSProcess.ChainLink)++this.chained,a.reference={method:"POST",href:b.process.server===this.server?this.localWPS:this.client.servers[b.process.server].url},b.process.describe({callback:function(){--this.chained,this.chainProcess(a,b)},scope:this});else{a.data={};var c=a.complexData;if(c){var d=this.findMimeType(c.supported.formats);a.data.complexData={mimeType:d,value:this.formats[d].write(this.toFeatures(b))}}else a.data.literalData={value:b}}},setResponseForm:function(a){a=a||{};var b=this.description.processOutputs[a.outputIndex||0];this.description.responseForm={rawDataOutput:{identifier:b.identifier,mimeType:this.findMimeType(b.complexOutput.supported.formats,a.supportedFormats)}}},getOutputIndex:function(a,b){var c;if(b){for(var d=a.length-1;d>=0;--d)if(a[d].identifier===b){c=d;break}}else c=0;return c},chainProcess:function(a,b){var c=this.getOutputIndex(b.process.description.processOutputs,b.output);a.reference.mimeType=this.findMimeType(a.complexData.supported.formats,b.process.description.processOutputs[c].complexOutput.supported.formats);var d={};for(d[a.reference.mimeType]=!0,b.process.setResponseForm({outputIndex:c,supportedFormats:d}),a.reference.body=b.process.description;this.executeCallbacks.length>0;)this.executeCallbacks[0]()},toFeatures:function(a){var b=OpenLayers.Util.isArray(a);b||(a=[a]);for(var c,d=new Array(a.length),e=0,f=a.length;e<f;++e)c=a[e],d[e]=c instanceof OpenLayers.Feature.Vector?c:new OpenLayers.Feature.Vector(c);return b?d:d[0]},findMimeType:function(a,b){b=b||this.formats;for(var c in a)if(c in b)return c},CLASS_NAME:"OpenLayers.WPSProcess"}),OpenLayers.WPSProcess.ChainLink=OpenLayers.Class({process:null,output:null,initialize:function(a){OpenLayers.Util.extend(this,a)},CLASS_NAME:"OpenLayers.WPSProcess.ChainLink"}),OpenLayers.WPSClient=OpenLayers.Class({servers:null,version:"1.0.0",lazy:!1,events:null,initialize:function(a){OpenLayers.Util.extend(this,a),this.events=new OpenLayers.Events(this),this.servers={};for(var b in a.servers)this.servers[b]="string"==typeof a.servers[b]?{url:a.servers[b],version:this.version,processDescription:{}}:a.servers[b]},execute:function(a){this.getProcess(a.server,a.process).execute({inputs:a.inputs,success:a.success,scope:a.scope})},getProcess:function(a,b){var c=new OpenLayers.WPSProcess({client:this,server:a,identifier:b});return this.lazy||c.describe(),c},describeProcess:function(a,b,c,d){var e=this.servers[a];e.processDescription[b]?window.setTimeout(function(){c.call(d,e.processDescription[b])},0):b in e.processDescription?this.events.register("describeprocess",this,function a(e){e.identifier===b&&(this.events.unregister("describeprocess",this,a),c.call(d,e.raw))}):(e.processDescription[b]=null,OpenLayers.Request.GET({url:e.url,params:{SERVICE:"WPS",VERSION:e.version,REQUEST:"DescribeProcess",IDENTIFIER:b},success:function(a){e.processDescription[b]=a.responseText,this.events.triggerEvent("describeprocess",{identifier:b,raw:a.responseText})},scope:this}))},destroy:function(){this.events.destroy(),this.events=null,this.servers=null},CLASS_NAME:"OpenLayers.WPSClient"}),OpenLayers.Format.CSWGetRecords.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",gmd:"http://www.isotc211.org/2005/gmd",geonet:"http://www.fao.org/geonetwork",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},readers:{csw:{GetRecordsResponse:function(a,b){b.records=[],this.readChildNodes(a,b);var c=this.getAttributeNS(a,"","version");""!=c&&(b.version=c)},RequestId:function(a,b){b.RequestId=this.getChildValue(a)},SearchStatus:function(a,b){b.SearchStatus={};var c=this.getAttributeNS(a,"","timestamp");""!=c&&(b.SearchStatus.timestamp=c)},SearchResults:function(a,b){this.readChildNodes(a,b);for(var c=a.attributes,d={},e=0,f=c.length;e<f;++e)"numberOfRecordsMatched"==c[e].name||"numberOfRecordsReturned"==c[e].name||"nextRecord"==c[e].name?d[c[e].name]=parseInt(c[e].nodeValue):d[c[e].name]=c[e].nodeValue;b.SearchResults=d},SummaryRecord:function(a,b){var c={type:"SummaryRecord"};this.readChildNodes(a,c),b.records.push(c)},BriefRecord:function(a,b){var c={type:"BriefRecord"};this.readChildNodes(a,c),b.records.push(c)},DCMIRecord:function(a,b){var c={type:"DCMIRecord"};this.readChildNodes(a,c),b.records.push(c)},Record:function(a,b){var c={type:"Record"};this.readChildNodes(a,c),b.records.push(c)},"*":function(a,b){b[a.localName||a.nodeName.split(":").pop()]=this.getChildValue(a)}},geonet:{info:function(a,b){var c={};this.readChildNodes(a,c),b.gninfo=c}},dc:{"*":function(a,b){var c=a.localName||a.nodeName.split(":").pop();OpenLayers.Util.isArray(b[c])||(b[c]=[]);for(var d={},e=a.attributes,f=0,g=e.length;f<g;++f)d[e[f].name]=e[f].nodeValue;d.value=this.getChildValue(a),""!=d.value&&b[c].push(d)}},dct:{"*":function(a,b){var c=a.localName||a.nodeName.split(":").pop();OpenLayers.Util.isArray(b[c])||(b[c]=[]),b[c].push(this.getChildValue(a))}},ows:OpenLayers.Util.applyDefaults({BoundingBox:function(a,b){b.bounds&&(b.BoundingBox=[{crs:b.projection,value:[b.bounds.left,b.bounds.bottom,b.bounds.right,b.bounds.top]}],delete b.projection,delete b.bounds),OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows.BoundingBox.apply(this,arguments)}},OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(a){var b=this.writeNode("csw:GetRecords",a);return b.setAttribute("xmlns:gmd",this.namespaces.gmd),OpenLayers.Format.XML.prototype.write.apply(this,[b])},writers:{csw:{GetRecords:function(a){a||(a={});var b=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:a.requestId||this.requestId,resultType:a.resultType||this.resultType,outputFormat:a.outputFormat||this.outputFormat,outputSchema:a.outputSchema||this.outputSchema,startPosition:a.startPosition||this.startPosition,maxRecords:a.maxRecords||this.maxRecords}});(a.DistributedSearch||this.DistributedSearch)&&this.writeNode("csw:DistributedSearch",a.DistributedSearch||this.DistributedSearch,b);var c=a.ResponseHandler||this.ResponseHandler;if(OpenLayers.Util.isArray(c)&&c.length>0)for(var d=0,e=c.length;d<e;d++)this.writeNode("csw:ResponseHandler",c[d],b);return this.writeNode("Query",a.Query||this.Query,b),b},DistributedSearch:function(a){return this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:a.hopCount}})},ResponseHandler:function(a){return this.createElementNSPlus("csw:ResponseHandler",{value:a.value})},Query:function(a){a||(a={});var b=this.createElementNSPlus("csw:Query",{attributes:{typeNames:a.typeNames||"csw:Record"}}),c=a.ElementName;if(OpenLayers.Util.isArray(c)&&c.length>0)for(var d=0,e=c.length;d<e;d++)this.writeNode("csw:ElementName",c[d],b);else this.writeNode("csw:ElementSetName",a.ElementSetName||{value:"summary"},b);return a.Constraint&&this.writeNode("csw:Constraint",a.Constraint,b),a.SortBy&&this.writeNode("ogc:SortBy",a.SortBy,b),b},ElementName:function(a){return this.createElementNSPlus("csw:ElementName",{value:a.value})},ElementSetName:function(a){return this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:a.typeNames},value:a.value})},Constraint:function(a){var b=this.createElementNSPlus("csw:Constraint",{attributes:{version:a.version}});if(a.Filter){var c=new OpenLayers.Format.Filter({version:a.version});b.appendChild(c.write(a.Filter))}else if(a.CqlText){var d=this.createElementNSPlus("CqlText",{value:a.CqlText.value});b.appendChild(d)}return b}},ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2"}),OpenLayers.Marker.Box=OpenLayers.Class(OpenLayers.Marker,{bounds:null,div:null,initialize:function(a,b,c){this.bounds=a,this.div=OpenLayers.Util.createDiv(),this.div.style.overflow="hidden",this.events=new OpenLayers.Events(this,this.div),this.setBorder(b,c)},destroy:function(){this.bounds=null,this.div=null,OpenLayers.Marker.prototype.destroy.apply(this,arguments)},setBorder:function(a,b){a||(a="red"),b||(b=2),this.div.style.border=b+"px solid "+a},draw:function(a,b){return OpenLayers.Util.modifyDOMElement(this.div,null,a,b),this.div},onScreen:function(){var a=!1;if(this.map){a=this.map.getExtent().containsBounds(this.bounds,!0,!0)}return a},display:function(a){this.div.style.display=a?"":"none"},CLASS_NAME:"OpenLayers.Marker.Box"}),OpenLayers.Format.Text=OpenLayers.Class(OpenLayers.Format,{defaultStyle:null,extractStyles:!0,initialize:function(a){a=a||{},!1!==a.extractStyles&&(a.defaultStyle={externalGraphic:OpenLayers.Util.getImageLocation("marker.png"),graphicWidth:21,graphicHeight:25,graphicXOffset:-10.5,graphicYOffset:-12.5}),OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(a){for(var b,c=a.split("\n"),d=[],e=0;e<c.length-1;e++){var f=c[e].replace(/^\s*/,"").replace(/\s*$/,"");if("#"!=f.charAt(0))if(b){for(var g=f.split("\t"),h=new OpenLayers.Geometry.Point(0,0),i={},j=this.defaultStyle?OpenLayers.Util.applyDefaults({},this.defaultStyle):null,k=!1,l=0;l<g.length;l++)if(g[l])if("point"==b[l]){var m=g[l].split(",");h.y=parseFloat(m[0]),h.x=parseFloat(m[1]),k=!0}else if("lat"==b[l])h.y=parseFloat(g[l]),k=!0;else if("lon"==b[l])h.x=parseFloat(g[l]),k=!0;else if("title"==b[l])i.title=g[l];else if("image"==b[l]||"icon"==b[l]&&j)j.externalGraphic=g[l];else if("iconSize"==b[l]&&j){var n=g[l].split(",");j.graphicWidth=parseFloat(n[0]),j.graphicHeight=parseFloat(n[1])}else if("iconOffset"==b[l]&&j){var o=g[l].split(",");j.graphicXOffset=parseFloat(o[0]),j.graphicYOffset=parseFloat(o[1])}else"description"==b[l]?i.description=g[l]:"overflow"==b[l]?i.overflow=g[l]:i[b[l]]=g[l];if(k){this.internalProjection&&this.externalProjection&&h.transform(this.externalProjection,this.internalProjection);var p=new OpenLayers.Feature.Vector(h,i,j);d.push(p)}}else b=f.split("\t")}return d},CLASS_NAME:"OpenLayers.Format.Text"}),OpenLayers.Layer.Text=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(a,b){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments),this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments),this.clearFeatures(),this.features=null},loadText:function(){if(!this.loaded&&null!=this.location){var a=function(a){this.events.triggerEvent("loadend")};this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,failure:a,scope:this}),this.loaded=!0}},moveTo:function(a,b,c){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments),this.visibility&&!this.loaded&&this.loadText()},parseData:function(a){var b=a.responseText,c={};OpenLayers.Util.extend(c,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(c.externalProjection=this.projection,c.internalProjection=this.map.getProjectionObject());for(var d=new OpenLayers.Format.Text(c),e=d.read(b),f=0,g=e.length;f<g;f++){var h,i,j,k={},l=e[f];h=new OpenLayers.LonLat(l.geometry.x,l.geometry.y),l.style.graphicWidth&&l.style.graphicHeight&&(i=new OpenLayers.Size(l.style.graphicWidth,l.style.graphicHeight)),void 0!==l.style.graphicXOffset&&void 0!==l.style.graphicYOffset&&(j=new OpenLayers.Pixel(l.style.graphicXOffset,l.style.graphicYOffset)),null!=l.style.externalGraphic?k.icon=new OpenLayers.Icon(l.style.externalGraphic,i,j):(k.icon=OpenLayers.Marker.defaultIcon(),null!=i&&k.icon.setSize(i)),null!=l.attributes.title&&null!=l.attributes.description&&(k.popupContentHTML="<h2>"+l.attributes.title+"</h2><p>"+l.attributes.description+"</p>"),k.overflow=l.attributes.overflow||"auto";var m=new OpenLayers.Feature(this,h,k);this.features.push(m);var n=m.createMarker();null!=l.attributes.title&&null!=l.attributes.description&&n.events.register("click",m,this.markerClick),this.addMarker(n)}this.events.triggerEvent("loadend")},markerClick:function(a){var b=this==this.layer.selectedFeature;this.layer.selectedFeature=b?null:this;for(var c=0,d=this.layer.map.popups.length;c<d;c++)this.layer.map.removePopup(this.layer.map.popups[c]);b||this.layer.map.addPopup(this.createPopup()),OpenLayers.Event.stop(a)},clearFeatures:function(){if(null!=this.features)for(;this.features.length>0;){var a=this.features[0];OpenLayers.Util.removeItem(this.features,a),a.destroy()}},CLASS_NAME:"OpenLayers.Layer.Text"}),OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:!1,irregular:!1,citeCompliant:!1,angle:null,fixedRadius:!1,feature:null,layer:null,origin:null,initialize:function(a,b,c){c&&c.layerOptions&&c.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style.default,{})),OpenLayers.Handler.Drag.prototype.initialize.apply(this,[a,b,c]),this.options=c||{}},setOptions:function(a){OpenLayers.Util.extend(this.options,a),OpenLayers.Util.extend(this,a)},activate:function(){var a=!1;if(OpenLayers.Handler.Drag.prototype.activate.apply(this,arguments)){var b=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,b),this.map.addLayer(this.layer),a=!0}return a},deactivate:function(){var a=!1;return OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)&&(this.dragging&&this.cancel(),null!=this.layer.map&&(this.layer.destroy(!1),this.feature&&this.feature.destroy()),this.layer=null,this.feature=null,a=!0),a},down:function(a){this.fixedRadius=!!this.radius;var b=this.layer.getLonLatFromViewPortPx(a.xy);this.origin=new OpenLayers.Geometry.Point(b.lon,b.lat),this.fixedRadius&&!this.irregular||(this.radius=this.map.getResolution()),this.persist&&this.clear(),this.feature=new OpenLayers.Feature.Vector,this.createGeometry(),this.callback("create",[this.origin,this.feature]),this.layer.addFeatures([this.feature],{silent:!0}),this.layer.drawFeature(this.feature,this.style)},move:function(a){var b=this.layer.getLonLatFromViewPortPx(a.xy),c=new OpenLayers.Geometry.Point(b.lon,b.lat);if(this.irregular){var d=Math.sqrt(2)*Math.abs(c.y-this.origin.y)/2;this.radius=Math.max(this.map.getResolution()/2,d)}else this.fixedRadius?this.origin=c:(this.calculateAngle(c,a),this.radius=Math.max(this.map.getResolution()/2,c.distanceTo(this.origin)));if(this.modifyGeometry(),this.irregular){var e,f=c.x-this.origin.x,g=c.y-this.origin.y;e=0==g?f/(this.radius*Math.sqrt(2)):f/g,this.feature.geometry.resize(1,this.origin,e),this.feature.geometry.move(f/2,g/2)}this.layer.drawFeature(this.feature,this.style)},up:function(a){this.finalize(),this.start==this.last&&this.callback("done",[a.xy])},out:function(a){this.finalize()},createGeometry:function(){this.angle=Math.PI*(1/this.sides-.5),this.snapAngle&&(this.angle+=this.snapAngle*(Math.PI/180)),this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)},modifyGeometry:function(){var a,b,c=this.feature.geometry.components[0];c.components.length!=this.sides+1&&(this.createGeometry(),c=this.feature.geometry.components[0]);for(var d=0;d<this.sides;++d)b=c.components[d],a=this.angle+2*d*Math.PI/this.sides,b.x=this.origin.x+this.radius*Math.cos(a),b.y=this.origin.y+this.radius*Math.sin(a),b.clearBounds()},calculateAngle:function(a,b){var c=Math.atan2(a.y-this.origin.y,a.x-this.origin.x);if(this.snapAngle&&this.snapToggle&&!b[this.snapToggle]){var d=Math.PI/180*this.snapAngle;this.angle=Math.round(c/d)*d}else this.angle=c},cancel:function(){this.callback("cancel",null),this.finalize()},finalize:function(){this.origin=null,this.radius=this.options.radius},clear:function(){this.layer&&(this.layer.renderer.clear(),this.layer.destroyFeatures())},callback:function(a,b){this.callbacks[a]&&this.callbacks[a].apply(this.control,[this.feature.geometry.clone()]),this.persist||"done"!=a&&"cancel"!=a||this.clear()},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"}),OpenLayers.Control.SLDSelect=OpenLayers.Class(OpenLayers.Control,{clearOnDeactivate:!1,layers:null,callbacks:null,selectionSymbolizer:{Polygon:{fillColor:"#FF0000",stroke:!1},Line:{strokeColor:"#FF0000",strokeWidth:2},Point:{graphicName:"square",fillColor:"#FF0000",pointRadius:5}},layerOptions:null,sketchStyle:null,wfsCache:{},layerCache:{},initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),this.callbacks=OpenLayers.Util.extend({done:this.select,click:this.select},this.callbacks),this.handlerOptions=this.handlerOptions||{},this.layerOptions=OpenLayers.Util.applyDefaults(this.layerOptions,{displayInLayerSwitcher:!1,tileOptions:{maxGetUrlLength:2048}}),this.sketchStyle&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({default:this.sketchStyle})})),this.handler=new a(this,this.callbacks,this.handlerOptions)},destroy:function(){for(var a in this.layerCache)delete this.layerCache[a];for(var a in this.wfsCache)delete this.wfsCache[a];OpenLayers.Control.prototype.destroy.apply(this,arguments)},coupleLayerVisiblity:function(a){this.setVisibility(a.object.getVisibility())},createSelectionLayer:function(a){var b;return this.layerCache[a.id]?b=this.layerCache[a.id]:(b=new OpenLayers.Layer.WMS(a.name,a.url,a.params,OpenLayers.Util.applyDefaults(this.layerOptions,a.getOptions())),this.layerCache[a.id]=b,!1===this.layerOptions.displayInLayerSwitcher&&a.events.on({visibilitychanged:this.coupleLayerVisiblity,scope:b}),this.map.addLayer(b)),b},createSLD:function(a,b,c){for(var d={version:"1.0.0",namedLayers:{}},e=[a.params.LAYERS].join(",").split(","),f=0,g=e.length;f<g;f++){var h=e[f];d.namedLayers[h]={name:h,userStyles:[]};var i=this.selectionSymbolizer,j=c[f];j.type.indexOf("Polygon")>=0?i={Polygon:this.selectionSymbolizer.Polygon}:j.type.indexOf("LineString")>=0?i={Line:this.selectionSymbolizer.Line}:j.type.indexOf("Point")>=0&&(i={Point:this.selectionSymbolizer.Point});var k=b[f];d.namedLayers[h].userStyles.push({name:"default",rules:[new OpenLayers.Rule({symbolizer:i,filter:k,maxScaleDenominator:a.options.minScale})]})}return new OpenLayers.Format.SLD({srsName:this.map.getProjection()}).write(d)},parseDescribeLayer:function(a){var b=new OpenLayers.Format.WMSDescribeLayer,c=a.responseXML;c&&c.documentElement||(c=a.responseText);for(var d=b.read(c),e=[],f=null,g=0,h=d.length;g<h;g++)"WFS"==d[g].owsType&&(e.push(d[g].typeName),f=d[g].owsURL);var i={url:f,params:{SERVICE:"WFS",TYPENAME:e.toString(),REQUEST:"DescribeFeatureType",VERSION:"1.0.0"},callback:function(a){var b=new OpenLayers.Format.WFSDescribeFeatureType,c=a.responseXML;c&&c.documentElement||(c=a.responseText);var d=b.read(c);this.control.wfsCache[this.layer.id]=d,this.control._queue&&this.control.applySelection()},scope:this};OpenLayers.Request.GET(i)},getGeometryAttributes:function(a){for(var b=[],c=this.wfsCache[a.id],d=0,e=c.featureTypes.length;d<e;d++)for(var f=c.featureTypes[d],g=f.properties,h=0,i=g.length;h<i;h++){var j=g[h],k=j.type;(k.indexOf("LineString")>=0||k.indexOf("GeometryAssociationType")>=0||k.indexOf("GeometryPropertyType")>=0||k.indexOf("Point")>=0||k.indexOf("Polygon")>=0)&&b.push(j)}return b},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);if(a)for(var b=0,c=this.layers.length;b<c;b++){var d=this.layers[b];if(d&&!this.wfsCache[d.id]){var e={url:d.url,params:{SERVICE:"WMS",VERSION:d.params.VERSION,LAYERS:d.params.LAYERS,REQUEST:"DescribeLayer"},callback:this.parseDescribeLayer,scope:{layer:d,control:this}};OpenLayers.Request.GET(e)}}return a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);if(a)for(var b=0,c=this.layers.length;b<c;b++){var d=this.layers[b];if(d&&!0===this.clearOnDeactivate){var e=this.layerCache,f=e[d.id];f&&(d.events.un({visibilitychanged:this.coupleLayerVisiblity,scope:f}),f.destroy(),delete e[d.id])}}return a},setLayers:function(a){this.active?(this.deactivate(),this.layers=a,this.activate()):this.layers=a},createFilter:function(a,b){var c=null;return this.handler instanceof OpenLayers.Handler.RegularPolygon?c=!0===this.handler.irregular?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:a.name,value:b.getBounds()}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b}):this.handler instanceof OpenLayers.Handler.Polygon?c=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b}):this.handler instanceof OpenLayers.Handler.Path?c=a.type.indexOf("Point")>=0?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:a.name,distance:.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:b}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b}):this.handler instanceof OpenLayers.Handler.Click&&(c=a.type.indexOf("Polygon")>=0?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b}):new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:a.name,distance:.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:b})),c},select:function(a){this._queue=function(){for(var b=0,c=this.layers.length;b<c;b++){for(var d=this.layers[b],e=this.getGeometryAttributes(d),f=[],g=0,h=e.length;g<h;g++){var i=e[g];if(null!==i){if(!(a instanceof OpenLayers.Geometry)){var j=this.map.getLonLatFromPixel(a.xy);a=new OpenLayers.Geometry.Point(j.lon,j.lat)}var k=this.createFilter(i,a);null!==k&&f.push(k)}}var l=this.createSelectionLayer(d);this.events.triggerEvent("selected",{layer:d,filters:f});var m=this.createSLD(d,f,e);l.mergeNewParams({SLD_BODY:m}),delete this._queue}},this.applySelection()},applySelection:function(){for(var a=!0,b=0,c=this.layers.length;b<c;b++)if(!this.wfsCache[this.layers[b].id]){a=!1;break}a&&this._queue.call(this)},CLASS_NAME:"OpenLayers.Control.SLDSelect"}),OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:!1,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),this.element=OpenLayers.Util.getElement(a)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.element=document.createElement("div"),this.div.appendChild(this.element)),this.map.events.register("moveend",this,this.updateScale),this.updateScale(),this.div},updateScale:function(){var a;if(!0===this.geodesic){if(!this.map.getUnits())return;var b=OpenLayers.INCHES_PER_UNIT;a=(this.map.getGeodesicPixelSize().w||1e-6)*b.km*OpenLayers.DOTS_PER_INCH}else a=this.map.getScale();a&&(a=a>=9500&&a<=95e4?Math.round(a/1e3)+"K":a>=95e4?Math.round(a/1e6)+"M":Math.round(a),this.element.innerHTML=OpenLayers.i18n("Scale = 1 : ${scaleDenom}",{scaleDenom:a}))},CLASS_NAME:"OpenLayers.Control.Scale"}),OpenLayers.Protocol.SOS=function(a){a=OpenLayers.Util.applyDefaults(a,OpenLayers.Protocol.SOS.DEFAULTS);var b=OpenLayers.Protocol.SOS["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported SOS version: "+a.version;return new b(a)},OpenLayers.Protocol.SOS.DEFAULTS={version:"1.0.0"},OpenLayers.Protocol.SOS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol,{fois:null,formatOptions:null,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a]),a.format||(this.format=new OpenLayers.Format.SOSGetFeatureOfInterest(this.formatOptions))},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){a=OpenLayers.Util.extend({},a),OpenLayers.Util.applyDefaults(a,this.options||{});var b=new OpenLayers.Protocol.Response({requestType:"read"}),c=this.format,d=OpenLayers.Format.XML.prototype.write.apply(c,[c.writeNode("sos:GetFeatureOfInterest",{fois:this.fois})]);return b.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,b,a),data:d}),b},handleRead:function(a,b){if(b.callback){var c=a.priv;c.status>=200&&c.status<300?(a.features=this.parseFeatures(c),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE,b.callback.call(b.scope,a)}},parseFeatures:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),!b||b.length<=0?null:this.format.read(b)},CLASS_NAME:"OpenLayers.Protocol.SOS.v1_0_0"}),OpenLayers.Layer.MapGuide=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,useHttpTile:!1,singleTile:!1,useOverlay:!1,useAsyncOverlay:!0,TILE_PARAMS:{operation:"GETTILEIMAGE",version:"1.2.0"},SINGLE_TILE_PARAMS:{operation:"GETMAPIMAGE",format:"PNG",locale:"en",clip:"1",version:"1.0.0"},OVERLAY_PARAMS:{operation:"GETDYNAMICMAPOVERLAYIMAGE",format:"PNG",locale:"en",clip:"1",version:"2.0.0"},FOLDER_PARAMS:{tileColumnsPerFolder:30,tileRowsPerFolder:30,format:"png",querystring:null},defaultSize:new OpenLayers.Size(300,300),tileOriginCorner:"tl",initialize:function(a,b,c,d){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments),null!=d&&null!=d.isBaseLayer||(this.isBaseLayer="true"!=this.transparent&&1!=this.transparent),d&&null!=d.useOverlay&&(this.useOverlay=d.useOverlay),this.singleTile?this.useOverlay?(OpenLayers.Util.applyDefaults(this.params,this.OVERLAY_PARAMS),this.useAsyncOverlay||(this.params.version="1.0.0")):OpenLayers.Util.applyDefaults(this.params,this.SINGLE_TILE_PARAMS):(this.useHttpTile?OpenLayers.Util.applyDefaults(this.params,this.FOLDER_PARAMS):OpenLayers.Util.applyDefaults(this.params,this.TILE_PARAMS),this.setTileSize(this.defaultSize))},clone:function(a){return null==a&&(a=new OpenLayers.Layer.MapGuide(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){var b,c=a.getCenterLonLat(),d=this.map.getSize();if(this.singleTile){var e={setdisplaydpi:OpenLayers.DOTS_PER_INCH,setdisplayheight:d.h*this.ratio,setdisplaywidth:d.w*this.ratio,setviewcenterx:c.lon,setviewcentery:c.lat,setviewscale:this.map.getScale()};if(this.useOverlay&&!this.useAsyncOverlay){var f={};f=OpenLayers.Util.extend(f,e),f.operation="GETVISIBLEMAPEXTENT",f.version="1.0.0",f.session=this.params.session,f.mapName=this.params.mapName,f.format="text/xml",b=this.getFullRequestString(f),OpenLayers.Request.GET({url:b,async:!1})}b=this.getFullRequestString(e)}else{var g=this.map.getResolution(),h=Math.floor((a.left-this.maxExtent.left)/g);h=Math.round(h/this.tileSize.w);var i=Math.floor((this.maxExtent.top-a.top)/g);i=Math.round(i/this.tileSize.h),b=this.useHttpTile?this.getImageFilePath({tilecol:h,tilerow:i,scaleindex:this.resolutions.length-this.map.zoom-1}):this.getFullRequestString({tilecol:h,tilerow:i,scaleindex:this.resolutions.length-this.map.zoom-1})}return b},getFullRequestString:function(a,b){var c=null==b?this.url:b;"object"==typeof c&&(c=c[Math.floor(Math.random()*c.length)]);var d=c,e=OpenLayers.Util.extend({},this.params);e=OpenLayers.Util.extend(e,a);var f=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c));for(var g in e)g.toUpperCase()in f&&delete e[g];var h=OpenLayers.Util.getParameterString(e);if(""!=(h=h.replace(/,/g,"+"))){var i=c.charAt(c.length-1);"&"==i||"?"==i?d+=h:-1==c.indexOf("?")?d+="?"+h:d+="&"+h}return d},getImageFilePath:function(a,b){var c=null==b?this.url:b;"object"==typeof c&&(c=c[Math.floor(Math.random()*c.length)]);var d=c,e="",f="";a.tilerow<0&&(e="-"),0==a.tilerow?e+="0":e+=Math.floor(Math.abs(a.tilerow/this.params.tileRowsPerFolder))*this.params.tileRowsPerFolder,a.tilecol<0&&(f="-"),0==a.tilecol?f+="0":f+=Math.floor(Math.abs(a.tilecol/this.params.tileColumnsPerFolder))*this.params.tileColumnsPerFolder;var g="/S"+Math.floor(a.scaleindex)+"/"+this.params.basemaplayergroupname+"/R"+e+"/C"+f+"/"+a.tilerow%this.params.tileRowsPerFolder+"_"+a.tilecol%this.params.tileColumnsPerFolder+"."+this.params.format;return this.params.querystring&&(g+="?"+this.params.querystring),d+=g},CLASS_NAME:"OpenLayers.Layer.MapGuide"}),OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:!1,immediate:!1,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);var c={done:this.measureComplete,point:this.measurePartial};this.immediate&&(c.modify=this.measureImmediate),this.callbacks=OpenLayers.Util.extend(c,this.callbacks),this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions),this.handler=new a(this,this.callbacks,this.handlerOptions)},deactivate:function(){return this.cancelDelay(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay(),this.handler.cancel()},setImmediate:function(a){this.immediate=a,this.immediate?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},updateHandler:function(a,b){var c=this.active;c&&this.deactivate(),this.handler=new a(this,this.callbacks,b),c&&this.activate()},measureComplete:function(a){this.cancelDelay(),this.measure(a,"measure")},measurePartial:function(a,b){this.cancelDelay(),b=b.clone(),this.handler.freehandMode(this.handler.evt)?this.measure(b,"measurepartial"):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null,this.measure(b,"measurepartial")},this),this.partialDelay)},measureImmediate:function(a,b,c){c&&!this.handler.freehandMode(this.handler.evt)&&(this.cancelDelay(),this.measure(b.geometry,"measurepartial"))},cancelDelay:function(){null!==this.delayedTrigger&&(window.clearTimeout(this.delayedTrigger),this.delayedTrigger=null)},measure:function(a,b){var c,d;a.CLASS_NAME.indexOf("LineString")>-1?(c=this.getBestLength(a),d=1):(c=this.getBestArea(a),d=2),this.events.triggerEvent(b,{measure:c[0],units:c[1],order:d,geometry:a})},getBestArea:function(a){for(var b,c,d=this.displaySystemUnits[this.displaySystem],e=0,f=d.length;e<f&&(b=d[e],!((c=this.getArea(a,b))>1));++e);return[c,b]},getArea:function(a,b){var c,d;this.geodesic?(c=a.getGeodesicArea(this.map.getProjectionObject()),d="m"):(c=a.getArea(),d=this.map.getUnits());var e=OpenLayers.INCHES_PER_UNIT[b];if(e){var f=OpenLayers.INCHES_PER_UNIT[d];c*=Math.pow(f/e,2)}return c},getBestLength:function(a){for(var b,c,d=this.displaySystemUnits[this.displaySystem],e=0,f=d.length;e<f&&(b=d[e],!((c=this.getLength(a,b))>1));++e);return[c,b]},getLength:function(a,b){var c,d
;this.geodesic?(c=a.getGeodesicLength(this.map.getProjectionObject()),d="m"):(c=a.getLength(),d=this.map.getUnits());var e=OpenLayers.INCHES_PER_UNIT[b];if(e){c*=OpenLayers.INCHES_PER_UNIT[d]/e}return c},CLASS_NAME:"OpenLayers.Control.Measure"}),OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(a){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a])},read_wmc_SRS:function(a,b){var c=this.getChildValue(b);"object"!=typeof a.projections&&(a.projections={});for(var d=c.split(/ +/),e=0,f=d.length;e<f;e++)a.projections[d[e]]=!0},write_wmc_Layer:function(a){var b=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[a]);if(a.srs){var c=[];for(var d in a.srs)c.push(d);b.appendChild(this.createElementDefaultNS("SRS",c.join(" ")))}b.appendChild(this.write_wmc_FormatList(a)),b.appendChild(this.write_wmc_StyleList(a)),a.dimensions&&b.appendChild(this.write_wmc_DimensionList(a)),b.appendChild(this.write_wmc_LayerExtension(a))},CLASS_NAME:"OpenLayers.Format.WMC.v1_0_0"}),OpenLayers.Format.WMTSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]),this.options=a;var b=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(b,this.yx)},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b.version=this.version,b},readers:{wmts:{Capabilities:function(a,b){this.readChildNodes(a,b)},Contents:function(a,b){b.contents={},b.contents.layers=[],b.contents.tileMatrixSets={},this.readChildNodes(a,b.contents)},Layer:function(a,b){var c={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[]};c.layers=[],this.readChildNodes(a,c),b.layers.push(c)},Style:function(a,b){var c={};c.isDefault="true"===a.getAttribute("isDefault"),this.readChildNodes(a,c),b.styles.push(c)},Format:function(a,b){b.formats.push(this.getChildValue(a))},TileMatrixSetLink:function(a,b){var c={};this.readChildNodes(a,c),b.tileMatrixSetLinks.push(c)},TileMatrixSet:function(a,b){if(b.layers){var c={matrixIds:[]};this.readChildNodes(a,c),b.tileMatrixSets[c.identifier]=c}else b.tileMatrixSet=this.getChildValue(a)},TileMatrix:function(a,b){var c={supportedCRS:b.supportedCRS};this.readChildNodes(a,c),b.matrixIds.push(c)},ScaleDenominator:function(a,b){b.scaleDenominator=parseFloat(this.getChildValue(a))},TopLeftCorner:function(a,b){var c,d=this.getChildValue(a),e=d.split(" ");if(b.supportedCRS){var f=b.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");c=!!this.yx[f]}b.topLeftCorner=c?new OpenLayers.LonLat(e[1],e[0]):new OpenLayers.LonLat(e[0],e[1])},TileWidth:function(a,b){b.tileWidth=parseInt(this.getChildValue(a))},TileHeight:function(a,b){b.tileHeight=parseInt(this.getChildValue(a))},MatrixWidth:function(a,b){b.matrixWidth=parseInt(this.getChildValue(a))},MatrixHeight:function(a,b){b.matrixHeight=parseInt(this.getChildValue(a))},ResourceURL:function(a,b){b.resourceUrl=b.resourceUrl||{};var c=a.getAttribute("resourceType");b.resourceUrls||(b.resourceUrls=[]);var d=b.resourceUrl[c]={format:a.getAttribute("format"),template:a.getAttribute("template"),resourceType:c};b.resourceUrls.push(d)},WSDL:function(a,b){b.wsdl={},b.wsdl.href=a.getAttribute("xlink:href")},ServiceMetadataURL:function(a,b){b.serviceMetadataUrl={},b.serviceMetadataUrl.href=a.getAttribute("xlink:href")},LegendURL:function(a,b){b.legend={},b.legend.href=a.getAttribute("xlink:href"),b.legend.format=a.getAttribute("format")},Dimension:function(a,b){var c={values:[]};this.readChildNodes(a,c),b.dimensions.push(c)},Default:function(a,b){b.default=this.getChildValue(a)},Value:function(a,b){b.values.push(this.getChildValue(a))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"}),OpenLayers.Layer.WorldWind=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{},isBaseLayer:!0,lzd:null,zoomLevels:null,initialize:function(a,b,c,d,e,f){this.lzd=c,this.zoomLevels=d;var g=[];g.push(a,b,e,f),OpenLayers.Layer.Grid.prototype.initialize.apply(this,g),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getZoom:function(){var a=this.map.getZoom();this.map.getMaxExtent();return a-=Math.log(this.maxResolution/(this.lzd/512))/Math.log(2)},getURL:function(a){a=this.adjustBounds(a);var b=this.getZoom(),c=this.map.getMaxExtent(),d=this.lzd/Math.pow(2,this.getZoom()),e=Math.floor((a.left-c.left)/d),f=Math.floor((a.bottom-c.bottom)/d);return this.map.getResolution()<=this.lzd/512&&this.getZoom()<=this.zoomLevels?this.getFullRequestString({L:b,X:e,Y:f}):OpenLayers.Util.getImageLocation("blank.gif")},CLASS_NAME:"OpenLayers.Layer.WorldWind"}),OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:!0,panMapIfOutOfView:!0,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:!1,fixedRelativePosition:!1,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(a,b,c,d,e,f,g){this.imageSrc=OpenLayers.Util.getImageLocation("cloud-popup-relative.png"),OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments),this.contentDiv.className=this.contentDisplayClass},CLASS_NAME:"OpenLayers.Popup.FramedCloud"}),OpenLayers.Format.SOSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.SOSCapabilities"}),OpenLayers.Format.SOSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.SOSCapabilities,{namespaces:{ows:"http://www.opengis.net/ows/1.1",sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]),this.options=a},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},readers:{gml:OpenLayers.Util.applyDefaults({name:function(a,b){b.name=this.getChildValue(a)},TimePeriod:function(a,b){b.timePeriod={},this.readChildNodes(a,b.timePeriod)},beginPosition:function(a,b){b.beginPosition=this.getChildValue(a)},endPosition:function(a,b){b.endPosition=this.getChildValue(a)}},OpenLayers.Format.GML.v3.prototype.readers.gml),sos:{Capabilities:function(a,b){this.readChildNodes(a,b)},Contents:function(a,b){b.contents={},this.readChildNodes(a,b.contents)},ObservationOfferingList:function(a,b){b.offeringList={},this.readChildNodes(a,b.offeringList)},ObservationOffering:function(a,b){var c=this.getAttributeNS(a,this.namespaces.gml,"id");b[c]={procedures:[],observedProperties:[],featureOfInterestIds:[],responseFormats:[],resultModels:[],responseModes:[]},this.readChildNodes(a,b[c])},time:function(a,b){b.time={},this.readChildNodes(a,b.time)},procedure:function(a,b){b.procedures.push(this.getAttributeNS(a,this.namespaces.xlink,"href"))},observedProperty:function(a,b){b.observedProperties.push(this.getAttributeNS(a,this.namespaces.xlink,"href"))},featureOfInterest:function(a,b){b.featureOfInterestIds.push(this.getAttributeNS(a,this.namespaces.xlink,"href"))},responseFormat:function(a,b){b.responseFormats.push(this.getChildValue(a))},resultModel:function(a,b){b.resultModels.push(this.getChildValue(a))},responseMode:function(a,b){b.responseModes.push(this.getChildValue(a))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.SOSCapabilities.v1_0_0"}),OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(a){var b=!0;if(this.pinching=!1,OpenLayers.Event.isMultiTouch(a))this.started=!0,this.last=this.start={distance:this.getDistance(a.touches),delta:0,scale:1},this.callback("start",[a,this.start]),b=!this.stopDown;else{if(this.started)return!1;this.started=!1,this.start=null,this.last=null}return OpenLayers.Event.preventDefault(a),b},touchmove:function(a){if(this.started&&OpenLayers.Event.isMultiTouch(a)){this.pinching=!0;var b=this.getPinchData(a);this.callback("move",[a,b]),this.last=b,OpenLayers.Event.stop(a)}else if(this.started)return!1;return!0},touchend:function(a){return!(this.started&&!OpenLayers.Event.isMultiTouch(a))||(this.started=!1,this.pinching=!1,this.callback("done",[a,this.start,this.last]),this.start=null,this.last=null,!1)},activate:function(){var a=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.pinching=!1,a=!0),a},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.started=!1,this.pinching=!1,this.start=null,this.last=null,a=!0),a},getDistance:function(a){var b=a[0],c=a[1];return Math.sqrt(Math.pow(b.olClientX-c.olClientX,2)+Math.pow(b.olClientY-c.olClientY,2))},getPinchData:function(a){var b=this.getDistance(a.touches),c=b/this.start.distance;return{distance:b,delta:this.last.distance-b,scale:c}},CLASS_NAME:"OpenLayers.Handler.Pinch"}),OpenLayers.Control.NavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]),this.addControls([new OpenLayers.Control.Navigation,new OpenLayers.Control.ZoomBox])},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);return null===this.defaultControl&&(this.defaultControl=this.controls[0]),a},CLASS_NAME:"OpenLayers.Control.NavToolbar"}),OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",url:["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],attribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",sphericalMercator:!0,wrapDateLine:!0,tileOptions:null,initialize:function(a,b,c){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options&&this.options.tileOptions)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])},CLASS_NAME:"OpenLayers.Layer.OSM"}),OpenLayers.Strategy.Refresh=OpenLayers.Class(OpenLayers.Strategy,{force:!1,interval:0,timer:null,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);return a&&(!0===this.layer.visibility&&this.start(),this.layer.events.on({visibilitychanged:this.reset,scope:this})),a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);return a&&(this.stop(),this.layer.events.un({visibilitychanged:this.reset,scope:this})),a},reset:function(){!0===this.layer.visibility?this.start():this.stop()},start:function(){this.interval&&"number"==typeof this.interval&&this.interval>0&&(this.timer=window.setInterval(OpenLayers.Function.bind(this.refresh,this),this.interval))},refresh:function(){this.layer&&this.layer.refresh&&"function"==typeof this.layer.refresh&&this.layer.refresh({force:this.force})},stop:function(){null!==this.timer&&(window.clearInterval(this.timer),this.timer=null)},CLASS_NAME:"OpenLayers.Strategy.Refresh"}),OpenLayers.Control.Geolocate=OpenLayers.Class(OpenLayers.Control,{geolocation:null,available:"geolocation"in navigator,bind:!0,watch:!1,geolocationOptions:null,destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.available&&!this.geolocation&&(this.geolocation=navigator.geolocation),this.geolocation?!!OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.watch?this.watchId=this.geolocation.watchPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions):this.getCurrentLocation(),!0):(this.events.triggerEvent("locationuncapable"),!1)},deactivate:function(){return this.active&&null!==this.watchId&&this.geolocation.clearWatch(this.watchId),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},geolocate:function(a){var b=new OpenLayers.LonLat(a.coords.longitude,a.coords.latitude).transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());this.bind&&this.map.setCenter(b),this.events.triggerEvent("locationupdated",{position:a,point:new OpenLayers.Geometry.Point(b.lon,b.lat)})},getCurrentLocation:function(){return!(!this.active||this.watch)&&(this.geolocation.getCurrentPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions),!0)},failure:function(a){this.events.triggerEvent("locationfailed",{error:a})},CLASS_NAME:"OpenLayers.Control.Geolocate"}),OpenLayers.Layer.ArcGIS93Rest=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{format:"png"},isBaseLayer:!0,initialize:function(a,b,c,d){var e=[];c=OpenLayers.Util.upperCaseObject(c),e.push(a,b,c,d),OpenLayers.Layer.Grid.prototype.initialize.apply(this,e),OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()&&(null!=d&&d.isBaseLayer||(this.isBaseLayer=!1),"jpg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"gif":"png"))},clone:function(a){return null==a&&(a=new OpenLayers.Layer.ArcGIS93Rest(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){a=this.adjustBounds(a);var b=this.projection.getCode().split(":"),c=b[b.length-1],d=this.getImageSize(),e={BBOX:a.toBBOX(),SIZE:d.w+","+d.h,F:"image",BBOXSR:c,IMAGESR:c};if(this.layerDefs){var f,g=[];for(f in this.layerDefs)this.layerDefs.hasOwnProperty(f)&&this.layerDefs[f]&&(g.push(f),g.push(":"),g.push(this.layerDefs[f]),g.push(";"));g.length>0&&(e.LAYERDEFS=g.join(""))}return this.getFullRequestString(e)},setLayerFilter:function(a,b){this.layerDefs||(this.layerDefs={}),b?this.layerDefs[a]=b:delete this.layerDefs[a]},clearLayerFilter:function(a){a?delete this.layerDefs[a]:delete this.layerDefs},mergeNewParams:function(a){var b=OpenLayers.Util.upperCaseObject(a),c=[b];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,c)},CLASS_NAME:"OpenLayers.Layer.ArcGIS93Rest"}),OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:!1,px:null,timerId:null,mousemove:function(a){return this.passesTolerance(a.xy)&&(this.clearTimer(),this.callback("move",[a]),this.px=a.xy,a=OpenLayers.Util.extend({},a),this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay)),!this.stopMove},mouseout:function(a){return OpenLayers.Util.mouseLeft(a,this.map.viewPortDiv)&&(this.clearTimer(),this.callback("move",[a])),!0},passesTolerance:function(a){var b=!0;if(this.pixelTolerance&&this.px){Math.sqrt(Math.pow(this.px.x-a.x,2)+Math.pow(this.px.y-a.y,2))<this.pixelTolerance&&(b=!1)}return b},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null)},delayedCall:function(a){this.callback("pause",[a])},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),a=!0),a},CLASS_NAME:"OpenLayers.Handler.Hover"}),OpenLayers.Control.GetFeature=OpenLayers.Class(OpenLayers.Control,{protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:!1,click:!0,single:!0,clickout:!0,toggle:!1,clickTolerance:5,hover:!1,box:!1,maxFeatures:10,features:null,hoverFeature:null,handlers:null,hoverResponse:null,filterType:OpenLayers.Filter.Spatial.BBOX,initialize:function(a){a.handlerOptions=a.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[a]),this.features={},this.handlers={},this.click&&(this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.selectClick},this.handlerOptions.click||{})),this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},OpenLayers.Util.extend(this.handlerOptions.box,{boxDivClassName:"olHandlerBoxSelectFeature"}))),this.hover&&(this.handlers.hover=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.selectHover},OpenLayers.Util.extend(this.handlerOptions.hover,{delay:250,pixelTolerance:2})))},activate:function(){if(!this.active)for(var a in this.handlers)this.handlers[a].activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active)for(var a in this.handlers)this.handlers[a].deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},selectClick:function(a){var b=this.pixelToBounds(a.xy);this.setModifiers(a),this.request(b,{single:this.single})},selectBox:function(a){var b;if(a instanceof OpenLayers.Bounds){var c=this.map.getLonLatFromPixel({x:a.left,y:a.bottom}),d=this.map.getLonLatFromPixel({x:a.right,y:a.top});b=new OpenLayers.Bounds(c.lon,c.lat,d.lon,d.lat)}else{if(this.click)return;b=this.pixelToBounds(a)}this.setModifiers(this.handlers.box.dragHandler.evt),this.request(b)},selectHover:function(a){var b=this.pixelToBounds(a.xy);this.request(b,{single:!0,hover:!0})},cancelHover:function(){this.hoverResponse&&(this.protocol.abort(this.hoverResponse),this.hoverResponse=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"))},request:function(a,b){b=b||{};var c=new OpenLayers.Filter.Spatial({type:this.filterType,value:a});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");var d=this.protocol.read({maxFeatures:1==b.single?this.maxFeatures:void 0,filter:c,callback:function(c){c.success()&&(c.features.length?1==b.single?this.selectBestFeature(c.features,a.getCenterLonLat(),b):this.select(c.features):b.hover?this.hoverSelect():(this.events.triggerEvent("clickout"),this.clickout&&this.unselectAll())),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},scope:this});1==b.hover&&(this.hoverResponse=d)},selectBestFeature:function(a,b,c){if(c=c||{},a.length){for(var d,e,f,g=new OpenLayers.Geometry.Point(b.lon,b.lat),h=Number.MAX_VALUE,i=0;i<a.length&&(d=a[i],!(d.geometry&&(f=g.distanceTo(d.geometry,{edge:!1}))<h&&(h=f,e=d,0==h)));++i);1==c.hover?this.hoverSelect(e):this.select(e||a)}},setModifiers:function(a){this.modifiers={multiple:this.multiple||this.multipleKey&&a[this.multipleKey],toggle:this.toggle||this.toggleKey&&a[this.toggleKey]}},select:function(a){this.modifiers.multiple||this.modifiers.toggle||this.unselectAll(),OpenLayers.Util.isArray(a)||(a=[a]);var b=this.events.triggerEvent("beforefeaturesselected",{features:a});if(!1!==b){for(var c,d=[],e=0,f=a.length;e<f;++e)c=a[e],this.features[c.fid||c.id]?this.modifiers.toggle&&this.unselect(this.features[c.fid||c.id]):!1!==(b=this.events.triggerEvent("beforefeatureselected",{feature:c}))&&(this.features[c.fid||c.id]=c,d.push(c),this.events.triggerEvent("featureselected",{feature:c}));this.events.triggerEvent("featuresselected",{features:d})}},hoverSelect:function(a){var b=a?a.fid||a.id:null,c=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;c&&c!=b&&(this.events.triggerEvent("outfeature",{feature:this.hoverFeature}),this.hoverFeature=null),b&&b!=c&&(this.events.triggerEvent("hoverfeature",{feature:a}),this.hoverFeature=a)},unselect:function(a){delete this.features[a.fid||a.id],this.events.triggerEvent("featureunselected",{feature:a})},unselectAll:function(){for(var a in this.features)this.unselect(this.features[a])},setMap:function(a){for(var b in this.handlers)this.handlers[b].setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},pixelToBounds:function(a){var b=a.add(-this.clickTolerance/2,this.clickTolerance/2),c=a.add(this.clickTolerance/2,-this.clickTolerance/2),d=this.map.getLonLatFromPixel(b),e=this.map.getLonLatFromPixel(c);return new OpenLayers.Bounds(d.lon,d.lat,e.lon,e.lat)},CLASS_NAME:"OpenLayers.Control.GetFeature"}),OpenLayers.Format.QueryStringFilter=function(){function a(a){return a=a.replace(/%/g,"\\%"),a=a.replace(/\\\\\.(\*)?/g,function(a,b){return b?a:"\\\\_"}),a=a.replace(/\\\\\.\*/g,"\\\\%"),a=a.replace(/(\\)?\.(\*)?/g,function(a,b,c){return b||c?a:"_"}),a=a.replace(/(\\)?\.\*/g,function(a,b){return b?a:"%"}),a=a.replace(/\\\./g,"."),a=a.replace(/(\\)?\\\*/g,function(a,b){return b?a:"*"})}var b={};return b[OpenLayers.Filter.Comparison.EQUAL_TO]="eq",b[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne",b[OpenLayers.Filter.Comparison.LESS_THAN]="lt",b[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte",b[OpenLayers.Filter.Comparison.GREATER_THAN]="gt",b[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte",b[OpenLayers.Filter.Comparison.LIKE]="ilike",OpenLayers.Class(OpenLayers.Format,{wildcarded:!1,srsInBBOX:!1,write:function(c,d){d=d||{};var e=c.CLASS_NAME,f=e.substring(e.lastIndexOf(".")+1);switch(f){case"Spatial":switch(c.type){case OpenLayers.Filter.Spatial.BBOX:d.bbox=c.value.toArray(),this.srsInBBOX&&c.projection&&d.bbox.push(c.projection.getCode());break;case OpenLayers.Filter.Spatial.DWITHIN:d.tolerance=c.distance;case OpenLayers.Filter.Spatial.WITHIN:d.lon=c.value.x,d.lat=c.value.y;break;default:OpenLayers.Console.warn("Unknown spatial filter type "+c.type)}break;case"Comparison":var g=b[c.type];if(void 0!==g){var h=c.value;c.type==OpenLayers.Filter.Comparison.LIKE&&(h=a(h),this.wildcarded&&(h="%"+h+"%")),d[c.property+"__"+g]=h,d.queryable=d.queryable||[],d.queryable.push(c.property)}else OpenLayers.Console.warn("Unknown comparison filter type "+c.type);break;case"Logical":if(c.type===OpenLayers.Filter.Logical.AND)for(var i=0,j=c.filters.length;i<j;i++)d=this.write(c.filters[i],d);else OpenLayers.Console.warn("Unsupported logical filter type "+c.type);break;default:OpenLayers.Console.warn("Unknown filter type "+f)}return d},CLASS_NAME:"OpenLayers.Format.QueryStringFilter"})}();OpenLayers.Format.WCSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WCSCapabilities.v1,{namespaces:{wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows/1.1"},errorProperty:"operationsMetadata",readers:{wcs:OpenLayers.Util.applyDefaults({Capabilities:function(a,b){this.readChildNodes(a,b)},Contents:function(a,b){b.contentMetadata=[],this.readChildNodes(a,b.contentMetadata)},CoverageSummary:function(a,b){var c={};this.readChildNodes(a,c),b.push(c)},Identifier:function(a,b){b.identifier=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b.abstract=this.getChildValue(a)},SupportedCRS:function(a,b){var c=this.getChildValue(a);c&&(b.supportedCRS||(b.supportedCRS=[]),b.supportedCRS.push(c))},SupportedFormat:function(a,b){var c=this.getChildValue(a);c&&(b.supportedFormat||(b.supportedFormat=[]),b.supportedFormat.push(c))}},OpenLayers.Format.WCSCapabilities.v1.prototype.readers.wcs),ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WCSCapabilities.v1_1_0"}),OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return!!OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.map.events.register("mousemove",this,this.redraw),this.map.events.register("mouseout",this,this.reset),this.redraw(),!0)},deactivate:function(){return!!OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.map.events.unregister("mousemove",this,this.redraw),this.map.events.unregister("mouseout",this,this.reset),this.element.innerHTML="",!0)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.div.left="",this.div.top="",this.element=this.div),this.div},redraw:function(a){var b;if(null==a)return void this.reset();if(null==this.lastXy||Math.abs(a.xy.x-this.lastXy.x)>this.granularity||Math.abs(a.xy.y-this.lastXy.y)>this.granularity)return void(this.lastXy=a.xy);if(b=this.map.getLonLatFromPixel(a.xy)){this.displayProjection&&b.transform(this.map.getProjectionObject(),this.displayProjection),this.lastXy=a.xy;var c=this.formatOutput(b);c!=this.element.innerHTML&&(this.element.innerHTML=c)}},reset:function(a){null!=this.emptyString&&(this.element.innerHTML=this.emptyString)},formatOutput:function(a){var b=parseInt(this.numDigits);return this.prefix+a.lon.toFixed(b)+this.separator+a.lat.toFixed(b)+this.suffix},CLASS_NAME:"OpenLayers.Control.MousePosition"}),OpenLayers.Tile.UTFGrid=OpenLayers.Class(OpenLayers.Tile,{url:null,utfgridResolution:2,json:null,format:null,destroy:function(){this.clear(),OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var a=OpenLayers.Tile.prototype.draw.apply(this,arguments);if(a)if(this.isLoading?(this.abortLoading(),this.events.triggerEvent("reload")):(this.isLoading=!0,this.events.triggerEvent("loadstart")),this.url=this.layer.getURL(this.bounds),this.layer.useJSONP){var b=new OpenLayers.Protocol.Script({url:this.url,callback:function(a){this.isLoading=!1,this.events.triggerEvent("loadend"),this.json=a.data},scope:this});b.read(),this.request=b}else this.request=OpenLayers.Request.GET({url:this.url,callback:function(a){this.isLoading=!1,this.events.triggerEvent("loadend"),200===a.status&&this.parseData(a.responseText)},scope:this});else this.unload();return a},abortLoading:function(){this.request&&(this.request.abort(),delete this.request),this.isLoading=!1},getFeatureInfo:function(a,b){var c=null;if(this.json){var d=this.getFeatureId(a,b);null!==d&&(c={id:d,data:this.json.data[d]})}return c},getFeatureId:function(a,b){var c=null;if(this.json){var d=this.utfgridResolution,e=Math.floor(b/d),f=Math.floor(a/d),g=this.json.grid[e].charCodeAt(f),h=this.indexFromCharCode(g),i=this.json.keys;!isNaN(h)&&h in i&&(c=i[h])}return c},indexFromCharCode:function(a){return a>=93&&a--,a>=35&&a--,a-32},parseData:function(a){this.format||(this.format=new OpenLayers.Format.JSON),this.json=this.format.read(a)},clear:function(){this.json=null},CLASS_NAME:"OpenLayers.Tile.UTFGrid"}),OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(a){if(a=a||{},this.params={},this.headers={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var b=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(a,c){return b.write(a,c)}}},destroy:function(){this.params=null,this.headers=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){OpenLayers.Protocol.prototype.read.apply(this,arguments),a=a||{},a.params=OpenLayers.Util.applyDefaults(a.params,this.options.params),a=OpenLayers.Util.applyDefaults(a,this.options),a.filter&&this.filterToParams&&(a.params=this.filterToParams(a.filter,a.params));var b=void 0!==a.readWithPOST?a.readWithPOST:this.readWithPOST,c=new OpenLayers.Protocol.Response({requestType:"read"});if(b){var d=a.headers||{};d["Content-Type"]="application/x-www-form-urlencoded",c.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,c,a),data:OpenLayers.Util.getParameterString(a.params),headers:d})}else c.priv=OpenLayers.Request.GET({url:a.url,callback:this.createCallback(this.handleRead,c,a),params:a.params,headers:a.headers});return c},handleRead:function(a,b){this.handleResponse(a,b)},create:function(a,b){b=OpenLayers.Util.applyDefaults(b,this.options);var c=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"create"});return c.priv=OpenLayers.Request.POST({url:b.url,callback:this.createCallback(this.handleCreate,c,b),headers:b.headers,data:this.format.write(a)}),c},handleCreate:function(a,b){this.handleResponse(a,b)},update:function(a,b){b=b||{};var c=b.url||a.url||this.options.url+"/"+a.fid;b=OpenLayers.Util.applyDefaults(b,this.options);var d=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"update"}),e=this.updateWithPOST?"POST":"PUT";return d.priv=OpenLayers.Request[e]({url:c,callback:this.createCallback(this.handleUpdate,d,b),headers:b.headers,data:this.format.write(a)}),d},handleUpdate:function(a,b){this.handleResponse(a,b)},delete:function(a,b){b=b||{};var c=b.url||a.url||this.options.url+"/"+a.fid;b=OpenLayers.Util.applyDefaults(b,this.options);var d=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"delete"}),e=this.deleteWithPOST?"POST":"DELETE",f={url:c,
callback:this.createCallback(this.handleDelete,d,b),headers:b.headers};return this.deleteWithPOST&&(f.data=this.format.write(a)),d.priv=OpenLayers.Request[e](f),d},handleDelete:function(a,b){this.handleResponse(a,b)},handleResponse:function(a,b){var c=a.priv;b.callback&&(c.status>=200&&c.status<300?("delete"!=a.requestType&&(a.features=this.parseFeatures(c)),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE,b.callback.call(b.scope,a))},parseFeatures:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),!b||b.length<=0?null:this.format.read(b)},commit:function(a,b){function c(a){for(var b=a.features?a.features.length:0,c=new Array(b),e=0;e<b;++e)c[e]=a.features[e].fid;o.insertIds=c,d.apply(this,[a])}function d(a){this.callUserCallback(a,b),n=n&&a.success(),++f>=m&&b.callback&&(o.code=n?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE,b.callback.apply(b.scope,[o]))}b=OpenLayers.Util.applyDefaults(b,this.options);var e=[],f=0,g={};g[OpenLayers.State.INSERT]=[],g[OpenLayers.State.UPDATE]=[],g[OpenLayers.State.DELETE]=[];for(var h,i,j=[],k=0,l=a.length;k<l;++k)h=a[k],(i=g[h.state])&&(i.push(h),j.push(h));var m=(g[OpenLayers.State.INSERT].length>0?1:0)+g[OpenLayers.State.UPDATE].length+g[OpenLayers.State.DELETE].length,n=!0,o=new OpenLayers.Protocol.Response({reqFeatures:j}),p=g[OpenLayers.State.INSERT];p.length>0&&e.push(this.create(p,OpenLayers.Util.applyDefaults({callback:c,scope:this},b.create))),p=g[OpenLayers.State.UPDATE];for(var k=p.length-1;k>=0;--k)e.push(this.update(p[k],OpenLayers.Util.applyDefaults({callback:d,scope:this},b.update)));p=g[OpenLayers.State.DELETE];for(var k=p.length-1;k>=0;--k)e.push(this.delete(p[k],OpenLayers.Util.applyDefaults({callback:d,scope:this},b.delete)));return e},abort:function(a){a&&a.priv.abort()},callUserCallback:function(a,b){var c=b[a.requestType];c&&c.callback&&c.callback.call(c.scope,a)},CLASS_NAME:"OpenLayers.Protocol.HTTP"}),OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:!1,resolution:null,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);return a&&this.layer.events.on({beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,scope:this}),a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);return a&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,scope:this})),a},cacheFeatures:function(a){var b=!0;return this.clustering||(this.clearCache(),this.features=a.features,this.cluster(),b=!1),b},clearCache:function(){this.clustering||(this.features=null)},cluster:function(a){if((!a||a.zoomChanged)&&this.features){var b=this.layer.map.getResolution();if(b!=this.resolution||!this.clustersExist()){this.resolution=b;for(var c,d,e,f=[],g=0;g<this.features.length;++g)if(c=this.features[g],c.geometry){d=!1;for(var h=f.length-1;h>=0;--h)if(e=f[h],this.shouldCluster(e,c)){this.addToCluster(e,c),d=!0;break}d||f.push(this.createCluster(this.features[g]))}if(this.clustering=!0,this.layer.removeAllFeatures(),this.clustering=!1,f.length>0){if(this.threshold>1){var i=f.slice();f=[];for(var j,g=0,k=i.length;g<k;++g)j=i[g],j.attributes.count<this.threshold?Array.prototype.push.apply(f,j.cluster):f.push(j)}this.clustering=!0,this.layer.addFeatures(f),this.clustering=!1}this.clusters=f}}},clustersExist:function(){var a=!1;if(this.clusters&&this.clusters.length>0&&this.clusters.length==this.layer.features.length){a=!0;for(var b=0;b<this.clusters.length;++b)if(this.clusters[b]!=this.layer.features[b]){a=!1;break}}return a},shouldCluster:function(a,b){var c=a.geometry.getBounds().getCenterLonLat(),d=b.geometry.getBounds().getCenterLonLat();return Math.sqrt(Math.pow(c.lon-d.lon,2)+Math.pow(c.lat-d.lat,2))/this.resolution<=this.distance},addToCluster:function(a,b){a.cluster.push(b),a.attributes.count+=1},createCluster:function(a){var b=a.geometry.getBounds().getCenterLonLat(),c=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat),{count:1});return c.cluster=[a],c},CLASS_NAME:"OpenLayers.Strategy.Cluster"}),OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:{w:180,h:90},layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:!1,handlers:null,resolutionFactor:1,maximized:!1,maximizeTitle:"",minimizeTitle:"",initialize:function(a){this.layers=[],this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,[a])},destroy:function(){this.mapDiv&&(this.handlers.click&&this.handlers.click.destroy(),this.handlers.drag&&this.handlers.drag.destroy(),this.ovmap&&this.ovmap.viewPortDiv.removeChild(this.extentRectangle),this.extentRectangle=null,this.rectEvents&&(this.rectEvents.destroy(),this.rectEvents=null),this.ovmap&&(this.ovmap.destroy(),this.ovmap=null),this.element.removeChild(this.mapDiv),this.mapDiv=null,this.div.removeChild(this.element),this.element=null,this.maximizeDiv&&(this.div.removeChild(this.maximizeDiv),this.maximizeDiv=null),this.minimizeDiv&&(this.div.removeChild(this.minimizeDiv),this.minimizeDiv=null),this.map.events.un({buttonclick:this.onButtonClick,moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments))},draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),0===this.layers.length){if(!this.map.baseLayer)return this.map.events.register("changebaselayer",this,this.baseLayerDraw),this.div;var a=this.map.baseLayer.clone();this.layers=[a]}if(this.element=document.createElement("div"),this.element.className=this.displayClass+"Element",this.element.style.display="none",this.mapDiv=document.createElement("div"),this.mapDiv.style.width=this.size.w+"px",this.mapDiv.style.height=this.size.h+"px",this.mapDiv.style.position="relative",this.mapDiv.style.overflow="hidden",this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap"),this.extentRectangle=document.createElement("div"),this.extentRectangle.style.position="absolute",this.extentRectangle.style.zIndex=1e3,this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.element.appendChild(this.mapDiv),this.div.appendChild(this.element),this.outsideViewport)this.element.style.display="";else{this.div.className+=" "+this.displayClass+"Container";var b=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,null,b,"absolute"),this.maximizeDiv.style.display="none",this.maximizeDiv.className=this.displayClass+"MaximizeButton olButton",this.maximizeTitle&&(this.maximizeDiv.title=this.maximizeTitle),this.div.appendChild(this.maximizeDiv);var b=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,null,b,"absolute"),this.minimizeDiv.style.display="none",this.minimizeDiv.className=this.displayClass+"MinimizeButton olButton",this.minimizeTitle&&(this.minimizeDiv.title=this.minimizeTitle),this.div.appendChild(this.minimizeDiv),this.minimizeControl()}return this.map.getExtent()&&this.update(),this.map.events.on({buttonclick:this.onButtonClick,moveend:this.update,scope:this}),this.maximized&&this.maximizeControl(),this.div},baseLayerDraw:function(){this.draw(),this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(a){var b=this.handlers.drag.last.x-a.x,c=this.handlers.drag.last.y-a.y;if(0!=b||0!=c){var d=this.rectPxBounds.top,e=this.rectPxBounds.left,f=Math.abs(this.rectPxBounds.getHeight()),g=this.rectPxBounds.getWidth(),h=Math.max(0,d-c);h=Math.min(h,this.ovmap.size.h-this.hComp-f);var i=Math.max(0,e-b);i=Math.min(i,this.ovmap.size.w-this.wComp-g),this.setRectPxBounds(new OpenLayers.Bounds(i,h+f,i+g,h))}},mapDivClick:function(a){var b=this.rectPxBounds.getCenterPixel(),c=a.xy.x-b.x,d=a.xy.y-b.y,e=this.rectPxBounds.top,f=this.rectPxBounds.left,g=Math.abs(this.rectPxBounds.getHeight()),h=this.rectPxBounds.getWidth(),i=Math.max(0,e+d);i=Math.min(i,this.ovmap.size.h-g);var j=Math.max(0,f+c);j=Math.min(j,this.ovmap.size.w-h),this.setRectPxBounds(new OpenLayers.Bounds(j,i+g,j+h,i)),this.updateMapToRect()},onButtonClick:function(a){a.buttonElement===this.minimizeDiv?this.minimizeControl():a.buttonElement===this.maximizeDiv&&this.maximizeControl()},maximizeControl:function(a){this.element.style.display="",this.showToggle(!1),null!=a&&OpenLayers.Event.stop(a)},minimizeControl:function(a){this.element.style.display="none",this.showToggle(!0),null!=a&&OpenLayers.Event.stop(a)},showToggle:function(a){this.maximizeDiv&&(this.maximizeDiv.style.display=a?"":"none"),this.minimizeDiv&&(this.minimizeDiv.style.display=a?"none":"")},update:function(){null==this.ovmap&&this.createMap(),!this.autoPan&&this.isSuitableOverview()||this.updateOverview(),this.updateRectToMap()},isSuitableOverview:function(){var a=this.map.getExtent(),b=this.map.getMaxExtent(),c=new OpenLayers.Bounds(Math.max(a.left,b.left),Math.max(a.bottom,b.bottom),Math.min(a.right,b.right),Math.min(a.top,b.top));this.ovmap.getProjection()!=this.map.getProjection()&&(c=c.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()));var d=this.ovmap.getResolution()/this.map.getResolution();return d>this.minRatio&&d<=this.maxRatio&&this.ovmap.getExtent().containsBounds(c)},updateOverview:function(){var a=this.map.getResolution(),b=this.ovmap.getResolution(),c=b/a;c>this.maxRatio?b=this.minRatio*a:c<=this.minRatio&&(b=this.maxRatio*a);var d;this.ovmap.getProjection()!=this.map.getProjection()?(d=this.map.center.clone(),d.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())):d=this.map.center,this.ovmap.setCenter(d,this.ovmap.getZoomForResolution(b*this.resolutionFactor)),this.updateRectToMap()},createMap:function(){var a=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:!1},this.mapOptions);if(this.ovmap=new OpenLayers.Map(this.mapDiv,a),this.ovmap.viewPortDiv.appendChild(this.extentRectangle),OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy),this.ovmap.addLayers(this.layers),this.ovmap.zoomToMaxExtent(),this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width")),this.wComp=this.wComp?this.wComp:2,this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width")),this.hComp=this.hComp?this.hComp:2,this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap}),this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:!0,double:!1,stopSingle:!0,stopDouble:!0,pixelTolerance:1,map:this.ovmap}),this.handlers.click.activate(),this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,!0),this.rectEvents.register("mouseover",this,function(a){this.handlers.drag.active||this.map.dragging||this.handlers.drag.activate()}),this.rectEvents.register("mouseout",this,function(a){this.handlers.drag.dragging||this.handlers.drag.deactivate()}),this.ovmap.getProjection()!=this.map.getProjection()){var b=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,c=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=b&&c?OpenLayers.INCHES_PER_UNIT[b]/OpenLayers.INCHES_PER_UNIT[c]:1}},updateRectToMap:function(){var a;a=this.ovmap.getProjection()!=this.map.getProjection()?this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):this.map.getExtent();var b=this.getRectBoundsFromMapBounds(a);b&&this.setRectPxBounds(b)},updateMapToRect:function(){var a=this.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!=this.map.getProjection()&&(a=a.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject())),this.map.panTo(a.getCenterLonLat())},setRectPxBounds:function(a){var b=Math.max(a.top,0),c=Math.max(a.left,0),d=Math.min(a.top+Math.abs(a.getHeight()),this.ovmap.size.h-this.hComp),e=Math.min(a.left+a.getWidth(),this.ovmap.size.w-this.wComp),f=Math.max(e-c,0),g=Math.max(d-b,0);if(f<this.minRectSize||g<this.minRectSize){this.extentRectangle.className=this.displayClass+this.minRectDisplayClass;var h=c+f/2-this.minRectSize/2,i=b+g/2-this.minRectSize/2;this.extentRectangle.style.top=Math.round(i)+"px",this.extentRectangle.style.left=Math.round(h)+"px",this.extentRectangle.style.height=this.minRectSize+"px",this.extentRectangle.style.width=this.minRectSize+"px"}else this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.extentRectangle.style.top=Math.round(b)+"px",this.extentRectangle.style.left=Math.round(c)+"px",this.extentRectangle.style.height=Math.round(g)+"px",this.extentRectangle.style.width=Math.round(f)+"px";this.rectPxBounds=new OpenLayers.Bounds(Math.round(c),Math.round(d),Math.round(e),Math.round(b))},getRectBoundsFromMapBounds:function(a){var b=this.getOverviewPxFromLonLat({lon:a.left,lat:a.bottom}),c=this.getOverviewPxFromLonLat({lon:a.right,lat:a.top}),d=null;return b&&c&&(d=new OpenLayers.Bounds(b.x,b.y,c.x,c.y)),d},getMapBoundsFromRectBounds:function(a){var b=this.getLonLatFromOverviewPx({x:a.left,y:a.bottom}),c=this.getLonLatFromOverviewPx({x:a.right,y:a.top});return new OpenLayers.Bounds(b.lon,b.lat,c.lon,c.lat)},getLonLatFromOverviewPx:function(a){var b=this.ovmap.size,c=this.ovmap.getResolution(),d=this.ovmap.getExtent().getCenterLonLat(),e=a.x-b.w/2,f=a.y-b.h/2;return{lon:d.lon+e*c,lat:d.lat-f*c}},getOverviewPxFromLonLat:function(a){var b=this.ovmap.getResolution(),c=this.ovmap.getExtent();if(c)return{x:Math.round(1/b*(a.lon-c.left)),y:Math.round(1/b*(c.top-a.lat))}},CLASS_NAME:"OpenLayers.Control.OverviewMap"}),OpenLayers.Format.WPSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.WPSCapabilities"}),OpenLayers.Format.WPSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wps:"http://www.opengis.net/wps/1.0.0",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},readers:{wps:{Capabilities:function(a,b){this.readChildNodes(a,b)},ProcessOfferings:function(a,b){b.processOfferings={},this.readChildNodes(a,b.processOfferings)},Process:function(a,b){var c=this.getAttributeNS(a,this.namespaces.wps,"processVersion"),d={processVersion:c};this.readChildNodes(a,d),b[d.identifier]=d},Languages:function(a,b){b.languages=[],this.readChildNodes(a,b.languages)},Default:function(a,b){var c={isDefault:!0};this.readChildNodes(a,c),b.push(c)},Supported:function(a,b){var c={};this.readChildNodes(a,c),b.push(c)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSCapabilities.v1_0_0"}),OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,pinchOrigin:null,currentCenter:null,autoActivate:!0,preserveCenter:!1,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},pinchStart:function(a,b){var c=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):a.xy;this.pinchOrigin=c,this.currentCenter=c},pinchMove:function(a,b){var c=b.scale,d=this.map.layerContainerOriginPx,e=this.pinchOrigin,f=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):a.xy,g=Math.round(d.x+f.x-e.x+(c-1)*(d.x-e.x)),h=Math.round(d.y+f.y-e.y+(c-1)*(d.y-e.y));this.map.applyTransform(g,h,c),this.currentCenter=f},pinchDone:function(a,b,c){this.map.applyTransform();var d=this.map.getZoomForResolution(this.map.getResolution()/c.scale,!0);if(d!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var e=this.map.getResolutionForZoom(d),f=this.map.getLonLatFromPixel(this.pinchOrigin),g=this.currentCenter,h=this.map.getSize();f.lon+=e*(h.w/2-g.x),f.lat-=e*(h.h/2-g.y),this.map.div.clientWidth=this.map.div.clientWidth,this.map.setCenter(f,d)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"}),OpenLayers.Control.TouchNavigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:!1,autoActivate:!0,initialize:function(a){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.pinchZoom&&(this.pinchZoom.destroy(),delete this.pinchZoom),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return!!OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.dragPan.activate(),this.handlers.click.activate(),this.pinchZoom.activate(),!0)},deactivate:function(){return!!OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.dragPan.deactivate(),this.handlers.click.deactivate(),this.pinchZoom.deactivate(),!0)},draw:function(){var a={click:this.defaultClick,dblclick:this.defaultDblClick},b=OpenLayers.Util.extend({double:!0,stopDouble:!0,pixelTolerance:2},this.clickHandlerOptions);this.handlers.click=new OpenLayers.Handler.Click(this,a,b),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.dragPan.draw(),this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))},defaultClick:function(a){a.lastTouches&&2==a.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(a){this.map.zoomTo(this.map.zoom+1,a.xy)},CLASS_NAME:"OpenLayers.Control.TouchNavigation"}),OpenLayers.Console.warn("OpenLayers.Rico is deprecated"),OpenLayers.Rico=OpenLayers.Rico||{},OpenLayers.Rico.Color=OpenLayers.Class({initialize:function(a,b,c){this.rgb={r:a,g:b,b:c}},setRed:function(a){this.rgb.r=a},setGreen:function(a){this.rgb.g=a},setBlue:function(a){this.rgb.b=a},setHue:function(a){var b=this.asHSB();b.h=a,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,b.b)},setSaturation:function(a){var b=this.asHSB();b.s=a,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,b.b)},setBrightness:function(a){var b=this.asHSB();b.b=a,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,b.b)},darken:function(a){var b=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,Math.max(b.b-a,0))},brighten:function(a){var b=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,Math.min(b.b+a,1))},blend:function(a){this.rgb.r=Math.floor((this.rgb.r+a.rgb.r)/2),this.rgb.g=Math.floor((this.rgb.g+a.rgb.g)/2),this.rgb.b=Math.floor((this.rgb.b+a.rgb.b)/2)},isBright:function(){this.asHSB();return this.asHSB().b>.5},isDark:function(){return!this.isBright()},asRGB:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return OpenLayers.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}}),OpenLayers.Rico.Color.createFromHex=function(a){if(4==a.length)for(var b=a,a="#",c=1;c<4;c++)a+=b.charAt(c)+b.charAt(c);0==a.indexOf("#")&&(a=a.substring(1));var d=a.substring(0,2),e=a.substring(2,4),f=a.substring(4,6);return new OpenLayers.Rico.Color(parseInt(d,16),parseInt(e,16),parseInt(f,16))},OpenLayers.Rico.Color.createColorFromBackground=function(a){var b=OpenLayers.Element.getStyle(OpenLayers.Util.getElement(a),"backgroundColor");if("transparent"==b&&a.parentNode)return OpenLayers.Rico.Color.createColorFromBackground(a.parentNode);if(null==b)return new OpenLayers.Rico.Color(255,255,255);if(0==b.indexOf("rgb(")){var c=b.substring(4,b.length-1),d=c.split(",");return new OpenLayers.Rico.Color(parseInt(d[0]),parseInt(d[1]),parseInt(d[2]))}return 0==b.indexOf("#")?OpenLayers.Rico.Color.createFromHex(b):new OpenLayers.Rico.Color(255,255,255)},OpenLayers.Rico.Color.HSBtoRGB=function(a,b,c){var d=0,e=0,f=0;if(0==b)d=parseInt(255*c+.5),e=d,f=d;else{var g=6*(a-Math.floor(a)),h=g-Math.floor(g),i=c*(1-b),j=c*(1-b*h),k=c*(1-b*(1-h));switch(parseInt(g)){case 0:d=255*c+.5,e=255*k+.5,f=255*i+.5;break;case 1:d=255*j+.5,e=255*c+.5,f=255*i+.5;break;case 2:d=255*i+.5,e=255*c+.5,f=255*k+.5;break;case 3:d=255*i+.5,e=255*j+.5,f=255*c+.5;break;case 4:d=255*k+.5,e=255*i+.5,f=255*c+.5;break;case 5:d=255*c+.5,e=255*i+.5,f=255*j+.5}}return{r:parseInt(d),g:parseInt(e),b:parseInt(f)}},OpenLayers.Rico.Color.RGBtoHSB=function(a,b,c){var d,e,f,g=a>b?a:b;c>g&&(g=c);var h=a<b?a:b;if(c<h&&(h=c),f=g/255,0==(e=0!=g?(g-h)/g:0))d=0;else{var i=(g-a)/(g-h),j=(g-b)/(g-h),k=(g-c)/(g-h);d=a==g?k-j:b==g?2+i-k:4+j-i,d/=6,d<0&&(d+=1)}return{h:d,s:e,b:f}},OpenLayers.Style2=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,initialize:function(a){OpenLayers.Util.extend(this,a),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a=0,b=this.rules.length;a<b;a++)this.rules[a].destroy();delete this.rules},clone:function(){var a=OpenLayers.Util.extend({},this);if(this.rules){a.rules=[];for(var b=0,c=this.rules.length;b<c;++b)a.rules.push(this.rules[b].clone())}return new OpenLayers.Style2(a)},CLASS_NAME:"OpenLayers.Style2"}),OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(a,b,c){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate(),this.eventListener=null,OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;for(var a=0,b=this.KEY_EVENTS.length;a<b;a++)OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[a],this.eventListener);return!0}return!1},deactivate:function(){var a=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var b=0,c=this.KEY_EVENTS.length;b<c;b++)OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[b],this.eventListener);a=!0}return a},handleKeyEvent:function(a){this.checkModifiers(a)&&this.callback(a.type,[a])},CLASS_NAME:"OpenLayers.Handler.Keyboard"}),OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{documentDrag:!1,geometryTypes:null,clickout:!0,toggle:!0,standalone:!1,layer:null,feature:null,vertex:null,vertices:null,virtualVertices:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:!0,modified:!1,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(a,b){b=b||{},this.layer=a,this.vertices=[],this.virtualVertices=[],this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,b.vertexRenderIntent)),this.virtualStyle.fillOpacity=.3,this.virtualStyle.strokeOpacity=.3,this.deleteCodes=[46,68],this.mode=OpenLayers.Control.ModifyFeature.RESHAPE,OpenLayers.Control.prototype.initialize.apply(this,[b]),OpenLayers.Util.isArray(this.deleteCodes)||(this.deleteCodes=[this.deleteCodes]);var c={down:function(a){this.vertex=null;var b=this.layer.getFeatureFromEvent(this.handlers.drag.evt);b?this.dragStart(b):this.clickout&&(this._unselect=this.feature)},move:function(a){delete this._unselect,this.vertex&&this.dragVertex(this.vertex,a)},up:function(){this.handlers.drag.stopDown=!1,this._unselect&&(this.unselectFeature(this._unselect),delete this._unselect)},done:function(a){this.vertex&&this.dragComplete(this.vertex)}},d={documentDrag:this.documentDrag,stopDown:!1},e={keydown:this.handleKeypress};this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,e),drag:new OpenLayers.Handler.Drag(this,c,d)}},destroy:function(){this.map&&this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.layer=null,OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.handlers.keyboard.activate()&&this.handlers.drag.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){var a=!1;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.moveLayerBack(),this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),this.layer.removeFeatures(this.vertices,{silent:!0}),this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.vertices=[],this.handlers.drag.deactivate(),this.handlers.keyboard.deactivate();var b=this.feature;b&&b.geometry&&b.layer&&this.unselectFeature(b),a=!0}return a},beforeSelectFeature:function(a){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:a})},selectFeature:function(a){if(!(this.feature===a||this.geometryTypes&&-1==OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME))){!1!==this.beforeSelectFeature(a)&&(this.feature&&this.unselectFeature(this.feature),this.feature=a,this.layer.selectedFeatures.push(a),this.layer.drawFeature(a,"select"),this.modified=!1,this.resetVertices(),this.onModificationStart(this.feature));var b=a.modified;!a.geometry||b&&b.geometry||(this._originalGeometry=a.geometry.clone())}},unselectFeature:function(a){this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[],this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),delete this.dragHandle),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),delete this.radiusHandle),this.layer.drawFeature(this.feature,"default"),this.feature=null,OpenLayers.Util.removeItem(this.layer.selectedFeatures,a),this.onModificationEnd(a),this.layer.events.triggerEvent("afterfeaturemodified",{feature:a,modified:this.modified}),this.modified=!1},dragStart:function(a){var b="OpenLayers.Geometry.Point"==a.geometry.CLASS_NAME;this.standalone||(a._sketch||!b)&&a._sketch||(this.toggle&&this.feature===a&&(this._unselect=a),this.selectFeature(a)),(a._sketch||b)&&(this.vertex=a,this.handlers.drag.stopDown=!0)},dragVertex:function(a,b){var c=this.map.getLonLatFromViewPortPx(b),d=a.geometry;d.move(c.lon-d.x,c.lat-d.y),this.modified=!0,"OpenLayers.Geometry.Point"==this.feature.geometry.CLASS_NAME?this.layer.events.triggerEvent("vertexmodified",{vertex:a.geometry,feature:this.feature,pixel:b}):(a._index?(a.geometry.parent.addComponent(a.geometry,a._index),delete a._index,OpenLayers.Util.removeItem(this.virtualVertices,a),this.vertices.push(a)):a==this.dragHandle?(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null)):a!==this.radiusHandle&&this.layer.events.triggerEvent("vertexmodified",{vertex:a.geometry,feature:this.feature,pixel:b}),this.virtualVertices.length>0&&(this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.layer.drawFeature(this.feature,this.standalone?void 0:"select")),this.layer.drawFeature(a)},dragComplete:function(a){this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE&&(this.feature.state=OpenLayers.State.UPDATE,this.modified&&this._originalGeometry)){var a=this.feature;a.modified=OpenLayers.Util.extend(a.modified,{geometry:this._originalGeometry}),delete this._originalGeometry}},resetVertices:function(){this.vertices.length>0&&(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[]),this.virtualVertices.length>0&&(this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),this.dragHandle=null),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null),this.feature&&"OpenLayers.Geometry.Point"!=this.feature.geometry.CLASS_NAME&&(this.mode&OpenLayers.Control.ModifyFeature.DRAG&&this.collectDragHandle(),this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)&&this.collectRadiusHandle(),this.mode&OpenLayers.Control.ModifyFeature.RESHAPE&&(this.mode&OpenLayers.Control.ModifyFeature.RESIZE||this.collectVertices()))},handleKeypress:function(a){var b=a.keyCode;if(this.feature&&-1!=OpenLayers.Util.indexOf(this.deleteCodes,b)){var c=this.layer.getFeatureFromEvent(this.handlers.drag.evt);c&&-1!=OpenLayers.Util.indexOf(this.vertices,c)&&!this.handlers.drag.dragging&&c.geometry.parent&&(c.geometry.parent.removeComponent(c.geometry),this.layer.events.triggerEvent("vertexremoved",{vertex:c.geometry,feature:this.feature,pixel:a.xy}),this.layer.drawFeature(this.feature,this.standalone?void 0:"select"),this.modified=!0,this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature}))}},collectVertices:function(){function a(c){var d,e,f,g;if("OpenLayers.Geometry.Point"==c.CLASS_NAME)e=new OpenLayers.Feature.Vector(c),e._sketch=!0,e.renderIntent=b.vertexRenderIntent,b.vertices.push(e);else{var h=c.components.length;for("OpenLayers.Geometry.LinearRing"==c.CLASS_NAME&&(h-=1),d=0;d<h;++d)f=c.components[d],"OpenLayers.Geometry.Point"==f.CLASS_NAME?(e=new OpenLayers.Feature.Vector(f),e._sketch=!0,e.renderIntent=b.vertexRenderIntent,b.vertices.push(e)):a(f);if(b.createVertices&&"OpenLayers.Geometry.MultiPoint"!=c.CLASS_NAME)for(d=0,g=c.components.length;d<g-1;++d){var i=c.components[d],j=c.components[d+1];if("OpenLayers.Geometry.Point"==i.CLASS_NAME&&"OpenLayers.Geometry.Point"==j.CLASS_NAME){var k=(i.x+j.x)/2,l=(i.y+j.y)/2,m=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(k,l),null,b.virtualStyle);m.geometry.parent=c,m._index=d+1,m._sketch=!0,b.virtualVertices.push(m)}}}}this.vertices=[],this.virtualVertices=[];var b=this;a.call(this,this.feature.geometry),this.layer.addFeatures(this.virtualVertices,{silent:!0}),this.layer.addFeatures(this.vertices,{silent:!0})},collectDragHandle:function(){var a=this.feature.geometry,b=a.getBounds().getCenterLonLat(),c=new OpenLayers.Geometry.Point(b.lon,b.lat),d=new OpenLayers.Feature.Vector(c);c.move=function(b,c){OpenLayers.Geometry.Point.prototype.move.call(this,b,c),a.move(b,c)},d._sketch=!0,this.dragHandle=d,this.dragHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.dragHandle],{silent:!0})},collectRadiusHandle:function(){var a=this.feature.geometry,b=a.getBounds(),c=b.getCenterLonLat(),d=new OpenLayers.Geometry.Point(c.lon,c.lat),e=new OpenLayers.Geometry.Point(b.right,b.bottom),f=new OpenLayers.Feature.Vector(e),g=this.mode&OpenLayers.Control.ModifyFeature.RESIZE,h=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE,i=this.mode&OpenLayers.Control.ModifyFeature.ROTATE;e.move=function(b,c){
OpenLayers.Geometry.Point.prototype.move.call(this,b,c);var e=this.x-d.x,f=this.y-d.y,j=e-b,k=f-c;if(i){var l=Math.atan2(k,j),m=Math.atan2(f,e),n=m-l;n*=180/Math.PI,a.rotate(n,d)}if(g){var o,p;if(h)o=f/k,p=e/j/o;else{var q=Math.sqrt(j*j+k*k);o=Math.sqrt(e*e+f*f)/q}a.resize(o,d,p)}},f._sketch=!0,this.radiusHandle=f,this.radiusHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.radiusHandle],{silent:!0})},setMap:function(a){this.handlers.drag.setMap(a),OpenLayers.Control.prototype.setMap.apply(this,arguments)},handleMapEvents:function(a){"removelayer"!=a.type&&"order"!=a.property||this.moveLayerToTop()},moveLayerToTop:function(){var a=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(a)},moveLayerBack:function(){var a=this.layer.getZIndex()-1;a>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(a):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Control.ModifyFeature"}),OpenLayers.Control.ModifyFeature.RESHAPE=1,OpenLayers.Control.ModifyFeature.RESIZE=2,OpenLayers.Control.ModifyFeature.ROTATE=4,OpenLayers.Control.ModifyFeature.DRAG=8,OpenLayers.Format.WFS=OpenLayers.Class(OpenLayers.Format.GML,{layer:null,wfsns:"http://www.opengis.net/wfs",ogcns:"http://www.opengis.net/ogc",initialize:function(a,b){OpenLayers.Format.GML.prototype.initialize.apply(this,[a]),this.layer=b,this.layer.featureNS&&(this.featureNS=this.layer.featureNS),this.layer.options.geometry_column&&(this.geometryName=this.layer.options.geometry_column),this.layer.options.typename&&(this.featureName=this.layer.options.typename)},write:function(a){var b=this.createElementNS(this.wfsns,"wfs:Transaction");b.setAttribute("version","1.0.0"),b.setAttribute("service","WFS");for(var c=0;c<a.length;c++)switch(a[c].state){case OpenLayers.State.INSERT:b.appendChild(this.insert(a[c]));break;case OpenLayers.State.UPDATE:b.appendChild(this.update(a[c]));break;case OpenLayers.State.DELETE:b.appendChild(this.remove(a[c]))}return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(a){var b=this.buildGeometryNode(a.geometry),c=this.createElementNS(this.featureNS,"feature:"+this.geometryName);c.appendChild(b);var d=this.createElementNS(this.featureNS,"feature:"+this.featureName);d.appendChild(c);for(var e in a.attributes){var f=this.createTextNode(a.attributes[e]),g=e;-1!=e.search(":")&&(g=e.split(":")[1]);var h=this.createElementNS(this.featureNS,"feature:"+g);h.appendChild(f),d.appendChild(h)}return d},insert:function(a){var b=this.createElementNS(this.wfsns,"wfs:Insert");return b.appendChild(this.createFeatureXML(a)),b},update:function(a){a.fid||OpenLayers.Console.userError(OpenLayers.i18n("noFID"));var b=this.createElementNS(this.wfsns,"wfs:Update");b.setAttribute("typeName",this.featurePrefix+":"+this.featureName),b.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var c=this.createElementNS(this.wfsns,"wfs:Property"),d=this.createElementNS(this.wfsns,"wfs:Name"),e=this.createTextNode(this.geometryName);d.appendChild(e),c.appendChild(d);var f=this.createElementNS(this.wfsns,"wfs:Value"),g=this.buildGeometryNode(a.geometry);a.layer&&g.setAttribute("srsName",a.layer.projection.getCode()),f.appendChild(g),c.appendChild(f),b.appendChild(c);for(var h in a.attributes)c=this.createElementNS(this.wfsns,"wfs:Property"),d=this.createElementNS(this.wfsns,"wfs:Name"),d.appendChild(this.createTextNode(h)),c.appendChild(d),f=this.createElementNS(this.wfsns,"wfs:Value"),f.appendChild(this.createTextNode(a.attributes[h])),c.appendChild(f),b.appendChild(c);var i=this.createElementNS(this.ogcns,"ogc:Filter"),j=this.createElementNS(this.ogcns,"ogc:FeatureId");return j.setAttribute("fid",a.fid),i.appendChild(j),b.appendChild(i),b},remove:function(a){if(!a.fid)return OpenLayers.Console.userError(OpenLayers.i18n("noFID")),!1;var b=this.createElementNS(this.wfsns,"wfs:Delete");b.setAttribute("typeName",this.featurePrefix+":"+this.featureName),b.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var c=this.createElementNS(this.ogcns,"ogc:Filter"),d=this.createElementNS(this.ogcns,"ogc:FeatureId");return d.setAttribute("fid",a.fid),c.appendChild(d),b.appendChild(c),b},destroy:function(){this.layer=null},CLASS_NAME:"OpenLayers.Format.WFS"}),OpenLayers.Format.WFSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{readers:{wfs:OpenLayers.Util.applyDefaults({Service:function(a,b){b.service={},this.readChildNodes(a,b.service)},Fees:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.fees=c)},AccessConstraints:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.accessConstraints=c)},OnlineResource:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.onlineResource=c)},Keywords:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.keywords=c.split(", "))},Capability:function(a,b){b.capability={},this.readChildNodes(a,b.capability)},Request:function(a,b){b.request={},this.readChildNodes(a,b.request)},GetFeature:function(a,b){b.getfeature={href:{},formats:[]},this.readChildNodes(a,b.getfeature)},ResultFormat:function(a,b){for(var c,d=a.childNodes,e=0;e<d.length;e++)c=d[e],1==c.nodeType&&b.formats.push(c.nodeName)},DCPType:function(a,b){this.readChildNodes(a,b)},HTTP:function(a,b){this.readChildNodes(a,b.href)},Get:function(a,b){b.get=a.getAttribute("onlineResource")},Post:function(a,b){b.post=a.getAttribute("onlineResource")},SRS:function(a,b){var c=this.getChildValue(a);c&&(b.srs=c)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs)},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_0_0"}),OpenLayers.Layer.PointGrid=OpenLayers.Class(OpenLayers.Layer.Vector,{dx:null,dy:null,ratio:1.5,maxFeatures:250,rotation:0,origin:null,gridBounds:null,initialize:function(a){a=a||{},OpenLayers.Layer.Vector.prototype.initialize.apply(this,[a.name,a])},setMap:function(a){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments),a.events.register("moveend",this,this.onMoveEnd)},removeMap:function(a){a.events.unregister("moveend",this,this.onMoveEnd),OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},setRatio:function(a){this.ratio=a,this.updateGrid(!0)},setMaxFeatures:function(a){this.maxFeatures=a,this.updateGrid(!0)},setSpacing:function(a,b){this.dx=a,this.dy=b||a,this.updateGrid(!0)},setOrigin:function(a){this.origin=a,this.updateGrid(!0)},getOrigin:function(){return this.origin||(this.origin=this.map.getExtent().getCenterLonLat()),this.origin},setRotation:function(a){this.rotation=a,this.updateGrid(!0)},onMoveEnd:function(){this.updateGrid()},getViewBounds:function(){var a=this.map.getExtent();if(this.rotation){var b=this.getOrigin(),c=new OpenLayers.Geometry.Point(b.lon,b.lat),d=a.toGeometry();d.rotate(-this.rotation,c),a=d.getBounds()}return a},updateGrid:function(a){if(a||this.invalidBounds()){var b=this.getViewBounds(),c=this.getOrigin(),d=new OpenLayers.Geometry.Point(c.lon,c.lat),e=b.getWidth(),f=b.getHeight(),g=e/f,h=Math.sqrt(this.dx*this.dy*this.maxFeatures/g),i=h*g,j=Math.min(e*this.ratio,i),k=Math.min(f*this.ratio,h),l=b.getCenterLonLat();this.gridBounds=new OpenLayers.Bounds(l.lon-j/2,l.lat-k/2,l.lon+j/2,l.lat+k/2);for(var m,n,o,p=Math.floor(k/this.dy),q=Math.floor(j/this.dx),r=c.lon+this.dx*Math.ceil((this.gridBounds.left-c.lon)/this.dx),s=c.lat+this.dy*Math.ceil((this.gridBounds.bottom-c.lat)/this.dy),t=new Array(p*q),u=0;u<q;++u){m=r+u*this.dx;for(var v=0;v<p;++v)n=s+v*this.dy,o=new OpenLayers.Geometry.Point(m,n),this.rotation&&o.rotate(this.rotation,d),t[u*p+v]=new OpenLayers.Feature.Vector(o)}this.destroyFeatures(this.features,{silent:!0}),this.addFeatures(t,{silent:!0})}},invalidBounds:function(){return!this.gridBounds||!this.gridBounds.containsBounds(this.getViewBounds())},CLASS_NAME:"OpenLayers.Layer.PointGrid"}),OpenLayers.Layer.Zoomify=OpenLayers.Class(OpenLayers.Layer.Grid,{size:null,isBaseLayer:!0,standardTileSize:256,tileOriginCorner:"tl",numberOfTiers:0,tileCountUpToTier:null,tierSizeInTiles:null,tierImageSize:null,initialize:function(a,b,c,d){this.initializeZoomify(c),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,b,c,{},d])},initializeZoomify:function(a){var b=a.clone();this.size=a.clone();var c=new OpenLayers.Size(Math.ceil(b.w/this.standardTileSize),Math.ceil(b.h/this.standardTileSize));for(this.tierSizeInTiles=[c],this.tierImageSize=[b];b.w>this.standardTileSize||b.h>this.standardTileSize;)b=new OpenLayers.Size(Math.floor(b.w/2),Math.floor(b.h/2)),c=new OpenLayers.Size(Math.ceil(b.w/this.standardTileSize),Math.ceil(b.h/this.standardTileSize)),this.tierSizeInTiles.push(c),this.tierImageSize.push(b);this.tierSizeInTiles.reverse(),this.tierImageSize.reverse(),this.numberOfTiers=this.tierSizeInTiles.length;var d=[1];this.tileCountUpToTier=[0];for(var e=1;e<this.numberOfTiers;e++)d.unshift(Math.pow(2,e)),this.tileCountUpToTier.push(this.tierSizeInTiles[e-1].w*this.tierSizeInTiles[e-1].h+this.tileCountUpToTier[e-1]);this.serverResolutions||(this.serverResolutions=d)},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments),this.tileCountUpToTier.length=0,this.tierSizeInTiles.length=0,this.tierImageSize.length=0},clone:function(a){return null==a&&(a=new OpenLayers.Layer.Zoomify(this.name,this.url,this.size,this.options)),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){a=this.adjustBounds(a);var b=this.getServerResolution(),c=Math.round((a.left-this.tileOrigin.lon)/(b*this.tileSize.w)),d=Math.round((this.tileOrigin.lat-a.top)/(b*this.tileSize.h)),e=this.getZoomForResolution(b),f=c+d*this.tierSizeInTiles[e].w+this.tileCountUpToTier[e],g="TileGroup"+Math.floor(f/256)+"/"+e+"-"+c+"-"+d+".jpg",h=this.url;return OpenLayers.Util.isArray(h)&&(h=this.selectUrl(g,h)),h+g},getImageSize:function(){if(arguments.length>0){var a=this.adjustBounds(arguments[0]),b=this.getServerResolution(),c=Math.round((a.left-this.tileOrigin.lon)/(b*this.tileSize.w)),d=Math.round((this.tileOrigin.lat-a.top)/(b*this.tileSize.h)),e=this.getZoomForResolution(b),f=this.standardTileSize,g=this.standardTileSize;if(c==this.tierSizeInTiles[e].w-1)var f=this.tierImageSize[e].w%this.standardTileSize;if(d==this.tierSizeInTiles[e].h-1)var g=this.tierImageSize[e].h%this.standardTileSize;return new OpenLayers.Size(f,g)}return this.tileSize},setMap:function(a){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.top)},CLASS_NAME:"OpenLayers.Layer.Zoomify"}),OpenLayers.Format.CQL=function(){function a(a,b){return b instanceof RegExp?b.exec(a):b(a)}function b(b,c){var d,e,g=c.length;for(d=0;d<g;d++){e=c[d];var h=f[e],i=a(b,h);if(i){var j=i[0];return{type:e,text:j,remainder:b.substr(j.length).replace(/^\s*/,"")}}}var k="ERROR: In parsing: ["+b+"], expected one of: ";for(d=0;d<g;d++)e=c[d],k+="\n    "+e+": "+f[e];throw new Error(k)}function c(a){var c,d=[],e=["NOT","GEOMETRY","SPATIAL","PROPERTY","LPAREN"];do{if(c=b(a,e),a=c.remainder,e=g[c.type],"END"!=c.type&&!e)throw new Error("No follows list for "+c.type);d.push(c)}while("END"!=c.type);return d}function d(a){function b(){var a=d.pop();switch(a.type){case"LOGICAL":var c=b(),e=b();return new OpenLayers.Filter.Logical({filters:[e,c],type:j[a.text.toUpperCase()]});case"NOT":var f=b();return new OpenLayers.Filter.Logical({filters:[f],type:OpenLayers.Filter.Logical.NOT});case"BETWEEN":var g,i,k;return d.pop(),i=b(),g=b(),k=b(),new OpenLayers.Filter.Comparison({property:k,lowerBoundary:g,upperBoundary:i,type:OpenLayers.Filter.Comparison.BETWEEN});case"COMPARISON":var l=b(),k=b();return new OpenLayers.Filter.Comparison({property:k,value:l,type:h[a.text.toUpperCase()]});case"IS_NULL":var k=b();return new OpenLayers.Filter.Comparison({property:k,type:h[a.text.toUpperCase()]});case"VALUE":var m=a.text.match(/^'(.*)'$/);return m?m[1].replace(/''/g,"'"):Number(a.text);case"SPATIAL":switch(a.text.toUpperCase()){case"BBOX":var n=b(),o=b(),p=b(),q=b(),r=b();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:r,value:OpenLayers.Bounds.fromArray([q,p,o,n])});case"INTERSECTS":var l=b(),k=b();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:k,value:l});case"WITHIN":var l=b(),k=b();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.WITHIN,property:k,value:l});case"CONTAINS":var l=b(),k=b();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.CONTAINS,property:k,value:l});case"DWITHIN":var s=b(),l=b(),k=b();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,value:l,property:k,distance:Number(s)})}case"GEOMETRY":return OpenLayers.Geometry.fromWKT(a.text);default:return a.text}}for(var c=[],d=[];a.length;){var e=a.shift();switch(e.type){case"PROPERTY":case"GEOMETRY":case"VALUE":d.push(e);break;case"COMPARISON":case"BETWEEN":case"IS_NULL":case"LOGICAL":for(var f=l[e.type];c.length>0&&l[c[c.length-1].type]<=f;)d.push(c.pop());c.push(e);break;case"SPATIAL":case"NOT":case"LPAREN":c.push(e);break;case"RPAREN":for(;c.length>0&&"LPAREN"!=c[c.length-1].type;)d.push(c.pop());c.pop(),c.length>0&&"SPATIAL"==c[c.length-1].type&&d.push(c.pop());case"COMMA":case"END":break;default:throw new Error("Unknown token type "+e.type)}}for(;c.length>0;)d.push(c.pop());var g=b();if(d.length>0){for(var i="Remaining tokens after building AST: \n",k=d.length-1;k>=0;k--)i+=d[k].type+": "+d[k].text+"\n";throw new Error(i)}return g}var e,f={PROPERTY:/^[_a-zA-Z]\w*/,COMPARISON:/^(=|<>|<=|<|>=|>|LIKE)/i,IS_NULL:/^IS NULL/i,COMMA:/^,/,LOGICAL:/^(AND|OR)/i,VALUE:/^('([^']|'')*'|\d+(\.\d*)?|\.\d+)/,LPAREN:/^\(/,RPAREN:/^\)/,SPATIAL:/^(BBOX|INTERSECTS|DWITHIN|WITHIN|CONTAINS)/i,NOT:/^NOT/i,BETWEEN:/^BETWEEN/i,GEOMETRY:function(a){var b=/^(POINT|LINESTRING|POLYGON|MULTIPOINT|MULTILINESTRING|MULTIPOLYGON|GEOMETRYCOLLECTION)/.exec(a);if(b){var c=a.length,d=a.indexOf("(",b[0].length);if(d>-1)for(var e=1;d<c&&e>0;)switch(d++,a.charAt(d)){case"(":e++;break;case")":e--}return[a.substr(0,d+1)]}},END:/^$/},g={LPAREN:["GEOMETRY","SPATIAL","PROPERTY","VALUE","LPAREN"],RPAREN:["NOT","LOGICAL","END","RPAREN"],PROPERTY:["COMPARISON","BETWEEN","COMMA","IS_NULL"],BETWEEN:["VALUE"],IS_NULL:["END"],COMPARISON:["VALUE"],COMMA:["GEOMETRY","VALUE","PROPERTY"],VALUE:["LOGICAL","COMMA","RPAREN","END"],SPATIAL:["LPAREN"],LOGICAL:["NOT","VALUE","SPATIAL","PROPERTY","LPAREN"],NOT:["PROPERTY","LPAREN"],GEOMETRY:["COMMA","RPAREN"]},h={"=":OpenLayers.Filter.Comparison.EQUAL_TO,"<>":OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"<":OpenLayers.Filter.Comparison.LESS_THAN,"<=":OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,">":OpenLayers.Filter.Comparison.GREATER_THAN,">=":OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,LIKE:OpenLayers.Filter.Comparison.LIKE,BETWEEN:OpenLayers.Filter.Comparison.BETWEEN,"IS NULL":OpenLayers.Filter.Comparison.IS_NULL},i={},j={AND:OpenLayers.Filter.Logical.AND,OR:OpenLayers.Filter.Logical.OR},k={},l={RPAREN:3,LOGICAL:2,COMPARISON:1};for(e in h)h.hasOwnProperty(e)&&(i[h[e]]=e);for(e in j)j.hasOwnProperty(e)&&(k[j[e]]=e);return OpenLayers.Class(OpenLayers.Format,{read:function(a){var b=d(c(a));return this.keepData&&(this.data=b),b},write:function(a){if(a instanceof OpenLayers.Geometry)return a.toString();switch(a.CLASS_NAME){case"OpenLayers.Filter.Spatial":switch(a.type){case OpenLayers.Filter.Spatial.BBOX:return"BBOX("+a.property+","+a.value.toBBOX()+")";case OpenLayers.Filter.Spatial.DWITHIN:return"DWITHIN("+a.property+", "+this.write(a.value)+", "+a.distance+")";case OpenLayers.Filter.Spatial.WITHIN:return"WITHIN("+a.property+", "+this.write(a.value)+")";case OpenLayers.Filter.Spatial.INTERSECTS:return"INTERSECTS("+a.property+", "+this.write(a.value)+")";case OpenLayers.Filter.Spatial.CONTAINS:return"CONTAINS("+a.property+", "+this.write(a.value)+")";default:throw new Error("Unknown spatial filter type: "+a.type)}case"OpenLayers.Filter.Logical":if(a.type==OpenLayers.Filter.Logical.NOT)return"NOT ("+this.write(a.filters[0])+")";for(var b="(",c=!0,d=0;d<a.filters.length;d++)c?c=!1:b+=") "+k[a.type]+" (",b+=this.write(a.filters[d]);return b+")";case"OpenLayers.Filter.Comparison":return a.type==OpenLayers.Filter.Comparison.BETWEEN?a.property+" BETWEEN "+this.write(a.lowerBoundary)+" AND "+this.write(a.upperBoundary):null!==a.value?a.property+" "+i[a.type]+" "+this.write(a.value):a.property+" "+i[a.type];case void 0:if("string"==typeof a)return"'"+a.replace(/'/g,"''")+"'";if("number"==typeof a)return String(a);default:throw new Error("Can't encode: "+a.CLASS_NAME+" "+a)}},CLASS_NAME:"OpenLayers.Format.CQL"})}(),OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(a){if(this.supported()){if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);for(var b=document.createStyleSheet(),c=["shape","rect","oval","fill","stroke","imagedata","group","textbox"],d=0,e=c.length;d<e;d++)b.addRule("olv\\:"+c[d],"behavior: url(#default#VML); position: absolute; display: inline-block;")}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)}},supported:function(){return!!document.namespaces},setExtent:function(a,b){var c=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),d=this.getResolution(),e=a.left/d|0,f=a.top/d-this.size.h|0;b||!this.offset?(this.offset={x:e,y:f},e=0,f=0):(e-=this.offset.x,f-=this.offset.y);var g=e-this.xOffset+" "+f;this.root.coordorigin=g;for(var h,i=[this.root,this.vectorRoot,this.textRoot],j=0,k=i.length;j<k;++j){h=i[j];var l=this.size.w+" "+this.size.h;h.coordsize=l}return this.root.style.flip="y",c},setSize:function(a){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);for(var b,c=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],d=this.size.w+"px",e=this.size.h+"px",f=0,g=c.length;f<g;++f)b=c[f],b.style.width=d,b.style.height=e},getNodeType:function(a,b){var c=null;switch(a.CLASS_NAME){case"OpenLayers.Geometry.Point":c=b.externalGraphic?"olv:rect":this.isComplexSymbol(b.graphicName)?"olv:shape":"olv:oval";break;case"OpenLayers.Geometry.Rectangle":c="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":c="olv:shape"}return c},setStyle:function(a,b,c,d){b=b||a._style,c=c||a._options;var e=b.fillColor,f=b.title||b.graphicTitle;if(f&&(a.title=f),"OpenLayers.Geometry.Point"===a._geometryClass)if(b.externalGraphic){c.isFilled=!0;var g=b.graphicWidth||b.graphicHeight,h=b.graphicHeight||b.graphicWidth;g=g||2*b.pointRadius,h=h||2*b.pointRadius;var i=this.getResolution(),j=void 0!=b.graphicXOffset?b.graphicXOffset:-.5*g,k=void 0!=b.graphicYOffset?b.graphicYOffset:-.5*h;a.style.left=((d.x-this.featureDx)/i-this.offset.x+j|0)+"px",a.style.top=(d.y/i-this.offset.y-(k+h)|0)+"px",a.style.width=g+"px",a.style.height=h+"px",a.style.flip="y",e="none",c.isStroked=!1}else if(this.isComplexSymbol(b.graphicName)){var l=this.importSymbol(b.graphicName);a.path=l.path,a.coordorigin=l.left+","+l.bottom;var m=l.size;a.coordsize=m+","+m,this.drawCircle(a,d,b.pointRadius),a.style.flip="y"}else this.drawCircle(a,d,b.pointRadius);c.isFilled?a.fillcolor=e:a.filled="false";var n=a.getElementsByTagName("fill"),o=0==n.length?null:n[0];c.isFilled?(o||(o=this.createNode("olv:fill",a.id+"_fill")),o.opacity=b.fillOpacity,"OpenLayers.Geometry.Point"===a._geometryClass&&b.externalGraphic&&(b.graphicOpacity&&(o.opacity=b.graphicOpacity),o.src=b.externalGraphic,o.type="frame",b.graphicWidth&&b.graphicHeight||(o.aspect="atmost")),o.parentNode!=a&&a.appendChild(o)):o&&a.removeChild(o);var p=b.rotation;void 0===p&&void 0===a._rotation||(a._rotation=p,b.externalGraphic?(this.graphicRotate(a,j,k,b),o.opacity=0):"OpenLayers.Geometry.Point"===a._geometryClass&&(a.style.rotation=p||0));var q=a.getElementsByTagName("stroke"),r=0==q.length?null:q[0];return c.isStroked?(r||(r=this.createNode("olv:stroke",a.id+"_stroke"),a.appendChild(r)),r.on=!0,r.color=b.strokeColor,r.weight=b.strokeWidth+"px",r.opacity=b.strokeOpacity,r.endcap="butt"==b.strokeLinecap?"flat":b.strokeLinecap||"round",b.strokeDashstyle&&(r.dashstyle=this.dashStyle(b))):(a.stroked=!1,r&&(r.on=!1)),"inherit"!=b.cursor&&null!=b.cursor&&(a.style.cursor=b.cursor),a},graphicRotate:function(a,b,c,d){var e,f,d=d||a._style,g=d.rotation||0;if(!d.graphicWidth||!d.graphicHeight){var h=new Image;return h.onreadystatechange=OpenLayers.Function.bind(function(){"complete"!=h.readyState&&"interactive"!=h.readyState||(e=h.width/h.height,f=Math.max(2*d.pointRadius,d.graphicWidth||0,d.graphicHeight||0),b*=e,d.graphicWidth=f*e,d.graphicHeight=f,this.graphicRotate(a,b,c,d))},this),void(h.src=d.externalGraphic)}f=Math.max(d.graphicWidth,d.graphicHeight),e=d.graphicWidth/d.graphicHeight;var i=Math.round(d.graphicWidth||f*e),j=Math.round(d.graphicHeight||f);a.style.width=i+"px",a.style.height=j+"px";var k=document.getElementById(a.id+"_image");k||(k=this.createNode("olv:imagedata",a.id+"_image"),a.appendChild(k)),k.style.width=i+"px",k.style.height=j+"px",k.src=d.externalGraphic,k.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var l=g*Math.PI/180,m=Math.sin(l),n=Math.cos(l),o="progid:DXImageTransform.Microsoft.Matrix(M11="+n+",M12="+-m+",M21="+m+",M22="+n+",SizingMethod='auto expand')\n",p=d.graphicOpacity||d.fillOpacity;p&&1!=p&&(o+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+p+")\n"),a.style.filter=o;var q=new OpenLayers.Geometry.Point(-b,-c),r=new OpenLayers.Bounds(0,0,i,j).toGeometry();r.rotate(d.rotation,q);var s=r.getBounds();a.style.left=Math.round(parseInt(a.style.left)+s.left)+"px",a.style.top=Math.round(parseInt(a.style.top)-s.bottom)+"px"},postDraw:function(a){a.style.visibility="visible";var b=a._style.fillColor,c=a._style.strokeColor;"none"==b&&a.fillcolor!=b&&(a.fillcolor=b),"none"==c&&a.strokecolor!=c&&(a.strokecolor=c)},setNodeDimension:function(a,b){var c=b.getBounds();if(c){var d=this.getResolution(),e=new OpenLayers.Bounds((c.left-this.featureDx)/d-this.offset.x|0,c.bottom/d-this.offset.y|0,(c.right-this.featureDx)/d-this.offset.x|0,c.top/d-this.offset.y|0);a.style.left=e.left+"px",a.style.top=e.top+"px",a.style.width=e.getWidth()+"px",a.style.height=e.getHeight()+"px",a.coordorigin=e.left+" "+e.top,a.coordsize=e.getWidth()+" "+e.getHeight()}},dashStyle:function(a){var b=a.strokeDashstyle;switch(b){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return b;default:var c=b.split(/[ ,]/);return 2==c.length?1*c[0]>=2*c[1]?"longdash":1==c[0]||1==c[1]?"dot":"dash":4==c.length?1*c[0]>=2*c[1]?"longdashdot":"dashdot":"solid"}},createNode:function(a,b){var c=document.createElement(a);return b&&(c.id=b),c.unselectable="on",c.onselectstart=OpenLayers.Function.False,c},nodeTypeCompare:function(a,b){var c=b,d=c.indexOf(":");-1!=d&&(c=c.substr(d+1));var e=a.nodeName;return d=e.indexOf(":"),-1!=d&&(e=e.substr(d+1)),c==e},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(a){return this.nodeFactory(this.container.id+a,"olv:group")},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(a,b,c){if(!isNaN(b.x)&&!isNaN(b.y)){var d=this.getResolution();a.style.left=((b.x-this.featureDx)/d-this.offset.x|0)-c+"px",a.style.top=(b.y/d-this.offset.y|0)-c+"px";var e=2*c;return a.style.width=e+"px",a.style.height=e+"px",a}return!1},drawLineString:function(a,b){return this.drawLine(a,b,!1)},drawLinearRing:function(a,b){return this.drawLine(a,b,!0)},drawLine:function(a,b,c){this.setNodeDimension(a,b);for(var d,e,f,g=this.getResolution(),h=b.components.length,i=new Array(h),j=0;j<h;j++)d=b.components[j],e=(d.x-this.featureDx)/g-this.offset.x|0,f=d.y/g-this.offset.y|0,i[j]=" "+e+","+f+" l ";var k=c?" x e":" e";return a.path="m"+i.join("")+k,a},drawPolygon:function(a,b){this.setNodeDimension(a,b);var c,d,e,f,g,h,i,j,k,l,m,n,o=this.getResolution(),p=[];for(c=0,d=b.components.length;c<d;c++){for(p.push("m"),e=b.components[c].components,f=0===c,g=null,h=null,i=0,j=e.length;i<j;i++)k=e[i],m=(k.x-this.featureDx)/o-this.offset.x|0,n=k.y/o-this.offset.y|0,l=" "+m+","+n,p.push(l),0==i&&p.push(" l"),f||(g?g!=l&&(h?h!=l&&(f=!0):h=l):g=l);p.push(f?" x ":" ")}return p.push("e"),a.path=p.join(""),a},drawRectangle:function(a,b){var c=this.getResolution();return a.style.left=((b.x-this.featureDx)/c-this.offset.x|0)+"px",a.style.top=(b.y/c-this.offset.y|0)+"px",a.style.width=(b.width/c|0)+"px",a.style.height=(b.height/c|0)+"px",a},drawText:function(a,b,c){var d=this.nodeFactory(a+this.LABEL_ID_SUFFIX,"olv:rect"),e=this.nodeFactory(a+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox"),f=this.getResolution();d.style.left=((c.x-this.featureDx)/f-this.offset.x|0)+"px",d.style.top=(c.y/f-this.offset.y|0)+"px",d.style.flip="y",e.innerText=b.label,"inherit"!=b.cursor&&null!=b.cursor&&(e.style.cursor=b.cursor),b.fontColor&&(e.style.color=b.fontColor),b.fontOpacity&&(e.style.filter="alpha(opacity="+100*b.fontOpacity+")"),b.fontFamily&&(e.style.fontFamily=b.fontFamily),b.fontSize&&(e.style.fontSize=b.fontSize),b.fontWeight&&(e.style.fontWeight=b.fontWeight),b.fontStyle&&(e.style.fontStyle=b.fontStyle),!0===b.labelSelect&&(d._featureId=a,e._featureId=a,e._geometry=c,e._geometryClass=c.CLASS_NAME),e.style.whiteSpace="nowrap",e.inset="1px,0px,0px,0px",d.parentNode||(d.appendChild(e),this.textRoot.appendChild(d));var g=b.labelAlign||"cm";1==g.length&&(g+="m");var h=e.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[g.substr(0,1)],i=e.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[g.substr(1,1)];d.style.left=parseInt(d.style.left)-h-1+"px",d.style.top=parseInt(d.style.top)+i+"px"},moveRoot:function(a){var b=this.map.getLayer(a.container.id);b instanceof OpenLayers.Layer.Vector.RootContainer&&(b=this.map.getLayer(this.container.id)),b&&b.renderer.clear(),OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments),b&&b.redraw()},importSymbol:function(a){var b=this.container.id+"-"+a,c=this.symbolCache[b];if(c)return c;var d=OpenLayers.Renderer.symbol[a];if(!d)throw new Error(a+" is not a valid symbol name");for(var e=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),f=["m"],g=0;g<d.length;g+=2){var h=d[g],i=d[g+1];e.left=Math.min(e.left,h),e.bottom=Math.min(e.bottom,i),e.right=Math.max(e.right,h),e.top=Math.max(e.top,i),f.push(h),f.push(i),0==g&&f.push("l")}f.push("x e");var j=f.join(" "),k=(e.getWidth()-e.getHeight())/2;return k>0?(e.bottom=e.bottom-k,e.top=e.top+k):(e.left=e.left+k,e.right=e.right-k),c={path:j,size:e.getWidth(),left:e.left,bottom:e.bottom},this.symbolCache[b]=c,c},CLASS_NAME:"OpenLayers.Renderer.VML"}),OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:.5,r:1,t:0,m:.5,b:1},OpenLayers.Control.CacheRead=OpenLayers.Class(OpenLayers.Control,{fetchEvent:"tileloadstart",layers:null,autoActivate:!0,setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);var b,c=this.layers||a.layers;for(b=c.length-1;b>=0;--b)this.addLayer({layer:c[b]});this.layers||a.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})},addLayer:function(a){a.layer.events.register(this.fetchEvent,this,this.fetch)},removeLayer:function(a){a.layer.events.unregister(this.fetchEvent,this,this.fetch)},fetch:function(a){if(this.active&&window.localStorage&&a.tile instanceof OpenLayers.Tile.Image){var b=a.tile,c=b.url;!b.layer.crossOriginKeyword&&OpenLayers.ProxyHost&&0===c.indexOf(OpenLayers.ProxyHost)&&(c=OpenLayers.Control.CacheWrite.urlMap[c]);var d=window.localStorage.getItem("olCache_"+c);d&&(b.url=d,"tileerror"===a.type&&b.setImgSrc(d))}},destroy:function(){if(this.layers||this.map){var a,b=this.layers||this.map.layers;for(a=b.length-1;a>=0;--a)this.removeLayer({layer:b[a]})}this.map&&this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheRead"}),OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"}),OpenLayers.Control.WMTSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,requestEncoding:"KVP",drillDown:!1,maxFeatures:10,clickCallback:"click",layers:null,queryVisible:!0,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,pending:0,initialize:function(a){if(a=a||{},a.handlerOptions=a.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[a]),this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(a.formatOptions)),!0===this.drillDown&&(this.hover=!1),this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var b={};b[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,b,this.handlerOptions.click||{})}},getInfoForClick:function(a){this.request(a.xy,{})},getInfoForHover:function(a){this.request(a.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(--this.pending,this.pending<=0&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0),this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var a,b=this.layers||this.map.layers,c=[],d=b.length-1;d>=0&&(!((a=b[d])instanceof OpenLayers.Layer.WMTS&&a.requestEncoding===this.requestEncoding)||this.queryVisible&&!a.getVisibility()||(c.push(a),this.drillDown&&!this.hover));--d);return c},buildRequestOptions:function(a,b){var c=this.map.getLonLatFromPixel(b),d=a.getURL(new OpenLayers.Bounds(c.lon,c.lat,c.lon,c.lat)),e=OpenLayers.Util.getParameters(d),f=a.getTileInfo(c);return OpenLayers.Util.extend(e,{service:"WMTS",version:a.version,request:"GetFeatureInfo",infoFormat:this.infoFormat,i:f.i,j:f.j}),OpenLayers.Util.applyDefaults(e,this.vendorParams),{url:OpenLayers.Util.isArray(a.url)?a.url[0]:a.url,params:OpenLayers.Util.upperCaseObject(e),callback:function(c){this.handleResponse(b,c,a)},scope:this}},request:function(a,b){b=b||{};var c=this.findLayers();if(c.length>0){for(var d,e=0,f=c.length;e<f;e++)if(d=c[e],!1!==this.events.triggerEvent("beforegetfeatureinfo",{xy:a,layer:d})){++this.pending;var g=this.buildRequestOptions(d,a),h=OpenLayers.Request.GET(g);!0===b.hover&&(this.hoverRequest=h)}this.pending>0&&OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait")}},handleResponse:function(a,b,c){if(--this.pending,this.pending<=0&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0),b.status&&(b.status<200||b.status>=300))this.events.triggerEvent("exception",{xy:a,request:b,layer:c});else{var d=b.responseXML;d&&d.documentElement||(d=b.responseText);var e,f;try{e=this.format.read(d)}catch(d){f=!0,this.events.triggerEvent("exception",{xy:a,request:b,error:d,layer:c})}f||this.events.triggerEvent("getfeatureinfo",{text:b.responseText,features:e,request:b,xy:a,layer:c})}},CLASS_NAME:"OpenLayers.Control.WMTSGetFeatureInfo"}),OpenLayers.Layer.MapServer=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{mode:"map",map_imagetype:"png"},initialize:function(a,b,c,d){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS),null!=d&&null!=d.isBaseLayer||(this.isBaseLayer="true"!=this.params.transparent&&1!=this.params.transparent)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.MapServer(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){a=this.adjustBounds(a);var b=[a.left,a.bottom,a.right,a.top],c=this.getImageSize();return this.getFullRequestString({mapext:b,imgext:b,map_size:[c.w,c.h],imgx:c.w/2,imgy:c.h/2,imgxy:[c.w,c.h]})},getFullRequestString:function(a,b){
var c=null==b?this.url:b,d=OpenLayers.Util.extend({},this.params);d=OpenLayers.Util.extend(d,a);var e=OpenLayers.Util.getParameterString(d);OpenLayers.Util.isArray(c)&&(c=this.selectUrl(e,c));var f=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c));for(var g in d)g.toUpperCase()in f&&delete d[g];e=OpenLayers.Util.getParameterString(d);var h=c;if(""!=(e=e.replace(/,/g,"+"))){var i=c.charAt(c.length-1);"&"==i||"?"==i?h+=e:-1==c.indexOf("?")?h+="?"+e:h+="&"+e}return h},CLASS_NAME:"OpenLayers.Layer.MapServer"}),OpenLayers.Protocol.CSW.v2_0_2=OpenLayers.Class(OpenLayers.Protocol,{formatOptions:null,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a]),a.format||(this.format=new OpenLayers.Format.CSWGetRecords.v2_0_2(OpenLayers.Util.extend({},this.formatOptions)))},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){a=OpenLayers.Util.extend({},a),OpenLayers.Util.applyDefaults(a,this.options||{});var b=new OpenLayers.Protocol.Response({requestType:"read"}),c=this.format.write(a.params||a);return b.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,b,a),params:a.params,headers:a.headers,data:c}),b},handleRead:function(a,b){if(b.callback){var c=a.priv;c.status>=200&&c.status<300?(a.data=this.parseData(c),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE,b.callback.call(b.scope,a)}},parseData:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),!b||b.length<=0?null:this.format.read(b)},CLASS_NAME:"OpenLayers.Protocol.CSW.v2_0_2"}),OpenLayers.Control.Graticule=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,intervals:[45,30,20,10,5,2,1,.5,.2,.1,.05,.01,.005,.002,.001],displayInLayerSwitcher:!0,visible:!0,numPoints:50,targetSize:200,layerName:null,labelled:!0,labelFormat:"dm",lineSymbolizer:{strokeColor:"#333",strokeWidth:1,strokeOpacity:.5},labelSymbolizer:{},gratLayer:null,initialize:function(a){a=a||{},a.layerName=a.layerName||OpenLayers.i18n("Graticule"),OpenLayers.Control.prototype.initialize.apply(this,[a]),this.labelSymbolizer.stroke=!1,this.labelSymbolizer.fill=!1,this.labelSymbolizer.label="${label}",this.labelSymbolizer.labelAlign="${labelAlign}",this.labelSymbolizer.labelXOffset="${xOffset}",this.labelSymbolizer.labelYOffset="${yOffset}"},destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.gratLayer&&(this.gratLayer.destroy(),this.gratLayer=null)},draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),!this.gratLayer){var a=new OpenLayers.Style({},{rules:[new OpenLayers.Rule({symbolizer:{Point:this.labelSymbolizer,Line:this.lineSymbolizer}})]});this.gratLayer=new OpenLayers.Layer.Vector(this.layerName,{styleMap:new OpenLayers.StyleMap({default:a}),visibility:this.visible,displayInLayerSwitcher:this.displayInLayerSwitcher})}return this.div},activate:function(){return!!OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.map.addLayer(this.gratLayer),this.map.events.register("moveend",this,this.update),this.update(),!0)},deactivate:function(){return!!OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.map.events.unregister("moveend",this,this.update),this.map.removeLayer(this.gratLayer),!0)},update:function(){var a=this.map.getExtent();if(a){this.gratLayer.destroyFeatures();var b=new OpenLayers.Projection("EPSG:4326"),c=this.map.getProjectionObject(),d=this.map.getResolution();c.proj&&"longlat"==c.proj.projName&&(this.numPoints=1);var e=this.map.getCenter(),f=new OpenLayers.Pixel(e.lon,e.lat);OpenLayers.Projection.transform(f,c,b);var g=this.targetSize*d;g*=g;for(var h,i=0;i<this.intervals.length;++i){h=this.intervals[i];var j=h/2,k=f.offset({x:-j,y:-j}),l=f.offset({x:j,y:j});OpenLayers.Projection.transform(k,b,c),OpenLayers.Projection.transform(l,b,c);if((k.x-l.x)*(k.x-l.x)+(k.y-l.y)*(k.y-l.y)<=g)break}f.x=Math.floor(f.x/h)*h,f.y=Math.floor(f.y/h)*h;var m,n=0,o=[f.clone()],p=f.clone();do{p=p.offset({x:0,y:h}),m=OpenLayers.Projection.transform(p.clone(),b,c),o.unshift(p)}while(a.containsPixel(m)&&++n<1e3);p=f.clone();do{p=p.offset({x:0,y:-h}),m=OpenLayers.Projection.transform(p.clone(),b,c),o.push(p)}while(a.containsPixel(m)&&++n<1e3);n=0;var q=[f.clone()];p=f.clone();do{p=p.offset({x:-h,y:0}),m=OpenLayers.Projection.transform(p.clone(),b,c),q.unshift(p)}while(a.containsPixel(m)&&++n<1e3);p=f.clone();do{p=p.offset({x:h,y:0}),m=OpenLayers.Projection.transform(p.clone(),b,c),q.push(p)}while(a.containsPixel(m)&&++n<1e3);for(var r=[],i=0;i<q.length;++i){for(var s=q[i].x,t=[],u=null,v=Math.min(o[0].y,90),w=Math.max(o[o.length-1].y,-90),x=(v-w)/this.numPoints,y=w,z=0;z<=this.numPoints;++z){var A=new OpenLayers.Geometry.Point(s,y);A.transform(b,c),t.push(A),y+=x,A.y>=a.bottom&&!u&&(u=A)}if(this.labelled){var B=new OpenLayers.Geometry.Point(u.x,a.bottom),C={value:s,label:this.labelled?OpenLayers.Util.getFormattedLonLat(s,"lon",this.labelFormat):"",labelAlign:"cb",xOffset:0,yOffset:2};this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(B,C))}var D=new OpenLayers.Geometry.LineString(t);r.push(new OpenLayers.Feature.Vector(D))}for(var z=0;z<o.length;++z)if(!((y=o[z].y)<-90||y>90)){for(var t=[],E=q[0].x,F=q[q.length-1].x,G=(F-E)/this.numPoints,s=E,u=null,i=0;i<=this.numPoints;++i){var A=new OpenLayers.Geometry.Point(s,y);A.transform(b,c),t.push(A),s+=G,A.x<a.right&&(u=A)}if(this.labelled){var B=new OpenLayers.Geometry.Point(a.right,u.y),C={value:y,label:this.labelled?OpenLayers.Util.getFormattedLonLat(y,"lat",this.labelFormat):"",labelAlign:"rb",xOffset:-2,yOffset:2};this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(B,C))}var D=new OpenLayers.Geometry.LineString(t);r.push(new OpenLayers.Feature.Vector(D))}this.gratLayer.addFeatures(r)}},CLASS_NAME:"OpenLayers.Control.Graticule"}),OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(a,b){},onDrag:function(a,b){},onComplete:function(a,b){},onEnter:function(a){},onLeave:function(a){},documentDrag:!1,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),this.layer=a,this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(a){this.handlers.feature.touch&&!this.over&&this.overFeature(a)&&(this.handlers.drag.dragstart(this.handlers.feature.evt),this.handlers.drag.stopDown=!1)},clickoutFeature:function(a){this.handlers.feature.touch&&this.over&&(this.outFeature(a),this.handlers.drag.stopDown=!0)},destroy:function(){this.layer=null,OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.handlers.drag.deactivate(),this.handlers.feature.deactivate(),this.feature=null,this.dragging=!1,this.lastPixel=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(a){var b=!1;return this.handlers.drag.dragging?this.feature.id==a.id?this.over=!0:this.over=!1:(this.feature=a,this.handlers.drag.activate(),b=!0,this.over=!0,OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onEnter(a)),b},downFeature:function(a){this.lastPixel=a,this.onStart(this.feature,a)},moveFeature:function(a){var b=this.map.getResolution();this.feature.geometry.move(b*(a.x-this.lastPixel.x),b*(this.lastPixel.y-a.y)),this.layer.drawFeature(this.feature),this.lastPixel=a,this.onDrag(this.feature,a)},upFeature:function(a){this.over||this.handlers.drag.deactivate()},doneDragging:function(a){this.onComplete(this.feature,a)},outFeature:function(a){this.handlers.drag.dragging?this.feature.id==a.id&&(this.over=!1):(this.over=!1,this.handlers.drag.deactivate(),OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onLeave(a),this.feature=null)},cancel:function(){this.handlers.drag.deactivate(),this.over=!1},setMap:function(a){this.handlers.drag.setMap(a),this.handlers.feature.setMap(a),OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"}),OpenLayers.Console.warn("OpenLayers.Rico is deprecated"),OpenLayers.Rico=OpenLayers.Rico||{},OpenLayers.Rico.Corner={round:function(a,b){a=OpenLayers.Util.getElement(a),this._setOptions(b);var c=this.options.color;"fromElement"==this.options.color&&(c=this._background(a));var d=this.options.bgColor;"fromParent"==this.options.bgColor&&(d=this._background(a.offsetParent)),this._roundCornersImpl(a,c,d)},changeColor:function(a,b){a.style.backgroundColor=b;for(var c=a.parentNode.getElementsByTagName("span"),d=0;d<c.length;d++)c[d].style.backgroundColor=b},changeOpacity:function(a,b){var c=b,d="alpha(opacity="+100*b+")";a.style.opacity=c,a.style.filter=d;for(var e=a.parentNode.getElementsByTagName("span"),f=0;f<e.length;f++)e[f].style.opacity=c,e[f].style.filter=d},reRound:function(a,b){var c=a.parentNode.childNodes[0],d=a.parentNode.childNodes[2];a.parentNode.removeChild(c),a.parentNode.removeChild(d),this.round(a.parentNode,b)},_roundCornersImpl:function(a,b,c){this.options.border&&this._renderBorder(a,c),this._isTopRounded()&&this._roundTopCorners(a,b,c),this._isBottomRounded()&&this._roundBottomCorners(a,b,c)},_renderBorder:function(a,b){var c="1px solid "+this._borderColor(b),d="border-left: "+c,e="border-right: "+c,f="style='"+d+";"+e+"'";a.innerHTML="<div "+f+">"+a.innerHTML+"</div>"},_roundTopCorners:function(a,b,c){for(var d=this._createCorner(c),e=0;e<this.options.numSlices;e++)d.appendChild(this._createCornerSlice(b,c,e,"top"));a.style.paddingTop=0,a.insertBefore(d,a.firstChild)},_roundBottomCorners:function(a,b,c){for(var d=this._createCorner(c),e=this.options.numSlices-1;e>=0;e--)d.appendChild(this._createCornerSlice(b,c,e,"bottom"));a.style.paddingBottom=0,a.appendChild(d)},_createCorner:function(a){var b=document.createElement("div");return b.style.backgroundColor=this._isTransparent()?"transparent":a,b},_createCornerSlice:function(a,b,c,d){var e=document.createElement("span"),f=e.style;f.backgroundColor=a,f.display="block",f.height="1px",f.overflow="hidden",f.fontSize="1px";var g=this._borderColor(a,b);return this.options.border&&0==c?(f.borderTopStyle="solid",f.borderTopWidth="1px",f.borderLeftWidth="0px",f.borderRightWidth="0px",f.borderBottomWidth="0px",f.height="0px",f.borderColor=g):g&&(f.borderColor=g,f.borderStyle="solid",f.borderWidth="0px 1px"),this.options.compact||c!=this.options.numSlices-1||(f.height="2px"),this._setMargin(e,c,d),this._setBorder(e,c,d),e},_setOptions:function(a){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:!0,border:!1,compact:!1},OpenLayers.Util.extend(this.options,a||{}),this.options.numSlices=this.options.compact?2:4,this._isTransparent()&&(this.options.blend=!1)},_whichSideTop:function(){return this._hasString(this.options.corners,"all","top")?"":this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0?"":this.options.corners.indexOf("tl")>=0?"left":this.options.corners.indexOf("tr")>=0?"right":""},_whichSideBottom:function(){return this._hasString(this.options.corners,"all","bottom")?"":this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0?"":this.options.corners.indexOf("bl")>=0?"left":this.options.corners.indexOf("br")>=0?"right":""},_borderColor:function(a,b){return"transparent"==a?b:this.options.border?this.options.border:this.options.blend?this._blend(b,a):""},_setMargin:function(a,b,c){var d=this._marginSize(b),e="top"==c?this._whichSideTop():this._whichSideBottom();"left"==e?(a.style.marginLeft=d+"px",a.style.marginRight="0px"):"right"==e?(a.style.marginRight=d+"px",a.style.marginLeft="0px"):(a.style.marginLeft=d+"px",a.style.marginRight=d+"px")},_setBorder:function(a,b,c){var d=this._borderSize(b),e="top"==c?this._whichSideTop():this._whichSideBottom();"left"==e?(a.style.borderLeftWidth=d+"px",a.style.borderRightWidth="0px"):"right"==e?(a.style.borderRightWidth=d+"px",a.style.borderLeftWidth="0px"):(a.style.borderLeftWidth=d+"px",a.style.borderRightWidth=d+"px"),0!=this.options.border&&(a.style.borderLeftWidth=d+"px",a.style.borderRightWidth=d+"px")},_marginSize:function(a){if(this._isTransparent())return 0;var b=[5,3,2,1],c=[3,2,1,0],d=[2,1],e=[1,0];return this.options.compact&&this.options.blend?e[a]:this.options.compact?d[a]:this.options.blend?c[a]:b[a]},_borderSize:function(a){var b=[5,3,2,1],c=[2,1,1,1],d=[1,0],e=[0,2,0,0];return this.options.compact&&(this.options.blend||this._isTransparent())?1:this.options.compact?d[a]:this.options.blend?c[a]:this.options.border?e[a]:this._isTransparent()?b[a]:0},_hasString:function(a){for(var b=1;b<arguments.length;b++)if(a.indexOf(arguments[b])>=0)return!0;return!1},_blend:function(a,b){var c=OpenLayers.Rico.Color.createFromHex(a);return c.blend(OpenLayers.Rico.Color.createFromHex(b)),c},_background:function(a){try{return OpenLayers.Rico.Color.createColorFromBackground(a).asHex()}catch(a){return"#ffffff"}},_isTransparent:function(){return"transparent"==this.options.color},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")},_hasSingleTextChild:function(a){return 1==a.childNodes.length&&3==a.childNodes[0].nodeType}},OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:!0,clearOnDeactivate:!1,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:!1,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]),this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);var b={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(b,this.previousOptions),this.previous=new OpenLayers.Control.Button(b);var c={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(c,this.nextOptions),this.next=new OpenLayers.Control.Button(c),this.clear()},onPreviousChange:function(a,b){a&&!this.previous.active?this.previous.activate():!a&&this.previous.active&&this.previous.deactivate()},onNextChange:function(a,b){a&&!this.next.active?this.next.activate():!a&&this.next.active&&this.next.deactivate()},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this),this.previous.destroy(),this.next.destroy(),this.deactivate();for(var a in this)this[a]=null},setMap:function(a){this.map=a,this.next.setMap(a),this.previous.setMap(a)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments),this.next.draw(),this.previous.draw()},previousTrigger:function(){var a=this.previousStack.shift(),b=this.previousStack.shift();return void 0!=b?(this.nextStack.unshift(a),this.previousStack.unshift(b),this.restoring=!0,this.restore(b),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)):this.previousStack.unshift(a),b},nextTrigger:function(){var a=this.nextStack.shift();return void 0!=a&&(this.previousStack.unshift(a),this.restoring=!0,this.restore(a),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)),a},clear:function(){this.previousStack=[],this.previous.deactivate(),this.nextStack=[],this.next.deactivate()},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}},restore:function(a){var b,c;if(this.map.getProjectionObject()==a.projection)c=this.map.getZoomForResolution(a.resolution),b=a.center;else{b=a.center.clone(),b.transform(a.projection,this.map.getProjectionObject());var d=a.units,e=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,f=d&&e?OpenLayers.INCHES_PER_UNIT[d]/OpenLayers.INCHES_PER_UNIT[e]:1;c=this.map.getZoomForResolution(f*a.resolution)}this.map.setCenter(b,c)},setListeners:function(){this.listeners={};for(var a in this.registry)this.listeners[a]=OpenLayers.Function.bind(function(){if(!this.restoring){var b=this.registry[a].apply(this,arguments);this.previousStack.unshift(b),this.previousStack.length>1&&this.onPreviousChange(this.previousStack[1],this.previousStack.length-1),this.previousStack.length>this.limit+1&&this.previousStack.pop(),this.nextStack.length>0&&(this.nextStack=[],this.onNextChange(null,0))}return!0},this)},activate:function(){var a=!1;if(this.map&&OpenLayers.Control.prototype.activate.apply(this)){null==this.listeners&&this.setListeners();for(var b in this.listeners)this.map.events.register(b,this,this.listeners[b]);a=!0,0==this.previousStack.length&&this.initStack()}return a},initStack:function(){this.map.getCenter()&&this.listeners.moveend()},deactivate:function(){var a=!1;if(this.map&&OpenLayers.Control.prototype.deactivate.apply(this)){for(var b in this.listeners)this.map.events.unregister(b,this,this.listeners[b]);this.clearOnDeactivate&&this.clear(),a=!0}return a},CLASS_NAME:"OpenLayers.Control.NavigationHistory"}),OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(a,b){b.srs[this.getChildValue(a)]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"}),OpenLayers.Layer.UTFGrid=OpenLayers.Class(OpenLayers.Layer.XYZ,{isBaseLayer:!1,projection:new OpenLayers.Projection("EPSG:900913"),useJSONP:!1,tileClass:OpenLayers.Tile.UTFGrid,initialize:function(a){OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a.name,a.url,{},a]),this.tileOptions=OpenLayers.Util.extend({utfgridResolution:this.utfgridResolution},this.tileOptions)},createBackBuffer:function(){},clone:function(a){return null==a&&(a=new OpenLayers.Layer.UTFGrid(this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getFeatureInfo:function(a){var b=null,c=this.getTileData(a);return c&&c.tile&&(b=c.tile.getFeatureInfo(c.i,c.j)),b},getFeatureId:function(a){var b=null,c=this.getTileData(a);return c.tile&&(b=c.tile.getFeatureId(c.i,c.j)),b},CLASS_NAME:"OpenLayers.Layer.UTFGrid"}),OpenLayers.TileManager=OpenLayers.Class({cacheSize:256,tilesPerFrame:2,frameDelay:16,moveDelay:100,zoomDelay:200,maps:null,tileQueueId:null,tileQueue:null,tileCache:null,tileCacheIndex:null,initialize:function(a){OpenLayers.Util.extend(this,a),this.maps=[],this.tileQueueId={},this.tileQueue={},this.tileCache={},this.tileCacheIndex=[]},addMap:function(a){if(!this._destroyed&&OpenLayers.Layer.Grid){this.maps.push(a),this.tileQueue[a.id]=[];for(var b=0,c=a.layers.length;b<c;++b)this.addLayer({layer:a.layers[b]});a.events.on({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this})}},removeMap:function(a){if(!this._destroyed&&OpenLayers.Layer.Grid){if(window.clearTimeout(this.tileQueueId[a.id]),a.layers)for(var b=0,c=a.layers.length;b<c;++b)this.removeLayer({layer:a.layers[b]});a.events&&a.events.un({move:this.move,zoomend:this.zoomEnd,changelayer:this.changeLayer,addlayer:this.addLayer,preremovelayer:this.removeLayer,scope:this}),delete this.tileQueue[a.id],delete this.tileQueueId[a.id],OpenLayers.Util.removeItem(this.maps,a)}},move:function(a){this.updateTimeout(a.object,this.moveDelay,!0)},zoomEnd:function(a){this.updateTimeout(a.object,this.zoomDelay)},changeLayer:function(a){"visibility"!==a.property&&"params"!==a.property||this.updateTimeout(a.object,0)},addLayer:function(a){var b=a.layer;if(b instanceof OpenLayers.Layer.Grid){b.events.on({addtile:this.addTile,retile:this.clearTileQueue,scope:this});var c,d,e;for(c=b.grid.length-1;c>=0;--c)for(d=b.grid[c].length-1;d>=0;--d)e=b.grid[c][d],this.addTile({tile:e}),e.url&&!e.imgDiv&&this.manageTileCache({object:e})}},removeLayer:function(a){var b=a.layer;if(b instanceof OpenLayers.Layer.Grid&&(this.clearTileQueue({object:b}),b.events&&b.events.un({addtile:this.addTile,retile:this.clearTileQueue,scope:this}),b.grid)){var c,d,e;for(c=b.grid.length-1;c>=0;--c)for(d=b.grid[c].length-1;d>=0;--d)e=b.grid[c][d],this.unloadTile({object:e})}},updateTimeout:function(a,b,c){window.clearTimeout(this.tileQueueId[a.id]);var d=this.tileQueue[a.id];c&&!d.length||(this.tileQueueId[a.id]=window.setTimeout(OpenLayers.Function.bind(function(){this.drawTilesFromQueue(a),d.length&&this.updateTimeout(a,this.frameDelay)},this),b))},addTile:function(a){a.tile instanceof OpenLayers.Tile.Image?a.tile.events.on({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this}):this.removeLayer({layer:a.tile.layer})},unloadTile:function(a){var b=a.object;b.events.un({beforedraw:this.queueTileDraw,beforeload:this.manageTileCache,loadend:this.addToCache,unload:this.unloadTile,scope:this}),OpenLayers.Util.removeItem(this.tileQueue[b.layer.map.id],b)},queueTileDraw:function(a){var b=a.object,c=!1,d=b.layer,e=d.getURL(b.bounds),f=this.tileCache[e];if(f&&"olTileImage"!==f.className&&(delete this.tileCache[e],OpenLayers.Util.removeItem(this.tileCacheIndex,e),f=null),d.url&&(d.async||!f)){var g=this.tileQueue[d.map.id];~OpenLayers.Util.indexOf(g,b)||g.push(b),c=!0}return!c},drawTilesFromQueue:function(a){for(var b=this.tileQueue[a.id],c=this.tilesPerFrame,d=a.zoomTween&&a.zoomTween.playing;!d&&b.length&&c;)b.shift().draw(!0),--c},manageTileCache:function(a){var b=a.object,c=this.tileCache[b.url];c&&(c.parentNode&&OpenLayers.Element.hasClass(c.parentNode,"olBackBuffer")&&(c.parentNode.removeChild(c),c.id=null),c.parentNode||(c.style.visibility="hidden",c.style.opacity=0,b.setImage(c),OpenLayers.Util.removeItem(this.tileCacheIndex,b.url),this.tileCacheIndex.push(b.url)))},addToCache:function(a){var b=a.object;this.tileCache[b.url]||OpenLayers.Element.hasClass(b.imgDiv,"olImageLoadError")||(this.tileCacheIndex.length>=this.cacheSize&&(delete this.tileCache[this.tileCacheIndex[0]],this.tileCacheIndex.shift()),this.tileCache[b.url]=b.imgDiv,this.tileCacheIndex.push(b.url))},clearTileQueue:function(a){for(var b=a.object,c=this.tileQueue[b.map.id],d=c.length-1;d>=0;--d)c[d].layer===b&&c.splice(d,1)},destroy:function(){for(var a=this.maps.length-1;a>=0;--a)this.removeMap(this.maps[a]);this.maps=null,this.tileQueue=null,this.tileQueueId=null,this.tileCache=null,this.tileCacheIndex=null,this._destroyed=!0}}),OpenLayers.Protocol.Script=OpenLayers.Class(OpenLayers.Protocol,{url:null,params:null,callback:null,callbackTemplate:"OpenLayers.Protocol.Script.registry.${id}",callbackKey:"callback",callbackPrefix:"",scope:null,format:null,pendingRequests:null,srsInBBOX:!1,initialize:function(a){if(a=a||{},this.params={},this.pendingRequests={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),this.format||(this.format=new OpenLayers.Format.GeoJSON),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var b=new OpenLayers.Format.QueryStringFilter({srsInBBOX:this.srsInBBOX});this.filterToParams=function(a,c){return b.write(a,c)}}},read:function(a){OpenLayers.Protocol.prototype.read.apply(this,arguments),a=OpenLayers.Util.applyDefaults(a,this.options),a.params=OpenLayers.Util.applyDefaults(a.params,this.options.params),a.filter&&this.filterToParams&&(a.params=this.filterToParams(a.filter,a.params));var b=new OpenLayers.Protocol.Response({requestType:"read"}),c=this.createRequest(a.url,a.params,OpenLayers.Function.bind(function(c){b.data=c,this.handleRead(b,a)},this));return b.priv=c,b},createRequest:function(a,b,c){var d=OpenLayers.Protocol.Script.register(c),e=OpenLayers.String.format(this.callbackTemplate,{id:d});b=OpenLayers.Util.extend({},b),b[this.callbackKey]=this.callbackPrefix+e,a=OpenLayers.Util.urlAppend(a,OpenLayers.Util.getParameterString(b));var f=document.createElement("script");return f.type="text/javascript",f.src=a,f.id="OpenLayers_Protocol_Script_"+d,this.pendingRequests[f.id]=f,document.getElementsByTagName("head")[0].appendChild(f),f},destroyRequest:function(a){OpenLayers.Protocol.Script.unregister(a.id.split("_").pop()),delete this.pendingRequests[a.id],a.parentNode&&a.parentNode.removeChild(a)},handleRead:function(a,b){this.handleResponse(a,b)},handleResponse:function(a,b){b.callback&&(a.data?(a.features=this.parseFeatures(a.data),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE,this.destroyRequest(a.priv),b.callback.call(b.scope,a))},parseFeatures:function(a){return this.format.read(a)},abort:function(a){if(a)this.destroyRequest(a.priv);else for(var b in this.pendingRequests)this.destroyRequest(this.pendingRequests[b])},destroy:function(){this.abort(),delete this.params,delete this.format,OpenLayers.Protocol.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Protocol.Script"}),function(){var a=OpenLayers.Protocol.Script,b=0;a.registry={},a.register=function(c){var d="c"+ ++b;return a.registry[d]=function(){c.apply(this,arguments)},d},a.unregister=function(b){delete a.registry[b]}}(),OpenLayers.Control.TransformFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,layer:null,preserveAspectRatio:!1,rotate:!0,feature:null,renderIntent:"temporary",rotationHandleSymbolizer:null,box:null,center:null,scale:1,ratio:1,rotation:0,handles:null,rotationHandles:null,dragControl:null,irregular:!1,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),this.layer=a,this.rotationHandleSymbolizer||(this.rotationHandleSymbolizer={stroke:!1,pointRadius:10,fillOpacity:0,cursor:"pointer"}),this.createBox(),this.createControl()},activate:function(){var a=!1;return OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.dragControl.activate(),this.layer.addFeatures([this.box]),this.rotate&&this.layer.addFeatures(this.rotationHandles),this.layer.addFeatures(this.handles),a=!0),a},deactivate:function(){var a=!1;return OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.layer.removeFeatures(this.handles),this.rotate&&this.layer.removeFeatures(this.rotationHandles),this.layer.removeFeatures([this.box]),this.dragControl.deactivate(),a=!0),a},setMap:function(a){this.dragControl.setMap(a),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setFeature:function(a,b){b=OpenLayers.Util.applyDefaults(b,{rotation:0,scale:1,ratio:1});var c=this.rotation,d=this.center;if(OpenLayers.Util.extend(this,b),!1!==this.events.triggerEvent("beforesetfeature",{feature:a})){this.feature=a,this.activate(),this._setfeature=!0;var e=this.feature.geometry.getBounds();this.box.move(e.getCenterLonLat()),this.box.geometry.rotate(-c,d),this._angle=0;var f;if(this.rotation){var g=a.geometry.clone();g.rotate(-this.rotation,this.center);var h=new OpenLayers.Feature.Vector(g.getBounds().toGeometry());h.geometry.rotate(this.rotation,this.center),this.box.geometry.rotate(this.rotation,this.center),this.box.move(h.geometry.getBounds().getCenterLonLat()),f=h.geometry.components[0].components[0].getBounds().getCenterLonLat()}else f=new OpenLayers.LonLat(e.left,e.bottom);this.handles[0].move(f),delete this._setfeature,this.events.triggerEvent("setfeature",{feature:a})}},unsetFeature:function(){this.active?this.deactivate():(this.feature=null,this.rotation=0,this.scale=1,this.ratio=1)},createBox:function(){var a=this;this.center=new OpenLayers.Geometry.Point(0,0),this.box=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-1,-1),new OpenLayers.Geometry.Point(0,-1),new OpenLayers.Geometry.Point(1,-1),new OpenLayers.Geometry.Point(1,0),new OpenLayers.Geometry.Point(1,1),new OpenLayers.Geometry.Point(0,1),new OpenLayers.Geometry.Point(-1,1),new OpenLayers.Geometry.Point(-1,0),new OpenLayers.Geometry.Point(-1,-1)]),null,"string"==typeof this.renderIntent?null:this.renderIntent),this.box.geometry.move=function(b,c){a._moving=!0,OpenLayers.Geometry.LineString.prototype.move.apply(this,arguments),a.center.move(b,c),delete a._moving};for(var b,c,d,e=function(a,b){OpenLayers.Geometry.Point.prototype.move.apply(this,arguments),this._rotationHandle&&this._rotationHandle.geometry.move(a,b),this._handle.geometry.move(a,b)},f=function(a,b,c){OpenLayers.Geometry.Point.prototype.resize.apply(this,arguments),this._rotationHandle&&this._rotationHandle.geometry.resize(a,b,c),this._handle.geometry.resize(a,b,c)},g=function(a,b){OpenLayers.Geometry.Point.prototype.rotate.apply(this,arguments),this._rotationHandle&&this._rotationHandle.geometry.rotate(a,b),this._handle.geometry.rotate(a,b)},h=function(b,c){var d=this.x,e=this.y;if(OpenLayers.Geometry.Point.prototype.move.call(this,b,c),!a._moving){var f=a.dragControl.handlers.drag.evt,g=!a._setfeature&&a.preserveAspectRatio,h=!(g||f&&f.shiftKey),i=new OpenLayers.Geometry.Point(d,e),j=a.center;this.rotate(-a.rotation,j),i.rotate(-a.rotation,j);var k=this.x-j.x,l=this.y-j.y,m=k-(this.x-i.x),n=l-(this.y-i.y);a.irregular&&!a._setfeature&&(k-=(this.x-i.x)/2,l-=(this.y-i.y)/2),this.x=d,this.y=e;var o,p=1;if(h)o=Math.abs(n)<1e-5?1:l/n,p=(Math.abs(m)<1e-5?1:k/m)/o;else{var q=Math.sqrt(m*m+n*n);o=Math.sqrt(k*k+l*l)/q}if(a._moving=!0,a.box.geometry.rotate(-a.rotation,j),delete a._moving,a.box.geometry.resize(o,j,p),a.box.geometry.rotate(a.rotation,j),a.transformFeature({scale:o,ratio:p}),a.irregular&&!a._setfeature){var r=j.clone();r.x+=Math.abs(d-j.x)<1e-5?0:this.x-d,r.y+=Math.abs(e-j.y)<1e-5?0:this.y-e,a.box.geometry.move(this.x-d,this.y-e),a.transformFeature({center:r})}}},i=function(b,c){var d=this.x,e=this.y;if(OpenLayers.Geometry.Point.prototype.move.call(this,b,c),!a._moving){var f=a.dragControl.handlers.drag.evt,g=f&&f.shiftKey?45:1,h=a.center,i=this.x-h.x,j=this.y-h.y,k=i-b,l=j-c;this.x=d,this.y=e;var m=Math.atan2(l,k),n=Math.atan2(j,i),o=n-m;o*=180/Math.PI,a._angle=(a._angle+o)%360;var p=a.rotation%g;(Math.abs(a._angle)>=g||0!==p)&&(o=Math.round(a._angle/g)*g-p,a._angle=0,a.box.geometry.rotate(o,h),a.transformFeature({rotation:o}))}},j=new Array(8),k=new Array(4),l=["sw","s","se","e","ne","n","nw","w"],m=0;m<8;++m)b=this.box.geometry.components[m],c=new OpenLayers.Feature.Vector(b.clone(),{role:l[m]+"-resize"},"string"==typeof this.renderIntent?null:this.renderIntent),m%2==0&&(d=new OpenLayers.Feature.Vector(b.clone(),{role:l[m]+"-rotate"},"string"==typeof this.rotationHandleSymbolizer?null:this.rotationHandleSymbolizer),d.geometry.move=i,b._rotationHandle=d,k[m/2]=d),b.move=e,b.resize=f,b.rotate=g,c.geometry.move=h,b._handle=c,j[m]=c;this.rotationHandles=k,this.handles=j},createControl:function(){var a=this;this.dragControl=new OpenLayers.Control.DragFeature(this.layer,{documentDrag:!0,moveFeature:function(b){this.feature===a.feature&&(this.feature=a.box),OpenLayers.Control.DragFeature.prototype.moveFeature.apply(this,arguments)},onDrag:function(b,c){b===a.box&&a.transformFeature({center:a.center})},onStart:function(b,c){var d=!a.geometryTypes||-1!==OpenLayers.Util.indexOf(a.geometryTypes,b.geometry.CLASS_NAME),e=OpenLayers.Util.indexOf(a.handles,b)
;e+=OpenLayers.Util.indexOf(a.rotationHandles,b),b!==a.feature&&b!==a.box&&-2==e&&d&&a.setFeature(b)},onComplete:function(b,c){a.events.triggerEvent("transformcomplete",{feature:a.feature})}})},drawHandles:function(){for(var a=this.layer,b=0;b<8;++b)this.rotate&&b%2==0&&a.drawFeature(this.rotationHandles[b/2],this.rotationHandleSymbolizer),a.drawFeature(this.handles[b],this.renderIntent)},transformFeature:function(a){if(!this._setfeature){this.scale*=a.scale||1,this.ratio*=a.ratio||1;var b=this.rotation;if(this.rotation=(this.rotation+(a.rotation||0))%360,!1!==this.events.triggerEvent("beforetransform",a)){var c=this.feature,d=c.geometry,e=this.center;d.rotate(-b,e),a.scale||a.ratio?d.resize(a.scale,e,a.ratio):a.center&&c.move(a.center.getBounds().getCenterLonLat()),d.rotate(this.rotation,e),this.layer.drawFeature(c),c.toState(OpenLayers.State.UPDATE),this.events.triggerEvent("transform",a)}}this.layer.drawFeature(this.box,this.renderIntent),this.drawHandles()},destroy:function(){for(var a,b=0;b<8;++b)a=this.box.geometry.components[b],a._handle.destroy(),a._handle=null,a._rotationHandle&&a._rotationHandle.destroy(),a._rotationHandle=null;this.center=null,this.feature=null,this.handles=null,this.rotationHandleSymbolizer=null,this.rotationHandles=null,this.box.destroy(),this.box=null,this.layer=null,this.dragControl.destroy(),this.dragControl=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.TransformFeature"}),OpenLayers.Layer.ArcGISCache=OpenLayers.Class(OpenLayers.Layer.XYZ,{url:null,tileOrigin:null,tileSize:new OpenLayers.Size(256,256),useArcGISServer:!0,type:"png",useScales:!1,overrideDPI:!1,initialize:function(a,b,c){if(OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.resolutions&&(this.serverResolutions=this.resolutions,this.maxExtent=this.getMaxExtentForResolution(this.resolutions[0])),this.layerInfo){var d=this.layerInfo,e=new OpenLayers.Bounds(d.fullExtent.xmin,d.fullExtent.ymin,d.fullExtent.xmax,d.fullExtent.ymax);if(this.projection="EPSG:"+d.spatialReference.wkid,this.sphericalMercator=102100==d.spatialReference.wkid,this.units="esriFeet"==d.units?"ft":"m",d.tileInfo){this.tileSize=new OpenLayers.Size(d.tileInfo.width||d.tileInfo.cols,d.tileInfo.height||d.tileInfo.rows),this.tileOrigin=new OpenLayers.LonLat(d.tileInfo.origin.x,d.tileInfo.origin.y);var f=new OpenLayers.Geometry.Point(e.left,e.top),g=new OpenLayers.Geometry.Point(e.right,e.bottom);this.useScales?this.scales=[]:this.resolutions=[],this.lods=[];for(var h in d.tileInfo.lods)if(d.tileInfo.lods.hasOwnProperty(h)){var i=d.tileInfo.lods[h];this.useScales?this.scales.push(i.scale):this.resolutions.push(i.resolution);var j=this.getContainingTileCoords(f,i.resolution);i.startTileCol=j.x,i.startTileRow=j.y;var k=this.getContainingTileCoords(g,i.resolution);i.endTileCol=k.x,i.endTileRow=k.y,this.lods.push(i)}this.maxExtent=this.calculateMaxExtentWithLOD(this.lods[0]),this.serverResolutions=this.resolutions,this.overrideDPI&&d.tileInfo.dpi&&(OpenLayers.DOTS_PER_INCH=d.tileInfo.dpi)}}},getContainingTileCoords:function(a,b){return new OpenLayers.Pixel(Math.max(Math.floor((a.x-this.tileOrigin.lon)/(this.tileSize.w*b)),0),Math.max(Math.floor((this.tileOrigin.lat-a.y)/(this.tileSize.h*b)),0))},calculateMaxExtentWithLOD:function(a){var b=a.endTileCol-a.startTileCol+1,c=a.endTileRow-a.startTileRow+1,d=this.tileOrigin.lon+a.startTileCol*this.tileSize.w*a.resolution,e=d+b*this.tileSize.w*a.resolution,f=this.tileOrigin.lat-a.startTileRow*this.tileSize.h*a.resolution,g=f-c*this.tileSize.h*a.resolution;return new OpenLayers.Bounds(d,g,e,f)},calculateMaxExtentWithExtent:function(a,b){var c=new OpenLayers.Geometry.Point(a.left,a.top),d=new OpenLayers.Geometry.Point(a.right,a.bottom),e=this.getContainingTileCoords(c,b),f=this.getContainingTileCoords(d,b),g={resolution:b,startTileCol:e.x,startTileRow:e.y,endTileCol:f.x,endTileRow:f.y};return this.calculateMaxExtentWithLOD(g)},getUpperLeftTileCoord:function(a){var b=new OpenLayers.Geometry.Point(this.maxExtent.left,this.maxExtent.top);return this.getContainingTileCoords(b,a)},getLowerRightTileCoord:function(a){var b=new OpenLayers.Geometry.Point(this.maxExtent.right,this.maxExtent.bottom);return this.getContainingTileCoords(b,a)},getMaxExtentForResolution:function(a){var b=this.getUpperLeftTileCoord(a),c=this.getLowerRightTileCoord(a),d=c.x-b.x+1,e=c.y-b.y+1,f=this.tileOrigin.lon+b.x*this.tileSize.w*a,g=f+d*this.tileSize.w*a,h=this.tileOrigin.lat-b.y*this.tileSize.h*a,i=h-e*this.tileSize.h*a;return new OpenLayers.Bounds(f,i,g,h)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.ArcGISCache(this.name,this.url,this.options)),OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])},initGriddedTiles:function(a){delete this._tileOrigin,OpenLayers.Layer.XYZ.prototype.initGriddedTiles.apply(this,arguments)},getMaxExtent:function(){var a=this.map.getResolution();return this.maxExtent=this.getMaxExtentForResolution(a)},getTileOrigin:function(){if(!this._tileOrigin){var a=this.getMaxExtent();this._tileOrigin=new OpenLayers.LonLat(a.left,a.bottom)}return this._tileOrigin},getURL:function(a){var b=this.getResolution(),c=this.tileOrigin.lon+b*this.tileSize.w/2,d=this.tileOrigin.lat-b*this.tileSize.h/2,e=a.getCenterLonLat(),f=(e.lon,e.lat,Math.round(Math.abs((e.lon-c)/(b*this.tileSize.w)))),g=Math.round(Math.abs((d-e.lat)/(b*this.tileSize.h))),h=this.map.getZoom();if(this.lods){var i=this.lods[this.map.getZoom()];if(f<i.startTileCol||f>i.endTileCol||g<i.startTileRow||g>i.endTileRow)return null}else{var j=this.getUpperLeftTileCoord(b),k=this.getLowerRightTileCoord(b);if(f<j.x||f>=k.x||g<j.y||g>=k.y)return null}var l=this.url,m=""+f+g+h;return OpenLayers.Util.isArray(l)&&(l=this.selectUrl(m,l)),this.useArcGISServer?l+="/tile/${z}/${y}/${x}":(f="C"+OpenLayers.Number.zeroPad(f,8,16),g="R"+OpenLayers.Number.zeroPad(g,8,16),h="L"+OpenLayers.Number.zeroPad(h,2,10),l=l+"/${z}/${y}/${x}."+this.type),l=OpenLayers.String.format(l,{x:f,y:g,z:h}),OpenLayers.Util.urlAppend(l,OpenLayers.Util.getParameterString(this.params))},CLASS_NAME:"OpenLayers.Layer.ArcGISCache"}),OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,drillDown:!1,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,initialize:function(a){if(a=a||{},a.handlerOptions=a.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[a]),this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(a.formatOptions)),!0===this.drillDown&&(this.hover=!1),this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var b={};b[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,b,this.handlerOptions.click||{})}},getInfoForClick:function(a){this.events.triggerEvent("beforegetfeatureinfo",{xy:a.xy}),OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait"),this.request(a.xy,{})},getInfoForHover:function(a){this.events.triggerEvent("beforegetfeatureinfo",{xy:a.xy}),this.request(a.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var a,b,c=this.layers||this.map.layers,d=[],e=c.length-1;e>=0;--e)(a=c[e])instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||a.getVisibility())&&(b=OpenLayers.Util.isArray(a.url)?a.url[0]:a.url,!1!==this.drillDown||this.url||(this.url=b),(!0===this.drillDown||this.urlMatches(b))&&d.push(a));return d},urlMatches:function(a){var b=OpenLayers.Util.isEquivalentUrl(this.url,a);if(!b&&this.layerUrls)for(var c=0,d=this.layerUrls.length;c<d;++c)if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[c],a)){b=!0;break}return b},buildWMSOptions:function(a,b,c,d){for(var e=[],f=[],g=0,h=b.length;g<h;g++)null!=b[g].params.LAYERS&&(e=e.concat(b[g].params.LAYERS),f=f.concat(this.getStyleNames(b[g])));var i=b[0],j=this.map.getProjection(),k=i.projection;k&&k.equals(this.map.getProjectionObject())&&(j=k.getCode());var l=OpenLayers.Util.extend({service:"WMS",version:i.params.VERSION,request:"GetFeatureInfo",exceptions:i.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,i.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:d,info_format:i.params.INFO_FORMAT||this.infoFormat},parseFloat(i.params.VERSION)>=1.3?{crs:j,i:parseInt(c.x),j:parseInt(c.y)}:{srs:j,x:parseInt(c.x),y:parseInt(c.y)});return 0!=e.length&&(l=OpenLayers.Util.extend({layers:e,query_layers:e,styles:f},l)),OpenLayers.Util.applyDefaults(l,this.vendorParams),{url:a,params:OpenLayers.Util.upperCaseObject(l),callback:function(b){this.handleResponse(c,b,a)},scope:this}},getStyleNames:function(a){return a.params.STYLES?a.params.STYLES:OpenLayers.Util.isArray(a.params.LAYERS)?new Array(a.params.LAYERS.length):a.params.LAYERS.replace(/[^,]/g,"")},request:function(a,b){var c=this.findLayers();if(0==c.length)return this.events.triggerEvent("nogetfeatureinfo"),void OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");if(b=b||{},!1===this.drillDown){var d=this.buildWMSOptions(this.url,c,a,c[0].params.FORMAT),e=OpenLayers.Request.GET(d);!0===b.hover&&(this.hoverRequest=e)}else{this._requestCount=0,this._numRequests=0,this.features=[];for(var f,g={},h=0,i=c.length;h<i;h++){var j=c[h];f=OpenLayers.Util.isArray(j.url)?j.url[0]:j.url,f in g?g[f].push(j):(this._numRequests++,g[f]=[j])}var c;for(var f in g){c=g[f];var d=this.buildWMSOptions(f,c,a,c[0].params.FORMAT);OpenLayers.Request.GET(d)}}},triggerGetFeatureInfo:function(a,b,c){this.events.triggerEvent("getfeatureinfo",{text:a.responseText,features:c,request:a,xy:b}),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(a,b,c){var d=b.responseXML;d&&d.documentElement||(d=b.responseText);var e=this.format.read(d);!1===this.drillDown?this.triggerGetFeatureInfo(b,a,e):(this._requestCount++,"object"===this.output?this._features=(this._features||[]).concat({url:c,features:e}):this._features=(this._features||[]).concat(e),this._requestCount===this._numRequests&&(this.triggerGetFeatureInfo(b,a,this._features.concat()),delete this._features,delete this._requestCount,delete this._numRequests))},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"}),OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"}),OpenLayers.Control.UTFGrid=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,layers:null,defaultHandlerOptions:{delay:300,pixelTolerance:4,stopMove:!1,single:!0,double:!1,stopSingle:!1,stopDouble:!1},handlerMode:"click",setHandler:function(a){this.handlerMode=a,this.resetHandler()},resetHandler:function(){return this.handler&&(this.handler.deactivate(),this.handler.destroy(),this.handler=null),"hover"==this.handlerMode?this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.reset},this.handlerOptions):"click"==this.handlerMode?this.handler=new OpenLayers.Handler.Click(this,{click:this.handleEvent},this.handlerOptions):"move"==this.handlerMode&&(this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.handleEvent},this.handlerOptions)),!!this.handler},initialize:function(a){a=a||{},a.handlerOptions=a.handlerOptions||this.defaultHandlerOptions,OpenLayers.Control.prototype.initialize.apply(this,[a]),this.resetHandler()},handleEvent:function(a){if(null==a)return void this.reset();var b=this.map.getLonLatFromPixel(a.xy);if(b){var c=this.findLayers();if(c.length>0){for(var d,e,f={},g=0,h=c.length;g<h;g++)d=c[g],e=OpenLayers.Util.indexOf(this.map.layers,d),f[e]=d.getFeatureInfo(b);this.callback(f,b,a.xy)}}},callback:function(a){},reset:function(a){this.callback(null)},findLayers:function(){for(var a,b=this.layers||this.map.layers,c=[],d=b.length-1;d>=0;--d)(a=b[d])instanceof OpenLayers.Layer.UTFGrid&&c.push(a);return c},CLASS_NAME:"OpenLayers.Control.UTFGrid"}),OpenLayers.Control.Split=OpenLayers.Class(OpenLayers.Control,{layer:null,source:null,sourceOptions:null,tolerance:null,edge:!0,deferDelete:!1,mutual:!0,targetFilter:null,sourceFilter:null,handler:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]),this.options=a||{},this.options.source&&this.setSource(this.options.source)},setSource:function(a){this.active?(this.deactivate(),this.handler&&(this.handler.destroy(),delete this.handler),this.source=a,this.activate()):this.source=a},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);return a&&(this.source?this.source.events&&this.source.events.on({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this}):(this.handler||(this.handler=new OpenLayers.Handler.Path(this,{done:function(a){this.onSketchComplete({feature:new OpenLayers.Feature.Vector(a)})}},{layerOptions:this.sourceOptions})),this.handler.activate())),a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);return a&&this.source&&this.source.events&&this.source.events.un({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this}),a},onSketchComplete:function(a){return this.feature=null,!this.considerSplit(a.feature)},afterFeatureModified:function(a){if(a.modified){"function"==typeof a.feature.geometry.split&&(this.feature=a.feature,this.considerSplit(a.feature))}},removeByGeometry:function(a,b){for(var c=0,d=a.length;c<d;++c)if(a[c].geometry===b){a.splice(c,1);break}},isEligible:function(a){return!!a.geometry&&(a.state!==OpenLayers.State.DELETE&&"function"==typeof a.geometry.split&&this.feature!==a&&(!this.targetFilter||this.targetFilter.evaluate(a.attributes)))},considerSplit:function(a){var b=!1,c=!1;if(!this.sourceFilter||this.sourceFilter.evaluate(a.attributes)){for(var d,e,f,g,h,i,j=this.layer&&this.layer.features||[],k=[],l=[],m=this.layer===this.source&&this.mutual,n={edge:this.edge,tolerance:this.tolerance,mutual:m},o=[a.geometry],p=0,q=j.length;p<q;++p)if(f=j[p],this.isEligible(f)){g=[f.geometry];for(var r=0;r<o.length;++r){h=o[r];for(var s=0;s<g.length;++s)d=g[s],h.getBounds().intersectsBounds(d.getBounds())&&(e=h.split(d,n))&&!1!==this.events.triggerEvent("beforesplit",{source:a,target:f})&&(m&&(i=e[0],i.length>1&&(i.unshift(r,1),Array.prototype.splice.apply(o,i),r+=i.length-3),e=e[1]),e.length>1&&(e.unshift(s,1),Array.prototype.splice.apply(g,e),s+=e.length-3))}g&&g.length>1&&(this.geomsToFeatures(f,g),this.events.triggerEvent("split",{original:f,features:g}),Array.prototype.push.apply(k,g),l.push(f),c=!0)}if(o&&o.length>1&&(this.geomsToFeatures(a,o),this.events.triggerEvent("split",{original:a,features:o}),Array.prototype.push.apply(k,o),l.push(a),b=!0),b||c){if(this.deferDelete){for(var t,u=[],p=0,q=l.length;p<q;++p)t=l[p],t.state===OpenLayers.State.INSERT?u.push(t):(t.state=OpenLayers.State.DELETE,this.layer.drawFeature(t));this.layer.destroyFeatures(u,{silent:!0});for(var p=0,q=k.length;p<q;++p)k[p].state=OpenLayers.State.INSERT}else this.layer.destroyFeatures(l,{silent:!0});this.layer.addFeatures(k,{silent:!0}),this.events.triggerEvent("aftersplit",{source:a,features:k})}}return b},geomsToFeatures:function(a,b){var c=a.clone();delete c.geometry;for(var d,e=0,f=b.length;e<f;++e)d=c.clone(),d.geometry=b[e],d.state=OpenLayers.State.INSERT,b[e]=d},destroy:function(){this.active&&this.deactivate(),OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Split"}),OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,serverResolutions:null,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(a){var b={url:!0,layer:!0,style:!0,matrixSet:!0};for(var c in b)if(!(c in a))throw new Error("Missing property '"+c+"' in layer configuration.");a.params=OpenLayers.Util.upperCaseObject(a.params);var d=[a.name,a.url,a.params,a];if(OpenLayers.Layer.Grid.prototype.initialize.apply(this,d),this.formatSuffix||(this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop()),this.matrixIds){var e=this.matrixIds.length;if(e&&"string"==typeof this.matrixIds[0]){var f=this.matrixIds;this.matrixIds=new Array(e);for(var g=0;g<e;++g)this.matrixIds[g]={identifier:f[g]}}}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments)},updateMatrixProperties:function(){this.matrix=this.getMatrix(),this.matrix&&(this.matrix.topLeftCorner&&(this.tileOrigin=this.matrix.topLeftCorner),this.matrix.tileWidth&&this.matrix.tileHeight&&(this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)),this.tileFullExtent||(this.tileFullExtent=this.maxExtent))},moveTo:function(a,b,c){return!b&&this.matrix||this.updateMatrixProperties(),OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.WMTS(this.options)),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getIdentifier:function(){return this.getServerZoom()},getMatrix:function(){var a;if(this.matrixIds&&0!==this.matrixIds.length)if("scaleDenominator"in this.matrixIds[0])for(var b,c=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.getServerResolution()/28e-5,d=Number.POSITIVE_INFINITY,e=0,f=this.matrixIds.length;e<f;++e)(b=Math.abs(1-this.matrixIds[e].scaleDenominator/c))<d&&(d=b,a=this.matrixIds[e]);else a=this.matrixIds[this.getIdentifier()];else a={identifier:this.getIdentifier()};return a},getTileInfo:function(a){var b=this.getServerResolution(),c=(a.lon-this.tileOrigin.lon)/(b*this.tileSize.w),d=(this.tileOrigin.lat-a.lat)/(b*this.tileSize.h),e=Math.floor(c),f=Math.floor(d);return{col:e,row:f,i:Math.floor((c-e)*this.tileSize.w),j:Math.floor((d-f)*this.tileSize.h)}},getURL:function(a){a=this.adjustBounds(a);var b="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(a)){var c,d=a.getCenterLonLat(),e=this.getTileInfo(d),f=(this.matrix.identifier,this.dimensions);if(b=OpenLayers.Util.isArray(this.url)?this.selectUrl([this.version,this.style,this.matrixSet,this.matrix.identifier,e.row,e.col].join(","),this.url):this.url,"REST"===this.requestEncoding.toUpperCase())if(c=this.params,-1!==b.indexOf("{")){var g=b.replace(/\{/g,"${"),h={style:this.style,Style:this.style,TileMatrixSet:this.matrixSet,TileMatrix:this.matrix.identifier,TileRow:e.row,TileCol:e.col};if(f){var i,j;for(j=f.length-1;j>=0;--j)i=f[j],h[i]=c[i.toUpperCase()]}b=OpenLayers.String.format(g,h)}else{var k=this.version+"/"+this.layer+"/"+this.style+"/";if(f)for(var j=0;j<f.length;j++)c[f[j]]&&(k=k+c[f[j]]+"/");k=k+this.matrixSet+"/"+this.matrix.identifier+"/"+e.row+"/"+e.col+"."+this.formatSuffix,b.match(/\/$/)||(b+="/"),b+=k}else"KVP"===this.requestEncoding.toUpperCase()&&(c={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:e.row,TILECOL:e.col,FORMAT:this.format},b=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[c]))}return b},mergeNewParams:function(a){if("KVP"===this.requestEncoding.toUpperCase())return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(a)])},CLASS_NAME:"OpenLayers.Layer.WMTS"}),OpenLayers.Layer.KaMapCache=OpenLayers.Class(OpenLayers.Layer.KaMap,{IMAGE_EXTENSIONS:{jpeg:"jpg",gif:"gif",png:"png",png8:"png",png24:"png",dithered:"png"},DEFAULT_FORMAT:"jpeg",initialize:function(a,b,c,d){OpenLayers.Layer.KaMap.prototype.initialize.apply(this,arguments),this.extension=this.IMAGE_EXTENSIONS[this.params.i.toLowerCase()||this.DEFAULT_FORMAT]},getURL:function(a){a=this.adjustBounds(a);var b=this.map.getResolution(),c=Math.round(1e4*this.map.getScale())/1e4,d=Math.round(a.left/b),e=-Math.round(a.top/b),f=Math.floor(d/this.tileSize.w/this.params.metaTileSize.w)*this.tileSize.w*this.params.metaTileSize.w,g=Math.floor(e/this.tileSize.h/this.params.metaTileSize.h)*this.tileSize.h*this.params.metaTileSize.h,h=["/",this.params.map,"/",c,"/",this.params.g.replace(/\s/g,"_"),"/def/t",g,"/l",f,"/t",e,"l",d,".",this.extension],i=this.url;return OpenLayers.Util.isArray(i)&&(i=this.selectUrl(h.join(""),i)),i+h.join("")},CLASS_NAME:"OpenLayers.Layer.KaMapCache"}),OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,format:"image/png",serverResolutions:null,initialize:function(a,b,c,d){this.layername=c,OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,b,{},d]),this.extension=this.format.split("/")[1].toLowerCase(),this.extension="jpg"==this.extension?"jpeg":this.extension},clone:function(a){return null==a&&(a=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){var b=this.getServerResolution(),c=this.maxExtent,d=this.tileSize,e=Math.round((a.left-c.left)/(b*d.w)),f=Math.round((a.bottom-c.bottom)/(b*d.h)),g=null!=this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,b):this.map.getZoom(),h=[this.layername,OpenLayers.Number.zeroPad(g,2),OpenLayers.Number.zeroPad(parseInt(e/1e6),3),OpenLayers.Number.zeroPad(parseInt(e/1e3)%1e3,3),OpenLayers.Number.zeroPad(parseInt(e)%1e3,3),OpenLayers.Number.zeroPad(parseInt(f/1e6),3),OpenLayers.Number.zeroPad(parseInt(f/1e3)%1e3,3),OpenLayers.Number.zeroPad(parseInt(f)%1e3,3)+"."+this.extension],i=h.join("/"),j=this.url;return OpenLayers.Util.isArray(j)&&(j=this.selectUrl(i,j)),(j="/"==j.charAt(j.length-1)?j:j+"/")+i},CLASS_NAME:"OpenLayers.Layer.TileCache"}),OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1_1,{version:"1.1.1",profile:"WMSC",readers:{wms:OpenLayers.Util.applyDefaults({VendorSpecificCapabilities:function(a,b){b.vendorSpecific={tileSets:[]},this.readChildNodes(a,b.vendorSpecific)},TileSet:function(a,b){var c={srs:{},bbox:{},resolutions:[]};this.readChildNodes(a,c),b.tileSets.push(c)},Resolutions:function(a,b){for(var c=this.getChildValue(a).split(" "),d=0,e=c.length;d<e;d++)""!=c[d]&&b.resolutions.push(parseFloat(c[d]))},Width:function(a,b){b.width=parseInt(this.getChildValue(a))},Height:function(a,b){b.height=parseInt(this.getChildValue(a))},Layers:function(a,b){b.layers=this.getChildValue(a)},Styles:function(a,b){b.styles=this.getChildValue(a)}},OpenLayers.Format.WMSCapabilities.v1_1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC"}),OpenLayers.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,{layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,minimizeDiv:null,maximizeDiv:null,ascending:!0,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.layerStates=[]},destroy:function(){this.clearLayersArray("base"),this.clearLayersArray("data"),this.map.events.un({buttonclick:this.onButtonClick,addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this}),this.events.unregister("buttonclick",this,this.onButtonClick),OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments),this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this}),this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this),this.loadContents(),this.outsideViewport||this.minimizeControl(),this.redraw(),this.div},onButtonClick:function(a){var b=a.buttonElement;b===this.minimizeDiv?this.minimizeControl():b===this.maximizeDiv?this.maximizeControl():b._layerSwitcher===this.id&&(b.for&&(b=document.getElementById(b.for)),b.disabled||("radio"==b.type?(b.checked=!0,this.map.setBaseLayer(this.map.getLayer(b._layer))):(b.checked=!b.checked,this.updateMap())))},clearLayersArray:function(a){this[a+"LayersDiv"].innerHTML="",this[a+"Layers"]=[]},checkRedraw:function(){if(!this.layerStates.length||this.map.layers.length!=this.layerStates.length)return!0;for(var a=0,b=this.layerStates.length;a<b;a++){var c=this.layerStates[a],d=this.map.layers[a];if(c.name!=d.name||c.inRange!=d.inRange||c.id!=d.id||c.visibility!=d.visibility)return!0}return!1},redraw:function(){if(!this.checkRedraw())return this.div;this.clearLayersArray("base"),this.clearLayersArray("data");var a=!1,b=!1,c=this.map.layers.length;this.layerStates=new Array(c);for(var d=0;d<c;d++){var e=this.map.layers[d];this.layerStates[d]={name:e.name,visibility:e.visibility,inRange:e.inRange,id:e.id}}var f=this.map.layers.slice();this.ascending||f.reverse();for(var d=0,c=f.length;d<c;d++){var e=f[d],g=e.isBaseLayer;if(e.displayInLayerSwitcher){g?b=!0:a=!0;var h=g?e==this.map.baseLayer:e.getVisibility(),i=document.createElement("input"),j=OpenLayers.Util.createUniqueID(this.id+"_input_");i.id=j,i.name=g?this.id+"_baseLayers":e.name,i.type=g?"radio":"checkbox",i.value=e.name,i.checked=h,i.defaultChecked=h,i.className="olButton",i._layer=e.id,i._layerSwitcher=this.id,g||e.inRange||(i.disabled=!0);var k=document.createElement("label");k.for=i.id,OpenLayers.Element.addClass(k,"labelSpan olButton"),k._layer=e.id,k._layerSwitcher=this.id,g||e.inRange||(k.style.color="gray"),k.innerHTML=e.name,k.style.verticalAlign=g?"bottom":"baseline";var l=document.createElement("br");(g?this.baseLayers:this.dataLayers).push({layer:e,inputElem:i,labelSpan:k});var m=g?this.baseLayersDiv:this.dataLayersDiv;m.appendChild(i),m.appendChild(k),m.appendChild(l)}}return this.dataLbl.style.display=a?"":"none",this.baseLbl.style.display=b?"":"none",this.div},updateMap:function(){for(var a=0,b=this.baseLayers.length;a<b;a++){var c=this.baseLayers[a];c.inputElem.checked&&this.map.setBaseLayer(c.layer,!1)}for(var a=0,b=this.dataLayers.length;a<b;a++){var c=this.dataLayers[a];c.layer.setVisibility(c.inputElem.checked)}},maximizeControl:function(a){this.div.style.width="",this.div.style.height="",this.showControls(!1),null!=a&&OpenLayers.Event.stop(a)},minimizeControl:function(a){this.div.style.width="0px",this.div.style.height="0px",this.showControls(!0),null!=a&&OpenLayers.Event.stop(a)},showControls:function(a){this.maximizeDiv.style.display=a?"":"none",this.minimizeDiv.style.display=a?"none":"",this.layersDiv.style.display=a?"none":""},loadContents:function(){this.layersDiv=document.createElement("div"),this.layersDiv.id=this.id+"_layersDiv",OpenLayers.Element.addClass(this.layersDiv,"layersDiv"),this.baseLbl=document.createElement("div"),this.baseLbl.innerHTML=OpenLayers.i18n("Base Layer"),OpenLayers.Element.addClass(this.baseLbl,"baseLbl"),this.baseLayersDiv=document.createElement("div"),OpenLayers.Element.addClass(this.baseLayersDiv,"baseLayersDiv"),this.dataLbl=document.createElement("div"),this.dataLbl.innerHTML=OpenLayers.i18n("Overlays"),OpenLayers.Element.addClass(this.dataLbl,"dataLbl"),this.dataLayersDiv=document.createElement("div"),OpenLayers.Element.addClass(this.dataLayersDiv,"dataLayersDiv"),this.ascending?(this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv),this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv)):(this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv),this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv)),this.div.appendChild(this.layersDiv);var a=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MaximizeDiv",null,null,a,"absolute"),OpenLayers.Element.addClass(this.maximizeDiv,"maximizeDiv olButton"),this.maximizeDiv.style.display="none",this.div.appendChild(this.maximizeDiv);var a=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MinimizeDiv",null,null,a,"absolute"),OpenLayers.Element.addClass(this.minimizeDiv,"minimizeDiv olButton"),this.minimizeDiv.style.display="none",this.div.appendChild(this.minimizeDiv)},CLASS_NAME:"OpenLayers.Control.LayerSwitcher"}),OpenLayers.Tile.Image.IFrame={useIFrame:null,blankImageUrl:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7",draw:function(){if(OpenLayers.Tile.Image.prototype.shouldDraw.call(this)){var a=this.layer.getURL(this.bounds),b=this.useIFrame;this.useIFrame=null!==this.maxGetUrlLength&&!this.layer.async&&a.length>this.maxGetUrlLength;var c=b&&!this.useIFrame,d=!b&&this.useIFrame;(c||d)&&(this.imgDiv&&this.imgDiv.parentNode===this.frame&&this.frame.removeChild(this.imgDiv),this.imgDiv=null,c&&this.frame.removeChild(this.frame.firstChild))}return OpenLayers.Tile.Image.prototype.draw.apply(this,arguments)},getImage:function(){if(!0===this.useIFrame){if(!this.frame.childNodes.length){var a=document.createElement("div"),b=a.style;b.position="absolute",b.width="100%",b.height="100%",b.zIndex=1,b.backgroundImage="url("+this.blankImageUrl+")",this.frame.appendChild(a)}var c,d=this.id+"_iFrame";return parseFloat(navigator.appVersion.split("MSIE")[1])<9?(c=document.createElement('<iframe name="'+d+'">'),c.style.backgroundColor="#FFFFFF",c.style.filter="chroma(color=#FFFFFF)"):(c=document.createElement("iframe"),c.style.backgroundColor="transparent",c.name=d),c.scrolling="no",c.marginWidth="0px",c.marginHeight="0px",c.frameBorder="0",c.style.position="absolute",c.style.width="100%",c.style.height="100%",this.layer.opacity<1&&OpenLayers.Util.modifyDOMElement(c,null,null,null,null,null,null,this.layer.opacity),this.frame.appendChild(c),this.imgDiv=c,c}return OpenLayers.Tile.Image.prototype.getImage.apply(this,arguments)},createRequestForm:function(){var a=document.createElement("form");a.method="POST";var b=this.layer.params._OLSALT;b=(b?b+"_":"")+this.bounds.toBBOX(),a.action=OpenLayers.Util.urlAppend(this.layer.url,b),a.target=this.id+"_iFrame";var c,d=(this.layer.getImageSize(),OpenLayers.Util.getParameters(this.url));for(var e in d)c=document.createElement("input"),c.type="hidden",c.name=e,c.value=d[e],a.appendChild(c);return a},setImgSrc:function(a){if(!0===this.useIFrame)if(a){var b=this.createRequestForm();this.frame.appendChild(b),b.submit(),this.frame.removeChild(b)}else this.imgDiv.parentNode===this.frame&&(this.frame.removeChild(this.imgDiv),this.imgDiv=null);else OpenLayers.Tile.Image.prototype.setImgSrc.apply(this,arguments)},onImageLoad:function(){OpenLayers.Tile.Image.prototype.onImageLoad.apply(this,arguments),!0===this.useIFrame&&(this.imgDiv.style.opacity=1,this.frame.style.opacity=this.layer.opacity)},createBackBuffer:function(){var a;return!1===this.useIFrame&&(a=OpenLayers.Tile.Image.prototype.createBackBuffer.call(this)),a}},OpenLayers.Format.Atom=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{atom:"http://www.w3.org/2005/Atom",georss:"http://www.georss.org/georss"},feedTitle:"untitled",defaultEntryTitle:"untitled",gmlParser:null,xy:!1,read:function(a){return"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),this.parseFeatures(a)},write:function(a){var b;if(OpenLayers.Util.isArray(a)){b=this.createElementNSPlus("atom:feed"),b.appendChild(this.createElementNSPlus("atom:title",{
value:this.feedTitle}));for(var c=0,d=a.length;c<d;c++)b.appendChild(this.buildEntryNode(a[c]))}else b=this.buildEntryNode(a);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},buildContentNode:function(a){var b=this.createElementNSPlus("atom:content",{attributes:{type:a.type||null}});if(a.src)b.setAttribute("src",a.src);else if("text"==a.type||null==a.type)b.appendChild(this.createTextNode(a.value));else if("html"==a.type){if("string"!=typeof a.value)throw"HTML content must be in form of an escaped string";b.appendChild(this.createTextNode(a.value))}else"xhtml"==a.type?b.appendChild(a.value):"xhtml"==a.type||a.type.match(/(\+|\/)xml$/)?b.appendChild(a.value):b.appendChild(this.createTextNode(a.value));return b},buildEntryNode:function(a){var b=a.attributes,c=b.atom||{},d=this.createElementNSPlus("atom:entry");if(c.authors)for(var e=OpenLayers.Util.isArray(c.authors)?c.authors:[c.authors],f=0,g=e.length;f<g;f++)d.appendChild(this.buildPersonConstructNode("author",e[f]));if(c.categories)for(var h,i=OpenLayers.Util.isArray(c.categories)?c.categories:[c.categories],f=0,g=i.length;f<g;f++)h=i[f],d.appendChild(this.createElementNSPlus("atom:category",{attributes:{term:h.term,scheme:h.scheme||null,label:h.label||null}}));if(c.content&&d.appendChild(this.buildContentNode(c.content)),c.contributors)for(var j=OpenLayers.Util.isArray(c.contributors)?c.contributors:[c.contributors],f=0,g=j.length;f<g;f++)d.appendChild(this.buildPersonConstructNode("contributor",j[f]));if(a.fid&&d.appendChild(this.createElementNSPlus("atom:id",{value:a.fid})),c.links)for(var k,l=OpenLayers.Util.isArray(c.links)?c.links:[c.links],f=0,g=l.length;f<g;f++)k=l[f],d.appendChild(this.createElementNSPlus("atom:link",{attributes:{href:k.href,rel:k.rel||null,type:k.type||null,hreflang:k.hreflang||null,title:k.title||null,length:k.length||null}}));if(c.published&&d.appendChild(this.createElementNSPlus("atom:published",{value:c.published})),c.rights&&d.appendChild(this.createElementNSPlus("atom:rights",{value:c.rights})),(c.summary||b.description)&&d.appendChild(this.createElementNSPlus("atom:summary",{value:c.summary||b.description})),d.appendChild(this.createElementNSPlus("atom:title",{value:c.title||b.title||this.defaultEntryTitle})),c.updated&&d.appendChild(this.createElementNSPlus("atom:updated",{value:c.updated})),a.geometry){var m=this.createElementNSPlus("georss:where");m.appendChild(this.buildGeometryNode(a.geometry)),d.appendChild(m)}return d},initGmlParser:function(){this.gmlParser=new OpenLayers.Format.GML.v3({xy:this.xy,featureNS:"http://example.com#feature",internalProjection:this.internalProjection,externalProjection:this.externalProjection})},buildGeometryNode:function(a){return this.gmlParser||this.initGmlParser(),this.gmlParser.writeNode("feature:_geometry",a).firstChild},buildPersonConstructNode:function(a,b){var c=["uri","email"],d=this.createElementNSPlus("atom:"+a);d.appendChild(this.createElementNSPlus("atom:name",{value:b.name}));for(var e=0,f=c.length;e<f;e++)b[c[e]]&&d.appendChild(this.createElementNSPlus("atom:"+c[e],{value:b[c[e]]}));return d},getFirstChildValue:function(a,b,c,d){var e=this.getElementsByTagNameNS(a,b,c);return e&&e.length>0?this.getChildValue(e[0],d):d},parseFeature:function(a){var b={},c=null,d=null,e=null,f=this.namespaces.atom;this.parsePersonConstructs(a,"author",b),d=this.getElementsByTagNameNS(a,f,"category"),d.length>0&&(b.categories=[]);for(var g=0,h=d.length;g<h;g++)c={},c.term=d[g].getAttribute("term"),e=d[g].getAttribute("scheme"),e&&(c.scheme=e),e=d[g].getAttribute("label"),e&&(c.label=e),b.categories.push(c);d=this.getElementsByTagNameNS(a,f,"content"),d.length>0&&(c={},e=d[0].getAttribute("type"),e&&(c.type=e),e=d[0].getAttribute("src"),e?c.src=e:("text"==c.type||"html"==c.type||null==c.type?c.value=this.getFirstChildValue(a,f,"content",null):"xhtml"==c.type||c.type.match(/(\+|\/)xml$/)?c.value=this.getChildEl(d[0]):c.value=this.getFirstChildValue(a,f,"content",null),b.content=c)),this.parsePersonConstructs(a,"contributor",b),b.id=this.getFirstChildValue(a,f,"id",null),d=this.getElementsByTagNameNS(a,f,"link"),d.length>0&&(b.links=new Array(d.length));for(var i=["rel","type","hreflang","title","length"],g=0,h=d.length;g<h;g++){c={},c.href=d[g].getAttribute("href");for(var j=0,k=i.length;j<k;j++)(e=d[g].getAttribute(i[j]))&&(c[i[j]]=e);b.links[g]=c}c=this.getFirstChildValue(a,f,"published",null),c&&(b.published=c),c=this.getFirstChildValue(a,f,"rights",null),c&&(b.rights=c),c=this.getFirstChildValue(a,f,"summary",null),c&&(b.summary=c),b.title=this.getFirstChildValue(a,f,"title",null),b.updated=this.getFirstChildValue(a,f,"updated",null);var l={title:b.title,description:b.summary,atom:b},m=this.parseLocations(a)[0],n=new OpenLayers.Feature.Vector(m,l);return n.fid=b.id,n},parseFeatures:function(a){var b=[],c=this.getElementsByTagNameNS(a,this.namespaces.atom,"entry");0==c.length&&(c=[a]);for(var d=0,e=c.length;d<e;d++)b.push(this.parseFeature(c[d]));return b},parseLocations:function(a){var b=this.namespaces.georss,c={components:[]},d=this.getElementsByTagNameNS(a,b,"where");if(d&&d.length>0){this.gmlParser||this.initGmlParser();for(var e=0,f=d.length;e<f;e++)this.gmlParser.readChildNodes(d[e],c)}var g=c.components,h=this.getElementsByTagNameNS(a,b,"point");if(h&&h.length>0)for(var e=0,f=h.length;e<f;e++){var i=OpenLayers.String.trim(h[e].firstChild.nodeValue).split(/\s+/);2!=i.length&&(i=OpenLayers.String.trim(h[e].firstChild.nodeValue).split(/\s*,\s*/)),g.push(new OpenLayers.Geometry.Point(i[1],i[0]))}var j=this.getElementsByTagNameNS(a,b,"line");if(j&&j.length>0)for(var k,l,m,e=0,f=j.length;e<f;e++){k=OpenLayers.String.trim(j[e].firstChild.nodeValue).split(/\s+/),m=[];for(var n=0,o=k.length;n<o;n+=2)l=new OpenLayers.Geometry.Point(k[n+1],k[n]),m.push(l);g.push(new OpenLayers.Geometry.LineString(m))}var p=this.getElementsByTagNameNS(a,b,"polygon");if(p&&p.length>0)for(var k,l,m,e=0,f=p.length;e<f;e++){k=OpenLayers.String.trim(p[e].firstChild.nodeValue).split(/\s+/),m=[];for(var n=0,o=k.length;n<o;n+=2)l=new OpenLayers.Geometry.Point(k[n+1],k[n]),m.push(l);g.push(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(m)]))}if(this.internalProjection&&this.externalProjection)for(var e=0,f=g.length;e<f;e++)g[e]&&g[e].transform(this.externalProjection,this.internalProjection);return g},parsePersonConstructs:function(a,b,c){for(var d=[],e=this.namespaces.atom,f=this.getElementsByTagNameNS(a,e,b),g=["uri","email"],h=0,i=f.length;h<i;h++){var j={};j.name=this.getFirstChildValue(f[h],e,"name",null);for(var k=0,l=g.length;k<l;k++){var m=this.getFirstChildValue(f[h],e,g[k],null);m&&(j[g[k]]=m)}d.push(j)}d.length>0&&(c[b+"s"]=d)},CLASS_NAME:"OpenLayers.Format.Atom"}),OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,slideFactor:75,observeElement:null,draw:function(){var a=this.observeElement||document;this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress},{observeElement:a})},defaultKeyPress:function(a){var b,c=!0,d=OpenLayers.Event.element(a);if(!d||"INPUT"!=d.tagName&&"TEXTAREA"!=d.tagName&&"SELECT"!=d.tagName){switch(a.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:b=this.map.getSize(),this.map.pan(0,-.75*b.h);break;case 34:b=this.map.getSize(),this.map.pan(0,.75*b.h);break;case 35:b=this.map.getSize(),this.map.pan(.75*b.w,0);break;case 36:b=this.map.getSize(),this.map.pan(-.75*b.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break;default:c=!1}c&&OpenLayers.Event.stop(a)}},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"});var hljs=new function(){function a(a){return a.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;")}function b(a){return a.nodeName.toLowerCase()}function c(a,b){var c=a&&a.exec(b);return c&&0==c.index}function d(a){var b=(a.className+" "+(a.parentNode?a.parentNode.className:"")).split(/\s+/);return b=b.map(function(a){return a.replace(/^lang(uage)?-/,"")}),b.filter(function(a){return s(a)||/no(-?)highlight/.test(a)})[0]}function e(a,b){var c={};for(var d in a)c[d]=a[d];if(b)for(var d in b)c[d]=b[d];return c}function f(a){var c=[];return function a(d,e){for(var f=d.firstChild;f;f=f.nextSibling)3==f.nodeType?e+=f.nodeValue.length:1==f.nodeType&&(c.push({event:"start",offset:e,node:f}),e=a(f,e),b(f).match(/br|hr|img|input/)||c.push({event:"stop",offset:e,node:f}));return e}(a,0),c}function g(c,d,e){function f(){return c.length&&d.length?c[0].offset!=d[0].offset?c[0].offset<d[0].offset?c:d:"start"==d[0].event?c:d:c.length?c:d}function g(c){function d(b){return" "+b.nodeName+'="'+a(b.value)+'"'}k+="<"+b(c)+Array.prototype.map.call(c.attributes,d).join("")+">"}function h(a){k+="</"+b(a)+">"}function i(a){("start"==a.event?g:h)(a.node)}for(var j=0,k="",l=[];c.length||d.length;){var m=f();if(k+=a(e.substr(j,m[0].offset-j)),j=m[0].offset,m==c){l.reverse().forEach(h);do{i(m.splice(0,1)[0]),m=f()}while(m==c&&m.length&&m[0].offset==j);l.reverse().forEach(g)}else"start"==m[0].event?l.push(m[0].node):l.pop(),i(m.splice(0,1)[0])}return k+a(e.substr(j))}function h(a){function b(a){return a&&a.source||a}function c(c,d){return RegExp(b(c),"m"+(a.cI?"i":"")+(d?"g":""))}function d(f,g){if(!f.compiled){if(f.compiled=!0,f.k=f.k||f.bK,f.k){var h={},i=function(b,c){a.cI&&(c=c.toLowerCase()),c.split(" ").forEach(function(a){var c=a.split("|");h[c[0]]=[b,c[1]?Number(c[1]):1]})};"string"==typeof f.k?i("keyword",f.k):Object.keys(f.k).forEach(function(a){i(a,f.k[a])}),f.k=h}f.lR=c(f.l||/\b[A-Za-z0-9_]+\b/,!0),g&&(f.bK&&(f.b="\\b("+f.bK.split(" ").join("|")+")\\b"),f.b||(f.b=/\B|\b/),f.bR=c(f.b),f.e||f.eW||(f.e=/\B|\b/),f.e&&(f.eR=c(f.e)),f.tE=b(f.e)||"",f.eW&&g.tE&&(f.tE+=(f.e?"|":"")+g.tE)),f.i&&(f.iR=c(f.i)),void 0===f.r&&(f.r=1),f.c||(f.c=[]);var j=[];f.c.forEach(function(a){a.v?a.v.forEach(function(b){j.push(e(a,b))}):j.push("self"==a?f:a)}),f.c=j,f.c.forEach(function(a){d(a,f)}),f.starts&&d(f.starts,g);var k=f.c.map(function(a){return a.bK?"\\.?("+a.b+")\\.?":a.b}).concat([f.tE,f.i]).map(b).filter(Boolean);f.t=k.length?c(k.join("|"),!0):{exec:function(a){return null}}}}d(a)}function i(b,d,e,f){function g(a,b){for(var d=0;d<b.c.length;d++)if(c(b.c[d].bR,a))return b.c[d]}function k(a,b){return c(a.eR,b)?a:a.eW?k(a.parent,b):void 0}function l(a,b){return!e&&c(b.iR,a)}function m(a,b){var c=w.cI?b[0].toLowerCase():b[0];return a.k.hasOwnProperty(c)&&a.k[c]}function n(a,b,c,d){var e=d?"":t.classPrefix,f='<span class="'+e,g=c?"":"</span>";return(f+=a+'">')+b+g}function o(){if(!x.k)return a(B);var b="",c=0;x.lR.lastIndex=0;for(var d=x.lR.exec(B);d;){b+=a(B.substr(c,d.index-c));var e=m(x,d);e?(C+=e[1],b+=n(e[0],a(d[0]))):b+=a(d[0]),c=x.lR.lastIndex,d=x.lR.exec(B)}return b+a(B.substr(c))}function p(){if(x.sL&&!u[x.sL])return a(B);var b=x.sL?i(x.sL,B,!0,y[x.sL]):j(B);return x.r>0&&(C+=b.r),"continuous"==x.subLanguageMode&&(y[x.sL]=b.top),n(b.language,b.value,!1,!0)}function q(){return void 0!==x.sL?p():o()}function r(b,c){var d=b.cN?n(b.cN,"",!0):"";b.rB?(z+=d,B=""):b.eB?(z+=a(c)+d,B=""):(z+=d,B=c),x=Object.create(b,{parent:{value:x}})}function v(b,c){if(B+=b,void 0===c)return z+=q(),0;var d=g(c,x);if(d)return z+=q(),r(d,c),d.rB?0:c.length;var e=k(x,c);if(e){var f=x;f.rE||f.eE||(B+=c),z+=q();do{x.cN&&(z+="</span>"),C+=x.r,x=x.parent}while(x!=e.parent);return f.eE&&(z+=a(c)),B="",e.starts&&r(e.starts,""),f.rE?0:c.length}if(l(c,x))throw new Error('Illegal lexeme "'+c+'" for mode "'+(x.cN||"<unnamed>")+'"');return B+=c,c.length||1}var w=s(b);if(!w)throw new Error('Unknown language: "'+b+'"');h(w);for(var x=f||w,y={},z="",A=x;A!=w;A=A.parent)A.cN&&(z=n(A.cN,"",!0)+z);var B="",C=0;try{for(var D,E,F=0;;){if(x.t.lastIndex=F,!(D=x.t.exec(d)))break;E=v(d.substr(F,D.index-F),D[0]),F=D.index+E}v(d.substr(F));for(var A=x;A.parent;A=A.parent)A.cN&&(z+="</span>");return{r:C,value:z,language:b,top:x}}catch(b){if(-1!=b.message.indexOf("Illegal"))return{r:0,value:a(d)};throw b}}function j(b,c){c=c||t.languages||Object.keys(u);var d={r:0,value:a(b)},e=d;return c.forEach(function(a){if(s(a)){var c=i(a,b,!1);c.language=a,c.r>e.r&&(e=c),c.r>d.r&&(e=d,d=c)}}),e.language&&(d.second_best=e),d}function k(a){return t.tabReplace&&(a=a.replace(/^((<[^>]+>|\t)+)/gm,function(a,b,c,d){return b.replace(/\t/g,t.tabReplace)})),t.useBR&&(a=a.replace(/\n/g,"<br>")),a}function l(a,b,c){var d=b?v[b]:c,e=[a.trim()];return a.match(/(\s|^)hljs(\s|$)/)||e.push("hljs"),d&&e.push(d),e.join(" ").trim()}function m(a){var b=d(a);if(!/no(-?)highlight/.test(b)){var c;t.useBR?(c=document.createElementNS("http://www.w3.org/1999/xhtml","div"),c.innerHTML=a.innerHTML.replace(/\n/g,"").replace(/<br[ \/]*>/g,"\n")):c=a;var e=c.textContent,h=b?i(b,e,!0):j(e),m=f(c);if(m.length){var n=document.createElementNS("http://www.w3.org/1999/xhtml","div");n.innerHTML=h.value,h.value=g(m,f(n),e)}h.value=k(h.value),a.innerHTML=h.value,a.className=l(a.className,b,h.language),a.result={language:h.language,re:h.r},h.second_best&&(a.second_best={language:h.second_best.language,re:h.second_best.r})}}function n(a){t=e(t,a)}function o(){if(!o.called){o.called=!0;var a=document.querySelectorAll("pre code");Array.prototype.forEach.call(a,m)}}function p(){addEventListener("DOMContentLoaded",o,!1),addEventListener("load",o,!1)}function q(a,b){var c=u[a]=b(this);c.aliases&&c.aliases.forEach(function(b){v[b]=a})}function r(){return Object.keys(u)}function s(a){return u[a]||u[v[a]]}var t={classPrefix:"hljs-",tabReplace:null,useBR:!1,languages:void 0},u={},v={};this.highlight=i,this.highlightAuto=j,this.fixMarkup=k,this.highlightBlock=m,this.configure=n,this.initHighlighting=o,this.initHighlightingOnLoad=p,this.registerLanguage=q,this.listLanguages=r,this.getLanguage=s,this.inherit=e,this.IR="[a-zA-Z][a-zA-Z0-9_]*",this.UIR="[a-zA-Z_][a-zA-Z0-9_]*",this.NR="\\b\\d+(\\.\\d+)?",this.CNR="(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",this.BNR="\\b(0b[01]+)",this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|<<|<<=|<=|<|===|==|=|>>>=|>>=|>=|>>>|>>|>|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",this.BE={b:"\\\\[\\s\\S]",r:0},this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE]},this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE]},this.PWM={b:/\b(a|an|the|are|I|I'm|isn't|don't|doesn't|won't|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such)\b/},this.CLCM={cN:"comment",b:"//",e:"$",c:[this.PWM]},this.CBCM={cN:"comment",b:"/\\*",e:"\\*/",c:[this.PWM]},this.HCM={cN:"comment",b:"#",e:"$",c:[this.PWM]},this.NM={cN:"number",b:this.NR,r:0},this.CNM={cN:"number",b:this.CNR,r:0},this.BNM={cN:"number",b:this.BNR,r:0},this.CSSNM={cN:"number",b:this.NR+"(%|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?",r:0},this.RM={cN:"regexp",b:/\//,e:/\/[gimuy]*/,i:/\n/,c:[this.BE,{b:/\[/,e:/\]/,r:0,c:[this.BE]}]},this.TM={cN:"title",b:this.IR,r:0},this.UTM={cN:"title",b:this.UIR,r:0}};hljs.registerLanguage("json",function(a){var b={literal:"true false null"},c=[a.QSM,a.CNM],d={cN:"value",e:",",eW:!0,eE:!0,c:c,k:b},e={b:"{",e:"}",c:[{cN:"attribute",b:'\\s*"',e:'"\\s*:\\s*',eB:!0,eE:!0,c:[a.BE],i:"\\n",starts:d}],i:"\\S"},f={b:"\\[",e:"\\]",c:[a.inherit(d,{cN:null})],i:"\\S"};return c.splice(c.length,0,e,f),{c:c,k:b,i:"\\S"}}),hljs.registerLanguage("xml",function(a){var b={b:/<\?(php)?(?!\w)/,e:/\?>/,sL:"php",subLanguageMode:"continuous"},c={eW:!0,i:/</,r:0,c:[b,{cN:"attribute",b:"[A-Za-z0-9\\._:-]+",r:0},{b:"=",r:0,c:[{cN:"value",c:[b],v:[{b:/"/,e:/"/},{b:/'/,e:/'/},{b:/[^\s\/>]+/}]}]}]};return{aliases:["html","xhtml","rss","atom","xsl","plist"],cI:!0,c:[{cN:"doctype",b:"<!DOCTYPE",e:">",r:10,c:[{b:"\\[",e:"\\]"}]},{cN:"comment",b:"\x3c!--",e:"--\x3e",r:10},{cN:"cdata",b:"<\\!\\[CDATA\\[",e:"\\]\\]>",r:10},{cN:"tag",b:"<style(?=\\s|>|$)",e:">",k:{title:"style"},c:[c],starts:{e:"</style>",rE:!0,sL:"css"}},{cN:"tag",b:"<script(?=\\s|>|$)",e:">",k:{title:"script"},c:[c],starts:{e:"<\/script>",rE:!0,sL:"javascript"}},b,{cN:"pi",b:/<\?\w+/,e:/\?>/,r:10},{cN:"tag",b:"</?",e:"/?>",c:[{cN:"title",b:/[^ \/><\n\t]+/,r:0},c]}]}}),Ext.define("PTS.util.DataTypes",{singleton:!0,requires:["Ext.data.Types","Ext.data.SortTypes"]},function(){var a=Ext.data.SortTypes;Ext.JSON.encodeDate=function(a){return Ext.Date.format(a,'"Y-m-d"')},Ext.data.Types.MYDATE={convert:function(a){return a?Ext.isDate(a)?a:Ext.Date.parse(a,"Y-m-d"):null},sortType:a.asDate,type:"mydate"},Ext.data.Types.MYDATESTAMP={convert:function(a){return a?Ext.isDate(a)?a:Ext.Date.parse(a,"Y-m-d h:i:s"):null},sortType:a.asDate,type:"mydatestamp"},Ext.data.Types.MYBOOLEAN={convert:function(a){return!this.useNull||void 0!==a&&null!==a&&""!==a?"false"!==a&&a?1:0:null},sortType:a.none,type:"myboolean"},Ext.data.Types.MYSTRING={convert:function(a){return void 0===a||null===a||""===a?null:a},sortType:function(a){return void 0===a||null===a||""===a?null:String(a).toUpperCase()},type:"mystring"}}),Ext.define("PTS.model.Base",{extend:"Ext.data.Model",requires:["PTS.util.DataTypes"]}),Ext.define("PTS.model.State",{extend:"PTS.model.Base",fields:[{name:"stateid",type:"int"},{name:"unittype",type:"mystring",useNull:!0},{name:"statenumeric",type:"mystring",useNull:!0},{name:"statealpha",type:"mystring",useNull:!0},{name:"statename",type:"mystring",useNull:!0},{name:"countryalpha",type:"mystring",useNull:!0},{name:"countryname",type:"mystring",useNull:!0},{name:"featurename",type:"mystring",useNull:!0}],idProperty:"stateid",proxy:{type:"rest",url:PTS.baseURL+"/statelist",reader:{type:"json",root:"data"},limitParam:void 0}}),Ext.define("PTS.store.States",{extend:"Ext.data.Store",model:"PTS.model.State",autoLoad:!0}),Ext.define("PTS.model.Country",{extend:"PTS.model.Base",fields:[{name:"countryid",mapping:"countryiso",type:"mystring",useNull:!0},{name:"iso3",type:"mystring",useNull:!0},{name:"isonumeric",type:"mystring",useNull:!0},{name:"fips",type:"mystring",useNull:!0},{name:"country",type:"mystring",useNull:!0},{name:"currencycode",type:"mystring",useNull:!0},{name:"currencyname",type:"mystring",useNull:!0},{name:"phone",type:"mystring",useNull:!0},{name:"postalcodeformat",type:"mystring",useNull:!0},{name:"postalcoderegex",type:"mystring",useNull:!0}],idProperty:"countryid",proxy:{type:"rest",url:PTS.baseURL+"/country",reader:{type:"json",root:"data"},limitParam:void 0}}),Ext.define("PTS.store.Countries",{extend:"Ext.data.Store",model:"PTS.model.Country",sorters:[{property:"country",direction:"ASC"}],autoLoad:!0}),Ext.define("PTS.model.Position",{extend:"PTS.model.Base",fields:[{name:"positionid",type:"int"},{name:"title",type:"mystring",useNull:!0},{name:"code",type:"mystring",useNull:!0}],idProperty:"positionid",proxy:{type:"rest",url:PTS.baseURL+"/position",reader:{type:"json",root:"data"},limitParam:void 0}}),Ext.define("PTS.store.Positions",{extend:"Ext.data.Store",model:"PTS.model.Position",autoLoad:!0,sorters:["title"],proxy:{type:"rest",url:PTS.baseURL+"/person",api:{read:PTS.baseURL+"/personpositionlist"},reader:{type:"json",root:"data"},limitParam:void 0}}),Ext.define("PTS.util.Format",{singleton:!0,netFunds:function(a){var b=Ext.util.Format.usMoney(a);return a>0?'<span style="color:green;">'+b+"</span>":a<0?'<span style="color:red;">'+b+"</span>":a},link:function(a){return a?'<a href="'+a+'" target="_blank">'+a+"</a>":a},docStatus:function(a){switch(a){case"Completed":return'<span style="color:green;">'+a+"</span>";case"Not Started":return'<span style="color:red;">'+a+"</span>";case"In Progress":return'<span style="color:blue;">'+a+"</span>";case null:return'<span style="color:gray;">N/A</span>';default:return a}},projectCode:function(a,b){return a+(b<10?"-0":"-")+b}}),Ext.define("PTS.model.Project",{extend:"PTS.model.Base",requires:["PTS.util.Format"],fields:[{name:"projectid",type:"int",persist:!1},{name:"orgid",type:"int",useNull:!0,convert:function(a,b){return a||PTS.user.get("groupid")}},{name:"parentprojectid",type:"int",useNull:!0},{name:"sciencebaseid",type:"mystring",useNull:!0},{name:"title",type:"mystring",useNull:!0},{name:"shorttitle",type:"mystring",useNull:!0},{name:"fiscalyear",type:"int",useNull:!0},{name:"number",type:"int",useNull:!0},{name:"startdate",type:"mydate"},{name:"enddate",type:"mydate"},{name:"description",type:"mystring",useNull:!0},{name:"abstract",type:"mystring",useNull:!0},{name:"supplemental",type:"mystring",useNull:!0},{name:"uuid",persist:!1},{name:"exportmetadata",type:"myboolean"},{name:"projectcode",persist:!1,convert:function(a,b){return PTS.orgcode+PTS.util.Format.projectCode(b.data.fiscalyear,b.data.number)}}],idProperty:"projectid",proxy:{type:"rest",url:PTS.baseURL+"/project",reader:{type:"json",root:"data"}},getProjectCode:function(){return this.get("fiscalyear")+"-"+this.get("number")}}),Ext.define("PTS.store.ProjectIDs",{extend:"Ext.data.Store",model:"PTS.model.Project",fields:[{name:"projectid",type:"int"},{name:"projectcode",type:"string"},{name:"title"},{name:"shorttitle"}],proxy:{type:"rest",url:PTS.baseURL+"/projectlist",reader:{type:"json",root:"data"},limitParam:void 0},autoLoad:!1,sorters:[{property:"fiscalyear",direction:"DESC"},{property:"number",direction:"DESC"}]}),Ext.define("PTS.model.Product",{extend:"PTS.model.Base",fields:[{name:"productid",type:"int",persist:!1},{name:"orgid",type:"int",useNull:!0,convert:function(a,b){return a||PTS.user.get("groupid")}},{name:"projectid",type:"int",useNull:!0},{name:"productgroupid",type:"int",useNull:!0},{name:"sciencebaseid",type:"mystring",useNull:!0},{name:"deliverabletypeid",type:"int",useNull:!0},{name:"isoprogresstypeid",type:"int",useNull:!0},{name:"maintenancefrequencyid",type:"int",useNull:!0},{name:"title",type:"mystring",useNull:!0},{name:"startdate",type:"mydate"},{name:"enddate",type:"mydate"},{name:"perioddescription",type:"mystring",useNull:!0},{name:"description",type:"mystring",useNull:!0},{name:"abstract",type:"mystring",useNull:!0},{name:"purpose",type:"mystring",useNull:!0},{name:"uuid",persist:!1},{name:"exportmetadata",type:"myboolean"},{name:"projectcode",type:"string",persist:!1,convert:function(a,b){return a||"None"}},{name:"type",type:"string",persist:!1},{name:"uselimitation",type:"mystring",useNull:!0},{name:"isgroup",type:"myboolean",useNull:!0},{name:"productgroup",type:"string",persist:!1,convert:function(a,b){return a||"None"}}],idProperty:"productid",proxy:{type:"rest",url:PTS.baseURL+"/product",api:{read:PTS.baseURL+"/productlist"},reader:{type:"json",root:"data"}}}),Ext.define("PTS.store.ProductGroupIDs",{extend:"Ext.data.Store",model:"PTS.model.Product",fields:[{name:"productid",type:"int"},{name:"projectid",type:"int"},{name:"projectcode",type:"string"},{name:"title"},{name:"isgroup",type:"myboolean"}],proxy:{type:"rest",url:PTS.baseURL+"/productgrouplist",reader:{type:"json",root:"data"},limitParam:void 0},autoLoad:!1,sorters:[{property:"projectcode",direction:"DESC"},{property:"title",direction:"ASC"}]}),Ext.define("PTS.Defaults",{singleton:!0,pageSize:25}),Ext.define("PTS.model.User",{extend:"PTS.model.Base",fields:[{name:"loginid",mapping:"loginid",type:"int",persist:!1},{name:"contactid",mapping:"contactid",type:"int",persist:!1},{name:"groupid",mapping:"groupid",type:"int",persist:!1},{name:"username",type:"mystring",useNull:!0},{name:"firstname",type:"mystring",useNull:!0},{name:"lastname",type:"mystring",useNull:!0},{name:"middlename",type:"mystring",useNull:!0},{name:"suffix",type:"mystring",useNull:!0},{name:"groupname",type:"mystring",useNull:!0},{name:"acronym",type:"mystring",useNull:!0},{name:"groupemail",type:"mystring",useNull:!0},{name:"projecturiformat",type:"mystring",useNull:!0},{name:"config",type:"auto",useNull:!0,convert:function(a,b){if(a){var c=JSON.parse(a);return c.loginid=b.data.loginid,c}return{loginid:b.data.loginid}}}],idProperty:"loginid",proxy:{type:"rest",url:PTS.baseURL+"/userinfo",reader:{type:"json",root:"data"}},getUserName:function(){var a=this.get("firstname");return this.get("lastname")+", "+a}}),Ext.define("PTS.util.VTypes",{singleton:!0,requires:["Ext.form.field.VTypes"]},function(){Ext.apply(Ext.form.field.VTypes,{daterange:function(a,b){var c=b.parseDate(a);if(!b.startDateField||b.dateRangeMax&&null!==c&&c.getTime()===b.dateRangeMax.getTime()){if(b.endDateField&&(!b.dateRangeMin||null===c||c.getTime()!==b.dateRangeMin.getTime())){var d=b.ownerCt.down("datefield[vfield=endDate]")||b.up("form").down("datefield[vfield=endDate]");d.setMinValue(c),d.validate(),b.dateRangeMin=c}}else{var e=b.ownerCt.down("datefield[vfield=beginDate]")||b.up("form").down("datefield[vfield=beginDate]");e.setMaxValue(c),e.validate(),b.dateRangeMax=c}return!0},daterangeText:"From date must be before To date",moddaterange:function(a,b){var c=b.parseDate(a),d=[b.up("form").down("#startDate")];return!b.startDateField||b.dateRangeMax&&null!==c&&c.getTime()===b.dateRangeMax.getTime()?!b.endDateField||b.dateRangeMin&&null!==c&&c.getTime()===b.dateRangeMin.getTime()||(d.push(b.up("form").down("#"+b.endDateField)),Ext.each(d,function(a){a.setMinValue(c),a.validate()}),b.dateRangeMin=c):(d.push(b.up("form").down("#"+b.startDateField)),Ext.each(d,function(a){a.setMaxValue(c),a.validate()}),b.dateRangeMax=c),!0},moddaterangeText:"From date must be before To date"})}),Ext.define("PTS.util.ActivityMonitor",{singleton:!0,ui:null,runner:null,task:null,lastActive:null,ready:!1,verbose:!1,interval:6e4,maxInactive:3e5,init:function(a){a||(a={}),Ext.apply(this,a,{runner:new Ext.util.TaskRunner,ui:Ext.getBody(),task:{run:this.monitorUI,interval:a.interval||this.interval,scope:this}}),this.ready=!0},isReady:function(){return this.ready},isActive:Ext.emptyFn,isInactive:Ext.emptyFn,start:function(){if(!this.isReady())return this.log("Please run ActivityMonitor.init()"),!1;this.ui.on("mousemove",this.captureActivity,this),this.ui.on("keydown",this.captureActivity,this),this.lastActive=new Date,this.log("ActivityMonitor has been started."),this.runner.start(this.task)},stop:function(){if(!this.isReady())return this.log("Please run ActivityMonitor.init()"),!1;this.runner.stop(this.task),this.lastActive=null,this.ui.un("mousemove",this.captureActivity),this.ui.un("keydown",this.captureActivity),this.log("ActivityMonitor has been stopped.")},captureActivity:function(a,b,c){this.lastActive=new Date},monitorUI:function(){var a=new Date,b=a-this.lastActive;b>=this.maxInactive?(this.log("MAXIMUM INACTIVE TIME HAS BEEN REACHED"),this.stop(),this.isInactive()):(this.log("CURRENTLY INACTIVE FOR "+b+" (ms)"),this.isActive())},log:function(a){this.verbose&&window.console.log(a)}}),Ext.define("PTS.util.AssociationJsonWriter",{extend:"Ext.data.writer.Json",alternateClassName:"Ext.data.AssociationJsonWriter",alias:"writer.ajson",getRecordData:function(a){var b,c,d,e,f=!0===a.phantom,g=this.writeAllFields||f,h=this.nameProperty,i=a.fields,j={};if(g)i.each(function(b){b.persist&&(c=b[h]||b.name,j[c]=a.get(b.name))});else{b=a.getChanges();for(e in b)b.hasOwnProperty(e)&&(d=i.get(e),c=d[h]||d.name,j[c]=b[e]);f||(j[a.idProperty]=a.getId())}return a.associations.items.length&&a.associations.each(function(b){var c=a[b.name](),d=c.getProxy(),e=c.getRemovedRecords(),f=[],g=[];c.each(function(a){a.dirty&&f.push(d.getWriter().getRecordData(a))},this),j[b.name]=f,e.length>0&&(void 0===j.destroy&&(j.destroy={}),Ext.each(e,function(a){g.push({id:a.getId()})},this),j.destroy[b.name]=g)},this),j}}),Ext.define("PTS.controller.Main",{extend:"Ext.app.Controller",init:function(){var a,b=this,c=Ext.getBody(),d=function(){Ext.Ajax.isLoading()||(c.unmask(),Ext.Ajax.un("requestcomplete",d,b))};Ext.Ajax.on("requestcomplete",d,b,{buffer:200}),c.mask("Please wait...Fetching User Info"),b.getModel("PTS.model.User").load(PTS.UserId.id,{success:function(d){var e=this.getStore("GroupUsers"),f=d.get("groupid");PTS.user=d,PTS.orgcode=PTS.user.get("acronym"),PTS.userConfig=Ext.create("PTS.model.UserConfig",d.get("config"));var g=PTS.userConfig.get("pageSize");PTS.Defaults.pageSize=g||PTS.Defaults.pageSize,Ext.StoreManager.each(function(a){25===a.pageSize&&(a.pageSize=PTS.Defaults.pageSize)}),e.setProxy({type:"ajax",url:PTS.baseURL+"/contactgroup/"+f+"/person",reader:{type:"json",root:"data"},extraParams:{filter:Ext.encode([{property:"positionid",value:["where not in",[96,85]]}])}}),e.load({callback:function(a,b,c){c&&this.loadRawData([{contactid:0,firstname:"System",lastname:"PTS",groupid:f,inactive:!0}],!0)},scope:e}),c.mask("Please wait...Fetching Data"),b.getStore("ProjectIDs").load(),b.getStore("ProductGroupIDs").load(),Ext.create("PTS.view.Viewport"),PTS.util.ActivityMonitor.init({verbose:!1,interval:9e5,maxInactive:1347e4,isActive:function(){Ext.Ajax.request({url:PTS.baseURL+"/poll"})},isInactive:function(){var a=Ext.create("Ext.window.MessageBox",{buttonText:{ok:"Keep Working"}});a.show({buttons:Ext.MessageBox.OK,closable:!1,fn:function(b){Ext.TaskManager.stop(a.task),PTS.util.ActivityMonitor.start()},msg:"Your session has been idle for too long. Click the button to keep working.",progress:!0,scope:this,title:"Inactivity Warning"}),a.updateProgress(0),a.seconds=0,a.task=Ext.TaskManager.start({run:function(){a.seconds+=1,a.seconds>6?(Ext.TaskManager.stop(a.task),window.location=PTS.baseURL+"/logout"):a.updateProgress(a.seconds/6)},scope:this,interval:2e3})}}),a=new Ext.util.DelayedTask(function(){PTS.util.ActivityMonitor.start()}),a.delay(2e4)},failure:function(a,b){Ext.MessageBox.show({title:"Error",msg:"There was an error. Failed to retrieve user info.",buttons:Ext.MessageBox.OK,icon:Ext.Msg.ERROR})},scope:b})}}),Ext.define("PTS.controller.report.Report",{extend:"Ext.app.Controller",init:function(){this.getController("report.tab.ReportTab").init()}}),Ext.define("PTS.controller.tps.Tps",{extend:"Ext.app.Controller",init:function(){this.getController("tps.tab.TpsTab").init()}}),Ext.define("Ext.ux.window.Notification",{extend:"Ext.window.Window",alias:"widget.uxNotification",cls:"ux-notification-light",autoHide:!0,autoHeight:!0,plain:!1,draggable:!1,shadow:!1,focus:Ext.emptyFn,manager:null,useXAxis:!1,position:"tr",spacing:6,paddingX:30,paddingY:10,slideInAnimation:"easeIn",slideBackAnimation:"bounceOut",slideInDuration:1500,slideBackDuration:1e3,hideDuration:500,autoCloseDelay:7e3,stickOnClick:!0,stickWhileHover:!0,isHiding:!1,readyToHide:!1,xPos:0,yPos:0,statics:{defaultManager:{el:null}},getXposAlignedToManager:function(){var a=this,b=0;if(a.manager&&a.manager.el&&a.manager.el.dom){if(!a.useXAxis)return a.el.getLeft();"br"==a.position||"tr"==a.position||"r"==a.position?(b+=a.manager.el.getAnchorXY("r")[0],b-=a.el.getWidth()+a.paddingX):(b+=a.manager.el.getAnchorXY("l")[0],b+=a.paddingX)}return b},getYposAlignedToManager:function(){var a=this,b=0;if(a.manager&&a.manager.el&&a.manager.el.dom){if(a.useXAxis)return a.el.getTop();"br"==a.position||"bl"==a.position||"b"==a.position?(b+=a.manager.el.getAnchorXY("b")[1],b-=a.el.getHeight()+a.paddingY):(b+=a.manager.el.getAnchorXY("t")[1],b+=a.paddingY)}return b},getXposAlignedToSibling:function(a){var b=this;return b.useXAxis?"tl"==b.position||"bl"==b.position||"l"==b.position?a.xPos+a.el.getWidth()+a.spacing:a.xPos-b.el.getWidth()-b.spacing:b.el.getLeft()},getYposAlignedToSibling:function(a){var b=this;return b.useXAxis?b.el.getTop():"tr"==b.position||"tl"==b.position||"t"==b.position?a.yPos+a.el.getHeight()+a.spacing:a.yPos-b.el.getHeight()-a.spacing},getNotifications:function(a){var b=this;return b.manager.notifications[a]||(b.manager.notifications[a]=[]),b.manager.notifications[a]},beforeShow:function(){var a=this;switch(Ext.isDefined(a.corner)&&(a.position=a.corner),Ext.isDefined(a.slideDownAnimation)&&(a.slideBackAnimation=a.slideDownAnimation),Ext.isDefined(a.autoDestroyDelay)&&(a.autoCloseDelay=a.autoDestroyDelay),Ext.isDefined(a.slideInDelay)&&(a.slideInDuration=a.slideInDelay),
Ext.isDefined(a.slideDownDelay)&&(a.slideBackDuration=a.slideDownDelay),Ext.isDefined(a.fadeDelay)&&(a.hideDuration=a.fadeDelay),a.position=a.position.replace(/c/,""),a.position){case"br":a.paddingFactorX=-1,a.paddingFactorY=-1,a.siblingAlignment="br-br",a.useXAxis?a.managerAlignment="bl-br":a.managerAlignment="tr-br";break;case"bl":a.paddingFactorX=1,a.paddingFactorY=-1,a.siblingAlignment="bl-bl",a.useXAxis?a.managerAlignment="br-bl":a.managerAlignment="tl-bl";break;case"tr":a.paddingFactorX=-1,a.paddingFactorY=1,a.siblingAlignment="tr-tr",a.useXAxis?a.managerAlignment="tl-tr":a.managerAlignment="br-tr";break;case"tl":a.paddingFactorX=1,a.paddingFactorY=1,a.siblingAlignment="tl-tl",a.useXAxis?a.managerAlignment="tr-tl":a.managerAlignment="bl-tl";break;case"b":a.paddingFactorX=0,a.paddingFactorY=-1,a.siblingAlignment="b-b",a.useXAxis=0,a.managerAlignment="t-b";break;case"t":a.paddingFactorX=0,a.paddingFactorY=1,a.siblingAlignment="t-t",a.useXAxis=0,a.managerAlignment="b-t";break;case"l":a.paddingFactorX=1,a.paddingFactorY=0,a.siblingAlignment="l-l",a.useXAxis=1,a.managerAlignment="r-l";break;case"r":a.paddingFactorX=-1,a.paddingFactorY=0,a.siblingAlignment="r-r",a.useXAxis=1,a.managerAlignment="l-r"}"string"==typeof a.manager&&(a.manager=Ext.getCmp(a.manager)),a.manager||(a.manager=a.statics().defaultManager,a.manager.el||(a.manager.el=Ext.getBody())),void 0===a.manager.notifications&&(a.manager.notifications={}),a.stickOnClick&&a.body&&a.body.dom&&Ext.fly(a.body.dom).on("click",function(){a.cancelAutoHide(),a.addCls("notification-fixed")},a),a.el.hover(function(){a.mouseIsOver=!0},function(){a.mouseIsOver=!1},a),a.autoHide&&(a.task=new Ext.util.DelayedTask(a.doAutoHide,a),a.task.delay(a.autoCloseDelay));var b=a.getNotifications(a.managerAlignment);b.length?(a.el.alignTo(b[b.length-1].el,a.siblingAlignment,[0,0]),a.xPos=a.getXposAlignedToSibling(b[b.length-1]),a.yPos=a.getYposAlignedToSibling(b[b.length-1])):(a.el.alignTo(a.manager.el,a.managerAlignment,[a.paddingX*a.paddingFactorX,a.paddingY*a.paddingFactorY]),a.xPos=a.getXposAlignedToManager(),a.yPos=a.getYposAlignedToManager()),Ext.Array.include(b,a),a.stopAnimation(),a.el.animate({to:{x:a.xPos,y:a.yPos,opacity:1},easing:a.slideInAnimation,duration:a.slideInDuration,dynamic:!0})},slideBack:function(){var a=this,b=a.getNotifications(a.managerAlignment),c=Ext.Array.indexOf(b,a);!a.isHiding&&a.el&&a.manager&&a.manager.el&&a.manager.el.dom&&a.manager.el.isVisible()&&(c?(a.xPos=a.getXposAlignedToSibling(b[c-1]),a.yPos=a.getYposAlignedToSibling(b[c-1])):(a.xPos=a.getXposAlignedToManager(),a.yPos=a.getYposAlignedToManager()),a.stopAnimation(),a.el.animate({to:{x:a.xPos,y:a.yPos},easing:a.slideBackAnimation,duration:a.slideBackDuration,dynamic:!0}))},cancelAutoHide:function(){var a=this;a.autoHide&&(a.task.cancel(),a.autoHide=!1)},doAutoHide:function(){var a=this;a.el.hover(function(){},function(){a.hide()},a),a.stickWhileHover&&a.mouseIsOver||a.hide()},hide:function(){var a=this;!a.isHiding&&a.el&&(a.isHiding=!0,a.cancelAutoHide(),a.stopAnimation(),a.el.animate({to:{opacity:0},easing:"easeIn",duration:a.hideDuration,dynamic:!1,listeners:{afteranimate:function(){if(a.manager){var b=a.getNotifications(a.managerAlignment),c=Ext.Array.indexOf(b,a);if(-1!=c)for(Ext.Array.erase(b,c,1);c<b.length;c++)b[c].slideBack()}a.readyToHide=!0,a.hide()}}})),a.readyToHide&&(a.isHiding=!1,a.readyToHide=!1,a.removeCls("notification-fixed"),this.callParent(arguments))}}),Ext.define("PTS.model.Modification",{extend:"PTS.model.Base",fields:[{name:"modificationid",type:"int",persist:!1},{name:"projectid",type:"int",useNull:!0},{name:"modtypeid",type:"int",useNull:!0},{name:"personid",type:"int",useNull:!0},{name:"parentmodificationid",type:"int",useNull:!0},{name:"parentcode",type:"mystring",persist:!1},{name:"startdate",type:"mydate"},{name:"enddate",type:"mydate"},{name:"effectivedate",type:"mydate"},{name:"datecreated",type:"mydate",persist:!1},{name:"modificationcode",type:"mystring",useNull:!0},{name:"title",type:"mystring",useNull:!0},{name:"shorttitle",type:"mystring",useNull:!0},{name:"description",type:"mystring",useNull:!0}],idProperty:"modificationid",proxy:{type:"rest",url:PTS.baseURL+"/modification",reader:{type:"json",root:"data"}}}),Ext.define("PTS.model.Deliverable",{extend:"PTS.model.Base",fields:[{name:"deliverableid",persist:!1,type:"int",useNull:!0},{name:"modificationid",type:"int",useNull:!0},{name:"parentmodificationid",type:"int",useNull:!0},{name:"parentdeliverableid",type:"int",useNull:!0},{name:"deliverabletypeid",type:"int",useNull:!0},{name:"personid",type:"int",useNull:!0},{name:"title",type:"mystring",useNull:!0},{name:"code",type:"mystring",useNull:!0},{name:"description",type:"mystring",useNull:!0},{name:"duedate",type:"mydate"},{name:"receiveddate",type:"mydate"},{name:"startdate",type:"mydate"},{name:"enddate",type:"mydate"},{name:"reminder",type:"boolean",defaultValue:!0,useNull:!0},{name:"staffonly",type:"boolean",defaultValue:!1,useNull:!0},{name:"publish",type:"boolean",defaultValue:!0,useNull:!0},{name:"restricted",type:"boolean",useNull:!0},{name:"accessdescription",type:"mystring",useNull:!0},{name:"id",persist:!1,convert:function(a,b){return b.data.modificationid&&b.data.deliverableid?b.data.modificationid+"/deliverable/"+b.data.deliverableid:null}}],idProperty:"id",proxy:{type:"rest",url:PTS.baseURL+"/modification",api:{read:PTS.baseURL+"/modification",create:PTS.baseURL+"/deliverable"},reader:{type:"json",root:"data"}}}),Ext.define("PTS.model.Funding",{extend:"PTS.model.Base",fields:[{name:"fundingid",type:"int",persist:!1},{name:"modificationid",type:"int",persist:!0,useNull:!0},{name:"fundingtypeid",type:"int",useNull:!0},{name:"projectcontactid",type:"int",useNull:!0},{name:"fundingrecipientid",type:"int",useNull:!0},{name:"amount",type:"number",useNull:!0},{name:"title",type:"mystring",useNull:!0}],idProperty:"fundingid",proxy:{type:"rest",url:PTS.baseURL+"/funding",reader:{type:"json",root:"data"}}}),Ext.define("Extensible.calendar.util.WeekEventRenderer",{requires:["Ext.core.DomHelper"],statics:{getEventRow:function(a,b,c){var d,e,f=Ext.get(a+"-wk-"+b);return f&&(e=f.child(".ext-cal-evt-tbl",!0),(d=e.tBodies[0].childNodes[c+1])||(d=Ext.core.DomHelper.append(e.tBodies[0],"<tr></tr>"))),Ext.get(d)},renderEvent:function(a,b,c,d,e,f,g){var h=Extensible.calendar.data.EventMappings,i=a.data||a.event.data,j=Ext.Date.clone(f),k=Extensible.Date.add(j,{days:e-c,millis:-1}),l=this.getEventRow(g.viewId,b,d),m=Extensible.Date.diffDays(f,i[h.EndDate.name])+1,n=Math.min(m,e-c);i._weekIndex=b,i._renderAsAllDay=i[h.IsAllDay.name]||a.isSpanStart,i.spanLeft=i[h.StartDate.name].getTime()<j.getTime(),i.spanRight=i[h.EndDate.name].getTime()>k.getTime(),i.spanCls=i.spanLeft?i.spanRight?"ext-cal-ev-spanboth":"ext-cal-ev-spanleft":i.spanRight?"ext-cal-ev-spanright":"";var o={tag:"td",cls:"ext-cal-ev",cn:g.tpl.apply(g.templateDataFn(i))};n>1&&(o.colspan=n),Ext.core.DomHelper.append(l,o)},render:function(a){for(var b,c,d,e,f,g,h,i,j,k=this,l=0,m=a.eventGrid,n=Ext.Date.clone(a.viewStart),o="",p=(a.tpl,void 0!=a.maxEventsPerDay?a.maxEventsPerDay:999),q=a.weekCount<1?6:a.weekCount,r=1==a.weekCount?a.dayCount:7;l<q;l++)for(c=0,d=m[l];c<r;c++){if(d&&d[c]){for(e=0,f=0,g=d[c],h=g.length,o=Ext.Date.format(n,"Ymd");e<h;e++)if(g[e]){if(e>=p){f++;continue}i=g[e],i.isSpan&&!i.isSpanStart||k.renderEvent(i,l,c,e,r,n,a)}else{if(e>=p)continue;b=k.getEventRow(a.viewId,l,e),Ext.core.DomHelper.append(b,{tag:"td",cls:"ext-cal-ev",html:"&#160;",id:a.viewId+"-empty-"+h+"-day-"+o})}if(f>0)b=k.getEventRow(a.viewId,l,p),Ext.core.DomHelper.append(b,{tag:"td",cls:"ext-cal-ev-more",id:"ext-cal-ev-more-"+Ext.Date.format(n,"Ymd"),cn:{tag:"a",html:Ext.String.format(a.getMoreText(f),f)}});else if(h<a.evtMaxCount[l]&&(b=k.getEventRow(a.viewId,l,h))){j={tag:"td",cls:"ext-cal-ev",html:"&#160;",id:a.viewId+"-empty-"+(h+1)+"-day-"+o};var s=a.evtMaxCount[l]-h;s>1&&(j.rowspan=s),Ext.core.DomHelper.append(b,j)}}else(b=k.getEventRow(a.viewId,l,0))&&(j={tag:"td",cls:"ext-cal-ev",html:"&#160;",id:a.viewId+"-empty-day-"+o},a.evtMaxCount[l]>1&&(j.rowspan=a.evtMaxCount[l]),Ext.core.DomHelper.append(b,j));n=Extensible.Date.add(n,{days:1})}}}}),Ext.define("PTS.view.controls.ConfigWindow",{extend:"Ext.window.Window",alias:"widget.configwindow",initComponent:function(){var a,b=this,c=PTS.userConfig.get("windowWidth"),d=Ext.Element.getViewportWidth()-20;a=b.width?b.width:c>0?c:900,Ext.applyIf(b,{width:a<d?a:d,maximized:0===c}),b.callParent(arguments)}}),Ext.define("Extensible.calendar.template.BoxLayout",{extend:"Ext.XTemplate",requires:["Ext.Date"],firstWeekDateFormat:"D j",otherWeeksDateFormat:"j",singleDayDateFormat:"l, F j, Y",multiDayFirstDayFormat:"M j, Y",multiDayMonthStartFormat:"M j",constructor:function(a){Ext.apply(this,a);var b=this.showWeekLinks?'<div id="{weekLinkId}" class="ext-cal-week-link">{weekNum}</div>':"";Extensible.calendar.template.BoxLayout.superclass.constructor.call(this,'<tpl for="weeks">','<div id="{[this.id]}-wk-{[xindex-1]}" class="ext-cal-wk-ct" style="top:{[this.getRowTop(xindex, xcount)]}%; height:{[this.getRowHeight(xcount)]}%;">',b,'<table class="ext-cal-bg-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for=".">','<td id="{[this.id]}-day-{date:date("Ymd")}" class="{cellCls}">&#160;</td>',"</tpl>","</tr>","</tbody>","</table>",'<table class="ext-cal-evt-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for=".">','<td id="{[this.id]}-ev-day-{date:date("Ymd")}" class="{titleCls}"><div>{title}</div></td>',"</tpl>","</tr>","</tbody>","</table>","</div>","</tpl>",{getRowTop:function(a,b){return 100/b*(a-1)},getRowHeight:function(a){return 100/a}})},applyTemplate:function(a){Ext.apply(this,a);for(var b=0,c="",d=!0,e=!1,f=!1,g=!1,h=!1,i=!1,j=a.weekendCls,k=a.prevMonthCls,l=a.nextMonthCls,m=a.todayCls,n=[[]],o=Extensible.Date.today(),p=Ext.Date.clone(this.viewStart),q=this.startDate.getMonth();(b<this.weekCount||-1==this.weekCount)&&!(p>this.viewEnd);b++){n[b]=[];for(var r=0;r<this.dayCount;r++){if(e=p.getTime()===o.getTime(),f=d||1==p.getDate(),g=p.getMonth()<q&&-1==this.weekCount,h=p.getMonth()>q&&-1==this.weekCount,i=p.getDay()%6==0,1==p.getDay()&&(n[b].weekNum=this.showWeekNumbers?Ext.Date.format(p,"W"):"&#160;",n[b].weekLinkId="ext-cal-week-"+Ext.Date.format(p,"Ymd")),f)c=e?this.getTodayText():Ext.Date.format(p,1==this.dayCount?this.singleDayDateFormat:d?this.multiDayFirstDayFormat:this.multiDayMonthStartFormat);else{var s=0==b&&!0!==this.showHeader?this.firstWeekDateFormat:this.otherWeeksDateFormat;c=e?this.getTodayText():Ext.Date.format(p,s)}n[b].push({title:c,date:Ext.Date.clone(p),titleCls:"ext-cal-dtitle "+(e?" ext-cal-dtitle-today":"")+(0==b?" ext-cal-dtitle-first":"")+(g?" ext-cal-dtitle-prev":"")+(h?" ext-cal-dtitle-next":""),cellCls:"ext-cal-day "+(e?" "+m:"")+(0==r?" ext-cal-day-first":"")+(g?" "+k:"")+(h?" "+l:"")+(i&&j?" "+j:"")}),p=Extensible.Date.add(p,{days:1}),d=!1}}return Ext.getVersion().isLessThan("4.1")?Extensible.calendar.template.BoxLayout.superclass.applyTemplate.call(this,{weeks:n}):this.applyOut({weeks:n},[]).join("")},getTodayText:function(){var a=Extensible.Date.use24HourTime?"G:i ":"g:ia ",b=!1!==this.showTodayText?this.todayText:"",c=!1!==this.showTime?' <span id="'+this.id+'-clock" class="ext-cal-dtitle-time" aria-live="off">'+Ext.Date.format(new Date,a)+"</span>":"",d=b.length>0||c.length>0?" &#8212; ":"";return 1==this.dayCount?Ext.Date.format(new Date,this.singleDayDateFormat)+d+b+c:(fmt=1==this.weekCount?this.firstWeekDateFormat:this.otherWeeksDateFormat,b.length>0?b+c:Ext.Date.format(new Date,fmt)+c)}},function(){this.createAlias("apply","applyTemplate")}),Ext.define("PTS.data.Calendar",{constructor:function(){return{calendars:[{id:1,title:"Past Due",color:2},{id:2,title:"Due Immediately",color:6},{id:3,title:"Due Soon",color:20},{id:4,title:"Received",color:26},{id:5,title:"Completed",color:33}]}}}),Ext.define("Ext.ux.grid.Printer",{requires:"Ext.XTemplate",statics:{print:function(a){var b=[];Ext.each(a.columns,function(a){a.isGroupHeader?b=b.concat(a.items.items):b.push(a)});var c=[];a.store.data.each(function(d,e){var f={};for(var g in d.data){var h=d.data[g];Ext.each(b,function(b,c){if(b.dataIndex==g){var f={item:"",tdAttr:"",style:""};h=b.renderer?b.renderer.call(a,h,f,d,e,c,a.store,a.view):h}},this),f[g]=h}c.push(f)});var d=[],e=this.printHidden;if(Ext.each(b,function(a){var b=!e&&a.hidden;Ext.isEmpty(a.dataIndex)||b||d.push(a)}),b=d,null===this.stylesheetPath){var f=Ext.Loader.getPath("Ext.ux.grid.Printer");this.stylesheetPath=f.substring(0,f.indexOf("Printer.js"))+"css/print.css"}var g=Ext.create("Ext.XTemplate",this.headerTpl).apply(b),h=Ext.create("Ext.XTemplate",this.bodyTpl).apply(b),i="",j=[];Ext.each(a.plugins,function(a){"rowexpander"==a.ptype&&(i+=a.rowBodyTpl.join(""))}),""!=i&&(j=['<tr class="{[xindex % 2 === 0 ? "even" : "odd"]}"><td colspan="'+b.length+'">',i,"</td></tr>"]);var k=['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">','<html class="'+Ext.baseCSSPrefix+'ux-grid-printer">',"<head>",'<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />','<link href="'+this.stylesheetPath+'" rel="stylesheet" type="text/css" />',"<title>"+a.title+"</title>","</head>",'<body class="'+Ext.baseCSSPrefix+'ux-grid-printer-body">','<div class="'+Ext.baseCSSPrefix+"ux-grid-printer-noprint "+Ext.baseCSSPrefix+'ux-grid-printer-links">','<a class="'+Ext.baseCSSPrefix+'ux-grid-printer-linkprint" href="javascript:void(0);" onclick="window.print();">'+this.printLinkText+"</a>",'<a class="'+Ext.baseCSSPrefix+'ux-grid-printer-linkclose" href="javascript:void(0);" onclick="window.close();">'+this.closeLinkText+"</a>","</div>",'<div id="'+Ext.baseCSSPrefix+'ux-grid-printer-title">','<div class="'+Ext.baseCSSPrefix+'ux-grid-printer-left"><h1>'+this.mainTitle+"</h1></div>",'<div class="'+Ext.baseCSSPrefix+'ux-grid-printer-right">'+this.rightTitle+"</div>","</div>","<table>","<tr>",g,"</tr>",'<tpl for=".">','<tr class="{[xindex % 2 === 0 ? "even" : "odd"]}">',h,"</tr>",j.join(""),"</tpl>","</table>","</body>","</html>"],l=Ext.create("Ext.XTemplate",k).apply(c),m=window.open("","printgrid");m.document.open(),m.document.write(l),m.document.close(),this.printAutomatically&&(Ext.isIE?window.print():m.print()),this.closeAutomaticallyAfterPrint&&(Ext.isIE?window.close():m.close())},stylesheetPath:null,printAutomatically:!1,closeAutomaticallyAfterPrint:!1,mainTitle:"",rightTitle:"",printLinkText:"Print",closeLinkText:"Close",headerTpl:['<tpl for=".">',"<th>{text}</th>","</tpl>"],bodyTpl:['<tpl for=".">',"<td>{{dataIndex}}</td>","</tpl>"],printHidden:!1}}),Ext.define("Ext.ux.grid.Save",{requires:["Ext.data.Operation","Ext.data.proxy.Rest","Ext.window.MessageBox","Ext.Ajax.request","Ext.Template"],statics:{save:function(a){var b=a.getStore(),c=this.progress,d=this.saveDir,e=new Ext.data.Operation({action:"read",filters:b.filters.items,sorters:b.sorters.items}),f=new Ext.data.proxy.Rest({url:b.getProxy().url,format:this.saveFormat}),g=f.buildRequest(e);c.show({msg:"Fetching your data, please wait...",width:300,wait:!0,waitConfig:{interval:200},modal:!1,title:"Retrieving Data..."}),Ext.Ajax.request({url:g.url,params:g.params,method:"GET",success:function(a,b){var e=Ext.decode(a.responseText),f=new Ext.Template("<div>",'<a href="{dir}/{file}">Click to Download</a> - {size}',"<br/>","<span>This file link will be active for two weeks.</span>","</div>",{compiled:!0,disableMethods:!0});c.show({msg:f.apply({dir:d,file:e.data.file,size:e.data.size}),width:300,closable:!0,modal:!1,icon:"pts-icon-download",title:"Download"})},failure:function(a,b){var d=Ext.decode(a.responseText);c.show({msg:d.message,width:300,closable:!0,buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR,modal:!1,title:"Error!"})}})},saveFormat:"csv",saveDir:"dl",progress:Ext.create("Ext.window.MessageBox")}}),Ext.define("Ext.ux.grid.HeaderToolTip",{alias:"plugin.headertooltip",init:function(a){a.headerCt.on("afterrender",this.createTip,a)},createTip:function(){var a=this,b=a.headerCt;a.tip=Ext.create("Ext.tip.ToolTip",{target:b.el,delegate:".x-column-header",trackMouse:!0,renderTo:Ext.getBody(),listeners:{beforeshow:function(a){var c=b.down("gridcolumn[id="+a.triggerElement.id+"]");return!!c&&(a.update(c.tooltip||c.text),!0)}}})}}),Ext.ns("Extensible.calendar.data"),Extensible.calendar.data.EventMappings={EventId:{name:"EventId",mapping:"id",type:"int"},CalendarId:{name:"CalendarId",mapping:"cid",type:"int"},Title:{name:"Title",mapping:"title",type:"string"},StartDate:{name:"StartDate",mapping:"start",type:"date",dateFormat:"c"},EndDate:{name:"EndDate",mapping:"end",type:"date",dateFormat:"c"},RRule:{name:"RecurRule",mapping:"rrule",type:"string"},Location:{name:"Location",mapping:"loc",type:"string"},Notes:{name:"Notes",mapping:"notes",type:"string"},Url:{name:"Url",mapping:"url",type:"string"},IsAllDay:{name:"IsAllDay",mapping:"ad",type:"boolean"},Reminder:{name:"Reminder",mapping:"rem",type:"string"}},Ext.define("PTS.view.button.Save",{extend:"Ext.button.Button",alias:"widget.savebutton",text:"Save",iconCls:"pts-menu-savebasic",disabled:!0,initComponent:function(){var a=this;Ext.applyIf(a,{handler:function(){Ext.Msg.alert("Click",'You clicked on "Save".')}}),a.callParent(arguments)}}),Ext.define("PTS.view.button.Edit",{extend:"Ext.button.Button",alias:"widget.editbutton",text:"Edit",iconCls:"pts-menu-editbasic",disabled:!0,initComponent:function(){var a=this;Ext.applyIf(a,{handler:function(){Ext.Msg.alert("Click",'You clicked on "Edit".')}}),a.callParent(arguments)}}),Ext.define("Extensible.calendar.data.EventModel",{extend:"Ext.data.Model",requires:["Ext.util.MixedCollection","Extensible.calendar.data.EventMappings"],statics:{reconfigure:function(){var a=Extensible.calendar.data,b=a.EventMappings,c=a.EventModel.prototype,d=[];c.idProperty=b.EventId.name||"id";for(prop in b)b.hasOwnProperty(prop)&&d.push(b[prop]);c.fields.clear();for(var e=0,f=d.length;e<f;e++)c.fields.add(Ext.create("Ext.data.Field",d[e]));return a.EventModel}}},function(){Extensible.calendar.data.EventModel.reconfigure()}),Ext.ns("Extensible.calendar.data"),Extensible.calendar.data.CalendarMappings={CalendarId:{name:"CalendarId",mapping:"id",type:"int"},Title:{name:"Title",mapping:"title",type:"string"},Description:{name:"Description",mapping:"desc",type:"string"},ColorId:{name:"ColorId",mapping:"color",type:"int"},IsHidden:{name:"IsHidden",mapping:"hidden",type:"boolean"}},Ext.define("Extensible.calendar.data.CalendarModel",{extend:"Ext.data.Model",requires:["Ext.util.MixedCollection","Extensible.calendar.data.CalendarMappings"],statics:{reconfigure:function(){var a=Extensible.calendar.data,b=a.CalendarMappings,c=a.CalendarModel.prototype,d=[];c.idProperty=b.CalendarId.name||"id";for(prop in b)b.hasOwnProperty(prop)&&d.push(b[prop]);c.fields.clear();for(var e=0,f=d.length;e<f;e++)c.fields.add(Ext.create("Ext.data.Field",d[e]));return a.CalendarModel}}},function(){Extensible.calendar.data.CalendarModel.reconfigure()}),Ext.define("Extensible.calendar.util.ColorPicker",{extend:"Ext.picker.Color",alias:"widget.extensible.calendarcolorpicker",requires:["Ext.XTemplate"],colorCount:32,constructor:function(){this.renderTpl=Ext.create("Ext.XTemplate",'<tpl for="colors"><a href="#" class="x-cal-{.}" hidefocus="on"><em><span unselectable="on">&#160;</span></em></a></tpl>'),this.callParent(arguments)},initComponent:function(){this.callParent(arguments),this.addCls("x-calendar-palette"),this.handler&&this.on("select",this.handler,this.scope||this,{delegate:"a"}),this.colors=[];for(var a=1;a<=this.colorCount;a++)this.colors.push(a)},handleClick:function(a,b){a.preventDefault();var c=b.className.split("x-cal-")[1];this.select(c)},select:function(a,b){var c=this,d=c.selectedCls,e=c.value;if(!c.rendered)return void(c.value=a);if(a!=e||c.allowReselect){var f=c.el;c.value&&f.down(".x-cal-"+e).removeCls(d),f.down(".x-cal-"+a).addCls(d),c.value=a,!0!==b&&c.fireEvent("select",c,a)}}}),Ext.define("PTS.model.GroupUser",{extend:"PTS.model.Base",fields:[{name:"contactid",mapping:"contactid",type:"int",persist:!1},{name:"groupid",mapping:"groupid",type:"int",persist:!1},{name:"firstname",type:"mystring",useNull:!0},{name:"lastname",type:"mystring",useNull:!0},{name:"middlename",type:"mystring",useNull:!0},{name:"suffix",type:"mystring",useNull:!0},{name:"groupname",type:"mystring",useNull:!0},{name:"acronym",type:"mystring",useNull:!0},{name:"fullname",convert:function(a,b){return b.data.lastname+", "+b.data.firstname}},{name:"inactive",type:"myboolean"}],idProperty:"contactid",getUserName:function(){var a=this.get("firstname");return this.get("lastname")+", "+a}}),Ext.define("Ext.ux.form.MultiSelect",{extend:"Ext.form.field.Base",alternateClassName:"Ext.ux.Multiselect",alias:["widget.multiselect","widget.multiselectfield"],uses:["Ext.view.BoundList","Ext.form.FieldSet","Ext.ux.layout.component.form.MultiSelect","Ext.view.DragZone","Ext.view.DropZone"],ddReorder:!1,appendOnly:!1,displayField:"text",allowBlank:!0,minSelections:0,maxSelections:Number.MAX_VALUE,blankText:"This field is required",minSelectionsText:"Minimum {0} item(s) required",maxSelectionsText:"Maximum {0} item(s) allowed",delimiter:",",componentLayout:"multiselectfield",fieldBodyCls:Ext.baseCSSPrefix+"form-multiselect-body",initComponent:function(){var a=this;a.bindStore(a.store,!0),a.store.autoCreated&&(a.valueField=a.displayField="field1",a.store.expanded||(a.displayField="field2")),Ext.isDefined(a.valueField)||(a.valueField=a.displayField),a.callParent()},bindStore:function(a,b){var c=this,d=c.store,e=c.boundList;d&&!b&&d!==a&&d.autoDestroy&&d.destroyStore(),c.store=a?Ext.data.StoreManager.lookup(a):null,e&&e.bindStore(a||null)},onRender:function(a,b){var c,d,e,f=this;f.callParent(arguments),d=f.boundList=Ext.create("Ext.view.BoundList",{deferInitialRefresh:!1,multiSelect:!0,store:f.store,displayField:f.displayField,border:!1,disabled:f.disabled}),e=d.getSelectionModel(),f.mon(e,{selectionChange:f.onSelectionChange,scope:f}),c=f.panel=Ext.create("Ext.panel.Panel",{title:f.listTitle,tbar:f.tbar,items:[d],renderTo:f.bodyEl,layout:"fit"}),c.ownerCt=f,f.setRawValue(f.rawValue)},getSubTplMarkup:function(){return""},afterRender:function(){var a=this;a.callParent(),!a.ddReorder||a.dragGroup||a.dropGroup||(a.dragGroup=a.dropGroup="MultiselectDD-"+Ext.id()),(a.draggable||a.dragGroup)&&(a.dragZone=Ext.create("Ext.view.DragZone",{view:a.boundList,ddGroup:a.dragGroup,dragText:"{0} Item{1}"})),(a.droppable||a.dropGroup)&&(a.dropZone=Ext.create("Ext.view.DropZone",{view:a.boundList,ddGroup:a.dropGroup,handleNodeDrop:function(a,b,c){var d,e=this.view,f=e.getStore(),g=a.records;a.view.store.remove(g),d=f.indexOf(b),"after"===c&&d++,f.insert(d,g),e.getSelectionModel().select(g)}}))},onSelectionChange:function(){this.checkChange()},clearValue:function(){this.setValue([])},getSubmitValue:function(){var a=this,b=a.delimiter,c=a.getValue();return Ext.isString(b)?c.join(b):c},getRawValue:function(){var a=this,b=a.boundList;return b&&(a.rawValue=Ext.Array.map(b.getSelectionModel().getSelection(),function(b){return b.get(a.valueField)})),a.rawValue},setRawValue:function(a){var b,c=this,d=c.boundList;return a=Ext.Array.from(a),c.rawValue=a,d&&(b=[],Ext.Array.forEach(a,function(a){var d=c.store.findRecord(c.valueField,a,void 0,void 0,!0,!0);d&&b.push(d)}),d.getSelectionModel().select(b,!1,!0)),a},valueToRaw:function(a){return a},isEqual:function(a,b){var c,d,e=Ext.Array.from;if(a=e(a),b=e(b),(d=a.length)!==b.length)return!1;for(c=0;c<d;c++)if(b[c]!==a[c])return!1;return!0},getErrors:function(a){var b,c=this,d=Ext.String.format,e=c.callParent(arguments);return a=Ext.Array.from(a||c.getValue()),b=a.length,!c.allowBlank&&b<1&&e.push(c.blankText),b<this.minSelections&&e.push(d(c.minSelectionsText,c.minSelections)),b>this.maxSelections&&e.push(d(c.maxSelectionsText,c.maxSelections)),e},onDisable:function(){var a=this;a.callParent(),a.updateReadOnly(),a.boundList&&a.boundList.disable()},onEnable:function(){var a=this;a.callParent(),a.updateReadOnly(),a.boundList&&a.boundList.enable()},setReadOnly:function(a){this.readOnly=a,this.updateReadOnly()},updateReadOnly:function(){var a=this,b=a.boundList,c=a.readOnly||a.disabled;b&&b.getSelectionModel().setLocked(c)},onDestroy:function(){Ext.destroyMembers(this,"panel","boundList","dragZone","dropZone"),this.callParent()}}),Ext.define("Ext.ux.layout.component.form.ItemSelector",{extend:"Ext.layout.component.field.Field",alias:["layout.itemselectorfield"],type:"itemselectorfield",defaultHeight:200,sizeBodyContents:function(a,b){var c=this;Ext.isNumber(b)||(b=c.defaultHeight),c.owner.innerCt.setSize(a,b)}}),Ext.define("Extensible.calendar.dd.StatusProxy",{extend:"Ext.dd.StatusProxy",moveEventCls:"ext-cal-dd-move",addEventCls:"ext-cal-dd-add",renderTpl:['<div class="'+Ext.baseCSSPrefix+'dd-drop-icon"></div>','<div class="ext-dd-ghost-ct">','<div id="{id}-ghost" class="'+Ext.baseCSSPrefix+'dd-drag-ghost"></div>','<div id="{id}-message" class="ext-dd-msg"></div>',"</div>"],childEls:["ghost","message"],constructor:function(a){Ext.getVersion().isLessThan("4.1")?this.preComponentConstructor(a):this.callParent(arguments)},preComponentConstructor:function(a){var b=this;Ext.apply(b,a),b.id=b.id||Ext.id(),b.proxy=Ext.createWidget("component",{floating:!0,id:b.id||Ext.id(),html:b.renderTpl.join(""),cls:Ext.baseCSSPrefix+"dd-drag-proxy "+b.dropNotAllowed,shadow:!a||!1!==a.shadow,renderTo:document.body}),b.el=b.proxy.el,b.el.show(),b.el.setVisibilityMode(Ext.core.Element.VISIBILITY),b.el.hide(),b.ghost=Ext.get(b.el.dom.childNodes[1].childNodes[0]),b.message=Ext.get(b.el.dom.childNodes[1].childNodes[1]),b.dropStatus=b.dropNotAllowed},update:function(a){this.callParent(arguments);var b=this.ghost.dom.firstChild;b&&Ext.fly(b).setHeight("auto")},updateMsg:function(a){this.message.update(a)}}),Ext.define("GeoExt.data.LayerModel",{alternateClassName:"GeoExt.data.LayerRecord",extend:"Ext.data.Model",requires:["Ext.data.proxy.Memory","Ext.data.reader.Json"],alias:"model.gx_layer",statics:{createFromLayer:function(a){return this.proxy.reader.readRecords([a]).records[0]}},fields:["id",{name:"title",type:"string",mapping:"name"},{name:"legendURL",type:"string",mapping:"metadata.legendURL"},{name:"hideTitle",type:"bool",mapping:"metadata.hideTitle"},{name:"hideInLegend",type:"bool",mapping:"metadata.hideInLegend"}],proxy:{type:"memory",reader:{type:"json"}},getLayer:function(){return this.raw}}),Ext.define("PTS.view.button.Delete",{extend:"Ext.button.Button",alias:"widget.deletebutton",text:"Delete",iconCls:"pts-menu-deletebasic",disabled:!0,initComponent:function(){var a=this;Ext.applyIf(a,{handler:function(){Ext.Msg.alert("Click",'You clicked on "Delete".')}}),a.callParent(arguments)}}),Ext.define("PTS.view.button.Reset",{extend:"Ext.button.Button",alias:"widget.resetbutton",text:"Reset",iconCls:"pts-menu-reset",disabled:!0,initComponent:function(){var a=this;Ext.applyIf(a,{handler:function(){Ext.Msg.alert("Click",'You clicked on "Reset".')}}),a.callParent(arguments)}}),Ext.define("Ext.ux.StoreMenu",{extend:"Ext.menu.Menu",alias:"widget.storemenu",plain:!0,loadingCls:void 0,initComponent:function(){var a=this;a.store=Ext.data.StoreManager.lookup(a.store||"ext-empty-store"),a.callParent(arguments),a.on("render",function(b){!b.store.data.getCount()>0?(b.add({text:"Loading...",iconCls:a.loadingCls,hideOnClick:!1,disabled:!0}),b.store.load()):b.store.each(function(b){a.add({text:b.get("text"),itemId:b.getId()})},a)}),a.store.on("load",function(b,c,d){a.removeAll(),b.each(function(b){a.add({text:b.get("text"),itemId:b.getId()})},a)})}}),Ext.define("PTS.util.mixin.CheckDirty",{requires:["Ext.Array"],isDirty:function(){var a=this.query("field");return!Ext.Array.every(a,function(a){return!a.isDirty()})},isValid:function(){var a=this.query("field");return Ext.Array.every(a,function(a){return a.isValid()})}}),Ext.define("Extensible.calendar.template.DayHeader",{extend:"Ext.XTemplate",requires:["Extensible.calendar.template.BoxLayout"],constructor:function(a){Ext.apply(this,a),this.allDayTpl=Ext.create("Extensible.calendar.template.BoxLayout",a),this.allDayTpl.compile(),Extensible.calendar.template.DayHeader.superclass.constructor.call(this,'<div class="ext-cal-hd-ct">','<table class="ext-cal-hd-days-tbl" cellspacing="0" cellpadding="0">',"<tbody>","<tr>",'<td class="ext-cal-gutter"></td>','<td class="ext-cal-hd-days-td"><div class="ext-cal-hd-ad-inner">{allDayTpl}</div></td>','<td class="ext-cal-gutter-rt"></td>',"</tr>","</tbody>","</table>","</div>")},applyTemplate:function(a){var b={allDayTpl:this.allDayTpl.apply(a)};return Ext.getVersion().isLessThan("4.1")?Extensible.calendar.template.DayHeader.superclass.applyTemplate.call(this,b):this.applyOut(b,[]).join("")}},function(){this.createAlias("apply","applyTemplate")}),Ext.define("Extensible.calendar.template.DayBody",{extend:"Ext.XTemplate",constructor:function(a){Ext.apply(this,a),Extensible.calendar.template.DayBody.superclass.constructor.call(this,'<table class="ext-cal-bg-tbl" cellspacing="0" cellpadding="0" style="height:{dayHeight}px;">',"<tbody>",'<tr height="1">','<td class="ext-cal-gutter"></td>','<td colspan="{dayCount}">','<div class="ext-cal-bg-rows">','<div class="ext-cal-bg-rows-inner">','<tpl for="times">','<div class="ext-cal-bg-row ext-row-{[xindex]}" style="height:{parent.hourHeight}px;">','<div class="ext-cal-bg-row-div {parent.hourSeparatorCls}" style="height:{parent.hourSeparatorHeight}px;"></div>',"</div>","</tpl>","</div>","</div>","</td>","</tr>","<tr>",'<td class="ext-cal-day-times">','<tpl for="times">','<div class="ext-cal-bg-row" style="height:{parent.hourHeight}px;">','<div class="ext-cal-day-time-inner"  style="height:{parent.hourHeight-1}px;">{.}</div>',"</div>","</tpl>","</td>",'<tpl for="days">','<td class="ext-cal-day-col">','<div class="ext-cal-day-col-inner">','<div id="{[this.id]}-day-col-{.:date("Ymd")}" class="ext-cal-day-col-gutter" style="height:{parent.dayHeight}px;"></div>',"</div>","</td>","</tpl>","</tr>","</tbody>","</table>")},applyTemplate:function(a){this.today=Extensible.Date.today(),this.dayCount=this.dayCount||1;for(var b=0,c=[],d=Ext.Date.clone(a.viewStart);b<this.dayCount;b++)c[b]=Extensible.Date.add(d,{days:b});var e,f=[],g=this.viewStartHour,h=this.viewEndHour,i=this.hourIncrement,j=this.hourHeight*(h-g),k=Extensible.Date.use24HourTime?"G:i":"ga";for(d=Extensible.Date.add(new Date("5/26/1972"),{hours:g}),b=g;b<h;b++)f.push(Ext.Date.format(d,k)),d=Extensible.Date.add(d,{minutes:i});return e={days:c,dayCount:c.length,times:f,hourHeight:this.hourHeight,hourSeparatorCls:this.showHourSeparator?"":"no-sep",dayHeight:j,hourSeparatorHeight:this.hourHeight/2},Ext.getVersion().isLessThan("4.1")?Extensible.calendar.template.DayBody.superclass.applyTemplate.call(this,e):this.applyOut(e,[]).join("")}},function(){this.createAlias("apply","applyTemplate")}),Ext.define("PTS.view.config.Window",{extend:"Ext.window.Window",alias:"widget.configwindow",requires:["Ext.form.Panel"],layout:{type:"fit"},closable:!1,closeAction:"hide",maximizable:!0,title:"Edit Settings",constrain:!0,modal:!1,y:20,addTools:function(){var a=this;a.callParent(),a.addTool({xtype:"tool",type:"close",action:"close"})},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"form",trackResetOnLoad:!0,bodyPadding:15,items:[{xtype:"combobox",fieldLabel:"Window Width",name:"windowWidth",qtip:"Sets the default width for editor windows.",editable:!1,store:[[900,"normal"],[1200,"wide"],[0,"maximize"]]},{xtype:"combobox",fieldLabel:"*Page Size",name:"pageSize",qtip:"Sets the default page size for grids. Select an option or enter a custom value.",editable:!0,store:[[25,25],[30,30],[40,40],[50,50]]}]}],dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"tbtext",text:"*Requires restart"},{xtype:"tbfill"},{xtype:"button",iconCls:"pts-menu-savebasic",text:"Save",action:"save"},{xtype:"button",text:"Close",
action:"close"}]}]}),a.callParent(arguments),a.down("form").loadRecord(PTS.userConfig)}}),Ext.define("Extensible.calendar.template.Month",{extend:"Ext.XTemplate",requires:["Extensible.calendar.template.BoxLayout"],dayHeaderFormat:"D",dayHeaderTitleFormat:"l, F j, Y",constructor:function(a){Ext.apply(this,a),this.weekTpl=Ext.create("Extensible.calendar.template.BoxLayout",a),this.weekTpl.compile();var b=this.showWeekLinks?'<div class="ext-cal-week-link-hd">&#160;</div>':"";Extensible.calendar.template.Month.superclass.constructor.call(this,'<div class="ext-cal-inner-ct {extraClasses}">','<div class="ext-cal-hd-ct ext-cal-month-hd">',b,'<table class="ext-cal-hd-days-tbl" cellpadding="0" cellspacing="0">',"<tbody>","<tr>",'<tpl for="days">','<th class="ext-cal-hd-day{[xindex==1 ? " ext-cal-day-first" : ""]}" title="{title}">{name}</th>',"</tpl>","</tr>","</tbody>","</table>","</div>",'<div class="ext-cal-body-ct">{weeks}</div>',"</div>")},applyTemplate:function(a){for(var b,c=[],d=this.weekTpl.apply(a),e=a.viewStart,f=Extensible.Date,g=0;g<7;g++){var h=f.add(e,{days:g});c.push({name:Ext.Date.format(h,this.dayHeaderFormat),title:Ext.Date.format(h,this.dayHeaderTitleFormat)})}var i=!0===this.showHeader?"":"ext-cal-noheader";return this.showWeekLinks&&(i+=" ext-cal-week-links"),b={days:c,weeks:d,extraClasses:i},Ext.getVersion().isLessThan("4.1")?Extensible.calendar.template.Month.superclass.applyTemplate.call(this,b):this.applyOut(b,[]).join("")}},function(){this.createAlias("apply","applyTemplate")}),Ext.define("PTS.view.issue.Window",{extend:"Ext.window.Window",alias:"widget.issuewindow",requires:["Ext.form.Panel"],layout:{type:"fit"},maximizable:!0,title:"Create New Issue",constrain:!0,modal:!1,y:20,width:600,minWidth:600,initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"form",trackResetOnLoad:!0,bodyPadding:15,url:PTS.baseURL+"/github/issue",method:"POST",layout:"anchor",defaults:{anchor:"100%"},items:[{xtype:"textfield",fieldLabel:"Title",name:"title",allowBlank:!1,minLength:3},{xtype:"htmleditor",height:400,fieldLabel:"Description",name:"body",qtip:"Enter a description of the issue.",allowBlank:!1,enableColors:!1,enableFont:!1,enableFontSize:!1,enableAlignments:!1}],buttons:[{xtype:"button",iconCls:"pts-menu-savebasic",text:"Save",action:"save",formBind:!0,disabled:!0},{xtype:"button",text:"Close",action:"closeIssue",handler:function(a){a.up("window").close()}}]}]}),a.callParent(arguments)}}),Ext.define("Ext.ux.grid.PrintGrid",{extend:"Object",requires:["Ext.button.Button","Ext.ux.grid.Printer","Ext.Date"],text:null,title:null,printHidden:!1,constructor:function(a){a&&Ext.apply(this,a)},init:function(a){var b,c=a.items.indexOf(a.child("#refresh"));b=Ext.create("Ext.button.Button",{text:this.text,mainTitle:this.title,printHidden:this.printHidden,iconCls:"pts-printer",itemId:"printBtn",tooltip:"Print the visible records",handler:function(){var b,c=this,d=c.up("gridpanel"),e=c.up("pagingtoolbar").getPageData(),f=Ext.Date.format(new Date,"F j, Y, g:i a"),g="Page "+e.currentPage+" of "+e.pageCount;b=Ext.isFunction(c.mainTitle)?c.mainTitle.call(a):c.mainTitle?c.mainTitle:d.title+" - "+f,Ext.ux.grid.Printer.mainTitle=b,Ext.ux.grid.Printer.rightTitle=g,Ext.ux.grid.Printer.printHidden=c.printHidden,Ext.ux.grid.Printer.print(d)}}),a.insert(c+1,b),a.on("change",function(a,c){b.setDisabled(!c.total)})}}),Ext.define("Ext.ux.grid.SaveGrid",{extend:"Object",requires:["Ext.button.Button","Ext.ux.grid.Save"],text:null,constructor:function(a){a&&Ext.apply(this,a)},init:function(a){var b,c=a.items.indexOf(a.child("#refresh"));b=Ext.create("Ext.button.Button",{text:this.text,iconCls:"pts-menu-savetable",tooltip:"Download the grid",handler:function(){Ext.ux.grid.Save.save(this.up("gridpanel"))}}),a.insert(c+1,b),a.on("change",function(a,c){b.setDisabled(!c.total)})}}),Ext.define("GeoExt.selection.FeatureModel",{extend:"Ext.selection.RowModel",alias:"selection.featuremodel",autoActivateControl:!0,layerFromStore:!0,selectControl:null,bound:!1,selectedFeatures:[],autoPanMapOnSelection:!1,constructor:function(a){if(a=a||{},a.selectControl instanceof OpenLayers.Control.SelectFeature){if(!a.singleSelect){var b=a.selectControl;a.singleSelect=!(b.multiple||b.multipleKey)}}else a.layer instanceof OpenLayers.Layer.Vector&&(this.selectControl=this.createSelectControl(a.layer,a.selectControl),delete a.layer,delete a.selectControl);a.autoPanMapOnSelection&&(this.autoPanMapOnSelection=!0,delete a.autoPanMapOnSelection),this.callParent(arguments)},bindComponent:function(){if(this.callParent(arguments),this.layerFromStore){var a=this.view.getStore()&&this.view.getStore().layer;!a||this.selectControl instanceof OpenLayers.Control.SelectFeature||(this.selectControl=this.createSelectControl(a,this.selectControl))}this.selectControl&&this.bindModel(this.selectControl)},createSelectControl:function(a,b){b=b||{};var c=void 0!==b.singleSelect?b.singleSelect:this.singleSelect;b=OpenLayers.Util.extend({toggle:!0,multipleKey:c?null:Ext.isMac?"metaKey":"ctrlKey"},b);var d=new OpenLayers.Control.SelectFeature(a,b);return a.map.addControl(d),d},bindModel:function(a,b){if(!this.bound){b=b||{},this.selectControl=a,a instanceof OpenLayers.Layer.Vector&&(this.selectControl=this.createSelectControl(a,b.controlConfig)),this.autoActivateControl&&this.selectControl.activate();for(var c=this.getLayers(),d=0,e=c.length;d<e;d++)c[d].events.on({featureselected:this.featureSelected,featureunselected:this.featureUnselected,scope:this});this.bound=!0}return this.selectControl},unbind:function(){var a=this.selectControl;if(this.bound){for(var b=this.getLayers(),c=0,d=b.length;c<d;c++)b[c].events.un({featureselected:this.featureSelected,featureunselected:this.featureUnselected,scope:this});this.autoActivateControl&&a.deactivate(),this.selectControl=null,this.bound=!1}return a},featureSelected:function(a){if(!this._selecting){var b=this.view.store,c=b.findBy(function(b,c){return b.raw==a.feature});-1==c||this.isSelected(c)||(this._selecting=!0,this.select(c,!this.singleSelect),this._selecting=!1,this.view.focusRow(c))}},featureUnselected:function(a){if(!this._selecting){var b=this.view.store,c=b.findBy(function(b,c){return b.raw==a.feature});-1!=c&&this.isSelected(c)&&(this._selecting=!0,this.deselect(c),this._selecting=!1,this.view.focusRow(c))}},onSelectChange:function(a,b){this.callParent(arguments);var c=a.raw;if(this.selectControl&&!this._selecting&&c){var d=this.getLayers();if(b){for(var e=0,f=d.length;e<f;e++)if(-1==Ext.Array.indexOf(d[e].selectedFeatures,c)){this._selecting=!0,this.selectControl.select(c),this._selecting=!1,this.selectedFeatures.push(c);break}this.autoPanMapOnSelection&&this.recenterToSelectionExtent()}else{for(var e=0,f=d.length;e<f;e++)if(-1!=Ext.Array.indexOf(d[e].selectedFeatures,c)){this._selecting=!0,this.selectControl.unselect(c),this._selecting=!1,OpenLayers.Util.removeItem(this.selectedFeatures,c);break}this.autoPanMapOnSelection&&this.selectedFeatures.length>0&&this.recenterToSelectionExtent()}}},getLayers:function(){return this.selectControl.layers||[this.selectControl.layer]},recenterToSelectionExtent:function(){var a=this.selectControl.map,b=this.getSelectionExtent();a.getZoomForExtent(b,!1)>a.getZoom()?a.setCenter(b.getCenterLonLat()):a.zoomToExtent(b)},getSelectionExtent:function(){var a=null,b=this.selectedFeatures;if(b&&b.length>0)for(var c=null,d=0,e=b.length;d<e;d++)(c=b[d].geometry)&&(null===a&&(a=new OpenLayers.Bounds),a.extend(c.getBounds()));return a}}),Ext.define("PTS.view.MainToolbar",{extend:"Ext.toolbar.Toolbar",requires:["Ext.form.field.Text","Ext.form.field.HtmlEditor","Ext.menu.Menu","Ext.menu.Item"],alias:"widget.maintoolbar",height:33,id:"pts-main-toolbar",itemId:"main-toolbar",initComponent:function(){var a=this;Ext.applyIf(a,{style:{border:"none",backgroundColor:"#FFF",backgroundImage:"none"},items:[{xtype:"tbtext",html:"<h1>"+PTS.UserId.title+' Project Tracking System <span class="pts-version">v'+PTS.app.version+"</span></h1>",style:{textAlign:"center",fontSize:"18px"},flex:1},{xtype:"container",width:200,items:[{xtype:"label",margin:"0 5",text:"Logged In:"},{xtype:"button",itemId:"userBtn",text:"",menu:{xtype:"menu",items:[{xtype:"menuitem",itemId:"configBtn",iconCls:"pts-menu-settings",text:"Settings"},{xtype:"menuitem",itemId:"issueBtn",iconCls:"pts-menu-exclamation",text:"Create Issue",tooltip:"Test"},{itemId:"switchPTS",iconCls:"pts-menu-switch",text:"Switch PTS",menu:{plain:!0,items:[]}},{xtype:"menuitem",iconCls:"pts-menu-logout",text:"Logout",handler:function(){window.location="logout"}}]}}]}]}),a.callParent(arguments)}}),Ext.define("PTS.controller.MainToolbar",{extend:"Ext.app.Controller",views:["MainToolbar","config.Window","issue.Window"],refs:[{ref:"configForm",selector:"configwindow form"},{ref:"issueForm",selector:"issuewindow form"}],init:function(){this.control({"maintoolbar #userBtn":{beforerender:this.onBeforeShowUserBtn},"maintoolbar #switchPTS menu":{click:this.onClickSwitchPTS},"maintoolbar #issueBtn":{click:this.showIssue},"maintoolbar #configBtn":{click:this.showSettings},"configwindow button[action=close]":{click:this.closeSettings},"configwindow tool[action=close]":{click:this.closeSettings},"configwindow button[action=save]":{click:this.saveSettings},"issuewindow button[action=save]":{click:this.saveIssue}})},onBeforeShowUserBtn:function(a){var b,c=PTS.user.getUserName(),d=a.menu.down("#switchPTS").menu;a.setText(c),d.add(PTS.UserId.paths),(b=d.down("menuitem[url="+window.location.pathname+"]"))&&b.disable()},onClickSwitchPTS:function(a,b){this.switchPTS(b.url)},switchPTS:function(a){window.location.href=a},showIssue:function(a){Ext.create("PTS.view.issue.Window").show()},showSettings:function(a){void 0===PTS.userConfigWindow&&(PTS.userConfigWindow=Ext.create("PTS.view.config.Window")),PTS.userConfigWindow.show()},closeSettings:function(a){var b=this.getConfigForm().getForm();b.isDirty()&&b.reset(),a.up("configwindow").close()},saveSettings:function(a){var b=this.getConfigForm().getForm(),c=this.getConfigForm().getEl(),d=b.getRecord();c.mask("Saving..."),b.updateRecord(d),d.save({success:function(a,b){this.getConfigForm().loadRecord(a),c.unmask()},failure:function(a,b){c.unmask()},scope:this})},saveIssue:function(a){var b=this.getIssueForm().up("window"),c=this.getIssueForm().getForm(),d=this.getIssueForm().getEl();d.mask("Saving..."),c.isValid()&&c.submit({method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},jsonData:Ext.JSON.encode(c.getFieldValues()),success:function(a,c){d.unmask(),b.close(),Ext.create("widget.uxNotification",{title:"Issue Created",iconCls:"ux-notification-icon-information",html:"Issue was created."}).show()},failure:function(a,b){d.unmask()}})},resetSettings:function(){this.getConfigForm().getForm().reset()}}),Ext.define("Extensible.calendar.form.EventWindow",{extend:"Ext.window.Window",alias:"widget.extensible.eventeditwindow",requires:["Ext.form.Panel","Extensible.calendar.data.EventModel","Extensible.calendar.data.EventMappings"],titleTextAdd:"Add Event",titleTextEdit:"Edit Event",width:600,labelWidth:65,detailsLinkText:"Edit Details...",savingMessage:"Saving changes...",deletingMessage:"Deleting event...",saveButtonText:"Save",deleteButtonText:"Delete",cancelButtonText:"Cancel",titleLabelText:"Title",datesLabelText:"When",calendarLabelText:"Calendar",closeAction:"hide",modal:!1,resizable:!1,constrain:!0,buttonAlign:"left",editDetailsLinkClass:"edit-dtl-link",enableEditDetails:!0,layout:"fit",formPanelConfig:{border:!1},initComponent:function(){this.addEvents({eventadd:!0,eventupdate:!0,eventdelete:!0,eventcancel:!0,editdetails:!0}),this.fbar=this.getFooterBarConfig(),this.callParent(arguments)},getFooterBarConfig:function(){var a=["->",{text:this.saveButtonText,itemId:this.id+"-save-btn",disabled:!1,handler:this.onSave,scope:this},{text:this.deleteButtonText,itemId:this.id+"-delete-btn",disabled:!1,handler:this.onDelete,scope:this,hideMode:"offsets"},{text:this.cancelButtonText,itemId:this.id+"-cancel-btn",disabled:!1,handler:this.onCancel,scope:this}];return!1!==this.enableEditDetails&&a.unshift({xtype:"tbtext",itemId:this.id+"-details-btn",text:'<a href="#" class="'+this.editDetailsLinkClass+'">'+this.detailsLinkText+"</a>"}),a},onRender:function(a,b){this.formPanel=Ext.create("Ext.FormPanel",Ext.applyIf({fieldDefaults:{labelWidth:this.labelWidth},items:this.getFormItemConfigs()},this.formPanelConfig)),this.add(this.formPanel),this.callParent(arguments)},getFormItemConfigs:function(){var a=[{xtype:"textfield",itemId:this.id+"-title",name:Extensible.calendar.data.EventMappings.Title.name,fieldLabel:this.titleLabelText,anchor:"100%"},{xtype:"extensible.daterangefield",itemId:this.id+"-dates",name:"dates",anchor:"95%",singleLine:!0,fieldLabel:this.datesLabelText}];return this.calendarStore&&a.push({xtype:"extensible.calendarcombo",itemId:this.id+"-calendar",name:Extensible.calendar.data.EventMappings.CalendarId.name,anchor:"100%",fieldLabel:this.calendarLabelText,store:this.calendarStore}),a},afterRender:function(){this.callParent(arguments),this.el.addCls("ext-cal-event-win"),this.initRefs();var a=this.getDockedItems("toolbar")[0].items.items[0];a.el.hasCls("x-component-default")&&Ext.destroy(a)},initRefs:function(){this.saveButton=this.down("#"+this.id+"-save-btn"),this.deleteButton=this.down("#"+this.id+"-delete-btn"),this.cancelButton=this.down("#"+this.id+"-cancel-btn"),this.detailsButton=this.down("#"+this.id+"-details-btn"),this.detailsButton&&this.detailsButton.getEl().on("click",this.onEditDetailsClick,this),this.titleField=this.down("#"+this.id+"-title"),this.dateRangeField=this.down("#"+this.id+"-dates"),this.calendarField=this.down("#"+this.id+"-calendar")},onEditDetailsClick:function(a){a.stopEvent(),this.updateRecord(this.activeRecord,!0),this.fireEvent("editdetails",this,this.activeRecord,this.animateTarget)},show:function(a,b){this.animateTarget=Ext.isIE8&&Ext.isStrict?null:b,M=Extensible.calendar.data.EventMappings,this.callParent([this.animateTarget,function(){this.titleField.focus(!1,100)},this]),this.deleteButton[a.data&&a.data[M.EventId.name]?"show":"hide"]();var c,d=this.formPanel.form;if(a.data)c=a,c.phantom?this.setTitle(this.titleTextAdd):this.setTitle(this.titleTextEdit),d.loadRecord(c);else{this.setTitle(this.titleTextAdd);var e=a[M.StartDate.name],f=a[M.EndDate.name]||Extensible.Date.add(e,{hours:1});c=Ext.create("Extensible.calendar.data.EventModel"),c.data[M.StartDate.name]=e,c.data[M.EndDate.name]=f,c.data[M.IsAllDay.name]=!!a[M.IsAllDay.name]||e.getDate()!=Extensible.Date.add(f,{millis:1}).getDate(),d.reset(),d.loadRecord(c)}return this.calendarStore&&this.calendarField.setValue(c.data[M.CalendarId.name]),this.dateRangeField.setValue(c.data),this.activeRecord=c,this},roundTime:function(a,b){b=b||15;var c=parseInt(a.getMinutes());return a.add("mi",b-c%b)},onCancel:function(){this.cleanup(!0),this.fireEvent("eventcancel",this,this.activeRecord,this.animateTarget)},cleanup:function(a){this.activeRecord&&this.activeRecord.reject(),delete this.activeRecord,!0===a&&this.hide()},updateRecord:function(a,b){var c,d=a.fields,e=this.formPanel.getForm().getValues(),f=Extensible.calendar.data.EventMappings,g={};d.each(function(a){(c=a.name)in e&&(g[c]=e[c])});var h=this.dateRangeField.getValue();return g[f.StartDate.name]=h[0],g[f.EndDate.name]=h[1],g[f.IsAllDay.name]=h[2],a.beginEdit(),a.set(g),b||a.endEdit(),this},onSave:function(){if(this.formPanel.form.isValid())return this.updateRecord(this.activeRecord)?void this.fireEvent(this.activeRecord.phantom?"eventadd":"eventupdate",this,this.activeRecord,this.animateTarget):void this.onCancel()},onDelete:function(){this.fireEvent("eventdelete",this,this.activeRecord,this.animateTarget)}}),Ext.define("Extensible.calendar.data.MemoryEventStore",{extend:"Ext.data.Store",model:"Extensible.calendar.data.EventModel",requires:["Ext.data.proxy.Memory","Ext.data.reader.Json","Ext.data.writer.Json","Extensible.calendar.data.EventModel","Extensible.calendar.data.EventMappings"],proxy:{type:"memory",reader:{type:"json",root:"evts"},writer:{type:"json"}},constructor:function(a){a=a||{},this.callParent(arguments),this.sorters=this.sorters||[{property:Extensible.calendar.data.EventMappings.StartDate.name,direction:"ASC"}],this.idProperty=this.idProperty||Extensible.calendar.data.EventMappings.EventId.mapping||"id",this.fields=Extensible.calendar.data.EventModel.prototype.fields.getRange(),!1!==a.autoMsg&&this.on("write",this.onWrite,this),this.autoMsg=a.autoMsg,this.onCreateRecords=Ext.Function.createInterceptor(this.onCreateRecords,this.interceptCreateRecords),this.initRecs()},interceptCreateRecords:function(a,b,c){if(c)for(var d=0,e=a.length;d<e;d++)a[d].data[Extensible.calendar.data.EventMappings.EventId.name]=a[d].id},initRecs:function(){this.each(function(a){a.store=this,a.phantom=!1},this)},onWrite:function(a,b){if(Extensible.example&&Extensible.example.msg){var c=(b.wasSuccessful(),b.getRecords()[0]),d=c.data[Extensible.calendar.data.EventMappings.Title.name];switch(b.action){case"create":Extensible.example.msg("Add",'Added "'+Ext.value(d,"(No title)")+'"');break;case"update":Extensible.example.msg("Update",'Updated "'+Ext.value(d,"(No title)")+'"');break;case"destroy":Extensible.example.msg("Delete",'Deleted "'+Ext.value(d,"(No title)")+'"')}}},onProxyLoad:function(a){var b,c=this;if(c.data&&c.data.length>0)c.totalCount=c.data.length,b=c.data.items;else{var d=a.getResultSet(),e=a.wasSuccessful();b=a.getRecords(),d&&(c.totalCount=d.total),e&&c.loadRecords(b,a)}c.loading=!1,c.fireEvent("load",c,b,e)}}),Ext.define("Extensible.calendar.data.MemoryCalendarStore",{extend:"Ext.data.Store",model:"Extensible.calendar.data.CalendarModel",requires:["Ext.data.proxy.Memory","Ext.data.reader.Json","Ext.data.writer.Json","Extensible.calendar.data.CalendarModel","Extensible.calendar.data.CalendarMappings"],proxy:{type:"memory",reader:{type:"json",root:"calendars"},writer:{type:"json"}},autoLoad:!0,initComponent:function(){this.sorters=this.sorters||[{property:Extensible.calendar.data.CalendarMappings.Title.name,direction:"ASC"}],this.idProperty=this.idProperty||Extensible.calendar.data.CalendarMappings.CalendarId.name||"id",this.fields=Extensible.calendar.data.CalendarModel.prototype.fields.getRange(),this.callParent(arguments)}}),Ext.define("Extensible.calendar.data.EventStore",{extend:"Ext.data.Store",model:"Extensible.calendar.data.EventModel",constructor:function(a){a=a||{},this.deferLoad=a.autoLoad,a.autoLoad=!1,this.callParent(arguments)},load:function(a){Extensible.log("store load"),a=a||{},a.params&&delete this.initialParams,this.initialParams&&(a.params=a.params||{},Ext.apply(a.params,this.initialParams),delete this.initialParams),this.callParent(arguments)}}),Ext.define("Extensible.calendar.gadget.CalendarListMenu",{extend:"Ext.menu.Menu",alias:"widget.extensible.calendarlistmenu",requires:["Extensible.calendar.util.ColorPicker"],hideOnClick:!0,ignoreParentClicks:!0,displayOnlyThisCalendarText:"Display only this calendar",enableScrolling:!1,initComponent:function(){this.addEvents("showcalendar","hidecalendar","radiocalendar","colorchange"),Ext.apply(this,{items:[{text:this.displayOnlyThisCalendarText,iconCls:"extensible-cal-icon-cal-show",handler:Ext.bind(this.handleRadioCalendarClick,this)},"-",{xtype:"extensible.calendarcolorpicker",id:this.id+"-calendar-color-picker",handler:Ext.bind(this.handleColorSelect,this)}]}),this.addClass("x-calendar-list-menu"),this.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.palette=this.down("#"+this.id+"-calendar-color-picker"),this.colorId&&this.palette.select(this.colorId,!0)},handleRadioCalendarClick:function(a,b){this.fireEvent("radiocalendar",this,this.calendarId)},handleColorSelect:function(a,b){this.fireEvent("colorchange",this,this.calendarId,b,this.colorId),this.colorId=b,this.menuHide()},setCalendar:function(a,b){return this.calendarId=a,this.colorId=b,this.rendered&&this.palette.select(b,!0),this},menuHide:function(){this.hideOnClick&&this.hide()}}),Ext.define("Extensible.calendar.gadget.CalendarListPanel",{extend:"Ext.panel.Panel",alias:"widget.extensible.calendarlist",requires:["Ext.XTemplate","Extensible.calendar.gadget.CalendarListMenu"],title:"Calendars",collapsible:!0,autoHeight:!0,layout:"fit",menuSelector:"em",width:100,initComponent:function(){this.addCls("x-calendar-list"),this.callParent(arguments)},afterRender:function(a,b){this.callParent(arguments),this.store&&this.setStore(this.store,!0),this.refresh(),this.body.on("click",this.onClick,this),this.body.on("mouseover",this.onMouseOver,this,{delegate:"li"}),this.body.on("mouseout",this.onMouseOut,this,{delegate:"li"})},getListTemplate:function(){return this.tpl||(this.tpl=Ext.isIE||Ext.isOpera?Ext.create("Ext.XTemplate",'<ul class="x-unselectable"><tpl for=".">','<li id="{cmpId}" class="ext-cal-evo {colorCls} {hiddenCls}">','<div class="ext-cal-evm">','<div class="ext-cal-evi">{title}<em>&#160;</em></div>',"</div>","</li>","</tpl></ul>"):Ext.create("Ext.XTemplate",'<ul class="x-unselectable"><tpl for=".">','<li id="{cmpId}" class="ext-cal-evr {colorCls} {hiddenCls}">{title}<em>&#160;</em></li>',"</tpl></ul>"),this.tpl.compile()),this.tpl},setStore:function(a,b){!b&&this.store&&(this.store.un("load",this.refresh,this),this.store.un("add",this.refresh,this),this.store.un("remove",this.refresh,this),this.store.un("update",this.onUpdate,this),this.store.un("clear",this.refresh,this)),a&&(a.on("load",this.refresh,this),a.on("add",this.refresh,this),a.on("remove",this.refresh,this),a.on("update",this.onUpdate,this),a.on("clear",this.refresh,this)),this.store=a},onUpdate:function(a,b,c){c==Ext.data.Record.COMMIT&&this.refresh()},refresh:function(){if(!this.skipRefresh){for(var a=[],b=0,c=null,d=Extensible.calendar.data.CalendarMappings,e=this.store.getRange(),f=e.length;b<f;b++)c={cmpId:this.id+"__"+e[b].data[d.CalendarId.name],title:e[b].data[d.Title.name],colorCls:this.getColorCls(e[b].data[d.ColorId.name])},!0===e[b].data[d.IsHidden.name]&&(c.hiddenCls="ext-cal-hidden"),a[a.length]=c;this.getListTemplate().overwrite(this.body,a)}},getColorCls:function(a){return"x-cal-"+a+"-ad"},toggleCalendar:function(a,b){var c=this.store.findRecord(Extensible.calendar.data.CalendarMappings.CalendarId.name,a);CM=Extensible.calendar.data.CalendarMappings,isHidden=c.data[CM.IsHidden.name],c.set([CM.IsHidden.name],!isHidden),!1!==b&&c.commit()},showCalendar:function(a,b){!0===this.store.findRecord(Extensible.calendar.data.CalendarMappings.CalendarId.name,a).data[Extensible.calendar.data.CalendarMappings.IsHidden.name]&&this.toggleCalendar(a,b)},hideCalendar:function(a,b){!0!==this.store.findRecord(Extensible.calendar.data.CalendarMappings.CalendarId.name,a).data[Extensible.calendar.data.CalendarMappings.IsHidden.name]&&this.toggleCalendar(a,b)},radioCalendar:function(a){for(var b,c=0,d=Extensible.calendar.data.CalendarMappings.CalendarId.name,e=this.store.getRange(),f=e.length;c<f;c++)b=e[c].data[d],b==a?this.showCalendar(b,!1):this.hideCalendar(b,!1);this.skipRefresh=!0,this.store.sync(),delete this.skipRefresh,this.refresh()},onMouseOver:function(a,b){Ext.fly(b).addCls("hover")},onMouseOut:function(a,b){Ext.fly(b).removeCls("hover")},getCalendarId:function(a){return a.id.split("__")[1]},getCalendarItemEl:function(a){return Ext.get(this.id+"__"+a)},onClick:function(a,b){var c;(c=a.getTarget(this.menuSelector,3,!0))?this.showEventMenu(c,a.getXY()):(c=a.getTarget("li",3,!0))&&this.toggleCalendar(this.getCalendarId(c))},handleColorChange:function(a,b,c,d){var e=this.store.findRecord(Extensible.calendar.data.CalendarMappings.CalendarId.name,b);e.data[Extensible.calendar.data.CalendarMappings.ColorId.name]=c,e.commit()},handleRadioCalendar:function(a,b){this.radioCalendar(b)},showEventMenu:function(a,b){var c=this.getCalendarId(a.parent("li")),d=this.store.findRecord(Extensible.calendar.data.CalendarMappings.CalendarId.name,c);colorId=d.data[Extensible.calendar.data.CalendarMappings.ColorId.name],this.menu||(this.menu=Ext.create("Extensible.calendar.gadget.CalendarListMenu"),this.menu.on("colorchange",this.handleColorChange,this),this.menu.on("radiocalendar",this.handleRadioCalendar,this)),this.menu.setCalendar(c,colorId),this.menu.showAt(b)}}),Ext.define("PTS.view.controls.GridForm",{extend:"Ext.form.Panel",alias:"widget.gridform",requires:[],layout:"border",bodyPadding:0,syncOnRemoveRow:!0,detailTitle:"Details",addRow:function(a){var b=a.up("gridform"),c=b.down("gridpanel").getStore(),d=c.getProxy().getModel(),e=Ext.create(d);b.loadRecord(e),b.fireEvent("loadrecord",e),b.down("#formpanel").enable()},saveRow:function(a){var b=a.up("gridform"),c=b.getRecord(),d=b.down("#formpanel").getEl(),e=b.down("gridpanel"),f=e.getStore();!1!==b.fireEvent("beforesaverow",c,f)&&(d.mask("Saving..."),b.getForm().updateRecord(c),c.save({success:function(a,c){var g=f.indexOfId(a.getId()),h=e.getSelectionModel();b.loadRecord(a),-1===g?(f.add(a),h.select(a)):(f.removeAt(g),f.insert(g,a),h.select(g)),d.unmask()},failure:function(a,b){d.unmask(),Ext.create("widget.uxNotification",{title:"Error",iconCls:"ux-notification-icon-error",html:"There was an error saving the link.</br>Error: "+PTS.app.getError()}).show()},scope:this}))},removeRow:function(a){var b=a.up("gridform"),c=b.down("gridpanel"),d=c.getEl(),e=c.getStore(),f=c.getView().getSelectionModel().getSelection()[0];!1!==b.fireEvent("beforeremoverow",f,e)&&(f&&e.remove(f),e.getBatchListeners=function(){var a=e,b=f,c={scope:a,exception:function(a,c){var f;d.unmask(),"destroy"===c.action&&(f=c.records[0],f.reject(),Ext.Array.remove(e.removed,f),e.insert(b.index,f))}};return"operation"===a.batchUpdateMode?c.operationcomplete=a.onBatchOperationComplete:c.complete=a.onBatchComplete,c},!f.phantom&&b.syncOnRemoveRow?(d.mask("Deleting..."),e.sync({success:function(){d.unmask(),b.down("#formpanel").disable(),b.fireEvent("removerow",f,e)}})):b.fireEvent("beforeremoverow",f,e))},initComponent:function(){var a=this;Ext.applyIf(a,{fieldDefaults:{labelAlign:"left",msgTarget:"side"},items:[{xtype:"gridpanel",region:"center",autoScroll:!0,store:a.store,columns:a.columns,viewConfig:a.gridViewConfig,dockedItems:[{xtype:"pagingtoolbar",store:a.store,dock:"top",displayInfo:!0,plugins:[Ext.create("Ext.ux.grid.PrintGrid",{printHidden:!0}),Ext.create("Ext.ux.grid.SaveGrid",{})]}],listeners:{selectionchange:function(a,b){var c=b[0],d=0===b.length;if(c){var e=this.up("form");e.getForm().loadRecord(c),e.fireEvent("loadrecord",c)}this.up("gridform").down("#removeRow").setDisabled(d),this.up("gridform").down("#formpanel").setDisabled(d)},viewready:function(a){a.getStore().count()>0&&a.getSelectionModel().select(0)}}},{flex:1,bodyPadding:10,xtype:"panel",itemId:"formpanel",region:"south",disabled:!0,split:!0,title:a.detailTitle,layout:"anchor",defaults:{anchor:"70%",labelWidth:90,allowBlank:!1},defaultType:"textfield",items:a.fields,tbar:[{xtype:"button",text:"Save",iconCls:"pts-menu-savebasic",formBind:!0,handler:this.saveRow}]}],tbar:[{text:"Add",iconCls:"pts-menu-addbasic",handler:this.addRow},{itemId:"removeRow",text:"Remove",iconCls:"pts-menu-deletebasic",handler:this.removeRow,disabled:!0}]}),Ext.each(a.extraButtons,function(b){a.tbar.push(b)}),a.callParent(arguments),a.addEvents("loadform","beforesaverow","beforeremoverow","removerow")}}),Ext.define("PTS.view.product.window.ProductLinks",{extend:"PTS.view.controls.GridForm",alias:"widget.productlinks",requires:["Ext.button.Button","Ext.toolbar.Toolbar"],title:"Links",detailTitle:"Link Details",store:"OnlineResources",initComponent:function(){var a=this;Ext.applyIf(a,{columns:[{text:"Title",flex:2,sortable:!0,dataIndex:"title"},{text:"Link (URL)",flex:3,sortable:!0,dataIndex:"uri"},{text:"Function",flex:1,sortable:!0,dataIndex:"onlinefunctionid",renderer:function(a,b,c,d,e,f,g){var h=Ext.getStore("OnlineFunctions").findRecord("onlinefunctionid",a,0,!1,!0,!0);return h?h.get("codename"):a}}],fields:[{fieldLabel:"Title",name:"title"},{fieldLabel:"Link (URL)",name:"uri",vtype:"url",emptyText:"http://"},{fieldLabel:"Function",name:"onlinefunctionid",xtype:"combobox",displayField:"codename",listConfig:{getInnerTpl:function(){return"<div>{codename}: {description}</div>"}},store:"OnlineFunctions",valueField:"onlinefunctionid",forceSelection:!0,allowBlank:!1,queryMode:"local",anchor:"100%"},{fieldLabel:"Description",xtype:"textareafield",name:"description",allowBlank:!1,grow:!0,growMin:80,anchor:"100%"}]}),a.callParent(arguments)}}),Ext.define("PTS.store.GroupUsers",{extend:"Ext.data.Store",model:"PTS.model.GroupUser",autoLoad:!1}),Ext.define("PTS.view.product.window.ProductSteps",{extend:"PTS.view.controls.GridForm",alias:"widget.productsteps",requires:["Ext.button.Button","Ext.toolbar.Toolbar","Ext.grid.plugin.DragDrop"],title:"Process Steps",detailTitle:"Step Details",store:"ProductSteps",gridViewConfig:{plugins:[{ptype:"gridviewdragdrop",pluginId:"stepsddplugin"}]},initComponent:function(){var a=this;Ext.applyIf(a,{columns:[{text:"#",sortable:!1,dataIndex:"priority"},{text:"Description",flex:2,sortable:!1,dataIndex:"description"},{text:"Date",xtype:"datecolumn",flex:1,sortable:!1,dataIndex:"stepdate"}],fields:[{fieldLabel:"Priority",name:"priority",disabled:!0,minValue:0,maxWidth:150},{fieldLabel:"Description",xtype:"textareafield",name:"description",allowBlank:!1,grow:!0,growMin:80,anchor:"100%"},{fieldLabel:"Rationale",xtype:"textareafield",name:"rationale",allowBlank:!1,grow:!0,growMin:80,anchor:"100%"},{fieldLabel:"Date",name:"stepdate",xtype:"datefield",maxWidth:250},{fieldLabel:"Processor",name:"productcontactid",xtype:"combobox",displayField:"namerole",store:"ProductContacts",valueField:"productcontactid",forceSelection:!0,allowBlank:!1,queryMode:"local",anchor:"50%"}]}),a.callParent(arguments)}}),Ext.define("Ext.ux.form.ItemSelector",{extend:"Ext.ux.form.MultiSelect",alias:["widget.itemselectorfield","widget.itemselector"],alternateClassName:["Ext.ux.ItemSelector"],requires:["Ext.ux.layout.component.form.ItemSelector","Ext.button.Button"],hideNavIcons:!1,buttons:["top","up","add","remove","down","bottom"],buttonsText:{top:"Move to Top",up:"Move Up",add:"Add to Selected",remove:"Remove from Selected",down:"Move Down",bottom:"Move to Bottom"},multiselects:[],innerAlign:"middle",componentLayout:"itemselectorfield",fieldBodyCls:Ext.baseCSSPrefix+"form-itemselector-body",bindStore:function(a,b){var c,d=this,e=d.toField,f=d.fromField;d.callParent(arguments),e&&(e.store.removeAll(),f.store.removeAll(),c=[],d.store.each(function(a){c.push(a.copy(a.getId()))}),f.store.add(c))},onRender:function(a,b){var c,d=this,e=Ext.baseCSSPrefix,f="ItemSelectorDD-"+Ext.id(),g={displayField:d.displayField,valueField:d.valueField,dragGroup:f,dropGroup:f,flex:1,hideLabel:!0,disabled:d.disabled},h=Ext.apply({listTitle:"Available",store:Ext.create("Ext.data.Store",{model:d.store.model}),listeners:{boundList:{itemdblclick:d.onItemDblClick,scope:d}}},d.multiselects[0],g),i=Ext.apply({listTitle:"Selected",store:Ext.create("Ext.data.Store",{model:d.store.model}),listeners:{boundList:{itemdblclick:d.onItemDblClick,scope:d},change:d.onToFieldChange,scope:d}},d.multiselects[1],g),j=Ext.widget("multiselect",h),k=Ext.widget("multiselect",i),l=[];Ext.ux.form.MultiSelect.superclass.onRender.call(d,a,b),d.fromField=j,d.toField=k,d.hideNavIcons||Ext.Array.forEach(d.buttons,function(a){l.push({xtype:"button",tooltip:d.buttonsText[a],handler:d["on"+Ext.String.capitalize(a)+"BtnClick"],cls:e+"form-itemselector-btn",iconCls:e+"form-itemselector-"+a,scope:d}),l.push({xtype:"component",height:3,width:1,style:"font-size:0;line-height:0"})}),c=d.innerCt=Ext.widget("container",{renderTo:d.bodyEl,layout:{type:"hbox",align:d.innerAlign},items:[d.fromField,{xtype:"container",layout:"stretch"===d.innerAlign?{type:"vbox",pack:"center",align:"center"}:void 0,margins:"0 4",items:l},d.toField]}),c.ownerCt=d,d.bindStore(d.store),d.setRawValue(d.rawValue)},onToFieldChange:function(){this.checkChange()},getSelections:function(a){
var b=a.getStore(),c=a.getSelectionModel().getSelection();c.length;return Ext.Array.sort(c,function(a,c){return a=b.indexOf(a),c=b.indexOf(c),a<c?-1:a>c?1:0})},onTopBtnClick:function(){var a=this.toField.boundList,b=a.getStore(),c=this.getSelections(a),d=c.length-1;for(b.suspendEvents();d>-1;--d)c[d],b.remove(c),b.insert(0,c);b.resumeEvents(),a.refresh()},onBottomBtnClick:function(){var a,b=this.toField.boundList,c=b.getStore(),d=this.getSelections(b),e=0,f=d.length;for(c.suspendEvents();e<f;++e)a=d[e],c.remove(a),c.add(a);c.resumeEvents(),b.refresh()},onUpBtnClick:function(){var a,b,c=this.toField.boundList,d=c.getStore(),e=this.getSelections(c),f=0,g=e.length;for(d.suspendEvents();f<g;++f)a=e[f],b=Math.max(0,d.indexOf(a)-1),d.remove(a),d.insert(b,a);d.resumeEvents(),c.refresh()},onDownBtnClick:function(){var a,b,c=this.toField.boundList,d=c.getStore(),e=this.getSelections(c),f=0,g=e.length,h=d.getCount();for(d.suspendEvents();f<g;++f)a=e[f],b=Math.min(h,d.indexOf(a)+1),d.remove(a),d.insert(b,a);d.resumeEvents(),c.refresh()},onAddBtnClick:function(){var a=this,b=a.fromField.boundList,c=this.getSelections(b);b.getStore().remove(c),this.toField.boundList.getStore().add(c)},onRemoveBtnClick:function(){var a=this,b=a.toField.boundList,c=this.getSelections(b);b.getStore().remove(c),this.fromField.boundList.getStore().add(c)},onItemDblClick:function(a){var b=this;a==b.toField.boundList?b.onRemoveBtnClick():a==b.fromField.boundList&&b.onAddBtnClick()},setRawValue:function(a){var b,c,d,e=this,f=Ext.Array;return a=f.from(a),e.rawValue=a,e.toField&&(b=e.toField.boundList.getStore(),c=e.fromField.boundList.getStore(),c.add(b.getRange()),b.removeAll(),d=[],Ext.Array.forEach(a,function(a){var b=c.findRecord(e.valueField,a,void 0,void 0,!0,!0);b&&d.push(b)}),c.remove(d),b.add(d)),a},getRawValue:function(){var a=this,b=a.toField,c=a.rawValue;return b&&(c=Ext.Array.map(b.boundList.getStore().getRange(),function(b){return b.get(a.valueField)})),a.rawValue=c,c},updateReadOnly:function(){var a=this,b=a.readOnly||a.disabled;a.rendered&&(a.toField.setReadOnly(b),a.fromField.setReadOnly(b),Ext.Array.forEach(a.innerCt.query("button"),function(a){a.setDisabled(b)}))},onDisable:function(){this.callParent();var a=this.fromField;a&&(a.disable(),this.toField.disable())},onEnable:function(){this.callParent();var a=this.fromField;a&&(a.enable(),this.toField.enable())},onDestroy:function(){Ext.destroyMembers(this,"innerCt"),this.callParent()}}),Ext.define("Extensible.calendar.dd.DragZone",{extend:"Ext.dd.DragZone",requires:["Extensible.calendar.dd.StatusProxy","Extensible.calendar.data.EventMappings"],ddGroup:"CalendarDD",eventSelector:".ext-cal-evt",constructor:function(a,b){Extensible.calendar._statusProxyInstance||(Extensible.calendar._statusProxyInstance=Ext.create("Extensible.calendar.dd.StatusProxy")),this.proxy=Extensible.calendar._statusProxyInstance,this.callParent(arguments)},getDragData:function(a){var b=a.getTarget(this.eventSelector,3);if(b){var c=this.view.getEventRecordFromEl(b);if(!c)return;return{type:"eventdrag",ddel:b,eventStart:c.data[Extensible.calendar.data.EventMappings.StartDate.name],eventEnd:c.data[Extensible.calendar.data.EventMappings.EndDate.name],proxy:this.proxy}}return b=this.view.getDayAt(a.getX(),a.getY()),b.el?{type:"caldrag",start:b.date,proxy:this.proxy}:null},onInitDrag:function(a,b){if(this.dragData.ddel){var c=this.dragData.ddel.cloneNode(!0),d=Ext.fly(c).down("dl");Ext.fly(c).setWidth("auto"),d&&d.setHeight("auto"),this.proxy.update(c),this.onStartDrag(a,b)}else this.dragData.start&&this.onStartDrag(a,b);return this.view.onInitDrag(),!0},afterRepair:function(){Ext.enableFx&&this.dragData.ddel&&Ext.Element.fly(this.dragData.ddel).highlight(this.hlColor||"c3daf9"),this.dragging=!1},getRepairXY:function(a){if(this.dragData.ddel)return Ext.Element.fly(this.dragData.ddel).getXY()},afterInvalidDrop:function(a,b){Ext.select(".ext-dd-shim").hide()},destroy:function(){this.callParent(arguments),delete Extensible.calendar._statusProxyInstance}}),Ext.define("PTS.view.controls.MetadataPanel",{extend:"Ext.panel.Panel",alias:"widget.metadatapanel",requires:["Ext.button.Button","Ext.button.Cycle","Ext.toolbar.Toolbar"],layout:"card",title:"Metadata",defaults:{border:!1,autoScroll:!0,bodyPadding:10},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"panel",layout:"fit",dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",iconCls:"pts-menu-savebasic",text:"Save",action:"save",disabled:!0},{xtype:"button",iconCls:"pts-menu-reset",text:"Reset",action:"reset"},"->",{xtype:"button",iconCls:"pts-menu-json",text:"Preview JSON",action:"json"},{xtype:"button",iconCls:"pts-menu-code",text:"Preview XML",action:"xml"},{xtype:"button",iconCls:"pts-menu-code",text:"Preview HTML",action:"html"},{xtype:"cycle",itemId:"publishBtn",showText:!0,menu:{items:[{iconCls:"pts-menu-publish",text:"Publish",action:"DELETE"},{iconCls:"pts-menu-unpublish",text:"Unpublish",action:"PUT"}]}}]}],items:a.formItems},{xtype:"panel",layout:"fit",dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",iconCls:"pts-arrow-left",text:"Back",action:"goback"},{xtype:"button",iconCls:"pts-menu-add",text:"Open in Window",action:"openpreview"}]}],items:[{xtype:"component",itemId:"metadataPreview",autoEl:{tag:"pre",children:[{tag:"code"}],style:"border:0;"}}]}]}),a.callParent(arguments)}}),Ext.define("PTS.view.product.window.ProductMetadata",{extend:"PTS.view.controls.MetadataPanel",alias:"widget.productmetadata",title:"Metadata"}),Ext.define("GeoExt.slider.Tip",{extend:"Ext.slider.Tip",alternateClassName:"GeoExt.SliderTip",hover:!0,minWidth:10,offsets:[0,-10],dragging:!1,init:function(a){this.callParent(arguments),this.hover&&a.on("render",this.registerThumbListeners,this),this.slider=a},registerThumbListeners:function(){for(var a,b,c=0,d=this.slider.thumbs.length;c<d;++c)a=this.slider.thumbs[c],b=a.tracker.el,function(a,b){b.on({mouseover:function(b){this.onSlide(this.slider,b,a),this.dragging=!1},mouseout:function(){this.dragging||this.hide.apply(this,arguments)},scope:this})}.apply(this,[a,b])},onSlide:function(a,b,c){return this.dragging=!0,this.callParent(arguments)}}),Ext.define("GeoExt.data.LayerStore",{requires:["GeoExt.data.LayerModel"],extend:"Ext.data.Store",model:"GeoExt.data.LayerModel",statics:{MAP_TO_STORE:1,STORE_TO_MAP:2},map:null,constructor:function(a){var b=this;a=Ext.apply({},a);var c=GeoExt.MapPanel&&a.map instanceof GeoExt.MapPanel?a.map.map:a.map;delete a.map,a.layers&&(a.data=a.layers),delete a.layers;var d={initDir:a.initDir};delete a.initDir,b.callParent([a]),c&&this.bind(c,d)},bind:function(a,b){var c=this;if(!c.map){c.map=a,b=Ext.apply({},b);var d=b.initDir;void 0==b.initDir&&(d=GeoExt.data.LayerStore.MAP_TO_STORE|GeoExt.data.LayerStore.STORE_TO_MAP);var e=a.layers.slice(0);d&GeoExt.data.LayerStore.STORE_TO_MAP&&c.each(function(a){c.map.addLayer(a.getLayer())},c),d&GeoExt.data.LayerStore.MAP_TO_STORE&&c.loadRawData(e,!0),a.events.on({changelayer:c.onChangeLayer,addlayer:c.onAddLayer,removelayer:c.onRemoveLayer,scope:c}),c.on({load:c.onLoad,clear:c.onClear,add:c.onAdd,remove:c.onRemove,update:c.onUpdate,scope:c}),c.data.on({replace:c.onReplace,scope:c}),c.fireEvent("bind",c,a)}},unbind:function(){var a=this;a.map&&(a.map.events.un({changelayer:a.onChangeLayer,addlayer:a.onAddLayer,removelayer:a.onRemoveLayer,scope:a}),a.un("load",a.onLoad,a),a.un("clear",a.onClear,a),a.un("add",a.onAdd,a),a.un("remove",a.onRemove,a),a.data.un("replace",a.onReplace,a),a.map=null)},onChangeLayer:function(a){var b=a.layer,c=this.findBy(function(a,c){return a.getLayer()===b});if(c>-1){var d=this.getAt(c);if("order"===a.property){if(!this._adding&&!this._removing){var e=this.map.getLayerIndex(b);e!==c&&(this._removing=!0,this.remove(d),delete this._removing,this._adding=!0,this.insert(e,[d]),delete this._adding)}}else"name"===a.property?d.set("title",b.name):this.fireEvent("update",this,d,Ext.data.Record.EDIT)}},onAddLayer:function(a){var b=this;if(!b._adding){b._adding=!0;var c=b.proxy.reader.read(a.layer);b.add(c.records),delete b._adding}},onRemoveLayer:function(a){if(this.map.unloadDestroy){if(!this._removing){var b=a.layer;this._removing=!0,this.remove(this.getByLayer(b)),delete this._removing}}else this.unbind()},onLoad:function(a,b,c){if(c){if(Ext.isArray(b)||(b=[b]),!this._addRecords){this._removing=!0;for(var d=this.map.layers.length-1;d>=0;d--)this.map.removeLayer(this.map.layers[d]);delete this._removing}var e=b.length;if(e>0){for(var f=new Array(e),g=0;g<e;g++)f[g]=b[g].getLayer();this._adding=!0,this.map.addLayers(f),delete this._adding}}delete this._addRecords},onClear:function(a){this._removing=!0;for(var b=this.map.layers.length-1;b>=0;b--)this.map.removeLayer(this.map.layers[b]);delete this._removing},onAdd:function(a,b,c){if(!this._adding){this._adding=!0;for(var d,e=b.length-1;e>=0;--e)d=b[e].getLayer(),this.map.addLayer(d),c!==this.map.layers.length-1&&this.map.setLayerIndex(d,c);delete this._adding}},onRemove:function(a,b,c){if(!this._removing){var d=b.getLayer();null!=this.map.getLayer(d.id)&&(this._removing=!0,this.removeMapLayer(b),delete this._removing)}},onUpdate:function(a,b,c){if(c===Ext.data.Record.EDIT&&b.modified&&b.modified.title){var d=b.getLayer(),e=b.get("title");e!==d.name&&d.setName(e)}},removeMapLayer:function(a){this.map.removeLayer(a.getLayer())},onReplace:function(a,b,c){this.removeMapLayer(b)},getByLayer:function(a){var b=this.findBy(function(b){return b.getLayer()===a});if(b>-1)return this.getAt(b)},destroy:function(){var a=this;a.unbind(),a.callParent()},loadRecords:function(a,b){b&&b.addRecords&&(this._addRecords=!0),this.callParent(arguments)}}),Ext.define("GeoExt.panel.Map",{extend:"Ext.panel.Panel",requires:["GeoExt.data.LayerStore"],alias:"widget.gx_mappanel",alternateClassName:"GeoExt.MapPanel",statics:{guess:function(){var a=Ext.ComponentQuery.query("gx_mappanel");return a&&a.length>0?a[0]:null}},center:null,zoom:null,extent:null,prettyStateKeys:!1,map:null,layers:null,stateEvents:["aftermapmove","afterlayervisibilitychange","afterlayeropacitychange","afterlayerorderchange","afterlayernamechange","afterlayeradd","afterlayerremove"],initComponent:function(){this.map instanceof OpenLayers.Map||(this.map=new OpenLayers.Map(Ext.applyIf(this.map||{},{allOverlays:!0})));var a=this.layers;(!a||a instanceof Array)&&(this.layers=Ext.create("GeoExt.data.LayerStore",{layers:a,map:this.map.layers.length>0?this.map:null})),Ext.isString(this.center)?this.center=OpenLayers.LonLat.fromString(this.center):Ext.isArray(this.center)&&(this.center=new OpenLayers.LonLat(this.center[0],this.center[1])),Ext.isString(this.extent)?this.extent=OpenLayers.Bounds.fromString(this.extent):Ext.isArray(this.extent)&&(this.extent=OpenLayers.Bounds.fromArray(this.extent)),this.callParent(arguments),this.on("resize",this.onResize,this),this.on("afterlayout",function(){"function"==typeof this.map.getViewport&&this.items.each(function(a){"function"==typeof a.addToMapPanel&&a.getEl().appendTo(this.map.getViewport())},this)},this),this.map.events.on({moveend:this.onMoveend,changelayer:this.onChangelayer,addlayer:this.onAddlayer,removelayer:this.onRemovelayer,scope:this})},onMoveend:function(a){this.fireEvent("aftermapmove",this,this.map,a)},onChangelayer:function(a){var b=this.map;a.property&&("visibility"===a.property?this.fireEvent("afterlayervisibilitychange",this,b,a):"order"===a.property?this.fireEvent("afterlayerorderchange",this,b,a):"nathis"===a.property?this.fireEvent("afterlayernathischange",this,b,a):"opacity"===a.property&&this.fireEvent("afterlayeropacitychange",this,b,a))},onAddlayer:function(){this.fireEvent("afterlayeradd")},onRemovelayer:function(){this.fireEvent("afterlayerremove")},onResize:function(){var a=this.map;this.body.dom!==a.div?(a.render(this.body.dom),this.layers.bind(a),a.layers.length>0?this.setInitialExtent():this.layers.on("add",this.setInitialExtent,this,{single:!0})):a.updateSize()},setInitialExtent:function(){var a=this.map;a.getCenter()||(this.center||this.zoom?a.setCenter(this.center,this.zoom):this.extent instanceof OpenLayers.Bounds?a.zoomToExtent(this.extent,!0):a.zoomToMaxExtent())},getState:function(){var a,b=this,c=b.map,d=b.callParent(arguments)||{};if(c){var e=c.getCenter();return e&&Ext.applyIf(d,{x:e.lon,y:e.lat,zoom:c.getZoom()}),b.layers.each(function(c){a=c.getLayer(),layerId=this.prettyStateKeys?c.get("title"):c.get("id"),d=b.addPropertyToState(d,"visibility_"+layerId,a.getVisibility()),d=b.addPropertyToState(d,"opacity_"+layerId,null===a.opacity?1:a.opacity)},b),d}},applyState:function(a){var b=this;map=b.map,b.center=new OpenLayers.LonLat(a.x,a.y),b.zoom=a.zoom;var c,d,e,f,g,h,i=map.layers;for(c=0,d=i.length;c<d;c++)e=i[c],f=b.prettyStateKeys?e.name:e.id,g=a["visibility_"+f],void 0!==g&&(g=/^true$/i.test(g),e.isBaseLayer?g&&map.setBaseLayer(e):e.setVisibility(g)),void 0!==(h=a["opacity_"+f])&&e.setOpacity(h)},onBeforeAdd:function(a){Ext.isFunction(a.addToMapPanel)&&a.addToMapPanel(this),this.callParent(arguments)},beforeDestroy:function(){this.map&&this.map.events&&this.map.events.un({moveend:this.onMoveend,changelayer:this.onChangelayer,scope:this}),this.initialConfig.map&&this.initialConfig.map instanceof OpenLayers.Map||this.map&&this.map.destroy&&this.map.destroy(),delete this.map,this.callParent(arguments)}}),Ext.define("PTS.view.dashboard.DeliverableList",{extend:"Ext.grid.Panel",alias:"widget.deliverablelist",requires:["Ext.ux.grid.PrintGrid","Ext.ux.grid.SaveGrid"],autoScroll:!0,title:"Deliverables",store:"DeliverableListings",initFilter:"over",initComponent:function(){var a=this;Ext.applyIf(a,{viewConfig:{},dockedItems:[{xtype:"pagingtoolbar",store:a.store,dock:"top",displayInfo:!0,plugins:[Ext.create("Ext.ux.grid.PrintGrid",{title:function(){return this.child("cycle#filter").getActiveItem().text+" Deliverables"},printHidden:!0}),Ext.create("Ext.ux.grid.SaveGrid",{})],items:["-",{xtype:"cycle",itemId:"filter",showText:!0,action:"filterdeliverable",tooltip:"Click to filter the Deliverables",menu:{xtype:"menu",width:120,items:[{iconCls:"pts-flag-red",text:"Past Due",filter:"over",checked:"over"===a.initFilter},{iconCls:"pts-flag-orange",text:"Due Soon",filter:"soon",checked:"soon"===a.initFilter},{iconCls:"pts-flag-green",text:"Incomplete",filter:"incomplete",checked:"incomplete"===a.initFilter},{iconCls:"pts-flag-white",text:"All",filter:"all",checked:"all"===a.initFilter},{iconCls:"pts-flag-gray",text:"Completed",filter:"complete",checked:"complete"===a.initFilter},{iconCls:"pts-flag-purple",text:"Not Completed",filter:"notcompleted",checked:"notcompleted"===a.initFilter},{iconCls:"pts-cross",text:"Undelivered",filter:"undelivered",checked:"undelivered"===a.initFilter}]}}]}],columns:[{xtype:"gridcolumn",width:75,dataIndex:"duedate",text:"Due Date",renderer:function(a,b,c,d,e,f,g){var h=Ext.util.Format.date(a);return c.get("dayspastdue")>0?'<span style="color:red;">'+h+"</span>":h}},{xtype:"gridcolumn",dataIndex:"title",flex:2,text:"Title"},{xtype:"gridcolumn",dataIndex:"projectcode",text:"Project"},{xtype:"gridcolumn",dataIndex:"project",text:"Project Title",flex:2},{xtype:"gridcolumn",dataIndex:"status",text:"Status"},{xtype:"gridcolumn",dataIndex:"dayspastdue",text:"Past Due",width:70,renderer:function(a,b,c,d,e,f,g){return a>0?'<span style="color:#FF0000;">'+a+"</span>":a}},{xtype:"gridcolumn",dataIndex:"contact",hidden:!0,text:"Contact"},{xtype:"gridcolumn",dataIndex:"email",hidden:!0,text:"E-mail",renderer:function(a){return a?'<a href="mailto:'+a+'">'+a+"</a>":""}},{xtype:"gridcolumn",dataIndex:"agreementnumber",hidden:!0,text:"Agreement"},{xtype:"gridcolumn",dataIndex:"staffcomments",hidden:!0,text:"Staff Comments"},{text:"Period",hidden:!0,columns:[{xtype:"datecolumn",dataIndex:"startdate",text:"Start",hidden:!0,width:75,sortable:!0},{xtype:"datecolumn",dataIndex:"enddate",text:"End",hidden:!0,width:75,sortable:!0}]},{xtype:"booleancolumn",dataIndex:"reminder",hidden:!0,sortable:!1,text:"Reminder?",width:65},{xtype:"booleancolumn",dataIndex:"staffonly",hidden:!0,sortable:!1,text:"Staff Only?",width:65}]}),a.callParent(arguments)}}),Ext.define("PTS.view.dashboard.TaskList",{extend:"Ext.grid.Panel",alias:"widget.tasklist",requires:["Ext.ux.grid.PrintGrid","Ext.ux.grid.SaveGrid"],autoScroll:!0,title:"Tasks",store:"Tasks",initComponent:function(){var a=this;Ext.applyIf(a,{viewConfig:{},dockedItems:[{xtype:"pagingtoolbar",store:"Tasks",dock:"top",displayInfo:!0,plugins:[Ext.create("Ext.ux.grid.PrintGrid",{title:function(){return this.child("cycle#filter").getActiveItem().text+" (Tasks)"}}),Ext.create("Ext.ux.grid.SaveGrid",{})],items:["-",{xtype:"cycle",itemId:"filter",showText:!0,action:"filtertask",tooltip:"Click to filter the Tasks",menu:{xtype:"menu",width:120,items:[{iconCls:"pts-menu-users",text:"Show All",filter:"all"},{iconCls:"pts-menu-user",text:"Show Mine",filter:"user"},{iconCls:"pts-menu-exclamation",text:"Due Today",filter:"today"}]}},"-",{xtype:"button",action:"togglecomplete",text:"Completed",enableToggle:"true",iconCls:"pts-btn-check",tooltip:"Include completed tasks"}]}],columns:[{xtype:"datecolumn",width:83,dataIndex:"duedate",text:"Due Date"},{xtype:"gridcolumn",dataIndex:"assignee",text:"Assignee"},{xtype:"gridcolumn",dataIndex:"title",flex:1,text:"Title"},{xtype:"gridcolumn",dataIndex:"status",text:"Status"},{xtype:"gridcolumn",dataIndex:"shorttitle",flex:1,text:"Project"},{xtype:"gridcolumn",dataIndex:"projectcode",hidden:!0,text:"Project Code"}]}),a.callParent(arguments)}}),Ext.define("PTS.view.controls.MyFieldContainer",{extend:"Ext.form.FieldContainer",mixins:{checkDirty:"PTS.util.mixin.CheckDirty"},alias:"widget.myfieldcontainer",initComponent:function(){this.callParent(arguments)}}),Ext.define("Ext.ux.CheckColumn",{extend:"Ext.grid.column.Column",alias:"widget.checkcolumn",constructor:function(){this.addEvents("checkchange"),this.callParent(arguments)},processEvent:function(a,b,c,d,e,f){if("mousedown"==a||"keydown"==a&&(f.getKey()==f.ENTER||f.getKey()==f.SPACE)){var g=b.panel.store.getAt(d),h=this.dataIndex,i=!g.get(h);return g.set(h,i),this.fireEvent("checkchange",this,d,i),!1}return this.callParent(arguments)},renderer:function(a){var b=Ext.baseCSSPrefix,c=[b+"grid-checkheader"];return a&&c.push(b+"grid-checkheader-checked"),'<div class="'+c.join(" ")+'">&#160;</div>'}}),Ext.define("PTS.view.controls.RowEditGrid",{extend:"Ext.grid.Panel",alias:"widget.roweditgrid",requires:["Ext.grid.plugin.RowEditing"],bodyPadding:0,syncOnRemoveRow:!0,addRow:function(a){var b=a.up("gridpanel"),c=b.getStore(),d=c.getProxy().getModel(),e=b.getPlugin("roweditplugin");c.insert(0,Ext.create(d)),e.startEdit(0,0)},removeRow:function(a){var b=a.up("gridpanel"),c=b.getEl(),d=b.getStore(),e=b.getView().getSelectionModel().getSelection()[0];!1!==b.fireEvent("beforeremoverow",e,d)&&(e&&d.remove(e),d.getBatchListeners=function(){var a=d,b=e,f={scope:a,exception:function(a,e){var f;c.unmask(),"destroy"===e.action&&(f=e.records[0],f.reject(),Ext.Array.remove(d.removed,f),d.insert(b.index,f))}};return"operation"===a.batchUpdateMode?f.operationcomplete=a.onBatchOperationComplete:f.complete=a.onBatchComplete,f},!e.phantom&&b.syncOnRemoveRow?(c.mask("Deleting..."),d.sync({success:function(){c.unmask(),b.fireEvent("removerow",e,d)}})):b.fireEvent("beforeremoverow",e,d))},initComponent:function(){var a=this;Ext.applyIf(a,{plugins:[Ext.create("Ext.grid.plugin.RowEditing",{clicksToEdit:1,autoCancel:!1,errorSummary:!1,pluginId:"roweditplugin"})],tbar:[{text:"Add",iconCls:"pts-menu-addbasic",handler:this.addRow},{itemId:"removeRow",text:"Remove",iconCls:"pts-menu-deletebasic",handler:this.removeRow,disabled:!0}]}),Ext.each(a.extraButtons,function(b){a.tbar.push(b)}),a.callParent(arguments),a.addEvents("beforeremoverow","removerow"),a.getSelectionModel().on("selectionchange",function(b,c){a.down("#removeRow").setDisabled(0===c.length)})}}),Ext.define("PTS.view.controls.PhoneFieldContainer",{extend:"PTS.view.controls.MyFieldContainer",alias:"widget.phonefieldcontainer",requires:["Ext.form.field.Display"],deleteCheckBox:"delete",deleteCheckBoxAction:function(a,b,c){var d=b?"#C62415":"inherit";a.ownerCt.getEl().setStyle({color:d})},initComponent:function(){var a=this,b=[{xtype:"displayfield",value:"(",flex:0},{xtype:"numberfield",margin:"0 1",width:50,name:"areacode",hideTrigger:!0,minValue:0,allowBlank:!1},{xtype:"displayfield",value:")",flex:0},{xtype:"numberfield",margin:"0 1",width:150,name:"phnumber",hideTrigger:!0,minValue:0,allowBlank:!1},{xtype:"numberfield",margin:"0 15 0 0",width:105,name:"extension",fieldLabel:"Ext",labelAlign:"right",labelWidth:50,hideTrigger:!0},{xtype:"countrycombo",name:"countryiso",fieldLabel:"Country",labelAlign:"right",labelWidth:50,flex:1,allowBlank:!1},{xtype:"hiddenfield",itemId:"recordId",name:"phoneid"}];a.deleteCheckBox&&b.push({xtype:"checkboxfield",itemId:a.deleteCheckBox,disabled:!0,hideEmptyLabel:!1,boxLabel:"Delete",labelWidth:10,listeners:{change:this.deleteCheckBoxAction}}),Ext.applyIf(a,{items:b}),a.callParent(arguments)}}),Ext.define("Ext.ux.form.SearchField",{extend:"Ext.form.field.Trigger",alias:"widget.searchfield",trigger1Cls:Ext.baseCSSPrefix+"form-clear-trigger",trigger2Cls:Ext.baseCSSPrefix+"form-search-trigger",hasSearch:!1,paramName:"query",initComponent:function(){this.callParent(arguments),this.on("specialkey",function(a,b){b.getKey()==b.ENTER&&this.onTrigger2Click()},this)},afterRender:function(){this.callParent(),this.triggerEl.item(0).setDisplayed("none")},onTrigger1Click:function(){var a=this,b=a.store,c=b.getProxy();a.hasSearch&&(a.setValue(""),c.extraParams[a.paramName]="",c.extraParams.start=0,b.load(),a.hasSearch=!1,a.triggerEl.item(0).setDisplayed("none"),a.doComponentLayout())},onTrigger2Click:function(){var a=this,b=a.store,c=b.getProxy(),d=a.getValue();if(d.length<1)return void a.onTrigger1Click();c.extraParams[a.paramName]=d,c.extraParams.start=0,b.load(),a.hasSearch=!0,a.triggerEl.item(0).setDisplayed("block"),a.doComponentLayout()}}),Ext.define("GeoExt.Action",{extend:"Ext.Action",alias:"widget.gx_action",control:null,activateOnEnable:!1,deactivateOnDisable:!1,map:null,uScope:null,uHandler:null,uToggleHandler:null,uCheckHandler:null,constructor:function(a){this.uScope=a.scope,this.uHandler=a.handler,this.uToggleHandler=a.toggleHandler,this.uCheckHandler=a.checkHandler,a.scope=this,a.handler=this.pHandler,a.toggleHandler=this.pToggleHandler,a.checkHandler=this.pCheckHandler,this.control=a.control;var b=this.control;delete a.control,this.activateOnEnable=!!a.activateOnEnable,delete a.activateOnEnable,this.deactivateOnDisable=!!a.deactivateOnDisable,delete a.deactivateOnDisable,b&&(a.map&&(a.map.addControl(b),delete a.map),(a.pressed||a.checked)&&b.map&&b.activate(),b.active&&(a.pressed=!0,a.checked=!0),b.events.on({activate:this.onCtrlActivate,deactivate:this.onCtrlDeactivate,scope:this})),this.callParent(arguments)},pHandler:function(a){var b=this.control;b&&b.type==OpenLayers.Control.TYPE_BUTTON&&b.trigger(),this.uHandler&&this.uHandler.apply(this.uScope,arguments)},pToggleHandler:function(a,b){this.changeControlState(b),this.uToggleHandler&&this.uToggleHandler.apply(this.uScope,arguments)},pCheckHandler:function(a,b){this.changeControlState(b),this.uCheckHandler&&this.uCheckHandler.apply(this.uScope,arguments)},changeControlState:function(a){a?this._activating||(this._activating=!0,this.control.activate(),this.initialConfig.pressed=!0,this.initialConfig.checked=!0,this._activating=!1):this._deactivating||(this._deactivating=!0,this.control.deactivate(),this.initialConfig.pressed=!1,this.initialConfig.checked=!1,this._deactivating=!1)},onCtrlActivate:function(){this.control.type==OpenLayers.Control.TYPE_BUTTON?this.enable():(this.safeCallEach("toggle",[!0]),this.safeCallEach("setChecked",[!0]))},onCtrlDeactivate:function(){this.control.type==OpenLayers.Control.TYPE_BUTTON?this.disable():(this.safeCallEach("toggle",[!1]),this.safeCallEach("setChecked",[!1]))},safeCallEach:function(a,b){for(var c=this.items,d=0,e=c.length;d<e;d++)c[d][a]&&(c[d].rendered?c[d][a].apply(c[d],b):c[d].on({render:Ext.Function.bind(c[d][a],c[d],b),single:!0}))},setDisabled:function(a){return!a&&this.activateOnEnable&&this.control&&!this.control.active&&this.control.activate(),a&&this.deactivateOnDisable&&this.control&&this.control.active&&this.control.deactivate(),GeoExt.Action.superclass.setDisabled.apply(this,arguments)}}),Ext.define("PTS.view.controls.MapToolbar",{extend:"Ext.toolbar.Toolbar",alias:"widget.maptoolbar",requires:["GeoExt.Action","PTS.view.button.Edit","PTS.view.button.Save","PTS.view.button.Delete","PTS.view.button.Reset","Ext.button.Button","Ext.button.Split","Ext.menu.CheckItem","Ext.ux.StoreMenu"],map:null,vectorLayer:null,saveStrategy:null,refreshStrategy:null,commonStore:!1,maskCmp:!1,showMask:function(a){var b=this,c=!0===b.maskCmp?b.ownerCt:b.maskCmp,d=a||"Loading Project Features...";c&&c.getEl().mask(d)},unmask:function(){var a=this,b=!0===a.maskCmp?a.ownerCt:a.maskCmp;b&&b.getEl().unmask()},initComponent:function(){var a,b,c,d=this,e=d.map,f=d.vectorLayer,g=[];new OpenLayers.Control.SelectFeature(f,{id:"PTS-Select-Hover",hover:!0,highlightOnly:!0,renderIntent:"temporary",unhighlight:function(a){var b=a.layer;!1!==this.events.triggerEvent("beforefeatureunhighlighted",{feature:a})&&(void 0===a._prevHighlighter?delete a._lastHighlighter:a._prevHighlighter==this.id?delete a._prevHighlighter:(a._lastHighlighter=a._prevHighlighter,delete a._prevHighlighter),b.drawFeature(a,a.style||a.layer.style||"default"),this.events.triggerEvent("featureunhighlighted",{feature:a}))},outFeature:function(a){if(this.hover)if(this.highlightOnly){var b=this.events.triggerEvent("beforefeatureunhighlighted",{feature:a});if(!1!==b&&a._lastHighlighter==this.id)if(a._prevHighlighter&&a._prevHighlighter!=this.id){delete a._lastHighlighter;var c=this.map.getControl(a._prevHighlighter);c&&c.highlight(a)}else this.unhighlight(a)}else this.unselect(a)}}),a=new OpenLayers.Control.NavigationHistory,e.addControl(a),g.push(Ext.create("Ext.button.Button",Ext.create("GeoExt.Action",{iconCls:"pts-arrow-left",control:a.previous,disabled:!0,tooltip:"previous in history"}))),g.push(Ext.create("Ext.button.Button",Ext.create("GeoExt.Action",{iconCls:"pts-arrow-right",control:a.next,disabled:!0,tooltip:"next in history"}))),g.push("-"),g.push(Ext.create("Ext.button.Button",{text:"Pan",iconCls:"pts-menu-pan",toggleGroup:"draw",allowDepress:!1,pressed:!0,tooltip:"Pan the map"})),g.push(Ext.create("Ext.button.Button",Ext.create("GeoExt.Action",{text:"Point",iconCls:"pts-menu-point",control:new OpenLayers.Control.DrawFeature(f,OpenLayers.Handler.Point),map:e,toggleGroup:"draw",allowDepress:!1,tooltip:"Draw a point"}))),g.push(Ext.create("Ext.button.Button",Ext.create("GeoExt.Action",{text:"Line",iconCls:"pts-menu-line",control:new OpenLayers.Control.DrawFeature(f,OpenLayers.Handler.Path),map:e,toggleGroup:"draw",allowDepress:!1,tooltip:"Draw a line"}))),g.push(Ext.create("Ext.button.Button",Ext.create("GeoExt.Action",{text:"Polygon",iconCls:"pts-menu-polygon",control:new OpenLayers.Control.DrawFeature(f,OpenLayers.Handler.Polygon),map:e,toggleGroup:"draw",allowDepress:!1,tooltip:"Draw a polygon"}))),f.styleMap.styles.vertex=new OpenLayers.Style({fillColor:"#EE00E2",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#EE00E2",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3}),b=new OpenLayers.Control.ModifyFeature(f,{id:"PTS-Modify-Feature",vertexRenderIntent:"vertex"}),g.push(Ext.create("Ext.button.Split",Ext.create("GeoExt.Action",{text:"Modify",itemId:"modify",iconCls:"pts-menu-modify",control:b,map:e,toggleGroup:"draw",allowDepress:!1,tooltip:"Modify a feature",menu:{items:[{xtype:"menucheckitem",text:"Modify",iconCls:"pts-menu-modify",group:"modoptions",checked:!0,modoption:OpenLayers.Control.ModifyFeature.RESHAPE},{xtype:"menucheckitem",text:"Move",iconCls:"pts-menu-move",group:"modoptions",modoption:OpenLayers.Control.ModifyFeature.DRAG},{xtype:"menucheckitem",text:"Resize",iconCls:"pts-menu-resize",group:"modoptions",modoption:OpenLayers.Control.ModifyFeature.RESIZE},{xtype:"menucheckitem",text:"Rotate",iconCls:"pts-menu-rotate",group:"modoptions",modoption:OpenLayers.Control.ModifyFeature.ROTATE}]},listeners:{render:function(a){a.menu.items.each(function(c){c.on("checkchange",function(c,d){var e=b.feature;d&&(b.mode=c.modoption,a.setText(c.text),a.setIconCls(c.iconCls),e&&(b.unselectFeature(e),b.selectFeature(e)),a.toggle(!0))})})}}}))),g.push("-"),d.maskCmp&&d.saveStrategy.events.on({start:function(){this.showMask("Saving project features...")},success:function(){this.unmask()},fail:function(){this.unmask()},scope:this}),g.push({xtype:"savebutton",handler:function(){var a,b=[];Ext.Array.some(f.features,function(a){return a.state})&&(Ext.each(f.features,function(c){c.state&&(void 0===c.fid&&c.state===OpenLayers.State.DELETE?b.push(c):a=!0)}),f.destroyFeatures(b),a?d.saveStrategy.save():this.unmask())},scope:this,disabled:!1,tooltip:"Save project features"}),d.refreshStrategy&&g.push({xtype:"resetbutton",handler:function(){d.showMask(),d.refreshStrategy.refresh()},disabled:!1,tooltip:"Reload the project features"}),g.push("-"),f.styleMap.styles.delete=new OpenLayers.Style({fillColor:"#FF272C",strokeColor:"#FF272C"}),c=OpenLayers.Class(OpenLayers.Control,{initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),this.layer=a,this.handler=new OpenLayers.Handler.Feature(this,a,{click:this.clickFeature})},clickFeature:function(a){this.layer.events.triggerEvent("beforedeletetoggle",{feature:a}),a.state===OpenLayers.State.DELETE?(void 0===a.fid?a.state=OpenLayers.State.INSERT:a.state=OpenLayers.State.UPDATE,this.highlight(a),this.layer.events.triggerEvent("afterfeaturemodified",{feature:a})):(a.state=OpenLayers.State.DELETE,this.layer.events.triggerEvent("afterfeaturemodified",{feature:a}),this.highlight(a)),this.layer.events.triggerEvent("deletetoggle",{feature:a})},highlight:function(a){var b=a.layer;a._prevHighlighter=a._lastHighlighter,a._lastHighlighter=this.id,a.state===OpenLayers.State.DELETE?b.drawFeature(a,"delete"):b.drawFeature(a,"default")},setMap:function(a){this.handler.setMap(a),OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DeleteFeature"}),g.push(Ext.create("PTS.view.button.Delete",Ext.create("GeoExt.Action",{control:new c(f),map:e,text:"Delete",disabled:!1,toggleGroup:"draw",allowDepress:!1,tooltip:"Click to mark features for deletion. Click again to unmark."}))),g.push("-"),d.commonStore&&g.push({text:"Add Feature",iconCls:"pts-menu-addbasic",itemId:"addFeature",menu:Ext.create("Ext.ux.StoreMenu",{store:"CommonVectors",loadingCls:"pts-loading-small"})}),g.push("->"),g.push(Ext.create("Ext.button.Button",{text:"Help"})),Ext.apply(d,{dock:"top",items:g}),d.callParent(arguments)}}),Ext.define("Extensible.calendar.menu.Event",{extend:"Ext.menu.Menu",alias:"widget.extensible.eventcontextmenu",requires:["Ext.menu.DatePicker"],hideOnClick:!0,ignoreParentClicks:!0,editDetailsText:"Edit Details",deleteText:"Delete",moveToText:"Move to...",enableScrolling:!1,initComponent:function(){this.addEvents("editdetails","eventdelete","eventmove"),this.buildMenu(),this.callParent(arguments)},buildMenu:function(){this.rendered||(this.dateMenu=Ext.create("Ext.menu.DatePicker",{scope:this,handler:function(a,b){b=Extensible.Date.copyTime(this.rec.data[Extensible.calendar.data.EventMappings.StartDate.name],b),this.fireEvent("eventmove",this,this.rec,b)}}),Ext.apply(this,{items:[{text:this.editDetailsText,iconCls:"extensible-cal-icon-evt-edit",scope:this,handler:function(){this.fireEvent("editdetails",this,this.rec,this.ctxEl)}},{text:this.deleteText,
iconCls:"extensible-cal-icon-evt-del",scope:this,handler:function(){this.fireEvent("eventdelete",this,this.rec,this.ctxEl)}},"-",{text:this.moveToText,iconCls:"extensible-cal-icon-evt-move",menu:this.dateMenu}]}))},showForEvent:function(a,b,c){this.rec=a,this.ctxEl=b,this.dateMenu.picker.setValue(a.data[Extensible.calendar.data.EventMappings.StartDate.name]),this.showAt(c)},onHide:function(){this.callParent(arguments),delete this.ctxEl}}),Ext.define("PTS.view.controls.DateRangeField",{extend:"Ext.form.field.Date",alias:"widget.daterangefield",initComponent:function(){var a=this;a.callParent(arguments),a.on("change",function(a,b,c){null===b&&Ext.form.field.VTypes.daterange(b,a)})}}),Ext.define("PTS.view.product.form.ProductForm",{extend:"Ext.form.Panel",alias:"widget.productform",requires:["PTS.view.controls.DateRangeField","Ext.form.field.Display"],autoScroll:!0,bodyPadding:5,title:"Product",submitEmptyText:!1,initComponent:function(){var a=this;a.initialConfig=Ext.apply({trackResetOnLoad:!0},a.initialConfig),Ext.applyIf(a,{dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",text:"Delete",iconCls:"pts-menu-deletebasic",action:"deleteproduct"},{xtype:"button",text:"Save",iconCls:"pts-menu-savebasic",action:"saveproduct",formBind:!0},{xtype:"button",text:"Reset",iconCls:"pts-menu-reset",action:"resetproduct"}]}],items:[{xtype:"fieldset",title:"Product",anchor:"-15",items:[{xtype:"checkboxfield",name:"isgroup",width:175,boxLabel:"Is Group?",labelPad:3,labelWidth:120},{xtype:"textfield",name:"title",fieldLabel:"Title",allowBlank:!1,emptyText:"Product Title",maxLength:150,enforceMaxLength:!0,anchor:"100%"},{xtype:"combobox",name:"projectid",forceSelection:!1,allowBlank:!0,fieldLabel:"Project",displayField:"projectcode",listConfig:{getInnerTpl:function(){return"<div>{projectcode}: {shorttitle}</div>"}},store:"ProjectIDs",valueField:"projectid",anchor:"100%",queryParam:"filter"},{xtype:"combobox",name:"productgroupid",forceSelection:!0,allowBlank:!0,fieldLabel:"Product Group",displayField:"title",listConfig:{getInnerTpl:function(){return"<div>{projectcode}: {title}</div>"}},store:"ProductGroupIDs",valueField:"productid",anchor:"100%",queryParam:"filter"},{xtype:"combobox",name:"deliverabletypeid",fieldLabel:"Type",allowBlank:!0,anchor:"50%",store:"ProductTypes",displayField:"type",valueField:"deliverabletypeid",forceSelection:!0,queryMode:"local",listConfig:{getInnerTpl:function(){return'<div data-qtip="{description}">{type}</div>'}}},{xtype:"combobox",name:"isoprogresstypeid",fieldLabel:"Progress",allowBlank:!1,anchor:"50%",store:"IsoProgressTypes",displayField:"codename",valueField:"isoprogresstypeid",forceSelection:!0,queryMode:"local",listConfig:{getInnerTpl:function(){return'<div data-qtip="{description}">{codename}</div>'}}},{xtype:"fieldcontainer",layout:{type:"anchor"},fieldLabel:"Time Period",items:[{xtype:"daterangefield",itemId:"startDate",name:"startdate",fieldLabel:"Start",allowBlank:!0,vfield:"beginDate",endDateField:"endDate",vtype:"daterange",labelWidth:70},{xtype:"daterangefield",itemId:"endDate",name:"enddate",allowBlank:!0,vfield:"endDate",startDateField:"startDate",vtype:"daterange",fieldLabel:"End",labelWidth:70},{xtype:"textfield",name:"perioddescription",fieldLabel:"Description",anchor:"75%",labelWidth:70}]},{xtype:"combobox",name:"maintenancefrequencyid",fieldLabel:"Maintenance Frequency",allowBlank:!0,anchor:"50%",store:"MaintenanceFrequencies",displayField:"codename",valueField:"maintenancefrequencyid",forceSelection:!0,queryMode:"local",listConfig:{getInnerTpl:function(){return'<div data-qtip="{description}">{codename}</div>'}}},{xtype:"displayfield",name:"uuid",submitValue:!1,fieldLabel:"UUID",anchor:"100%"},{xtype:"fieldcontainer",layout:{align:"stretchmax",type:"hbox"},fieldLabel:"ScienceBase ID",items:[{xtype:"textfield",name:"sciencebaseid",allowBlank:!0,emptyText:"ScienceBase ID",hideLabel:!0,width:300},{xtype:"simplelink",text:"View in ScienceBase",margin:"0 10",cls:"x-form-item-label",handler:function(){window.open("https://www.sciencebase.gov/catalog/item/"+this.prev("textfield[name=sciencebaseid]").value,"_sb")}}]}]},{xtype:"fieldset",collapsible:!0,title:"Description",anchor:"-15",items:[{xtype:"textareafield",name:"description",allowBlank:!1,grow:!0,growMin:80,anchor:"100%"}]},{xtype:"fieldset",collapsible:!0,title:"Abstract",anchor:"-15",items:[{xtype:"textareafield",name:"abstract",allowBlank:!1,grow:!0,growMin:80,anchor:"100%"}]},{xtype:"fieldset",collapsible:!0,title:"Purpose",anchor:"-15",items:[{xtype:"textareafield",name:"purpose",grow:!0,growMin:80,anchor:"100%"}]},{xtype:"fieldset",collapsible:!0,title:"Use Limitation",anchor:"-15",items:[{xtype:"textareafield",name:"uselimitation",grow:!0,growMin:80,anchor:"100%"}]}]}),a.callParent(arguments)}}),Ext.define("Extensible.calendar.dd.DropZone",{extend:"Ext.dd.DropZone",requires:["Ext.Layer","Extensible.calendar.data.EventMappings"],ddGroup:"CalendarDD",eventSelector:".ext-cal-evt",dateRangeFormat:"{0}-{1}",dateFormat:"n/j",shims:[],getTargetFromEvent:function(a){var b=this.dragOffset||0,c=a.getPageY()-b,d=this.view.getDayAt(a.getPageX(),c);return d.el?d:null},onNodeOver:function(a,b,c,d){var e=Extensible.Date,f="eventdrag"==d.type?a.date:e.min(d.start,a.date),g="eventdrag"==d.type?e.add(a.date,{days:e.diffDays(d.eventStart,d.eventEnd)}):e.max(d.start,a.date);if(!this.dragStartDate||!this.dragEndDate||0!=e.diffDays(f,this.dragStartDate)||0!=e.diffDays(g,this.dragEndDate)){this.dragStartDate=f,this.dragEndDate=e.add(g,{days:1,millis:-1,clearTime:!0}),this.shim(f,g);var h=Ext.Date.format(f,this.dateFormat);e.diffDays(f,g)>0&&(g=Ext.Date.format(g,this.dateFormat),h=Ext.String.format(this.dateRangeFormat,h,g));var i=Ext.String.format("eventdrag"==d.type?this.moveText:this.createText,h);d.proxy.updateMsg(i)}return this.dropAllowed},shim:function(a,b){this.currWeek=-1;var c,d,e=Ext.Date.clone(a),f=0,g=Extensible.Date,h=g.diffDays(e,b)+1;for(Ext.each(this.shims,function(a){a&&(a.isActive=!1)});f++<h;){var i=this.view.getDayEl(e);if(i){var j=this.view.getWeekIndex(e),c=this.shims[j];c||(c=this.createShim(),this.shims[j]=c),j!=this.currWeek?(c.boxInfo=i.getBox(),this.currWeek=j):(d=i.getBox(),c.boxInfo.right=d.right,c.boxInfo.width=d.right-c.boxInfo.x),c.isActive=!0}e=g.add(e,{days:1})}Ext.each(this.shims,function(a){a&&(a.isActive?(a.show(),a.setBox(a.boxInfo)):a.isVisible()&&a.hide())})},createShim:function(){var a=this.view.ownerCalendarPanel?this.view.ownerCalendarPanel:this.view;this.shimCt||(this.shimCt=Ext.get("ext-dd-shim-ct-"+a.id),this.shimCt||(this.shimCt=document.createElement("div"),this.shimCt.id="ext-dd-shim-ct-"+a.id,a.getEl().parent().appendChild(this.shimCt)));var b=document.createElement("div");return b.className="ext-dd-shim",this.shimCt.appendChild(b),Ext.create("Ext.Layer",{shadow:!1,useDisplay:!0,constrain:!1},b)},clearShims:function(){Ext.each(this.shims,function(a){a&&a.hide()})},onContainerOver:function(a,b,c){return this.dropAllowed},onCalendarDragComplete:function(){delete this.dragStartDate,delete this.dragEndDate,this.clearShims()},onNodeDrop:function(a,b,c,d){if(a&&d){if("eventdrag"==d.type){var e=this.view.getEventRecordFromEl(d.ddel),f=Extensible.Date.copyTime(e.data[Extensible.calendar.data.EventMappings.StartDate.name],a.date);return this.view.onEventDrop(e,f),this.onCalendarDragComplete(),!0}if("caldrag"==d.type)return this.view.onCalendarEndDrag(this.dragStartDate,this.dragEndDate,Ext.bind(this.onCalendarDragComplete,this)),!0}return this.onCalendarDragComplete(),!1},onContainerDrop:function(a,b,c){return this.onCalendarDragComplete(),!1},destroy:function(){Ext.each(this.shims,function(a){a&&Ext.destroy(a)}),Ext.removeNode(this.shimCt),delete this.shimCt,this.shims.length=0}}),Ext.define("PTS.view.controls.KeywordTree",{extend:"Ext.tree.Panel",alias:"widget.keywordtree",requires:["Ext.tree.plugin.TreeViewDragDrop","Ext.grid.column.Template"],rootVisible:!1,store:"KeywordNodes",multiSelect:!0,singleExpand:!0,cls:"pts-keyword-tree",hideHeaders:!0,initComponent:function(){var a=this;Ext.applyIf(a,{viewConfig:{copy:!0,plugins:{ptype:"treeviewdragdrop",dragGroup:"keywords"}},columns:[{xtype:"treecolumn",text:"Keyword",dataIndex:"text",flex:1},{xtype:"templatecolumn",width:20,text:"",hideable:!1,cls:"x-action-col-cell",tpl:'<tpl if="definition"><div data-qtip="{[Ext.htmlEncode(values.definition)]}" class="pts-col-info"></div></tpl>'}]}),a.callParent(arguments)}}),Ext.define("PTS.view.product.window.ProductStatus",{extend:"PTS.view.controls.RowEditGrid",alias:"widget.productstatus",requires:["Ext.form.field.ComboBox","PTS.store.GroupUsers"],title:"Status",store:"ProductStatuses",initComponent:function(){var a=this;Ext.applyIf(a,{columns:[{xtype:"gridcolumn",dataIndex:"datetypeid",renderer:function(a,b,c,d,e,f,g){var h=g.getHeaderAtIndex(e).getEditor(),i=h.getStore().find(h.valueField,a,0,!1,!0,!0),j=h.getStore().getAt(i);return j?j.get(h.displayField):a},editor:{xtype:"combobox",displayField:"codename",listConfig:{getInnerTpl:function(){return'<div data-qtip="{description}">{codename}</div>'}},store:"DateTypes",valueField:"datetypeid",forceSelection:!0,allowBlank:!1,queryMode:"local"},text:"Status"},{xtype:"datecolumn",dataIndex:"effectivedate",editor:{xtype:"datefield",allowBlank:!1},text:"Effective Date"},{xtype:"gridcolumn",dataIndex:"contactid",hidden:!0,renderer:function(a){var b=Ext.getStore("GroupUsers"),c=b.find("contactid",a,0,!1,!0,!0),d=b.getAt(c);return d?d.get("fullname"):a},text:"User"},{xtype:"gridcolumn",dataIndex:"comment",editor:{xtype:"textfield"},flex:2,text:"Comment"}]}),a.callParent(arguments)}}),Ext.define("Ext.ux.form.BoxSelect",{extend:"Ext.form.field.ComboBox",alias:["widget.comboboxselect","widget.boxselect"],requires:["Ext.selection.Model","Ext.data.Store"],multiSelect:!0,forceSelection:!0,selectOnFocus:!0,triggerOnClick:!0,createNewOnEnter:!1,createNewOnBlur:!1,encodeSubmitValue:!1,stacked:!1,pinList:!0,grow:!0,growMin:!1,growMax:!1,componentLayout:"boxselectfield",initComponent:function(){var a=this,b=a.typeAhead;b&&!a.editable&&Ext.Error.raise("If typeAhead is enabled the combo must be editable: true -- please change one of those settings."),Ext.apply(a,{typeAhead:!1}),a.callParent(arguments),a.typeAhead=b,a.selectionModel=new Ext.selection.Model({store:a.valueStore,mode:"MULTI",onSelectChange:function(a,b,c,d){d()}}),!Ext.isEmpty(a.delimiter)&&a.multiSelect&&(a.delimiterEndingRegexp=new RegExp(String(a.delimiter).replace(/[$%()*+.?\[\\\]{|}]/g,"\\$&")+"$"))},initEvents:function(){var a=this;a.callParent(arguments),a.enableKeyEvents||a.mon(a.inputEl,"keydown",a.onKeyDown,a),a.mon(a.itemList,"click",a.onItemListClick,a),a.mon(a.selectionModel,"selectionchange",a.applyMultiselectItemMarkup,a)},bindStore:function(a,b){var c=this,d=c.store;d&&(c.mun(d,"beforeload",c.onBeforeLoad,c),c.valueStore&&(c.mun(c.valueStore,"datachanged",c.applyMultiselectItemMarkup,c),c.valueStore=null)),c.callParent(arguments),c.store&&(c.valueStore=new Ext.data.Store({model:c.store.model,proxy:{type:"memory"}}),c.mon(c.valueStore,"datachanged",c.applyMultiselectItemMarkup,c),c.mon(c.store,"beforeload",c.onBeforeLoad,c))},createPicker:function(){var a=this,b=a.callParent(arguments);return a.mon(b,{beforerefresh:a.onBeforeListRefresh,show:function(a){var c=b.listEl;c.getHeight()>b.maxHeight&&c.setHeight(b.maxHeight)},scope:a}),b},onDestroy:function(){var a=this;Ext.destroyMembers(a,"selectionModel","valueStore"),a.callParent(arguments)},afterRender:function(){var a=this;Ext.supports.Placeholder&&a.inputEl&&a.emptyText&&delete a.inputEl.dom.placeholder,!0===a.stacked&&a.itemList.addCls("x-boxselect-stacked"),a.grow&&(Ext.isNumber(a.growMin)&&a.growMin>0&&a.itemList.applyStyles("min-height:"+a.growMin+"px"),Ext.isNumber(a.growMax)&&a.growMax>0&&a.itemList.applyStyles("max-height:"+a.growMax+"px")),a.applyMultiselectItemMarkup(),a.callParent(arguments)},findRecord:function(a,b){var c,d=this.store,e=!1;return d.snapshot?(c=d.snapshot.findIndexBy(function(c){return c.get(a)===b}),e=-1!==c&&d.snapshot.getAt(c)):(c=d.findExact(a,b),e=-1!==c&&d.getAt(c)),e},onBeforeLoad:function(){this.ignoreSelection++},onLoad:function(){var a=this,b=a.valueField,c=a.valueStore,d=!1;c&&(Ext.isEmpty(a.value)||0!=c.getCount()||a.setValue(a.value,!1,!0),c.suspendEvents(),c.each(function(e){var f=a.findRecord(b,e.get(b)),g=f?c.indexOf(e):-1;g>=0&&(c.removeAt(g),c.insert(g,f),d=!0)}),c.resumeEvents(),d&&c.fireEvent("datachanged",c)),a.callParent(arguments),a.ignoreSelection=Ext.Number.constrain(a.ignoreSelection-1,0),a.alignPicker()},isFilteredRecord:function(a){var b,c=this,d=c.store,e=c.valueField,f=!1;return b=d.findExact(e,a.get(e)),f=-1===b&&(!d.snapshot||!1!==c.findRecord(e,a.get(e))),f=f||!f&&-1===b&&!0!==c.forceSelection&&c.valueStore.findExact(e,a.get(e))>=0},doRawQuery:function(){var a=this,b=a.inputEl.dom.value;a.multiSelect&&(b=b.split(a.delimiter).pop()),this.doQuery(b,!1,!0)},onBeforeListRefresh:function(){this.ignoreSelection++},onListRefresh:function(){this.callParent(arguments),this.ignoreSelection=Ext.Number.constrain(this.ignoreSelection-1,0)},onListSelectionChange:function(a,b){var c,d=this,e=d.valueStore,f=[];d.ignoreSelection<=0&&d.isExpanded&&(e.each(function(a){(Ext.Array.contains(b,a)||d.isFilteredRecord(a))&&f.push(a)}),f=Ext.Array.merge(f,b),c=Ext.Array.intersect(f,e.getRange()).length,c==f.length&&c==d.valueStore.getCount()||(d.setValue(f,!1),d.multiSelect&&d.pinList||Ext.defer(d.collapse,1,d),e.getCount()>0&&d.fireEvent("select",d,e.getRange())),d.inputEl.focus(),d.pinList||(d.inputEl.dom.value=""),d.selectOnFocus&&d.inputEl.dom.select())},syncSelection:function(){var a,b,c,d=this,e=d.picker,f=d.valueField;e&&(a=e.store,b=[],d.valueStore&&d.valueStore.each(function(c){var d=a.findExact(f,c.get(f));d>=0&&b.push(a.getAt(d))}),d.ignoreSelection++,c=e.getSelectionModel(),c.deselectAll(),b.length>0&&c.select(b),d.ignoreSelection=Ext.Number.constrain(d.ignoreSelection-1,0))},alignPicker:function(){if(this.rendered){var a,b,c=this,d=c.itemList.getBox(!1,!0);if(c.isExpanded){a=c.getPicker();a.getTargetEl().dom.scrollTop;c.matchFieldWidth&&a.setSize(d.width,a.store&&a.store.getCount()?null:0),a.isFloating()&&(a.alignTo(c.itemList,c.pickerAlign,c.pickerOffset),b=a.el.getY()<c.inputEl.getY(),c.bodyEl[b?"addCls":"removeCls"](c.openCls+"-above"),a.el[b?"addCls":"removeCls"](a.baseCls+"-above"))}}},getCursorPosition:function(){var a;return Ext.isIE?(a=document.selection.createRange(),a.collapse(!0),a.moveStart("character",-this.inputEl.dom.value.length),a=a.text.length):a=this.inputEl.dom.selectionStart,a},hasSelectedText:function(){var a,b;return Ext.isIE?(a=document.selection,b=a.createRange(),b.parentElement()==this.inputEl.dom):this.inputEl.dom.selectionStart!=this.inputEl.dom.selectionEnd},onKeyDown:function(a,b){var c,d,e=this,f=a.getKey(),g=e.inputEl.dom.value,h=e.valueStore,i=e.selectionModel,j=!1;if(!e.readOnly&&!e.disabled&&e.editable){if(h.getCount()>0&&(""==g||0===e.getCursorPosition()&&!e.hasSelectedText())&&(f==a.BACKSPACE||f==a.DELETE?(i.getCount()>0?e.valueStore.remove(i.getSelection()):e.valueStore.remove(e.valueStore.last()),e.setValue(e.valueStore.getRange()),i.deselectAll(),j=!0):f==a.RIGHT||f==a.LEFT?0===i.getCount()&&f==a.LEFT?(i.select(h.last()),j=!0):i.getCount()>0&&(c=i.getLastFocused()||i.getLastSelected())&&(d=h.indexOf(c),f==a.RIGHT?d<h.getCount()-1?(i.select(d+1,a.shiftKey),j=!0):a.shiftKey||(i.deselect(c),j=!0):f==a.LEFT&&d>0&&(i.select(d-1,a.shiftKey),j=!0)):f==a.A&&a.ctrlKey&&(i.selectAll(),j=a.A),e.inputEl.focus()),j)return e.preventKeyUpEvent=j,void a.stopEvent();e.isExpanded&&f==a.ENTER&&e.picker.highlightedItem&&(e.preventKeyUpEvent=!0),e.enableKeyEvents&&e.callParent(arguments),a.isSpecialKey()||a.hasModifier()||(e.selectionModel.deselectAll(),e.inputEl.focus())}},onKeyUp:function(a,b){var c,d=this,e=d.inputEl.dom.value;if(d.preventKeyUpEvent)return a.stopEvent(),void(!0!==d.preventKeyUpEvent&&a.getKey()!==d.preventKeyUpEvent||delete d.preventKeyUpEvent);(d.multiSelect&&d.delimiterEndingRegexp&&d.delimiterEndingRegexp.test(e)||!0===d.createNewOnEnter&&a.getKey()==a.ENTER)&&(e=e.replace(d.delimiterEndingRegexp,""),Ext.isEmpty(e)||(c=d.valueStore.findExact(d.valueField,e),c>=0?c=d.valueStore.getAt(c):(c=d.store.findExact(d.valueField,e),c=c>=0&&d.store.getAt(c)),c||d.forceSelection||(c={},c[d.valueField]=e,c[d.displayField]=e,c=new d.valueStore.model(c)),c&&(d.collapse(),d.setValue(d.valueStore.getRange().concat(c)),d.inputEl.dom.value="",d.inputEl.focus()))),d.callParent([a,b]),Ext.Function.defer(d.alignPicker,10,d)},onTypeAhead:function(){var a,b,c,d=this,e=d.displayField,f=d.inputEl.dom,g=d.store.findRecord(e,f.value),h=d.getPicker();g&&(a=g.get(e),b=a.length,c=f.value.length,h.highlightItem(h.getNode(g)),0!==c&&c!==b&&(f.value=a,d.selectText(c,a.length)))},onItemListClick:function(a,b,c){var d=this,e=a.getTarget(".x-boxselect-item"),f=!!e&&a.getTarget(".x-boxselect-item-close");d.readOnly||d.disabled||(a.stopPropagation(),e?(f?d.removeByListItemNode(e):d.toggleSelectionByListItemNode(e,a.shiftKey),d.inputEl.focus()):d.triggerOnClick&&d.onTriggerClick())},getMultiSelectItemMarkup:function(){var a=this;return a.multiSelectItemTpl||(a.labelTpl?Ext.isString(a.labelTpl)&&(a.labelTpl=Ext.create("Ext.XTemplate",a.labelTpl)):a.labelTpl=Ext.create("Ext.XTemplate","{[values."+a.displayField+"]}"),a.multiSelectItemTpl=['<tpl for=".">','<li class="x-boxselect-item ','<tpl if="this.isSelected(values.'+a.valueField+')">'," selected","</tpl>",'" qtip="{[typeof values === "string" ? values : values.'+a.displayField+']}">','<div class="x-boxselect-item-text">{[typeof values === "string" ? values : this.getItemLabel(values)]}</div>','<div class="x-tab-close-btn x-boxselect-item-close"></div>',"</li>","</tpl>",{compile:!0,disableFormats:!0,isSelected:function(b){var c=a.valueStore.findExact(a.valueField,b);if(c>=0)return a.selectionModel.isSelected(a.valueStore.getAt(c))},getItemLabel:function(b){return a.getTpl("labelTpl").apply(b)}}]),this.getTpl("multiSelectItemTpl").apply(Ext.Array.pluck(this.valueStore.getRange(),"data"))},applyMultiselectItemMarkup:function(){var a,b=this,c=b.itemList;if(c){for(;null!=(a=b.inputElCt.prev());)a.remove();b.inputElCt.insertHtml("beforeBegin",b.getMultiSelectItemMarkup())}},getRecordByListItemNode:function(a){for(var b=this,c=0,d=b.itemList.dom.firstChild;d&&d.nextSibling&&d!=a;)c++,d=d.nextSibling;return!1!==(c=d==a&&c)&&b.valueStore.getAt(c)},toggleSelectionByListItemNode:function(a,b){var c=this,d=c.getRecordByListItemNode(a);d&&(c.selectionModel.isSelected(d)?c.selectionModel.deselect(d):c.selectionModel.select(d,b))},removeByListItemNode:function(a){var b=this,c=b.getRecordByListItemNode(a);c&&(b.valueStore.remove(c),b.setValue(b.valueStore.getRange()))},getRawValue:function(){var a,b=this,c=b.inputEl;return b.inputEl=!1,a=b.callParent(arguments),b.inputEl=c,a},setRawValue:function(a){var b,c=this,d=c.inputEl;return c.inputEl=!1,b=c.callParent([a]),c.inputEl=d,b},addValue:function(a){var b=this;a&&b.setValue(Ext.Array.merge(b.value,Ext.Array.from(a)))},removeValue:function(a){var b=this;a&&b.setValue(Ext.Array.difference(b.value,Ext.Array.from(a)))},setValue:function(a,b,c){var d,e,f,g,h=this,i=h.valueStore,j=h.valueField,k=[];for(Ext.isEmpty(a)&&(a=null),Ext.isString(a)&&h.multiSelect&&(a=a.split(h.delimiter)),a=Ext.Array.from(a),f=0,e=a.length;f<e;f++)(d=a[f])&&d.isModel||(g=i.findExact(j,d),g>=0?a[f]=i.getAt(g):(g=h.findRecord(j,d),g||(h.forceSelection?k.push(d):(g={},g[h.valueField]=d,g[h.displayField]=d,g=new h.valueStore.model(g))),g&&(a[f]=g)));if(!0!==c&&k.length>0&&"remote"===h.queryMode){var l={};return l.filter=JSON.stringify([{property:h.valueField,value:["where in",k]}]),h.store.load({params:l,callback:function(){h.rendered&&h.itemList.unmask(),h.setValue(a,b,!0),h.autoSize()}}),!1}!h.multiSelect&&a.length>0&&(a=a[a.length-1]),h.callParent([a,b])},getValueRecords:function(){return this.valueStore.getRange()},getSubmitData:function(){var a=this,b=a.callParent(arguments);return a.multiSelect&&a.encodeSubmitValue&&b&&b[a.name]&&(b[a.name]=Ext.encode(b[a.name])),b},beforeBlur:function(){var a=this;a.doQueryTask.cancel(),a.assertValue(),a.collapse()},mimicBlur:function(){var a=this;a.selectOnTab&&a.picker&&a.picker.highlightedItem&&(a.inputEl.dom.value=""),a.callParent(arguments)},assertValue:function(){var a=this,b=a.inputEl.dom.value,c=!Ext.isEmpty(b)&&a.findRecordByDisplay(b),d=!1;c||a.forceSelection||!a.createNewOnBlur||Ext.isEmpty(b)?c&&(d=c):d=b,d&&a.addValue(d),a.inputEl.dom.value="",a.collapse()},checkChange:function(){if(!this.suspendCheckChange&&!this.isDestroyed){var a=this,b=a.valueStore,c=a.lastValue,d=a.valueField,e=Ext.Array.map(Ext.Array.from(a.value),function(a){return a.isModel?a.get(d):a},this).join(this.delimiter);a.isEqual(e,c)||(b.suspendEvents(),b.removeAll(),Ext.isArray(a.valueModels)&&b.add(a.valueModels),b.resumeEvents(),b.fireEvent("datachanged",b),a.lastValue=e,a.fireEvent("change",a,e,c),a.onChange(e,c))}},applyEmptyText:function(){var a,b,c=this,d=c.emptyText;c.rendered&&d&&(b=Ext.isEmpty(c.value)&&!c.hasFocus,a=c.inputEl,b?(a.dom.value=d,a.addCls(c.emptyCls)):(a.dom.value===d&&(a.dom.value=""),a.removeCls(c.emptyCls)))},preFocus:function(){var a,b=this,c=b.inputEl,d=b.emptyText;d&&c.dom.value===d&&(c.dom.value="",a=!0,c.removeCls(b.emptyCls)),(b.selectOnFocus||a)&&c.dom.select()},onFocus:function(){var a=this,b=a.focusCls,c=a.itemList;b&&c&&c.addCls(b),a.callParent(arguments)},onBlur:function(){var a=this,b=a.focusCls,c=a.itemList;b&&c&&c.removeCls(b),a.callParent(arguments)},renderActiveError:function(){var a=this,b=a.invalidCls,c=a.itemList,d=a.hasActiveError();b&&c&&c[d?"addCls":"removeCls"](a.invalidCls+"-field"),a.callParent(arguments)},autoSize:function(){var a,b=this;return b.rendered&&(b.doComponentLayout(),b.grow&&(a=b.getHeight())!==b.lastInputHeight&&(b.alignPicker(),b.fireEvent("autosize",a),b.lastInputHeight=a)),b}},function(){var a=!Ext.getVersion("extjs").isLessThan("4.0.5"),b={};a?Ext.apply(b,{fieldSubTpl:['<div class="x-boxselect">','<ul id="{cmpId}-itemList" class="x-boxselect-list {fieldCls} {typeCls}">','<li id="{cmpId}-inputElCt" class="x-boxselect-input">','<input id="{cmpId}-inputEl" type="{type}" ','<tpl if="name">name="{name}" </tpl>','<tpl if="size">size="{size}" </tpl>','<tpl if="tabIdx">tabIndex="{tabIdx}" </tpl>','class="x-boxselect-input-field" autocomplete="off" />',"</li>","</ul>",'<div id="{cmpId}-triggerWrap" class="{triggerWrapCls}" role="presentation">',"{triggerEl}",'<div class="{clearCls}" role="presentation"></div>',"</div>",'<div class="{clearCls}" role="presentation"></div>',"</div>",{compiled:!0,disableFormats:!0}],childEls:["itemList","inputEl","inputElCt"]}):Ext.apply(b,{fieldSubTpl:['<div class="x-boxselect">','<ul class="x-boxselect-list {fieldCls} {typeCls}">','<li class="x-boxselect-input">','<input id="{id}" type="{type}" ','<tpl if="name">name="{name}" </tpl>','<tpl if="size">size="{size}" </tpl>','<tpl if="tabIdx">tabIndex="{tabIdx}" </tpl>','class="x-boxselect-input-field" autocomplete="off" />',"</li>","</ul>",'<div class="{triggerWrapCls}" role="presentation">',"{triggerEl}",'<div class="{clearCls}" role="presentation"></div>',"</div>","</div>",{compiled:!0,disableFormats:!0}],renderSelectors:{itemList:"ul.x-boxselect-list",inputEl:"input.x-boxselect-input-field",inputElCt:"li.x-boxselect-input"}}),Ext.override(this,b)}),Ext.define("Ext.ux.layout.component.field.BoxSelectField",{alias:["layout.boxselectfield"],extend:"Ext.layout.component.field.Field",type:"boxselectfield",beforeLayout:function(a,b){var c=this,d=c.owner,e=this.lastValue,f=Ext.encode(d.value);return this.lastValue=f,c.callParent(arguments)||d.grow&&f!==e},sizeBodyContents:function(a,b){var c,d,e,f,g,h,i,j=this,k=j.owner,l=k.triggerWrap,m=k.getTriggerWidth();(k.hideTrigger||k.readOnly||m>0)&&(c=k.itemList,j.setElementSize(c,Ext.isNumber(a)?a-m:a,b),l.setWidth(m),d=k.inputEl,e=k.inputElCt,g=c.getBox(!0,!0),h=g.width,(k.grow&&k.growMax&&c.dom.scrollHeight>k.growMax-25||k.isFixedHeight()&&c.dom.scrollHeight>c.dom.clientHeight)&&(h-=Ext.getScrollbarSize().width),i=h-10,f=e.dom.previousSibling,f&&(i-=f.offsetLeft+Ext.fly(f).getWidth()+Ext.fly(f).getPadding("lr")),i<35&&(i=h-10),i>=0&&(j.setElementSize(d,i),k.hasFocus&&e.scrollIntoView(c)))}}),Ext.define("PTS.view.product.form.ProductMetadataForm",{extend:"Ext.form.Panel",alias:"widget.productmetadataform",requires:["Ext.ux.form.ItemSelector","Ext.ux.form.BoxSelect"],autoScroll:!0,bodyPadding:5,border:0,submitEmptyText:!1,initComponent:function(){var a=this;a.initialConfig=Ext.apply({trackResetOnLoad:!0},a.initialConfig),Ext.applyIf(a,{defaults:{validateOnChange:!0},items:[{xtype:"boxselect",name:"topiccategory",fieldLabel:"Topic Categories",anchor:"100%",store:"TopicCategories",displayField:"codename",valueField:"topiccategoryid",allowBlank:!1,listConfig:{getInnerTpl:function(){return'<div data-qtip="{description}">{codename}</div>'}},emptyText:"Pick one or more categories",queryMode:"local",style:{marginBottom:"25px"}},{xtype:"boxselect",fieldLabel:"Spatial Format",name:"spatialformat",displayField:"codename",listConfig:{getInnerTpl:function(){return"<div>{codename}: {description}</div>"}},store:"SpatialFormats",valueField:"spatialformatid",forceSelection:!0,allowBlank:!0,queryMode:"local",anchor:"50%",emptyText:"Pick one or more spatial formats, if applicable",style:{marginBottom:"25px"}},{xtype:"fieldset",collapsible:!0,title:"Spatial Reference System",anchor:"-15",padding:15,items:[{xtype:"boxselect",name:"epsgcode",fieldLabel:"EPSG Code",anchor:"100%",store:"EpsgCodes",displayField:"srid_text",valueField:"srid_text",allowBlank:!0,triggerOnClick:!1,hideTrigger:!0,listConfig:{getInnerTpl:function(){return'<div data-qtip="{name}">{srid}: {name}</div>'}},emptyText:"Pick one or more EPSG codes, if applicable",queryMode:"remote",queryParam:"filter",style:{marginBottom:"25px"}},{xtype:"textareafield",fieldLabel:"WKT Format(pipe-delimited)",emptyText:"Enter valid WKT projection strings separated by a pipe(|) , if applicable",name:"wkt",allowBlank:!0,grow:!0,growMin:80,anchor:"100%"}]}]}),a.callParent(arguments)}}),Ext.define("PTS.view.contact.window.ContactToolbar",{extend:"Ext.toolbar.Toolbar",alias:"widget.contacttoolbar",requires:["Ext.toolbar.*"],dock:"top",initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"button",text:"Edit",iconCls:"pts-menu-editbasic",hidden:!0,action:"editcontact"},{xtype:"button",text:"Delete",iconCls:"pts-menu-deletebasic",action:"deletecontact"},{xtype:"button",text:"Save",iconCls:"pts-menu-savebasic",action:"savecontact"},{xtype:"button",text:"Reset",iconCls:"pts-menu-reset",action:"resetcontact"}]}),a.callParent(arguments)}}),Ext.define("PTS.view.controls.PositionCombo",{extend:"Ext.form.field.ComboBox",alias:"widget.positioncombo",requires:["PTS.store.Positions"],name:"positionid",fieldLabel:"Position",store:"Positions",displayField:"title",valueField:"positionid",forceSelection:!0,allowBlank:!1,queryMode:"local",initComponent:function(){this.callParent(arguments)}}),Ext.define("Ext.ux.grid.FilterBar",{extend:"Ext.toolbar.Toolbar",alias:"widget.filterbar",requires:["Ext.ux.form.SearchField","Ext.form.field.ComboBox","Ext.data.ArrayStore"],searchStore:null,comboData:null,initComponent:function(){var a=this,b=a.searchStore;b&&(b=Ext.data.StoreManager.lookup(b)),a.searchStore=b,Ext.applyIf(a,{items:[{xtype:"combobox",itemId:"searchCombo",fieldLabel:"Search",labelWidth:50,store:Ext.create("Ext.data.ArrayStore",{fields:["fieldId","fieldName","fieldType"]}),queryMode:"local",valueField:"fieldId",displayField:"fieldName",triggerAction:"all",editable:!1,emptyText:"Select a field",listeners:{change:function(a,b,c){var d=""===b,e=a.getStore().findRecord("fieldId",b).get("fieldType"),f="booleancolumn"===e,g=a.ownerCt.down("searchfield"),h=a.ownerCt.down("#booleanField");g.setVisible(!f),h.setVisible(f),h.reset(),g.setDisabled(d)}}},{xtype:"searchfield",flex:1,disabled:!0,store:a.searchStore,onTrigger1Click:function(){var a=this,b=a.store;a.hasSearch&&(a.setValue(""),b.clearFilter(),a.hasSearch=!1,a.triggerEl.item(0).setDisplayed("none"),a.doComponentLayout())},onTrigger2Click:function(){var a=this,b=a.store,c=a.ownerCt.down("#searchCombo").getValue(),d=a.getValue();if(d.length<1)return void a.onTrigger1Click();b.filters.clear(),b.filter(c,["ilike",d]),a.hasSearch=!0,a.triggerEl.item(0).setDisplayed("block"),a.doComponentLayout()},listeners:{render:function(a){Ext.tip.QuickTipManager.register({target:a.triggerEl,title:"Search Hint",text:"Wildcards % and _ are allowed."})}}},{xtype:"radiogroup",itemId:"booleanField",padding:"0 0 0 25",hidden:!0,width:175,columns:3,items:[{boxLabel:"Yes",name:"bool",inputValue:!0},{boxLabel:"No",name:"bool",inputValue:!1},{xtype:"button",text:"Clear",handler:function(){this.searchStore.clearFilter(),this.down("#booleanField").reset()},scope:this}],listeners:{change:function(a,b,c){var d=this,e=d.searchStore,f=d.ownerCt.down("#searchCombo").getValue(),g=a.getValue();void 0===g.bool||Ext.isArray(g.bool)||(e.filters.clear(),e.filter(f,g.bool))},scope:this}}],listeners:{added:function(a){var b=a.ownerCt.columns,c=[],d=a.down("#searchCombo").getStore();Ext.each(b,function(a){a.dataIndex&&c.push([a.dataIndex,a.text,a.xtype])}),d.loadData(c)},removed:function(a,b){a.searchStore.clearFilter()}}}),a.callParent(arguments)}}),Ext.define("PTS.view.product.window.ProductKeywords",{extend:"Ext.panel.Panel",alias:"widget.productkeywords",requires:["PTS.view.controls.KeywordTree","Ext.ux.grid.FilterBar","Ext.grid.plugin.DragDrop","Ext.grid.column.Template"],layout:{type:"border"},title:"Keywords",initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"gridpanel",itemId:"productKeywords",region:"center",multiSelect:!0,viewConfig:{stripeRows:!1,plugins:{ptype:"gridviewdragdrop",dropGroup:"keywords",dragGroup:"deletekeywords"},getRowClass:function(a,b,c,d){return a.phantom?"pts-grid-row-phantom":""}},store:"ProductKeywords",columns:[{text:"Keyword",flex:1,sortable:!0,dataIndex:"text"}],title:"Product Keywords",dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",iconCls:"pts-menu-deletebasic",text:"Remove",action:"removekeywords"},{xtype:"button",iconCls:"pts-menu-savebasic",text:"Save",action:"savekeywords"},{xtype:"button",iconCls:"pts-menu-refresh",text:"Refresh",action:"refreshkeywords"}]}]},{xtype:"tabpanel",flex:1,title:"Keywords",preventHeader:!0,region:"west",split:!0,activeTab:0,tabPosition:"bottom",items:[{xtype:"keywordtree",itemId:"keywordTree",title:"Keyword Tree"},{xtype:"gridpanel",itemId:"keywordSearch",title:"Search",store:"Keywords",columns:[{xtype:"gridcolumn",dataIndex:"text",flex:1,text:"Keyword",renderer:function(a,b,c,d,e,f,g){var h=c.get("fullname");return h?'<span data-qtip="'+h+'">'+a+"</span>":a}},{xtype:"gridcolumn",hidden:!0,dataIndex:"fullname",flex:2,text:"Full Path"},{xtype:"templatecolumn",width:28,text:"",hideable:!1,cls:"x-action-col-cell",tpl:'<tpl if="definition"><div data-qtip="{[Ext.htmlEncode(values.definition)]}" class="pts-col-info"></div></tpl>'},{xtype:"templatecolumn",width:28,text:"",hideable:!1,cls:"x-action-col-cell",tpl:'<tpl if="text"><div data-qtip="Add: {[Ext.htmlEncode(values.text)]}" class="pts-col-add"></div></tpl>',action:"addkeyword"}],viewConfig:{copy:!0,plugins:{ptype:"gridviewdragdrop",dragGroup:"keywords"}},dockedItems:[{xtype:"filterbar",searchStore:"Keywords",dock:"top"},{xtype:"pagingtoolbar",displayInfo:!0,store:"Keywords",dock:"top"}]}]}]}),a.callParent(arguments)}}),Ext.define("Extensible.calendar.form.field.ReminderCombo",{extend:"Ext.form.ComboBox",alias:"widget.extensible.remindercombo",requires:["Ext.data.ArrayStore"],fieldLabel:"Reminder",queryMode:"local",triggerAction:"all",forceSelection:!0,displayField:"desc",valueField:"value",noneText:"None",atStartTimeText:"At start time",reminderValueFormat:"{0} {1} before start",minutesText:"minutes",hourText:"hour",
hoursText:"hours",dayText:"day",daysText:"days",weekText:"week",weeksText:"weeks",initComponent:function(){this.store=this.store||Ext.create("Ext.data.ArrayStore",{fields:["value","desc"],idIndex:0,data:this.getValueList()}),this.callParent(arguments)},getValueList:function(){var a=this,b=a.reminderValueFormat,c=Ext.String.format;return[["",a.noneText],["0",a.atStartTimeText],["5",c(b,"5",a.getMinutesText(5))],["15",c(b,"15",a.getMinutesText(15))],["30",c(b,"30",a.getMinutesText(30))],["60",c(b,"1",a.getHoursText(1))],["90",c(b,"1.5",a.getHoursText(1.5))],["120",c(b,"2",a.getHoursText(2))],["180",c(b,"3",a.getHoursText(3))],["360",c(b,"6",a.getHoursText(6))],["720",c(b,"12",a.getHoursText(12))],["1440",c(b,"1",a.getDaysText(1))],["2880",c(b,"2",a.getDaysText(2))],["4320",c(b,"3",a.getDaysText(3))],["5760",c(b,"4",a.getDaysText(4))],["7200",c(b,"5",a.getDaysText(5))],["10080",c(b,"1",a.getWeeksText(1))],["20160",c(b,"2",a.getWeeksText(2))]]},getMinutesText:function(a){return 1===a?this.minuteText:this.minutesText},getHoursText:function(a){return 1===a?this.hourText:this.hoursText},getDaysText:function(a){return 1===a?this.dayText:this.daysText},getWeeksText:function(a){return 1===a?this.weekText:this.weeksText},initValue:function(){void 0!==this.value?this.setValue(this.value):this.setValue(""),this.originalValue=this.getValue()}}),Ext.define("Extensible.form.recurrence.Combo",{extend:"Ext.form.ComboBox",alias:"widget.extensible.recurrencecombo",requires:["Ext.data.ArrayStore"],width:160,fieldLabel:"Repeats",mode:"local",triggerAction:"all",forceSelection:!0,displayField:"pattern",valueField:"id",recurrenceText:{none:"Does not repeat",daily:"Daily",weekly:"Weekly",monthly:"Monthly",yearly:"Yearly"},initComponent:function(){this.callParent(arguments),this.addEvents("recurrencechange"),this.store=this.store||Ext.create("Ext.data.ArrayStore",{fields:["id","pattern"],idIndex:0,data:[["NONE",this.recurrenceText.none],["DAILY",this.recurrenceText.daily],["WEEKLY",this.recurrenceText.weekly],["MONTHLY",this.recurrenceText.monthly],["YEARLY",this.recurrenceText.yearly]]})},initValue:function(){this.callParent(arguments),void 0!=this.value&&this.fireEvent("recurrencechange",this.value)},setValue:function(a){var b=this.value;return this.callParent(arguments),b!=a&&this.fireEvent("recurrencechange",a),this}}),Ext.define("Extensible.calendar.form.field.CalendarCombo",{extend:"Ext.form.field.ComboBox",alias:"widget.extensible.calendarcombo",requires:["Extensible.calendar.data.CalendarMappings"],fieldLabel:"Calendar",triggerAction:"all",queryMode:"local",forceSelection:!0,selectOnFocus:!0,defaultCls:"x-cal-default",hiddenCalendarCls:"ext-cal-hidden",initComponent:function(){this.valueField=Extensible.calendar.data.CalendarMappings.CalendarId.name,this.displayField=Extensible.calendar.data.CalendarMappings.Title.name,this.listConfig=Ext.apply(this.listConfig||{},{getInnerTpl:this.getListItemTpl}),this.store.on("update",this.refreshColorCls,this),this.callParent(arguments)},getListItemTpl:function(a){return'<div class="x-combo-list-item x-cal-{'+Extensible.calendar.data.CalendarMappings.ColorId.name+'}"><div class="ext-cal-picker-icon">&#160;</div>{'+a+"}</div>"},afterRender:function(){this.callParent(arguments),this.wrap=this.el.down(".x-form-item-body"),this.wrap.addCls("ext-calendar-picker"),this.icon=Ext.core.DomHelper.append(this.wrap,{tag:"div",cls:"ext-cal-picker-icon ext-cal-picker-mainicon"})},refreshColorCls:function(){var a=this,b=Extensible.calendar.data.CalendarMappings,c="",d=a.getValue();return a.wrap?(void 0!==a.currentStyleClss&&a.wrap.removeCls(a.currentStyleClss),Ext.isEmpty(d)||(Ext.isArray(d)&&(d=d[0]),d.data||(d=this.store.findRecord(b.CalendarId.name,d)),c="x-cal-"+(d.data?d.data[b.ColorId.name]:d)),a.currentStyleClss=c,a.wrap.addCls(c),a):a},setValue:function(a){!a&&this.store.getCount()>0&&(a=this.store.getAt(0).data[Extensible.calendar.data.CalendarMappings.CalendarId.name]),this.callParent(arguments),this.refreshColorCls()}}),Ext.define("PTS.view.contact.PersonDDList",{extend:"Ext.grid.Panel",alias:"widget.personddlist",requires:["Ext.ux.grid.FilterBar","Ext.selection.CheckboxModel","Ext.grid.plugin.DragDrop"],title:"Persons",store:"DDPersons",itemId:"personsList",initComponent:function(){var a=this;Ext.applyIf(a,{selModel:Ext.create("Ext.selection.CheckboxModel",{injectCheckbox:!1,mode:"SIMPLE",checkOnly:!0}),viewConfig:{copy:!0,plugins:{ptype:"gridviewdragdrop"}},dockedItems:[{xtype:"pagingtoolbar",store:"DDPersons",displayInfo:!1}],columns:[{xtype:"gridcolumn",dataIndex:"firstname",flex:1,text:"First Name"},{xtype:"gridcolumn",dataIndex:"lastname",flex:3,text:"Last Name"},{xtype:"gridcolumn",dataIndex:"priacronym",width:60,text:"Group"},{xtype:"gridcolumn",dataIndex:"prigroupname",flex:2,hidden:!0,text:"Group Name"}]}),a.callParent(arguments),a.addDocked({xtype:"filterbar",searchStore:a.store,dock:"bottom"})}}),Ext.define("PTS.view.contact.GroupDDList",{extend:"Ext.grid.Panel",alias:"widget.groupddlist",requires:["Ext.ux.grid.FilterBar","Ext.selection.CheckboxModel","Ext.grid.plugin.DragDrop"],title:"Groups",store:"DDContactGroups",itemId:"groupsList",initComponent:function(){var a=this;Ext.applyIf(a,{selModel:Ext.create("Ext.selection.CheckboxModel",{injectCheckbox:!1,mode:"SIMPLE",checkOnly:!0}),viewConfig:{copy:!0,plugins:{ptype:"gridviewdragdrop"}},dockedItems:[{xtype:"pagingtoolbar",store:"DDContactGroups",displayInfo:!1}],columns:[{xtype:"gridcolumn",dataIndex:"fullname",flex:1,text:"Full Name"},{xtype:"gridcolumn",dataIndex:"acronym",text:"Acronym"},{xtype:"gridcolumn",dataIndex:"name",flex:1,text:"Name",hidden:!0}]}),a.callParent(arguments),a.addDocked({xtype:"filterbar",searchStore:a.store,dock:"bottom"})}}),Ext.define("PTS.view.contact.window.PersonGroups",{extend:"Ext.panel.Panel",alias:"widget.persongroups",requires:["Ext.ux.CheckColumn","Ext.ux.grid.HeaderToolTip","PTS.view.contact.GroupDDList","PTS.view.contact.PersonDDList","Ext.selection.CheckboxModel","Ext.grid.plugin.DragDrop"],layout:{align:"stretch",padding:5,type:"hbox"},title:"Manage Contact Groups",disabled:!0,initComponent:function(){var a,b=this;a=Ext.create("Ext.grid.plugin.CellEditing",{itemId:"contactEditor",clicksToEdit:1,listeners:{beforeedit:function(a){return!a.column||!a.column.isCheckerHd&&!a.column.is("actioncolumn")}}}),Ext.applyIf(b,{items:[{xtype:"panel",itemId:"contactLists",style:{borderWidth:"1px 0 0 1px",padding:0},activeItem:1,flex:1,layout:{type:"card"},defaults:{autoScroll:!0,border:0},items:[{xtype:"personddlist",itemId:"personsList",title:"Persons",dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",iconCls:"pts-menu-addbasic",text:"Add Member",action:"addcontacts"}]},{xtype:"pagingtoolbar",store:"DDPersons",displayInfo:!0}]},{xtype:"groupddlist",itemId:"groupsList",title:"Groups",dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",iconCls:"pts-menu-addbasic",text:"Assign Group",action:"addcontacts"}]},{xtype:"pagingtoolbar",store:"DDContactGroups",displayInfo:!0}]}]},{xtype:"gridpanel",itemId:"groupMembersList",title:"Assigned Groups",store:"ContactContactGroups",flex:1,selModel:Ext.create("Ext.selection.CheckboxModel",{injectCheckbox:!1,mode:"SIMPLE",checkOnly:!0}),plugins:[a,"headertooltip"],viewConfig:{plugins:[{ptype:"gridviewdragdrop",pluginId:"contactsddplugin"}]},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",iconCls:"pts-menu-deletebasic",text:"Remove",action:"removecontacts"},{xtype:"button",iconCls:"pts-menu-savebasic",text:"Save",action:"savecontacts"},{xtype:"button",iconCls:"pts-menu-refresh",text:"Refresh",action:"refreshcontacts"}]},{xtype:"pagingtoolbar",store:"ContactContactGroups",displayInfo:!0}],columns:[{xtype:"gridcolumn",sortable:!1,dataIndex:"name",flex:1,text:"Name"},{xtype:"gridcolumn",dataIndex:"positionid",renderer:function(a,b,c,d,e,f,g){var h=g.getHeaderAtIndex(e).getEditor(),i=h.getStore().find(h.valueField,a,0,!1,!0,!0),j=h.getStore().getAt(i);return j?j.get(h.displayField):a},editor:{xtype:"positioncombo",fieldLabel:"",typeAhead:!0,forceSelection:!0,triggerAction:"all",selectOnTab:!0,lazyRender:!0,listClass:"x-combo-list-small",queryMode:"local",listeners:{blur:function(a){a.getStore().clearFilter()}}},flex:2,text:"Position"}]}]}),b.callParent(arguments)}}),Ext.define("PTS.view.controls.MyFieldSet",{extend:"Ext.form.FieldSet",alias:"widget.myfieldset",mixins:{checkDirty:"PTS.util.mixin.CheckDirty"},initComponent:function(){this.callParent(arguments)}}),Ext.define("PTS.view.controls.CountryCombo",{extend:"Ext.form.field.ComboBox",alias:"widget.countrycombo",requires:["PTS.store.Countries"],name:"countryid",fieldLabel:"Country",store:"Countries",displayField:"country",valueField:"countryid",value:"US",forceSelection:!0,allowBlank:!1,queryMode:"local",initComponent:function(){this.callParent(arguments)}}),Ext.define("GeoExt.slider.Zoom",{extend:"Ext.slider.Single",requires:["GeoExt.panel.Map"],alias:"widget.gx_zoomslider",alternateClassName:"GeoExt.ZoomSlider",map:null,baseCls:"gx-zoomslider",aggressive:!1,updating:!1,initComponent:function(){this.callParent(arguments),this.map&&(this.map instanceof GeoExt.MapPanel&&(this.map=this.map.map),this.bind(this.map)),!0===this.aggressive?this.on("change",this.changeHandler,this):this.on("changecomplete",this.changeHandler,this),this.on("beforedestroy",this.unbind,this)},onRender:function(){this.callParent(arguments),this.el.addCls(this.baseCls)},afterRender:function(){this.callParent(arguments),this.update()},addToMapPanel:function(a){this.on({render:function(){var b=this.getEl();b.setStyle({position:"absolute",zIndex:a.map.Z_INDEX_BASE.Control}),b.on({mousedown:this.stopMouseEvents,click:this.stopMouseEvents})},afterrender:function(){this.bind(a.map)},scope:this})},stopMouseEvents:function(a){a.stopEvent()},removeFromMapPanel:function(a){var b=this.getEl();b.un("mousedown",this.stopMouseEvents,this),b.un("click",this.stopMouseEvents,this),this.unbind()},bind:function(a){this.map=a,this.map.events.on({zoomend:this.update,changebaselayer:this.initZoomValues,scope:this}),this.map.baseLayer&&(this.initZoomValues(),this.update())},unbind:function(){this.map&&this.map.events&&this.map.events.un({zoomend:this.update,changebaselayer:this.initZoomValues,scope:this})},initZoomValues:function(){var a=this.map.baseLayer;void 0===this.initialConfig.minValue&&(this.minValue=a.minZoomLevel||0),void 0===this.initialConfig.maxValue&&(this.maxValue=null==a.minZoomLevel?a.numZoomLevels-1:a.maxZoomLevel)},getZoom:function(){return this.getValue()},getScale:function(){return OpenLayers.Util.getScaleFromResolution(this.map.getResolutionForZoom(this.getValue()),this.map.getUnits())},getResolution:function(){return this.map.getResolutionForZoom(this.getValue())},changeHandler:function(){this.map&&!this.updating&&this.map.zoomTo(this.getValue())},update:function(){this.rendered&&this.map&&(this.updating=!0,this.setValue(this.map.getZoom()),this.updating=!1)}}),Ext.define("GeoExt.slider.LayerOpacity",{alternateClassName:"GeoExt.LayerOpacitySlider",extend:"Ext.slider.Single",requires:"GeoExt.data.LayerModel",alias:"widget.gx_opacityslider",layer:null,complementaryLayer:null,delay:5,changeVisibilityDelay:5,aggressive:!1,changeVisibility:!1,value:null,inverse:!1,constructor:function(a){a.layer&&(this.layer=this.getLayer(a.layer),this.bind(),this.complementaryLayer=this.getLayer(a.complementaryLayer),void 0!==a.inverse&&(this.inverse=a.inverse),a.value=void 0!==a.value?a.value:this.getOpacityValue(this.layer),delete a.layer,delete a.complementaryLayer),this.callParent([a])},bind:function(){this.layer&&this.layer.map&&this.layer.map.events.on({changelayer:this.update,scope:this})},unbind:function(){this.layer&&this.layer.map&&this.layer.map.events&&this.layer.map.events.un({changelayer:this.update,scope:this})},update:function(a){"opacity"!==a.property||a.layer!=this.layer||this._settingOpacity||this.setValue(this.getOpacityValue(this.layer))},setLayer:function(a){this.unbind(),this.layer=this.getLayer(a),this.setValue(this.getOpacityValue(a)),this.bind()},getOpacityValue:function(a){var b;return b=a&&null!==a.opacity?parseInt(a.opacity*(this.maxValue-this.minValue)):this.maxValue,!0===this.inverse&&(b=this.maxValue-this.minValue-b),b},getLayer:function(a){return a instanceof OpenLayers.Layer?a:a instanceof GeoExt.data.LayerModel?a.getLayer():void 0},initComponent:function(){this.callParent(),this.changeVisibility&&this.layer&&(0==this.layer.opacity||!1===this.inverse&&this.value==this.minValue||!0===this.inverse&&this.value==this.maxValue)&&this.layer.setVisibility(!1),this.complementaryLayer&&(this.layer&&1==this.layer.opacity||!1===this.inverse&&this.value==this.maxValue||!0===this.inverse&&this.value==this.minValue)&&this.complementaryLayer.setVisibility(!1),!0===this.aggressive?this.on("change",this.changeLayerOpacity,this,{buffer:this.delay}):this.on("changecomplete",this.changeLayerOpacity,this),!0===this.changeVisibility&&this.on("change",this.changeLayerVisibility,this,{buffer:this.changeVisibilityDelay}),this.complementaryLayer&&this.on("change",this.changeComplementaryLayerVisibility,this,{buffer:this.changeVisibilityDelay}),this.on("beforedestroy",this.unbind,this)},changeLayerOpacity:function(a,b){this.layer&&(b/=this.maxValue-this.minValue,!0===this.inverse&&(b=1-b),this._settingOpacity=!0,this.layer.setOpacity(b),delete this._settingOpacity)},changeLayerVisibility:function(a,b){var c=this.layer.getVisibility();!1===this.inverse&&b==this.minValue||!0===this.inverse&&b==this.maxValue&&!0===c?this.layer.setVisibility(!1):(!1===this.inverse&&b>this.minValue||!0===this.inverse&&b<this.maxValue&&0==c)&&this.layer.setVisibility(!0)},changeComplementaryLayerVisibility:function(a,b){var c=this.complementaryLayer.getVisibility();!1===this.inverse&&b==this.maxValue||!0===this.inverse&&b==this.minValue&&!0===c?this.complementaryLayer.setVisibility(!1):(!1===this.inverse&&b<this.maxValue||!0===this.inverse&&b>this.minValue&&0==c)&&this.complementaryLayer.setVisibility(!0)},addToMapPanel:function(a){this.on({render:function(){var b=this.getEl();b.setStyle({position:"absolute",zIndex:a.map.Z_INDEX_BASE.Control}),b.on({mousedown:this.stopMouseEvents,click:this.stopMouseEvents})},scope:this})},removeFromMapPanel:function(a){this.getEl().un({mousedown:this.stopMouseEvents,click:this.stopMouseEvents,scope:this}),this.unbind()},stopMouseEvents:function(a){a.stopEvent()}}),Ext.define("PTS.view.project.ProjectMap",{extend:"GeoExt.panel.Map",alias:"widget.projectmap",requires:["GeoExt.panel.Map","GeoExt.slider.Zoom","GeoExt.slider.Tip","GeoExt.slider.LayerOpacity","Ext.toolbar.Toolbar","PTS.view.controls.MapToolbar","PTS.view.button.Edit","PTS.view.button.Save"],title:"Map",displayTools:!0,commonStore:!1,layerUrl:PTS.baseURL+"/projectfeature",layerName:"Project Features",zoomOnLoad:!0,maxZoomOnLoad:6,mapToolbar:void 0,initComponent:function(){var a=this,b=(new OpenLayers.Layer.WMS("OpenLayers WMS","http://vmap0.tiles.osgeo.org/wms/vmap0?",{layers:"basic"}),new OpenLayers.Layer.TMS("SDMI BDL(Alaska Albers)","http://swmha.gina.alaska.edu/tilesrv/bdl/tile/",{type:"jpeg",wrapDateLine:!0,isBaseLayer:!0,getURL:function(a){var b=this.map.getResolution(),c=Math.round((a.left-this.maxExtent.left)/(b*this.tileSize.w)),d=Math.round((this.maxExtent.top-a.top)/(b*this.tileSize.h)),e=this.map.getZoom(),f=1<<e,g=c%f;g<0&&(g+=f);var h=g+"/"+d+"/"+e,i=this.url;return i instanceof Array&&(i=this.selectUrl(h,i)),i+h}}),new OpenLayers.Strategy.Save),c=new OpenLayers.Strategy.Fixed,d=new OpenLayers.Strategy.Refresh,e=new OpenLayers.Layer.Vector(a.layerName,{visibility:!1,strategies:[d,c,b],protocol:new OpenLayers.Protocol.HTTP({url:a.layerUrl,format:new OpenLayers.Format.GeoJSON({ignoreExtraDims:!0}),deleteWithPOST:!0})}),f=function(a){a.code!==OpenLayers.Protocol.Response.SUCCESS?PTS.app.showError("There was an error processing the features.</br>Error: "+Ext.decode(a.priv.responseText).message):"delete"!==a.requestType.toLowerCase()&&this.projectVectors.events.triggerEvent("ptsfeaturesupdated",a)};e.protocol.options.update={callback:f,scope:this},e.protocol.options.create={callback:f,scope:this},e.protocol.options.delete={callback:f,scope:this};for(var g={currentVersion:10.01,mapName:"Layers",copyrightText:"Sources: Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, IGN, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community",spatialReference:{wkid:102100},singleFusedMapCache:!0,tileInfo:{rows:256,cols:256,dpi:96,format:"JPEG",compressionQuality:90,origin:{x:-20037508.342787,y:20037508.342787},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:591657527.591555},{level:1,resolution:78271.5169639999,scale:295828763.795777},{level:2,resolution:39135.7584820001,scale:147914381.897889},{level:3,resolution:19567.8792409999,scale:73957190.948944},{level:4,resolution:9783.93962049996,scale:36978595.474472},{level:5,resolution:4891.96981024998,scale:18489297.737236},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,scale:1128.497176}]},initialExtent:{xmin:-20037507.0671618,ymin:-19971868.8804086,xmax:20037507.0671618,ymax:19971868.8804086,spatialReference:{wkid:102100}},fullExtent:{xmin:-20037507.0671618,ymin:-19971868.8804086,xmax:20037507.0671618,ymax:19971868.8804086,spatialReference:{wkid:102100}},units:"esriMeters"},h=new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),i=new OpenLayers.Bounds(g.fullExtent.xmin,g.fullExtent.ymin,g.fullExtent.xmax,g.fullExtent.ymax),j=[],k=0;k<g.tileInfo.lods.length;k++)j.push(g.tileInfo.lods[k].resolution);var l=new OpenLayers.Layer.ArcGISCache("Topo","http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",{isBaseLayer:!1,wrapDateLine:!1,visibility:!0,displayInLayerSwitcher:!1,resolutions:j,tileSize:new OpenLayers.Size(g.tileInfo.cols,g.tileInfo.rows),tileOrigin:new OpenLayers.LonLat(g.tileInfo.origin.x,g.tileInfo.origin.y),maxExtent:i,projection:"EPSG:"+g.spatialReference.wkid}),m=new OpenLayers.Layer.ArcGISCache("National Map Vector","http://basemap.nationalmap.gov/ArcGIS/rest/services/TNM_Vector_Small/MapServer",{isBaseLayer:!1,wrapDateLine:!1,visibility:!1,resolutions:j,tileSize:new OpenLayers.Size(g.tileInfo.cols,g.tileInfo.rows),tileOrigin:new OpenLayers.LonLat(g.tileInfo.origin.x,g.tileInfo.origin.y),projection:"EPSG:"+g.spatialReference.wkid}),n=new OpenLayers.Layer.XYZ("GINA BDL","http://tiles.gina.alaska.edu/tilesrv/bdl/tile/${x}/${y}/${z}",{sphericalMercator:!0,isBaseLayer:!1,wrapDateLine:!0,displayInLayerSwitcher:!1}),o=Ext.create("GeoExt.slider.LayerOpacity",{id:"topoSlider",layer:l,complementaryLayer:n,changeVisibility:!0,aggressive:!0,vertical:!0,height:120,x:10,y:200,plugins:Ext.create("GeoExt.slider.Tip",{getText:function(a){return Ext.String.format("{0}%",a.value)}})}),p=new OpenLayers.Layer("Topo/Imagery",{sphericalMercator:!0,isBaseLayer:!1,wrapDateLine:!0,displayInLayerSwitcher:!0});p.events.on({visibilitychanged:function(a){var b=a.object.visibility,c=this;c.setVisible(b),c.complementaryLayer.setVisibility(b),c.layer.setVisibility(b)},scope:o});var q=new OpenLayers.Layer("Empty",{sphericalMercator:!0,isBaseLayer:!0,wrapDateLine:!0,displayInLayerSwitcher:!1});a.map=new OpenLayers.Map("map",{maxExtent:h,theme:null,units:"esriFeet"==g.units?"ft":"m",resolutions:j,tileSize:new OpenLayers.Size(g.tileInfo.cols,g.tileInfo.rows),projection:"EPSG:"+g.spatialReference.wkid,layers:[q,p,n,l,m,e]}),e.events.on({beforefeatureselected:function(a){if(a.feature.state===OpenLayers.State.DELETE)return!1}}),Ext.applyIf(a,{items:[{xtype:"gx_zoomslider",vertical:!0,height:100,x:10,y:70,plugins:Ext.create("GeoExt.SliderTip",{getText:function(a){var b=a.slider;return Ext.String.format("<div>Zoom Level: {0}</div><div>Resolution: {1}</div><div>Scale: 1 : {2}</div>",b.getZoom(),b.getResolution(),b.getScale())}})},o],projectVectors:e}),a.callParent(arguments),a.map.addControl(new OpenLayers.Control.LayerSwitcher),a.displayTools&&(a.mapToolbar={xtype:"maptoolbar",map:a.map,vectorLayer:e,saveStrategy:b,refreshStrategy:d,commonStore:a.commonStore,maskCmp:!0,dock:"top"},a.addDocked(a.mapToolbar))},addVector:function(a){var b,c,d=this,e=d.projectVectors,f=new OpenLayers.Format.WKT;if(c=f.read(a)){c.constructor!=Array&&(c=[c]);for(var g=0;g<c.length;++g)c[g].state=OpenLayers.State.INSERT,b?b.extend(c[g].geometry.getBounds()):b=c[g].geometry.getBounds();e.addFeatures(c),d.map.zoomToExtent(b)}}}),Ext.define("Extensible.form.field.DateRange",{extend:"Ext.form.FieldContainer",alias:"widget.extensible.daterangefield",requires:["Ext.form.field.Date","Ext.form.field.Time","Ext.form.Label","Ext.form.field.Checkbox"],toText:"to",allDayText:"All day",singleLine:!0,dateFormat:"n/j/Y",fieldLayout:{type:"hbox",defaultMargins:{top:0,right:5,bottom:0,left:0}},initComponent:function(){var a=this;a.timeFormat=a.timeFormat||(Extensible.Date.use24HourTime?"G:i":"g:i A"),a.addCls("ext-dt-range"),a.singleLine?(a.layout=a.fieldLayout,a.items=a.getFieldConfigs()):a.items=[{xtype:"container",layout:a.fieldLayout,items:[a.getStartDateConfig(),a.getStartTimeConfig(),a.getDateSeparatorConfig()]},{xtype:"container",layout:a.fieldLayout,items:[a.getEndDateConfig(),a.getEndTimeConfig(),a.getAllDayConfig()]}],a.callParent(arguments),a.initRefs()},initRefs:function(){var a=this;a.startDate=a.down("#"+a.id+"-start-date"),a.startTime=a.down("#"+a.id+"-start-time"),a.endTime=a.down("#"+a.id+"-end-time"),a.endDate=a.down("#"+a.id+"-end-date"),a.allDay=a.down("#"+a.id+"-allday"),a.toLabel=a.down("#"+a.id+"-to-label")},getFieldConfigs:function(){var a=this;return[a.getStartDateConfig(),a.getStartTimeConfig(),a.getDateSeparatorConfig(),a.getEndTimeConfig(),a.getEndDateConfig(),a.getAllDayConfig()]},getLayoutItems:function(a){var b=this;return a?b.items.items:[[b.startDate,b.startTime,b.toLabel],[b.endDate,b.endTime,b.allDay]]},getStartDateConfig:function(){return{xtype:"datefield",id:this.id+"-start-date",format:this.dateFormat,width:100,listeners:{change:{fn:function(){this.onFieldChange("date","start")},scope:this}}}},getStartTimeConfig:function(){return{xtype:"timefield",id:this.id+"-start-time",hidden:!1===this.showTimes,labelWidth:0,hideLabel:!0,width:90,format:this.timeFormat,listeners:{select:{fn:function(){this.onFieldChange("time","start")},scope:this}}}},getEndDateConfig:function(){return{xtype:"datefield",id:this.id+"-end-date",format:this.dateFormat,hideLabel:!0,width:100,listeners:{change:{fn:function(){this.onFieldChange("date","end")},scope:this}}}},getEndTimeConfig:function(){return{xtype:"timefield",id:this.id+"-end-time",hidden:!1===this.showTimes,labelWidth:0,hideLabel:!0,width:90,format:this.timeFormat,listeners:{select:{fn:function(){this.onFieldChange("time","end")},scope:this}}}},getAllDayConfig:function(){return{xtype:"checkbox",id:this.id+"-allday",hidden:!1===this.showTimes||!1===this.showAllDay,boxLabel:this.allDayText,margins:{top:2,right:5,bottom:0,left:0},handler:this.onAllDayChange,scope:this}},onAllDayChange:function(a,b){this.startTime.setVisible(!b),this.endTime.setVisible(!b)},getDateSeparatorConfig:function(){return{xtype:"label",id:this.id+"-to-label",text:this.toText,margins:{top:4,right:5,bottom:0,left:0}}},isSingleLine:function(){var a=this;if(void 0===a.calculatedSingleLine)if("auto"==a.singleLine){var b=a.ownerCt.getEl(),c=a.ownerCt.getWidth()-b.getPadding("lr"),d=b.down(".x-panel-body");d&&(c-=d.getPadding("lr")),d=b.down(".x-form-item-label"),d&&(c-=d.getWidth()-d.getPadding("lr")),singleLine=!(c<=a.singleLineMinWidth)}else a.calculatedSingleLine=void 0===a.singleLine||a.singleLine;return a.calculatedSingleLine},onFieldChange:function(a,b){this.checkDates(a,b),this.fireEvent("change",this,this.getValue())},checkDates:function(a,b){var c=this,d="date"===a?"Date":"Time",e=this["start"+d],f=this["end"+d],g=c.getDT("start"),h=c.getDT("end");g>h&&("start"==b?f.setValue(g):(e.setValue(h),c.checkDates(a,"start"))),"date"==a&&c.checkDates("time",b)},getValue:function(){return[this.getDT("start"),this.getDT("end"),this.allDay.getValue()]},getDT:function(a){var b=this[a+"Time"].getValue(),c=this[a+"Date"].getValue();if(!Ext.isDate(c))return null;if(c=Ext.Date.format(c,this[a+"Date"].format),b&&""!=b){b=Ext.Date.format(b,this[a+"Time"].format);return Ext.Date.parseDate(c+" "+b,this[a+"Date"].format+" "+this[a+"Time"].format)}return Ext.Date.parseDate(c,this[a+"Date"].format)},setValue:function(a){if(a){var b=this,c=Extensible.calendar.data.EventMappings,d=c.StartDate.name;Ext.isArray(a)?(b.setDT(a[0],"start"),b.setDT(a[1],"end"),b.allDay.setValue(!!a[2])):Ext.isDate(a)?(b.setDT(a,"start"),b.setDT(a,"end"),b.allDay.setValue(!1)):a[d]&&(b.setDT(a[d],"start"),b.setDT(a[c.EndDate.name],"end")||b.setDT(a[d],"end"),b.allDay.setValue(!!a[c.IsAllDay.name]))}},setDT:function(a,b){if(a&&Ext.isDate(a))return this[b+"Date"].setValue(a),this[b+"Time"].setValue(Ext.Date.format(a,this[b+"Time"].format)),!0},isDirty:function(){var a=!1;return this.rendered&&!this.disabled&&this.items.each(function(b){if(b.isDirty())return a=!0,!1}),a},reset:function(){this.delegateFn("reset")},delegateFn:function(a){this.items.each(function(b){b[a]&&b[a]()})},beforeDestroy:function(){Ext.destroy(this.fieldCt),this.callParent(arguments)},getRawValue:Ext.emptyFn,setRawValue:Ext.emptyFn}),Ext.define("Extensible.calendar.form.EventDetails",{extend:"Ext.form.Panel",alias:"widget.extensible.eventeditform",requires:["Extensible.form.field.DateRange","Extensible.calendar.form.field.ReminderCombo","Extensible.calendar.data.EventMappings","Extensible.calendar.form.field.CalendarCombo","Extensible.form.recurrence.Combo","Ext.layout.container.Column"],labelWidth:65,labelWidthRightCol:65,colWidthLeft:.6,colWidthRight:.4,title:"Event Form",titleTextAdd:"Add Event",titleTextEdit:"Edit Event",titleLabelText:"Title",datesLabelText:"When",reminderLabelText:"Reminder",notesLabelText:"Notes",locationLabelText:"Location",webLinkLabelText:"Web Link",calendarLabelText:"Calendar",repeatsLabelText:"Repeats",saveButtonText:"Save",deleteButtonText:"Delete",cancelButtonText:"Cancel",bodyStyle:"padding:20px 20px 10px;",border:!1,buttonAlign:"center",autoHeight:!0,enableRecurrence:!1,layout:"column",initComponent:function(){this.addEvents({eventadd:!0,eventupdate:!0,eventdelete:!0,eventcancel:!0}),this.titleField=Ext.create("Ext.form.TextField",{fieldLabel:this.titleLabelText,name:Extensible.calendar.data.EventMappings.Title.name,anchor:"90%"}),this.dateRangeField=Ext.create("Extensible.form.field.DateRange",{fieldLabel:this.datesLabelText,singleLine:!1,anchor:"90%",listeners:{change:Ext.bind(this.onDateChange,this)}}),this.reminderField=Ext.create("Extensible.calendar.form.field.ReminderCombo",{name:Extensible.calendar.data.EventMappings.Reminder.name,fieldLabel:this.reminderLabelText,anchor:"70%"}),this.notesField=Ext.create("Ext.form.TextArea",{fieldLabel:this.notesLabelText,name:Extensible.calendar.data.EventMappings.Notes.name,grow:!0,growMax:150,anchor:"100%"}),this.locationField=Ext.create("Ext.form.TextField",{fieldLabel:this.locationLabelText,name:Extensible.calendar.data.EventMappings.Location.name,anchor:"100%"}),this.urlField=Ext.create("Ext.form.TextField",{fieldLabel:this.webLinkLabelText,name:Extensible.calendar.data.EventMappings.Url.name,anchor:"100%"});var a=[this.titleField,this.dateRangeField,this.reminderField],b=[this.notesField,this.locationField,this.urlField];this.enableRecurrence&&(this.recurrenceField=Ext.create("Extensible.form.recurrence.Fieldset",{name:Extensible.calendar.data.EventMappings.RRule.name,fieldLabel:this.repeatsLabelText,anchor:"90%"}),a.splice(2,0,this.recurrenceField)),this.calendarStore&&(this.calendarField=Ext.create("Extensible.calendar.form.field.CalendarCombo",{store:this.calendarStore,fieldLabel:this.calendarLabelText,name:Extensible.calendar.data.EventMappings.CalendarId.name,anchor:"70%"}),a.splice(2,0,this.calendarField)),this.items=[{id:this.id+"-left-col",columnWidth:this.colWidthLeft,layout:"anchor",fieldDefaults:{labelWidth:this.labelWidth},border:!1,items:a},{id:this.id+"-right-col",columnWidth:this.colWidthRight,layout:"anchor",fieldDefaults:{labelWidth:this.labelWidthRightCol||this.labelWidth},border:!1,items:b}],this.fbar=[{text:this.saveButtonText,scope:this,handler:this.onSave},{itemId:this.id+"-del-btn",text:this.deleteButtonText,scope:this,handler:this.onDelete},{text:this.cancelButtonText,scope:this,handler:this.onCancel}],this.addCls("ext-evt-edit-form"),this.callParent(arguments)},onDateChange:function(a,b){this.recurrenceField&&this.recurrenceField.setStartDate(b[0])},loadRecord:function(a){this.form.reset().loadRecord.apply(this.form,arguments),this.activeRecord=a,this.dateRangeField.setValue(a.data),this.recurrenceField&&this.recurrenceField.setStartDate(a.data[Extensible.calendar.data.EventMappings.StartDate.name]),this.calendarStore&&this.form.setValues({calendar:a.data[Extensible.calendar.data.EventMappings.CalendarId.name]}),a.phantom?(this.setTitle(this.titleTextAdd),this.down("#"+this.id+"-del-btn").hide()):(this.setTitle(this.titleTextEdit),this.down("#"+this.id+"-del-btn").show()),this.titleField.focus()},updateRecord:function(){var a=this.dateRangeField.getValue(),b=Extensible.calendar.data.EventMappings,c=this.activeRecord,d=c.fields,e=!1;return c.beginEdit(),d.each(function(a){var b=this.form.findField(a.name);if(b){var d=b.getValue();d.getGroupValue?d=d.getGroupValue():b.eachItem&&(d=[],b.eachItem(function(a){d.push(a.getValue())})),c.set(a.name,d)}},this),c.set(b.StartDate.name,a[0]),c.set(b.EndDate.name,a[1]),c.set(b.IsAllDay.name,a[2]),e=c.dirty,c.endEdit(),e},onCancel:function(){this.cleanup(!0),this.fireEvent("eventcancel",this,this.activeRecord)},cleanup:function(a){this.activeRecord&&this.activeRecord.reject(),delete this.activeRecord,this.form.isDirty()&&this.form.reset()},onSave:function(){if(this.form.isValid())return this.updateRecord()?void this.fireEvent(this.activeRecord.phantom?"eventadd":"eventupdate",this,this.activeRecord):void this.onCancel()},onDelete:function(){this.fireEvent("eventdelete",this,this.activeRecord)}}),Ext.define("Extensible.calendar.view.AbstractCalendar",{extend:"Ext.Component",requires:["Ext.CompositeElement"],requires:["Extensible.calendar.form.EventDetails","Extensible.calendar.form.EventWindow","Extensible.calendar.menu.Event","Extensible.calendar.dd.DragZone","Extensible.calendar.dd.DropZone"],startDay:0,spansHavePriority:!1,trackMouseOver:!0,enableFx:!0,enableAddFx:!0,enableUpdateFx:!1,enableRemoveFx:!0,enableDD:!0,enableContextMenus:!0,suppressBrowserContextMenu:!1,monitorResize:!0,todayText:"Today",ddCreateEventText:"Create event for {0}",ddMoveEventText:"Move event to {0}",ddResizeEventText:"Update event to {0}",defaultEventTitleText:"(No title)",dateParamStart:"startDate",dateParamEnd:"endDate",dateParamFormat:"Y-m-d",editModal:!1,enableEditDetails:!0,weekendCls:"ext-cal-day-we",prevMonthCls:"ext-cal-day-prev",nextMonthCls:"ext-cal-day-next",todayCls:"ext-cal-day-today",hideMode:"offsets",weekCount:1,dayCount:1,eventSelector:".ext-cal-evt",eventOverClass:"ext-evt-over",eventElIdDelimiter:"-evt-",dayElIdDelimiter:"-day-",getEventBodyMarkup:Ext.emptyFn,
getEventTemplate:Ext.emptyFn,initComponent:function(){this.setStartDate(this.startDate||new Date),this.callParent(arguments),!0===this.readOnly&&this.addCls("ext-cal-readonly"),this.addEvents({eventsrendered:!0,eventclick:!0,eventover:!0,eventout:!0,beforedatechange:!0,datechange:!0,rangeselect:!0,beforeeventmove:!0,eventmove:!0,initdrag:!0,dayover:!0,dayout:!0,editdetails:!0,eventadd:!0,eventupdate:!0,eventcancel:!0,beforeeventdelete:!0,eventdelete:!0})},afterRender:function(){this.callParent(arguments),this.renderTemplate(),this.store&&(this.setStore(this.store,!0),this.store.deferLoad?(this.reloadStore(this.store.deferLoad),delete this.store.deferLoad):this.store.initialParams=this.getStoreParams()),this.calendarStore&&this.setCalendarStore(this.calendarStore,!0),this.on("resize",this.onResize,this),this.el.on({mouseover:this.onMouseOver,mouseout:this.onMouseOut,click:this.onClick,scope:this}),this.enableContextMenus&&!0!==this.readOnly&&this.el.on("contextmenu",this.onContextMenu,this),this.el.unselectable(),this.enableDD&&!0!==this.readOnly&&this.initDD&&this.initDD(),this.on("eventsrendered",this.onEventsRendered),Ext.defer(this.forceSize,100,this)},getStoreDateParams:function(){var a={};return a[this.dateParamStart]=Ext.Date.format(this.viewStart,this.dateParamFormat),a[this.dateParamEnd]=Ext.Date.format(this.viewEnd,this.dateParamFormat),a},getStoreParams:function(){return this.getStoreDateParams()},reloadStore:function(a){Extensible.log("reloadStore"),a=Ext.isObject(a)?a:{},a.params=a.params||{},Ext.apply(a.params,this.getStoreParams()),this.store.load(a)},onEventsRendered:function(){this.forceSize()},forceSize:function(){if(this.el&&this.el.down){var a=this.el.down(".ext-cal-hd-ct"),b=this.el.down(".ext-cal-body-ct");if(null==b||null==a)return;var c=a.getHeight(),d=this.el.parent().getSize();b.setHeight(d.height-c)}},refresh:function(a){Extensible.log("refresh (base), reload = "+a),!0===a&&this.reloadStore(),this.prepareData(),this.renderTemplate(),this.renderItems()},getWeekCount:function(){var a=Extensible.Date.diffDays(this.viewStart,this.viewEnd);return Math.ceil(a/this.dayCount)},prepareData:function(){var a=Ext.Date.getLastDateOfMonth(this.startDate),b=0,c=Ext.Date.clone(this.viewStart),e=this.weekCount<1?6:this.weekCount;this.eventGrid=[[]],this.allDayGrid=[[]],this.evtMaxCount=[];for(var f=this.store.queryBy(function(a){return this.isEventVisible(a.data)},this);b<e&&(this.evtMaxCount[b]=0,!(-1==this.weekCount&&c>a));b++)for(this.eventGrid[b]=this.eventGrid[b]||[],this.allDayGrid[b]=this.allDayGrid[b]||[],d=0;d<this.dayCount;d++){if(f.getCount()>0){var g=f.filterBy(function(a){var e=Ext.Date.clearTime(a.data[Extensible.calendar.data.EventMappings.StartDate.name],!0),f=c.getTime()==e.getTime(),g=0==b&&0==d&&c>a.data[Extensible.calendar.data.EventMappings.StartDate.name];return f||g},this);this.sortEventRecordsForDay(g),this.prepareEventGrid(g,b,d)}c=Extensible.Date.add(c,{days:1})}this.currentWeekCount=b},prepareEventGrid:function(a,b,c){var d,e=this,f=0,g=(Ext.Date.clone(e.viewStart),e.maxEventsPerDay||999);a.each(function(a){var h=Extensible.calendar.data.EventMappings;if(Extensible.Date.diffDays(a.data[h.StartDate.name],a.data[h.EndDate.name])>0){var i=Extensible.Date.diffDays(Extensible.Date.max(e.viewStart,a.data[h.StartDate.name]),Extensible.Date.min(e.viewEnd,a.data[h.EndDate.name]))+1;e.prepareEventGridSpans(a,e.eventGrid,b,c,i),e.prepareEventGridSpans(a,e.allDayGrid,b,c,i,!0)}else f=e.findEmptyRowIndex(b,c),e.eventGrid[b][c]=e.eventGrid[b][c]||[],e.eventGrid[b][c][f]=a,a.data[h.IsAllDay.name]&&(f=e.findEmptyRowIndex(b,c,!0),e.allDayGrid[b][c]=e.allDayGrid[b][c]||[],e.allDayGrid[b][c][f]=a);return d=e[e.isHeaderView?"allDayGrid":"eventGrid"][b][c]||[],d.length&&e.evtMaxCount[b]<d.length&&(e.evtMaxCount[b]=Math.min(g+1,d.length)),!0},e)},prepareEventGridSpans:function(a,b,c,d,e,f){var g=c,h=d,i=this.findEmptyRowIndex(c,d,f),j=Ext.Date.clone(this.viewStart),k={event:a,isSpan:!0,isSpanStart:!0,spanLeft:!1,spanRight:6==d};for(b[c][d]=b[c][d]||[],b[c][d][i]=k;--e&&!((j=Extensible.Date.add(j,{days:1}))>this.viewEnd);)++h>6&&(h=0,g++,i=this.findEmptyRowIndex(g,0)),b[g]=b[g]||[],b[g][h]=b[g][h]||[],b[g][h][i]={event:a,isSpan:!0,isSpanStart:0==h,spanLeft:g>c&&h%7==0,spanRight:6==h&&e>1}},findEmptyRowIndex:function(a,b,c){for(var d=c?this.allDayGrid:this.eventGrid,e=d[a]?d[a][b]||[]:[],f=0,g=e.length;f<g;f++)if(null==e[f])return f;return g},renderTemplate:function(){this.tpl&&(this.tpl.overwrite(this.el,this.getTemplateParams()),this.lastRenderStart=Ext.Date.clone(this.viewStart),this.lastRenderEnd=Ext.Date.clone(this.viewEnd))},getTemplateParams:function(){return{viewStart:this.viewStart,viewEnd:this.viewEnd,startDate:this.startDate,dayCount:this.dayCount,weekCount:this.weekCount,weekendCls:this.weekendCls,prevMonthCls:this.prevMonthCls,nextMonthCls:this.nextMonthCls,todayCls:this.todayCls}},disableStoreEvents:function(){return this.monitorStoreEvents=!1,this},enableStoreEvents:function(a){return this.monitorStoreEvents=!0,!0===a&&this.refresh(),this},onResize:function(){this.refresh(!1)},onInitDrag:function(){this.fireEvent("initdrag",this)},onEventDrop:function(a,b){this.moveEvent(a,b)},onCalendarEndDrag:function(a,b,c){this.dragPending=!0;var d={},c=Ext.bind(this.onCalendarEndDragComplete,this,[c]);d[Extensible.calendar.data.EventMappings.StartDate.name]=a,d[Extensible.calendar.data.EventMappings.EndDate.name]=b,!1!==this.fireEvent("rangeselect",this,d,c)?(this.showEventEditor(d,null),this.editWin?this.editWin.on("hide",c,this,{single:!0}):c()):this.onCalendarEndDragComplete(c)},onCalendarEndDragComplete:function(a){a(),this.dragPending=!1},onUpdate:function(a,b,c){if(!0!==this.hidden&&!1!==this.monitorStoreEvents&&c==Ext.data.Record.COMMIT){Extensible.log("onUpdate"),this.dismissEventEditor();var d=b.data[Extensible.calendar.data.EventMappings.RRule.name];this.refresh(void 0!==d&&""!==d),this.enableFx&&this.enableUpdateFx&&this.doUpdateFx(this.getEventEls(b.data[Extensible.calendar.data.EventMappings.EventId.name]),{scope:this})}},doUpdateFx:function(a,b){this.highlightEvent(a,null,b)},onAdd:function(a,b,c){var d=Ext.isArray(b)?b[0]:b;if(!0!==this.hidden&&!1!==this.monitorStoreEvents){if(d._deleting)return void delete d._deleting;Extensible.log("onAdd");var e=d.data[Extensible.calendar.data.EventMappings.RRule.name];this.dismissEventEditor(),this.tempEventId=d.id,this.refresh(void 0!==e&&""!==e),this.enableFx&&this.enableAddFx&&this.doAddFx(this.getEventEls(d.data[Extensible.calendar.data.EventMappings.EventId.name]),{scope:this})}},doAddFx:function(a,b){a.fadeIn(Ext.apply(b,{duration:2e3}))},onRemove:function(a,b){if(!0!==this.hidden&&!1!==this.monitorStoreEvents){Extensible.log("onRemove"),this.dismissEventEditor();var c=b.data[Extensible.calendar.data.EventMappings.RRule.name],d=void 0!==c&&""!==c;this.enableFx&&this.enableRemoveFx?this.doRemoveFx(this.getEventEls(b.data[Extensible.calendar.data.EventMappings.EventId.name]),{remove:!0,scope:this,callback:Ext.bind(this.refresh,this,[d])}):(this.getEventEls(b.data[Extensible.calendar.data.EventMappings.EventId.name]).remove(),this.refresh(d))}},doRemoveFx:function(a,b){0==a.getCount()&&Ext.isFunction(b.callback)?b.callback.call(b.scope||this):a.fadeOut(b)},highlightEvent:function(a,b,c){if(this.enableFx){var d;Ext.isIE||Ext.isOpera?a.each(function(a){a.highlight(b,Ext.applyIf({attr:"color"},c)),(d=a.down(".ext-cal-evm"))&&d.highlight(b,c)},this):a.highlight(b,c)}},getEventIdFromEl:function(a){a=Ext.get(a);var b,c="",d=a.dom.className.split(" ");return Ext.each(d,function(a){if(b=a.split(this.eventElIdDelimiter),b.length>1)return c=b[1],!1},this),c},getEventId:function(a){return void 0===a&&this.tempEventId&&(a=this.tempEventId),a},getEventSelectorCls:function(a,b){return(b?".":"")+this.id+this.eventElIdDelimiter+this.getEventId(a)},getEventEls:function(a){var b=this.el.select(this.getEventSelectorCls(this.getEventId(a),!0),!1);return Ext.create("Ext.CompositeElement",b)},isToday:function(){var a=Ext.Date.clearTime(new Date).getTime();return this.viewStart.getTime()<=a&&this.viewEnd.getTime()>=a},onDataChanged:function(a){Extensible.log("onDataChanged"),this.refresh(!1)},isEventVisible:function(a){var b=Extensible.calendar.data.EventMappings,c=a.data||a,d=this.calendarStore?this.calendarStore.findRecord(b.CalendarId.name,a[b.CalendarId.name]):null;if(d&&!0===d.data[Extensible.calendar.data.CalendarMappings.IsHidden.name])return!1;var e=this.viewStart.getTime(),f=this.viewEnd.getTime(),g=c[b.StartDate.name].getTime(),h=c[b.EndDate.name].getTime();return Extensible.Date.rangesOverlap(e,f,g,h)},isOverlapping:function(a,b){var c=a.data?a.data:a,d=b.data?b.data:b,e=Extensible.calendar.data.EventMappings,f=c[e.StartDate.name].getTime(),g=Extensible.Date.add(c[e.EndDate.name],{seconds:-1}).getTime(),h=d[e.StartDate.name].getTime(),i=Extensible.Date.add(d[e.EndDate.name],{seconds:-1}).getTime(),j=Extensible.Date.diff(c[e.StartDate.name],d[e.StartDate.name],"m");g<f&&(g=f),i<h&&(i=h);var k=Extensible.Date.rangesOverlap(f,g,h,i),l=this.minEventDisplayMinutes||0,m=l>0&&j>-l&&j<l;return k||m},isEventSpanning:function(a){var b=Extensible.calendar.data.EventMappings,c=a.data||a;return Extensible.Date.diffDays(c[b.StartDate.name],c[b.EndDate.name])>0},getDayEl:function(a){return Ext.get(this.getDayId(a))},getDayId:function(a){return Ext.isDate(a)&&(a=Ext.Date.format(a,"Ymd")),this.id+this.dayElIdDelimiter+a},getStartDate:function(){return this.startDate},setStartDate:function(a,b){var c=this;Extensible.log("setStartDate (base) "+Ext.Date.format(a,"Y-m-d"));var d=Ext.Date.clone,e=c.startDate?d(c.startDate):null,f=d(a),g=c.viewStart?d(c.viewStart):null,h=c.viewEnd?d(c.viewEnd):null;!1!==c.fireEvent("beforedatechange",c,e,f,g,h)&&(c.startDate=Ext.Date.clearTime(a),c.setViewBounds(a),c.ownerCalendarPanel&&c.ownerCalendarPanel.startDate!==c.startDate&&(c.ownerCalendarPanel.startDate=c.startDate),c.rendered&&c.refresh(b),c.fireEvent("datechange",c,d(c.startDate),d(c.viewStart),d(c.viewEnd)))},setViewBounds:function(a){var b=this,c=a||b.startDate,d=c.getDay()-b.startDay,e=Extensible.Date;switch(d<0&&(d+=7),this.weekCount){case 0:case 1:return b.viewStart=b.dayCount<7&&!b.startDayIsStatic?c:e.add(c,{days:-d,clearTime:!0}),void(b.viewEnd=e.add(b.viewStart,{days:b.dayCount||7,seconds:-1}));case-1:c=Ext.Date.getFirstDateOfMonth(c),d=c.getDay()-b.startDay,d<0&&(d+=7),b.viewStart=e.add(c,{days:-d,clearTime:!0});var f=e.add(c,{months:1,seconds:-1});return d=b.startDay,d>f.getDay()&&(d-=7),void(b.viewEnd=e.add(f,{days:6-f.getDay()+d}));default:b.viewStart=e.add(c,{days:-d,clearTime:!0}),b.viewEnd=e.add(b.viewStart,{days:7*b.weekCount,seconds:-1})}},getViewBounds:function(){return{start:this.viewStart,end:this.viewEnd}},sortEventRecordsForDay:function(a){a.length<2||a.sortBy(Ext.bind(function(a,b){var c=a.data,d=b.data,e=Extensible.calendar.data.EventMappings;if(c[e.IsAllDay.name])return-1;if(d[e.IsAllDay.name])return 1;if(this.spansHavePriority){var f=Extensible.Date.diffDays;return f(c[e.StartDate.name],c[e.EndDate.name])>0?f(d[e.StartDate.name],d[e.EndDate.name])>0?c[e.StartDate.name].getTime()==d[e.StartDate.name].getTime()?d[e.EndDate.name].getTime()-c[e.EndDate.name].getTime():c[e.StartDate.name].getTime()-d[e.StartDate.name].getTime():-1:f(d[e.StartDate.name],d[e.EndDate.name])>0?1:c[e.StartDate.name].getTime()-d[e.StartDate.name].getTime()}return c[e.StartDate.name].getTime()-d[e.StartDate.name].getTime()},this))},moveTo:function(a,b){return Ext.isDate(a)?(this.setStartDate(a,b),this.startDate):a},moveNext:function(a){return this.moveTo(Extensible.Date.add(this.viewEnd,{days:1}),a)},movePrev:function(a){var b=Extensible.Date.diffDays(this.viewStart,this.viewEnd)+1;return this.moveDays(-b,a)},moveMonths:function(a,b){return this.moveTo(Extensible.Date.add(this.startDate,{months:a}),b)},moveWeeks:function(a,b){return this.moveTo(Extensible.Date.add(this.startDate,{days:7*a}),b)},moveDays:function(a,b){return this.moveTo(Extensible.Date.add(this.startDate,{days:a}),b)},moveToday:function(a){return this.moveTo(new Date,a)},setStore:function(a,b){var c=this.store;!b&&c&&(c.un("datachanged",this.onDataChanged,this),c.un("clear",this.refresh,this),c.un("write",this.onWrite,this),c.un("exception",this.onException,this)),a&&(a.on("datachanged",this.onDataChanged,this),a.on("clear",this.refresh,this),a.on("write",this.onWrite,this),a.on("exception",this.onException,this)),this.store=a},onException:function(a,b,c,d,e,f){f.reject&&f.reject()},setCalendarStore:function(a,b){!b&&this.calendarStore&&(this.calendarStore.un("datachanged",this.refresh,this),this.calendarStore.un("add",this.refresh,this),this.calendarStore.un("remove",this.refresh,this),this.calendarStore.un("update",this.refresh,this)),a&&(a.on("datachanged",this.refresh,this),a.on("add",this.refresh,this),a.on("remove",this.refresh,this),a.on("update",this.refresh,this)),this.calendarStore=a},getEventRecord:function(a){var b=this.store.find(Extensible.calendar.data.EventMappings.EventId.name,a,0,!1,!0,!0);return this.store.getAt(b)},getEventRecordFromEl:function(a){return this.getEventRecord(this.getEventIdFromEl(a))},getEventEditor:function(){return this.editWin=this.editWin||Ext.WindowMgr.get("ext-cal-editwin"),this.editWin||(this.editWin=Ext.create("Extensible.calendar.form.EventWindow",{id:"ext-cal-editwin",calendarStore:this.calendarStore,modal:this.editModal,enableEditDetails:this.enableEditDetails,listeners:{eventadd:{fn:function(a,b,c){a.currentView.onEventAdd(null,b)},scope:this},eventupdate:{fn:function(a,b,c){a.currentView.onEventUpdate(null,b)},scope:this},eventdelete:{fn:function(a,b,c){a.currentView.onEventDelete(null,b)},scope:this},editdetails:{fn:function(a,b,c,d){a.animateTarget=null,a.hide(),a.currentView.fireEvent("editdetails",a.currentView,b)},scope:this},eventcancel:{fn:function(a,b,c){this.dismissEventEditor(null,c),a.currentView.onEventCancel()},scope:this}}})),this.editWin.currentView=this,this.editWin},showEventEditor:function(a,b){return this.getEventEditor().show(a,b,this),this},dismissEventEditor:function(a,b){this.newRecord&&this.newRecord.phantom&&this.store.remove(this.newRecord),delete this.newRecord;var c=Ext.WindowMgr.get("ext-cal-editwin");return c&&c[a||"hide"](b),this},save:function(){this.store.autoSync||this.store.sync()},onWrite:function(a,b){if(b.wasSuccessful()){var c=b.records[0];switch(b.action){case"create":this.onAdd(a,c);break;case"update":this.onUpdate(a,c,Ext.data.Record.COMMIT);break;case"destroy":this.onRemove(a,c)}}},onEventAdd:function(a,b){this.newRecord=b,b.store||(this.store.add(b),this.save()),this.fireEvent("eventadd",this,b)},onEventUpdate:function(a,b){this.save(),this.fireEvent("eventupdate",this,b)},onEventDelete:function(a,b){b.store&&this.store.remove(b),this.save(),this.fireEvent("eventdelete",this,b)},onEventCancel:function(a,b){this.fireEvent("eventcancel",this,b)},onDayClick:function(a,b,c){if(!0!==this.readOnly&&!1!==this.fireEvent("dayclick",this,Ext.Date.clone(a),b,c)){var d=Extensible.calendar.data.EventMappings,e={};e[d.StartDate.name]=a,e[d.IsAllDay.name]=b,this.showEventEditor(e,c)}},showEventMenu:function(a,b){this.eventMenu||(this.eventMenu=Ext.create("Extensible.calendar.menu.Event",{listeners:{editdetails:Ext.bind(this.onEditDetails,this),eventdelete:Ext.bind(this.onDeleteEvent,this),eventmove:Ext.bind(this.onMoveEvent,this)}})),this.eventMenu.showForEvent(this.getEventRecordFromEl(a),a,b),this.menuActive=!0},onEditDetails:function(a,b,c){this.fireEvent("editdetails",this,b,c),this.menuActive=!1},onMoveEvent:function(a,b,c){this.moveEvent(b,c),this.menuActive=!1},moveEvent:function(a,b){if(0!==Extensible.Date.compare(a.data[Extensible.calendar.data.EventMappings.StartDate.name],b)&&!1!==this.fireEvent("beforeeventmove",this,a,Ext.Date.clone(b))){var c=b.getTime()-a.data[Extensible.calendar.data.EventMappings.StartDate.name].getTime();a.beginEdit(),a.set(Extensible.calendar.data.EventMappings.StartDate.name,b),a.set(Extensible.calendar.data.EventMappings.EndDate.name,Extensible.Date.add(a.data[Extensible.calendar.data.EventMappings.EndDate.name],{millis:c})),a.endEdit(),this.save(),this.fireEvent("eventmove",this,a)}},onDeleteEvent:function(a,b,c){b._deleting=!0,this.deleteEvent(b,c),this.menuActive=!1},deleteEvent:function(a,b){!1!==this.fireEvent("beforeeventdelete",this,a,b)&&(this.store.remove(a),this.save(),this.fireEvent("eventdelete",this,a,b))},onContextMenu:function(a,b){var c,d=!1;(c=a.getTarget(this.eventSelector,5,!0))&&(this.dismissEventEditor().showEventMenu(c,a.getXY()),d=!0),(d||!0===this.suppressBrowserContextMenu)&&a.preventDefault()},onClick:function(a,b){var c=this,d=a.getTarget(c.eventSelector,5);if(c.dropZone&&c.dropZone.clearShims(),!0===c.menuActive)return c.menuActive=!1,!0;if(d){var e=c.getEventIdFromEl(d),f=c.getEventRecord(e);return!1!==c.fireEvent("eventclick",c,f,d)&&!0!==c.readOnly&&c.showEventEditor(f,d),!0}},onMouseOver:function(a,b){!1===this.trackMouseOver||void 0!=this.dragZone&&this.dragZone.dragging||this.handleEventMouseEvent(a,b,"over")||this.handleDayMouseEvent(a,b,"over")},onMouseOut:function(a,b){!1===this.trackMouseOver||void 0!=this.dragZone&&this.dragZone.dragging||this.handleEventMouseEvent(a,b,"out")||this.handleDayMouseEvent(a,b,"out")},handleEventMouseEvent:function(a,b,c){var d;if(d=a.getTarget(this.eventSelector,5,!0)){var e=Ext.get(a.getRelatedTarget());if(d==e||d.contains(e))return!0;var f=this.getEventIdFromEl(d);if(""!=this.eventOverClass){this.getEventEls(f)["over"==c?"addCls":"removeCls"](this.eventOverClass)}return this.fireEvent("event"+c,this,this.getEventRecord(f),d),!0}return!1},getDateFromId:function(a,b){var c=a.split(b);return c[c.length-1]},handleDayMouseEvent:function(a,b,c){if((b=a.getTarget("td",3))&&b.id&&b.id.indexOf(this.dayElIdDelimiter)>-1){var d,e,f=this.getDateFromId(b.id,this.dayElIdDelimiter),g=Ext.get(a.getRelatedTarget());if(g&&(d=g.is("td")?g:g.up("td",3),e=d&&d.id?this.getDateFromId(d.id,this.dayElIdDelimiter):""),!g||f!=e){var h=this.getDayEl(f);h&&""!=this.dayOverClass&&h["over"==c?"addCls":"removeCls"](this.dayOverClass),this.fireEvent("day"+c,this,Ext.Date.parseDate(f,"Ymd"),h)}}},renderItems:function(){throw"This method must be implemented by a subclass"},destroy:function(){this.callParent(arguments),this.el&&this.el.un("contextmenu",this.onContextMenu,this),Ext.destroy(this.editWin,this.eventMenu,this.dragZone,this.dropZone)}}),Ext.define("Extensible.calendar.view.MonthDayDetail",{extend:"Ext.Component",alias:"widget.extensible.monthdaydetailview",requires:["Ext.XTemplate","Extensible.calendar.view.AbstractCalendar"],initComponent:function(){this.callParent(arguments),this.addEvents({eventsrendered:!0})},afterRender:function(){this.tpl=this.getTemplate(),this.callParent(arguments),this.el.on({click:this.view.onClick,mouseover:this.view.onMouseOver,mouseout:this.view.onMouseOut,scope:this.view})},getTemplate:function(){return this.tpl||(this.tpl=Ext.create("Ext.XTemplate",'<div class="ext-cal-mdv x-unselectable">','<table class="ext-cal-mvd-tbl" cellpadding="0" cellspacing="0">',"<tbody>",'<tpl for=".">','<tr><td class="ext-cal-ev">{markup}</td></tr>',"</tpl>","</tbody>","</table>","</div>")),this.tpl.compile(),this.tpl},update:function(a){this.date=a,this.refresh()},refresh:function(){if(this.rendered){var a=this.view.getEventTemplate(),b=[];evts=this.store.queryBy(function(a){var b=Ext.Date.clearTime(this.date,!0).getTime(),c=Extensible.calendar.data.EventMappings,d=Ext.Date.clearTime(a.data[c.StartDate.name],!0).getTime(),e=b==d,f=!1,g=a.data[c.CalendarId.name],h=this.calendarStore?this.calendarStore.getById(g):null;if(h&&!0===h.data[Extensible.calendar.data.CalendarMappings.IsHidden.name])return!1;if(!e){var i=Ext.Date.clearTime(a.data[c.EndDate.name],!0).getTime();f=d<b&&i>=b}return e||f},this),Extensible.calendar.view.AbstractCalendar.prototype.sortEventRecordsForDay.call(this,evts),evts.each(function(c){var d=c.data,e=Extensible.calendar.data.EventMappings;d._renderAsAllDay=d[e.IsAllDay.name]||Extensible.Date.diffDays(d[e.StartDate.name],d[e.EndDate.name])>0,d.spanLeft=Extensible.Date.diffDays(d[e.StartDate.name],this.date)>0,d.spanRight=Extensible.Date.diffDays(this.date,d[e.EndDate.name])>0,d.spanCls=d.spanLeft?d.spanRight?"ext-cal-ev-spanboth":"ext-cal-ev-spanleft":d.spanRight?"ext-cal-ev-spanright":"",b.push({markup:a.apply(this.getTemplateEventData(d))})},this),this.tpl.overwrite(this.el,b),this.fireEvent("eventsrendered",this,this.date,evts.getCount())}},getTemplateEventData:function(a){var b=this.view.getTemplateEventData(a);return b._elId="dtl-"+b._elId,b}}),Ext.define("Extensible.calendar.view.Month",{extend:"Extensible.calendar.view.AbstractCalendar",alias:"widget.extensible.monthview",requires:["Ext.XTemplate","Extensible.calendar.template.Month","Extensible.calendar.util.WeekEventRenderer","Extensible.calendar.view.MonthDayDetail"],moreText:"+{0} more...",detailsTitleDateFormat:"F j",showTime:!0,showTodayText:!0,showHeader:!1,showWeekLinks:!1,showWeekNumbers:!1,weekLinkOverClass:"ext-week-link-over",daySelector:".ext-cal-day",moreSelector:".ext-cal-ev-more",weekLinkSelector:".ext-cal-week-link",weekCount:-1,dayCount:7,moreElIdDelimiter:"-more-",weekLinkIdDelimiter:"ext-cal-week-",initComponent:function(){this.callParent(arguments),this.addEvents({dayclick:!0,weekclick:!0,dayover:!0,dayout:!0})},initDD:function(){var a={view:this,createText:this.ddCreateEventText,moveText:this.ddMoveEventText,ddGroup:this.ddGroup||this.id+"-MonthViewDD"};this.dragZone=Ext.create("Extensible.calendar.dd.DragZone",this.el,a),this.dropZone=Ext.create("Extensible.calendar.dd.DropZone",this.el,a)},onDestroy:function(){Ext.destroy(this.ddSelector),Ext.destroy(this.dragZone),Ext.destroy(this.dropZone),this.callParent(arguments)},afterRender:function(){this.tpl||(this.tpl=Ext.create("Extensible.calendar.template.Month",{id:this.id,showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime,showHeader:this.showHeader,showWeekLinks:this.showWeekLinks,showWeekNumbers:this.showWeekNumbers}),this.tpl.compile()),this.addCls("ext-cal-monthview ext-cal-ct"),this.callParent(arguments)},onResize:function(){this.monitorResize&&(this.maxEventsPerDay=this.getMaxEventsPerDay(),this.refresh(!1))},forceSize:function(){if(this.showWeekLinks&&this.el){var a=this.el.down(".ext-cal-hd-days-tbl"),b=this.el.select(".ext-cal-bg-tbl"),c=this.el.select(".ext-cal-evt-tbl"),d=this.el.down(".ext-cal-week-link").getWidth(),e=this.el.getWidth()-d;a.setWidth(e),b.setWidth(e),c.setWidth(e)}this.callParent(arguments)},initClock:function(){null!==Ext.fly(this.id+"-clock")&&(this.prevClockDay=(new Date).getDay(),this.clockTask&&Ext.TaskManager.stop(this.clockTask),this.clockTask=Ext.TaskManager.start({run:function(){var a=Ext.fly(this.id+"-clock"),b=new Date;b.getDay()==this.prevClockDay?a&&a.update(Ext.Date.format(b,Extensible.Date.use24HourTime?"G:i":"g:ia")):(this.prevClockDay=b.getDay(),this.moveTo(b))},scope:this,interval:1e3}))},getMoreText:function(a){return this.moreText},getEventBodyMarkup:function(){return this.eventBodyMarkup||(this.eventBodyMarkup=["{Title}",'<tpl if="_isReminder">','<i class="ext-cal-ic ext-cal-ic-rem">&#160;</i>',"</tpl>",'<tpl if="_isRecurring">','<i class="ext-cal-ic ext-cal-ic-rcr">&#160;</i>',"</tpl>",'<tpl if="spanLeft">','<i class="ext-cal-spl">&#160;</i>',"</tpl>",'<tpl if="spanRight">','<i class="ext-cal-spr">&#160;</i>',"</tpl>"].join("")),this.eventBodyMarkup},getEventTemplate:function(){if(!this.eventTpl){var a,b=this.getEventBodyMarkup();a=Ext.isIE||Ext.isOpera?Ext.create("Ext.XTemplate",'<tpl if="_renderAsAllDay">','<div class="{_extraCls} {spanCls} ext-cal-evt ext-cal-evo">','<div class="ext-cal-evm">','<div class="ext-cal-evi">',"</tpl>",'<tpl if="!_renderAsAllDay">','<div class="{_extraCls} ext-cal-evt ext-cal-evr">',"</tpl>",b,'<tpl if="_renderAsAllDay">',"</div>","</div>","</tpl>","</div>"):Ext.create("Ext.XTemplate",'<div class="{_extraCls} {spanCls} ext-cal-evt ext-cal-evr">',b,"</div>"),a.compile(),this.eventTpl=a}return this.eventTpl},getTemplateEventData:function(a){var b=Extensible.calendar.data.EventMappings,c=[this.getEventSelectorCls(a[b.EventId.name])],d={},e=(a[b.RRule.name],"x-cal-default"),f=a[b.Title.name],g=Extensible.Date.use24HourTime?"G:i ":"g:ia ";if(this.calendarStore&&a[b.CalendarId.name]){var h=this.calendarStore.findRecord(Extensible.calendar.data.CalendarMappings.CalendarId.name,a[b.CalendarId.name]);h&&(e="x-cal-"+h.data[Extensible.calendar.data.CalendarMappings.ColorId.name])}if(e+=a._renderAsAllDay?"-ad":"",c.push(e),this.getEventClass){var h=this.getEventRecord(a[b.EventId.name]),i=this.getEventClass(h,!!a._renderAsAllDay,d,this.store);c.push(i)}return d._extraCls=c.join(" "),d._isRecurring=a.Recurrence&&""!=a.Recurrence,d._isReminder=a[b.Reminder.name]&&""!=a[b.Reminder.name],d.Title=(a[b.IsAllDay.name]?"":Ext.Date.format(a[b.StartDate.name],g))+(f&&0!=f.length?f:this.defaultEventTitleText),Ext.applyIf(d,a)},refresh:function(a){Extensible.log("refresh (MonthView)"),this.detailPanel&&this.detailPanel.hide(),this.callParent(arguments),!1!==this.showTime&&this.initClock()},renderItems:function(){Extensible.calendar.util.WeekEventRenderer.render({eventGrid:this.allDayOnly?this.allDayGrid:this.eventGrid,viewStart:this.viewStart,tpl:this.getEventTemplate(),maxEventsPerDay:this.maxEventsPerDay,viewId:this.id,templateDataFn:Ext.bind(this.getTemplateEventData,this),evtMaxCount:this.evtMaxCount,weekCount:this.weekCount,dayCount:this.dayCount,getMoreText:Ext.bind(this.getMoreText,this)}),this.fireEvent("eventsrendered",this)},getDayEl:function(a){return Ext.get(this.getDayId(a))},getDayId:function(a){return Ext.isDate(a)&&(a=Ext.Date.format(a,"Ymd")),this.id+this.dayElIdDelimiter+a},getWeekIndex:function(a){var b=this.getDayEl(a).up(".ext-cal-wk-ct");return parseInt(b.id.split("-wk-")[1])},getDaySize:function(a){var b=this.el.getBox(),c=this.getViewPadding(),d=(b.width-c.width)/this.dayCount,e=(b.height-c.height)/this.getWeekCount();if(a){var f=this.el.select(".ext-cal-dtitle").last().parent("tr");e=f?e-f.getHeight(!0):e}return{height:e,width:d}},getEventHeight:function(){if(!this.eventHeight){var a=this.el.select(".ext-cal-evt").first();if(!a)return 16;this.eventHeight=a.parent("td").getHeight()}return this.eventHeight},getMaxEventsPerDay:function(){var a=this.getDaySize(!0).height,b=this.getEventHeight();return Math.max(Math.floor((a-b)/b),0)},getViewPadding:function(a){var a=a||"tlbr",b=a.indexOf("t")>-1,c=a.indexOf("l")>-1,d=a.indexOf("r")>-1,e=this.showHeader&&b?this.el.select(".ext-cal-hd-days-tbl").first().getHeight():0,f=0;return this.isHeaderView?(c&&(f=this.el.select(".ext-cal-gutter").first().getWidth()),d&&(f+=this.el.select(".ext-cal-gutter-rt").first().getWidth())):this.showWeekLinks&&c&&(f=this.el.select(".ext-cal-week-link").first().getWidth()),{height:e,width:f}},getDayAt:function(a,b){var c=this.el.getBox(),d=this.getViewPadding("tl"),e=this.getDaySize(),f=Math.floor((a-c.x-d.width)/e.width),g=Math.floor((b-c.y-d.height)/e.height),h=7*g+f,i=Extensible.Date.add(this.viewStart,{days:h});return{date:i,el:this.getDayEl(i)}},moveNext:function(){return this.moveMonths(1,!0)},movePrev:function(){return this.moveMonths(-1,!0)},onInitDrag:function(){this.callParent(arguments),Ext.select(this.daySelector).removeCls(this.dayOverClass),this.detailPanel&&this.detailPanel.hide()},onMoreClick:function(a){this.detailPanel?this.detailPanel.setTitle(Ext.Date.format(a,this.detailsTitleDateFormat)):(this.detailPanel=Ext.create("Ext.Panel",{id:this.id+"-details-panel",title:Ext.Date.format(a,this.detailsTitleDateFormat),layout:"fit",floating:!0,renderTo:Ext.getBody(),tools:[{type:"close",handler:function(a,b,c){c.ownerCt.hide()}}],items:{xtype:"extensible.monthdaydetailview",id:this.id+"-details-view",date:a,view:this,store:this.store,calendarStore:this.calendarStore,listeners:{eventsrendered:Ext.bind(this.onDetailViewUpdated,this)}}}),this.enableContextMenus&&!0!==this.readOnly&&this.detailPanel.body.on("contextmenu",this.onContextMenu,this)),this.detailPanel.getComponent(this.id+"-details-view").update(a)},onDetailViewUpdated:function(a,b,c){var d=this.detailPanel,e=this.getDayEl(b),f=e.getBox();d.setWidth(Math.max(f.width,220)),d.show(),d.getPositionEl().alignTo(e,"t-t?")},onHide:function(){this.callParent(arguments),this.detailPanel&&this.detailPanel.hide()},onClick:function(a,b){if(this.detailPanel&&this.detailPanel.hide(),el=a.getTarget(this.moreSelector,3)){var c=el.id.split(this.moreElIdDelimiter)[1];return void this.onMoreClick(Ext.Date.parseDate(c,"Ymd"))}if(el=a.getTarget(this.weekLinkSelector,3)){var c=el.id.split(this.weekLinkIdDelimiter)[1];return void this.fireEvent("weekclick",this,Ext.Date.parseDate(c,"Ymd"))}if(!Extensible.calendar.view.Month.superclass.onClick.apply(this,arguments)&&(el=a.getTarget("td",3))&&el.id&&el.id.indexOf(this.dayElIdDelimiter)>-1){var d=el.id.split(this.dayElIdDelimiter),c=d[d.length-1];return void this.onDayClick(Ext.Date.parseDate(c,"Ymd"),!1,Ext.get(this.getDayId(c)))}},handleDayMouseEvent:function(a,b,c){var d=a.getTarget(this.weekLinkSelector,3,!0);if(d)return void d["over"==c?"addCls":"removeCls"](this.weekLinkOverClass);this.callParent(arguments)},destroy:function(){this.callParent(arguments),this.detailsPanel&&this.detailPanel.body.un("contextmenu",this.onContextMenu,this)}}),Ext.define("PTS.Overrides",{singleton:!0,requires:["Ext.form.field.Radio","Ext.data.AbstractStore","Ext.data.Store","Ext.data.proxy.Proxy","Ext.view.AbstractView","Ext.form.field.ComboBox","Extensible.calendar.view.Month","Ext.grid.RowEditor","Ext.Array","Ext.util.Sorter","Ext.data.TreeStore","Ext.grid.Scroller","Ext.button.Cycle","Ext.data.Model","Ext.form.action.Submit"]},function(){Ext.override(Ext.data.Model,{compatibility:"4",getData:function(a){var b,c,d=this,e=d.fields.items,f=e.length,g={};for(c=0;c<f;c++)b=e[c].name,g[b]=d.get(b);return!0===a&&Ext.apply(g,d.getAssociatedData()),g}}),Ext.override(Ext.menu.Menu,{compatibility:"4",onMouseLeave:function(a){var b=this;b.activeChild&&a.within(b.activeChild.el,!0)||(b.deactivateActiveItem(),b.disabled||b.fireEvent("mouseleave",b,a))}}),Ext.override(Ext.data.Store,{filter:function(a,b){Ext.isString(a)&&(a={property:a,value:b});for(var c=this,d=c.decodeFilters(a),e=0,f=c.sortOnFilter&&!c.remoteSort,g=d.length,h=!0;e<g;e++)c.filters.replace(d[e]);for(e=0,g=c.filters.items.length;e<g;e++)if(!c.filters.items[e].disabled){h=!1;break}h||(c.remoteFilter?(delete c.totalCount,c.buffered?(c.pageMap.clear(),c.loadPage(1)):(c.currentPage=1,c.load())):c.filters.getCount()&&(c.snapshot=c.snapshot||c.data.clone(),c.data=c.data.filter(c.filters.items),f&&c.sort(),(!f||c.sorters.length<1)&&c.fireEvent("datachanged",c)))}}),Ext.override(Ext.grid.RowEditor,{loadRecord:function(a){var b=this,c=b.getForm();c.loadRecord(a),c.isValid()?b.hideToolTip():b.errorSummary&&b.showToolTip(),Ext.Array.forEach(b.query(">displayfield"),function(c){b.renderColumnData(c,a)},b)}}),Ext.override(Ext.util.Sorter,{defaultSorterFn:function(a,b){var c=this,d=c.transform,e=c.getRoot(a)[c.property],f=c.getRoot(b)[c.property];return d&&(e=d(e),f=d(f)),null!==e&&null!==f?e>f?1:e<f?-1:0:e===f?0:null===e?1:-1}}),Ext.override(Ext.view.AbstractView,{onMaskBeforeShow:function(){if(!this.el.isVisible(!0))return!1;this.callOverridden(arguments)},onAdd:function(a,b,c){var d,e=this;0===e.all.getCount()?e.refresh():(d=e.bufferRender(b,c),e.doAdd(d,b,c),e.selModel.refresh(),e.updateIndexes(c)),e.fireEvent("itemadd",b,c,d)}}),Ext.override(Ext.form.field.Radio,{resetOriginalValue:function(){this.getManager().getByName(this.name).each(function(a){a.originalValue=a.getValue(),a.checkDirty()})}}),Ext.override(Ext.data.AbstractStore,{sync:function(a){var b=this,c={},d=b.getNewRecords(),e=b.getUpdatedRecords(),f=b.getRemovedRecords(),g=!1;return d.length>0&&(c.create=d,g=!0),e.length>0&&(c.update=e,g=!0),f.length>0&&(c.destroy=f,g=!0),
g&&!1!==b.fireEvent("beforesync",c)&&(a=a||{},b.proxy.batch(Ext.apply(a,{operations:c,listeners:b.getBatchListeners()}))),b},getModifiedRecords:function(){return[].concat(this.getNewRecords(),this.getUpdatedRecords())},rejectChanges:function(){for(var a=this,b=a.getModifiedRecords(),c=b.length,d=0;d<c;d++)b[d].reject(),b[d].phantom&&a.remove(b[d]);for(b=a.removed,c=b.length,d=0;d<c;d++)a.insert(b[d].lastIndex||0,b[d]),b[d].reject(),delete b[d].lastIndex;a.removed.length=0}}),Ext.override(Ext.data.proxy.Proxy,{batch:function(a,b){var c,d,e=this,f=e.batchActions;return void 0===a.operations&&(a={operations:a,listeners:b}),a.batch?Ext.isDefined(a.batch.runOperation)&&(c=Ext.applyIf(a.batch,{proxy:e,listeners:{}})):a.batch={proxy:e,listeners:a.listeners||{}},c||(c=new Ext.data.Batch(a.batch)),c.on("complete",Ext.bind(e.onBatchComplete,e,[a],0)),Ext.each(e.batchOrder.split(","),function(b){(d=a.operations[b])&&(f?c.add(new Ext.data.Operation({action:b,records:d})):Ext.each(d,function(a){c.add(new Ext.data.Operation({action:b,records:[a]}))}))},e),c.start(),c},onBatchComplete:function(a,b){var c=a.scope||this;b.hasException?Ext.isFunction(a.failure)&&Ext.callback(a.failure,c,[b,a]):Ext.isFunction(a.success)&&Ext.callback(a.success,c,[b,a]),Ext.isFunction(a.callback)&&Ext.callback(a.callback,c,[b,a])}}),Extensible.calendar.view.Month.override({getEventTemplate:function(){if(!this.eventTpl){var a,b=this.getEventBodyMarkup();a=Ext.isIE||Ext.isOpera?Ext.create("Ext.XTemplate",'<tpl if="_renderAsAllDay">','<div data-qtip="<b>{Title}</b><br/>Status: {Status}<br/>Project: {ProjectCode}<br/>Project Title: {ProjectTitle}<br/>Type: {Type}<br/>Manager: {Manager}<br/>Description: {Desc}" class="{_extraCls} {spanCls} ext-cal-evt ext-cal-evo">','<div class="ext-cal-evm">','<div class="ext-cal-evi">',"</tpl>",'<tpl if="!_renderAsAllDay">','<div data-qtip="<b>{Title}</b><br/>Status: {Status}<br/>Project: {ProjectCode}<br/>Project Title: {ProjectTitle}<br/>Type: {Type}<br/>Manager: {Manager}<br/>Description: {Desc}" class="{_extraCls} ext-cal-evt ext-cal-evr">',"</tpl>",b,'<tpl if="_renderAsAllDay">',"</div>","</div>","</tpl>","</div>"):Ext.create("Ext.XTemplate",'<div data-qtip="<b>{Title}</b><br/>Status: {Status}<br/>Project: {ProjectCode}<br/>Project Title: {ProjectTitle}<br/>Type: {Type}<br/>Manager: {Manager}<br/>Description: {Desc}" class="{_extraCls} {spanCls} ext-cal-evt ext-cal-evr">',b,"</div>"),a.compile(),this.eventTpl=a}return this.eventTpl}}),Ext.override(Ext.data.TreeStore,{load:function(a){a=a||{},a.params=a.params||{};var b=this,c=a.node||b.tree.getRootNode();return c||(c=b.setRootNode({expanded:!0},!0)),a.id=c.getId(),b.clearOnLoad&&(b.clearRemovedOnLoad&&b.clearRemoved(c),b.tree.un("remove",b.onNodeRemove,b),c.removeAll(!1),b.tree.on("remove",b.onNodeRemove,b)),Ext.applyIf(a,{node:c}),c&&c.set("loading",!0),b.callParent([a])}}),Ext.override(Ext.grid.Scroller,{onAdded:function(){this.callParent(arguments);var a=this;a.scrollEl&&(a.mun(a.scrollEl,"scroll",a.onElScroll,a),a.mon(a.scrollEl,"scroll",a.onElScroll,a))}}),Ext.override(Ext.form.action.Submit,{doSubmit:function(){var a,b=Ext.apply(this.createCallback(),{url:this.getUrl(),method:this.getMethod(),headers:this.headers});this.form.hasUpload()?(a=b.form=this.buildForm(),b.isUpload=!0):(b.params=this.getParams(),b.jsonData=this.jsonData),Ext.Ajax.request(b),a&&Ext.removeNode(a)},getParams:function(){var a=this.callParent(),b=this.jsonData?null:this.form.getValues(!1,!1,!1!==this.submitEmptyText);return Ext.apply({},b,a)}}),Ext.override(Ext.CycleButton,{setActiveItem:function(a,b){var c=this;Ext.isObject(a)||(a=c.menu.getComponent(a)),a&&(c.rendered?(c.setText(c.getButtonText(a)),c.setIconCls(a.iconCls)):(c.text=c.getButtonText(a),c.iconCls=a.iconCls),c.activeItem=a,a.checked||a.setChecked(!0,b),c.forceIcon&&c.setIconCls(c.forceIcon),b||c.fireEvent("change",c,a))}}),Ext.override(Ext.form.field.Base,{labelableRenderTpl:['<tpl if="!hideLabel && !(!fieldLabel && hideEmptyLabel)">','<label id="{id}-labelEl"<tpl if="inputId"> for="{inputId}"</tpl> class="{labelCls}"','<tpl if="labelStyle"> style="{labelStyle}"</tpl>>','<tpl if="fieldLabel">{fieldLabel}','<tpl if="qtip"><span class="pts-field-tip" data-qtip="{qtip}">&nbsp;</span></tpl>',"{labelSeparator}</tpl>","</label>","</tpl>",'<div class="{baseBodyCls} {fieldBodyCls}" id="{id}-bodyEl" role="presentation">{subTplMarkup}</div>','<div id="{id}-errorEl" class="{errorMsgCls}" style="display:none"></div>','<div class="{clearCls}" role="presentation">\x3c!-- --\x3e</div>',{compiled:!0,disableFormats:!0}],getLabelableRenderData:function(){var a,b=this,c=b.labelAlign,d=b.labelCls,e=b.labelClsExtra,f=b.labelPad;return"top"===c?a="margin-bottom:"+f+"px;":(a="margin-right:"+f+"px;",Ext.isBorderBox&&(a+="width:"+b.labelWidth+"px;")),Ext.copyTo({inputId:b.getInputId(),fieldLabel:b.getFieldLabel(),labelCls:e?d+" "+e:d,labelStyle:a+(b.labelStyle||""),subTplMarkup:b.getSubTplMarkup()},b,"hideLabel,hideEmptyLabel,fieldBodyCls,baseBodyCls,errorMsgCls,clearCls,labelSeparator,qtip",!0)}})}),Ext.define("Extensible.calendar.view.MultiWeek",{extend:"Extensible.calendar.view.Month",alias:"widget.extensible.multiweekview",weekCount:2,moveNext:function(){return this.moveWeeks(this.weekCount,!0)},movePrev:function(){return this.moveWeeks(-this.weekCount,!0)}}),Ext.define("Extensible.calendar.view.DayHeader",{extend:"Extensible.calendar.view.Month",alias:"widget.extensible.dayheaderview",requires:["Extensible.calendar.template.DayHeader"],weekCount:1,dayCount:1,allDayOnly:!0,monitorResize:!1,isHeaderView:!0,afterRender:function(){this.tpl||(this.tpl=Ext.create("Extensible.calendar.template.DayHeader",{id:this.id,showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime})),this.tpl.compile(),this.addCls("ext-cal-day-header"),this.callParent(arguments)},forceSize:Ext.emptyFn,refresh:function(a){Extensible.log("refresh (DayHeaderView)"),this.callParent(arguments),this.recalcHeaderBox()},recalcHeaderBox:function(){var a=this.el.down(".ext-cal-evt-tbl"),b=a.getHeight();this.el.setHeight(b+7),this.el.down(".ext-cal-hd-ad-inner").setHeight(b+5),this.el.down(".ext-cal-bg-tbl").setHeight(b+5)},moveNext:function(){return this.moveDays(this.dayCount)},movePrev:function(){return this.moveDays(-this.dayCount)},onClick:function(a,b){if((el=a.getTarget("td",3))&&el.id&&el.id.indexOf(this.dayElIdDelimiter)>-1){var c=el.id.split(this.dayElIdDelimiter),d=c[c.length-1];return void this.onDayClick(Ext.Date.parseDate(d,"Ymd"),!0,Ext.get(this.getDayId(d,!0)))}this.callParent(arguments)}}),Ext.define("PTS.view.contact.ContactLists",{extend:"Ext.tab.Panel",alias:"widget.contactlists",requires:["PTS.view.contact.GroupDDList","PTS.view.contact.PersonDDList"],itemId:"contactLists",activeTab:0,plain:!0,flex:1,addBtnText:"Add to Project",initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"personddlist",itemId:"personsList",title:"Persons"},{xtype:"groupddlist",itemId:"groupsList",title:"Groups"}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",iconCls:"pts-menu-addbasic",text:a.addBtnText,action:"addcontacts"}]}]}),a.callParent(arguments)}}),Ext.define("PTS.view.product.window.ProductContacts",{extend:"Ext.panel.Panel",alias:"widget.productcontacts",requires:["Ext.ux.CheckColumn","Ext.ux.grid.HeaderToolTip","PTS.view.contact.ContactLists","Ext.selection.CheckboxModel","Ext.grid.plugin.DragDrop"],layout:{align:"stretch",padding:5,type:"hbox"},title:"Contacts",initComponent:function(){var a,b=this;a=Ext.create("Ext.grid.plugin.CellEditing",{itemId:"contactEditor",pluginId:"contactEditor",clicksToEdit:1,listeners:{beforeedit:function(a){return!a.column||!a.column.isCheckerHd&&!a.column.is("actioncolumn")}}}),Ext.applyIf(b,{items:[{xtype:"contactlists",addBtnText:"Add to Product",flex:1},{xtype:"gridpanel",itemId:"productContactsList",title:"Product Contacts",store:"ProductContacts",flex:1,selModel:Ext.create("Ext.selection.CheckboxModel",{injectCheckbox:!1,mode:"SIMPLE",checkOnly:!0}),plugins:[a,"headertooltip"],viewConfig:{plugins:[{ptype:"gridviewdragdrop",pluginId:"contactsddplugin"}]},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",iconCls:"pts-menu-deletebasic",text:"Remove",action:"removecontacts"},{xtype:"button",iconCls:"pts-menu-savebasic",text:"Save",action:"savecontacts"},{xtype:"button",iconCls:"pts-menu-refresh",text:"Refresh",action:"refreshcontacts"}]},{xtype:"pagingtoolbar",store:"ProductContacts",displayInfo:!0}],columns:[{xtype:"gridcolumn",sortable:!1,dataIndex:"name",flex:1,text:"Name"},{xtype:"gridcolumn",dataIndex:"isoroletypeid",renderer:function(a,b,c,d,e,f,g){var h=g.getHeaderAtIndex(e).getEditor(),i=h.getStore().find(h.valueField,a,0,!1,!0,!0),j=h.getStore().getAt(i);return j?j.get(h.displayField):a},editor:{xtype:"combobox",itemId:"roletypeCbxProduct",typeAhead:!0,forceSelection:!0,triggerAction:"all",displayField:"codename",valueField:"isoroletypeid",selectOnTab:!0,store:"IsoRoleTypes",lazyRender:!0,listClass:"x-combo-list-small",queryMode:"local",listConfig:{getInnerTpl:function(){return'<div data-qtip="{description}">{codename}</div>'}},listeners:{blur:function(a){a.getStore().clearFilter()}}},flex:1,text:"Role"}]}]}),b.callParent(arguments)}}),Ext.define("PTS.view.product.window.Window",{extend:"PTS.view.controls.ConfigWindow",alias:"widget.productwindow",requires:["PTS.view.product.form.ProductForm","PTS.view.product.window.ProductLinks","PTS.view.product.window.ProductStatus","PTS.view.product.window.ProductContacts","PTS.view.product.window.ProductMetadata","PTS.view.product.window.ProductSteps","PTS.view.product.form.ProductMetadataForm","PTS.view.product.window.ProductKeywords","PTS.view.project.ProjectMap","GeoExt.selection.FeatureModel","Ext.grid.plugin.CellEditing"],height:Ext.Element.getViewportHeight()-40,minWidth:750,width:900,layout:{type:"fit"},closable:!1,maximizable:!0,title:"Edit Product",constrain:!0,modal:!0,y:10,addTools:function(){var a=this;a.callParent(),a.addTool({xtype:"tool",type:"close",action:"closewindow"})},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"tabpanel",itemId:"producttabpanel",items:[{xtype:"productform"},{xtype:"productlinks"},{xtype:"productstatus"},{xtype:"productcontacts"},{xtype:"productkeywords"},{xtype:"panel",defaults:{preventHeader:!0},layout:{type:"border"},title:"Map",items:[{xtype:"projectmap",commonStore:"CommonVectors",center:"-16760019.526289, 9118642.6397498",zoom:4,region:"center",layerName:"Product Features",layerUrl:PTS.baseURL+"/productfeature"},{xtype:"gridpanel",itemId:"featureGrid",store:"ProductVectors",height:250,split:!0,autoScroll:!0,title:"Feature List",region:"south",columns:[{xtype:"gridcolumn",dataIndex:"name",flex:1,text:"Name",editor:{xtype:"textfield",allowBlank:!1}},{xtype:"gridcolumn",dataIndex:"comment",flex:2,text:"Description",editor:{xtype:"textfield",allowBlank:!1}}],selModel:{selectControl:{id:"PTS-Select-Row"}},selType:"featuremodel",plugins:[Ext.create("Ext.grid.plugin.CellEditing",{pluginId:"cellEdit",clicksToEdit:1})]}]},{xtype:"productsteps"},{xtype:"productmetadata",formItems:[{xtype:"productmetadataform"}]}]}],dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"tbfill"},{xtype:"button",text:"Close",action:"closewindow"}]}]}),a.callParent(arguments)}}),Ext.define("PTS.controller.product.Product",{extend:"Ext.app.Controller",views:["product.window.Window"],refs:[{ref:"productWindow",selector:"productwindow"}],stores:[],init:function(){var a=this.getController("product.tab.ProductTab"),b=this.getController("product.window.Window");a.init(),b.init(),this.application.on({saveproduct:this.onSaveProduct,scope:this})},setProxies:function(a){var b=this.getProductWindow(),c=b.down("productlinks>gridpanel").getStore();c.setProxy({type:"rest",url:PTS.baseURL+"/onlineresource",appendId:!0,api:{read:PTS.baseURL+"/product/"+a+"/onlineresource"},reader:{type:"json",root:"data"}}),c.load(),c=b.down("#producttabpanel>productstatus").getStore(),c.setProxy({type:"rest",url:PTS.baseURL+"/productstatus",appendId:!0,api:{read:PTS.baseURL+"/product/"+a+"/productstatus"},reader:{type:"json",root:"data"}}),c.load()},openProduct:function(a,b,c){var d,e,f=!!a&&a.get("productid");!1!==f?(e=a.get("title"),d=Ext.create(this.getProductWindowWindowView(),{title:"Edit Product: "+e,productId:f}),this.setProxies(f)):(d=Ext.create(this.getProductWindowWindowView(),{title:"New Product"}),d.down("#producttabpanel").items.each(function(){"productform"!==this.getXType()&&this.disable()})),this.application.fireEvent("openproduct",f),d.show(c,b)},onSaveProduct:function(a){this.getProductWindow().down("#producttabpanel").items.each(function(){"productform"!==this.getXType()&&this.enable()}),this.setProxies(a.getId())}}),Ext.define("PTS.view.controls.MyCombo",{extend:"Ext.form.field.ComboBox",alias:"widget.mycombo",requires:["Ext.form.field.ComboBox"],initComponent:function(){var a=this;a.callParent(arguments),a.on("beforedestroy",function(a){a.getStore().clearFilter(!1)})}}),Ext.define("PTS.view.controls.FilterCombo",{extend:"PTS.view.controls.MyCombo",alias:"widget.filtercombo",requires:["Ext.form.field.ComboBox"],baseFilter:null,doQuery:function(a,b,c){a=a||"";var d=this,e={query:a,forceAll:b,combo:d,cancel:!1},f=d.store,g="local"===d.queryMode;return!1!==d.fireEvent("beforequery",e)&&!e.cancel&&(a=e.query,b=e.forceAll,(b||a.length>=d.minChars)&&(d.expand(),d.queryCaching&&d.lastQuery===a||(d.lastQuery=a,g?(b?f.clearFilter():(f.clearFilter(!0),f.filter(d.displayField,a)),this.baseFilter&&f.filter(this.baseFilter)):(d.rawQuery=c,d.pageSize?d.loadPage(1):f.load({params:d.getParams(a)}))),d.getRawValue()!==d.getDisplayValue()&&(d.ignoreSelection++,d.picker.getSelectionModel().deselectAll(),d.ignoreSelection--),g&&d.doAutoSelect(),d.typeAhead&&d.doTypeAhead()),!0)},initComponent:function(){this.callParent(arguments)}}),Ext.define("PTS.view.controls.StateCombo",{extend:"PTS.view.controls.FilterCombo",alias:"widget.statecombo",requires:["PTS.store.States","Ext.form.field.ComboBox"],name:"stateid",fieldLabel:"State",store:"States",displayField:"statename",valueField:"stateid",forceSelection:!0,allowBlank:!1,queryMode:"local",lastQuery:"",initComponent:function(){var a=this;a.callParent(arguments),a.baseFilter=[{filterFn:function(b){var c=a.up("addressfieldset").down("countrycombo").getValue();return b.get("countryalpha")===c}}]}}),Ext.define("PTS.view.controls.AddressFieldSet",{extend:"PTS.view.controls.MyFieldSet",alias:"widget.addressfieldset",requires:["PTS.view.controls.StateCombo","PTS.view.controls.CountryCombo"],cls:"pts-contact-fieldset",itemId:"address",margin:"10 0 0 0",checkboxName:"addressCbx",checkboxToggle:!0,collapsed:!0,collapsible:!0,title:"Address",copyCheckBox:!1,deleteCheckBox:"delete",deleteCheckBoxAction:function(a,b,c){var d=b?"#C62415":"inherit";a.ownerCt.getEl().setStyle({color:d})},initComponent:function(){var a=this,b=[{xtype:"textfield",name:"street1",fieldLabel:"Street 1",allowBlank:!1,anchor:"100%"},{xtype:"textfield",name:"street2",fieldLabel:"Street 2",anchor:"100%"},{xtype:"fieldcontainer",layout:{align:"middle",defaultMargins:{top:0,right:5,bottom:0,left:0},type:"hbox"},items:[{xtype:"textfield",itemId:"city",disabled:!0,width:400,name:"city",fieldLabel:"City",allowBlank:!1,flex:0},{xtype:"statecombo",itemId:"state",disabled:!0,width:400,name:"stateid",fieldLabel:"State",allowBlank:!1,labelAlign:"right",labelWidth:75,flex:0}]},{xtype:"fieldcontainer",layout:{align:"middle",defaultMargins:{top:0,right:5,bottom:0,left:0},type:"hbox"},items:[{xtype:"countrycombo",itemId:"country",width:400,name:"countryiso",fieldLabel:"Country",allowBlank:!1},{xtype:"textfield",itemId:"postalcode",width:200,name:"postalcode",fieldLabel:"Zip code",allowBlank:!1,labelAlign:"right",labelWidth:75,flex:0},{xtype:"textfield",width:130,name:"postal4",fieldLabel:"Zip4",labelAlign:"right",labelWidth:60,flex:0}]},{xtype:"hiddenfield",itemId:"recordId",name:"addressid",fieldLabel:"Label",anchor:"100%"}];a.deleteCheckBox&&b.splice(0,0,{xtype:"checkboxfield",itemId:a.deleteCheckBox,disabled:!0,hideEmptyLabel:!1,boxLabel:"Delete address",anchor:"100%",listeners:{change:this.deleteCheckBoxAction}}),a.copyCheckBox&&b.splice(0,0,{xtype:"checkboxfield",itemId:a.copyCheckBox,hideEmptyLabel:!1,boxLabel:"Copy primary mailing address",anchor:"100%"}),Ext.applyIf(a,{items:b}),a.callParent(arguments)}}),Ext.define("PTS.view.contact.window.ContactDetail",{extend:"Ext.container.Container",alias:"widget.contactdetail",requires:["PTS.view.controls.MyFieldContainer","PTS.view.controls.AddressFieldSet","Ext.form.field.Hidden","PTS.view.controls.PhoneFieldContainer"],margin:"0 0 10 0",layout:{type:"anchor"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"myfieldcontainer",itemId:"emailAddress",layout:{type:"fit"},anchor:"75%",items:[{xtype:"textfield",name:"uri",fieldLabel:"Primary E-mail",vtype:"email"},{xtype:"hiddenfield",itemId:"recordId",name:"eaddressid",fieldLabel:"Label"}]},{xtype:"myfieldcontainer",itemId:"webAddress",layout:{type:"fit"},anchor:"75%",items:[{xtype:"textfield",name:"uri",fieldLabel:"Website",vtype:"url"},{xtype:"hiddenfield",itemId:"recordId",name:"eaddressid",fieldLabel:"Label"}]},{xtype:"addressfieldset",cls:"pts-contact-fieldset",itemId:"mailAddress",margin:"10 0 0 0",checkboxName:"mailingCbx",checkboxToggle:!0,collapsed:!0,collapsible:!0,title:"Primary Mailing Address"},{xtype:"addressfieldset",cls:"pts-contact-fieldset",itemId:"physicalAddress",copyCheckBox:"sameAddCbx",margin:"10 0 0 0",checkboxName:"physicalCbx",checkboxToggle:!0,collapsed:!0,collapsible:!0,title:"Primary Physical Address"},{xtype:"myfieldset",cls:"pts-contact-fieldset",itemId:"phoneNumbers",margin:"10 0 0 0",checkboxName:"phoneCbx",checkboxToggle:!0,collapsed:!0,collapsible:!0,title:"Phone",items:[{xtype:"phonefieldcontainer",itemId:"officePhone",layout:{align:"middle",type:"hbox"},fieldLabel:"Office"},{xtype:"phonefieldcontainer",itemId:"mobilePhone",layout:{align:"middle",type:"hbox"},fieldLabel:"Mobile"},{xtype:"phonefieldcontainer",itemId:"faxPhone",layout:{align:"middle",type:"hbox"},fieldLabel:"Fax"}]}]}),a.callParent(arguments)}}),Ext.define("PTS.view.contact.window.ContactForm",{extend:"Ext.panel.Panel",alias:"widget.contactform",requires:["PTS.view.contact.window.ContactDetail","PTS.view.contact.window.PersonGroups","PTS.view.contact.window.ContactToolbar","PTS.view.controls.PositionCombo"],activeItem:0,layout:{type:"card"},title:"Edit Contact",preventHeader:!0,initComponent:function(){var a=this;Ext.applyIf(a,{defaults:{preventHeader:!0},items:[{xtype:"tabpanel",itemId:"person",activeTab:0,items:[{xtype:"form",itemId:"personForm",autoScroll:!0,bodyPadding:10,title:"Person",trackResetOnLoad:!0,dockedItems:[{xtype:"contacttoolbar"}],items:[{xtype:"checkboxfield",name:"inactive",anchor:"100%",fieldLabel:"Inactive?",hideLabel:!0,boxLabel:"Inactive?",boxLabelAlign:"before"},{xtype:"fieldcontainer",defaults:{hideLabel:!0},layout:{defaultMargins:{top:0,right:5,bottom:0,left:0},type:"hbox"},combineErrors:!0,fieldLabel:"Name",msgTarget:"side",anchor:"100%",items:[{xtype:"textfield",name:"firstname",fieldLabel:"First Name",allowBlank:!1,emptyText:"First",flex:1},{xtype:"textfield",name:"middlename",fieldLabel:"Middle Name",emptyText:"Middle",flex:1},{xtype:"textfield",name:"lastname",fieldLabel:"Last Name",allowBlank:!1,emptyText:"Last",flex:1},{xtype:"textfield",width:65,name:"suffix",fieldLabel:"Suffix",emptyText:"Suffix"}]},{xtype:"positioncombo",name:"positionid",anchor:"50%"},{xtype:"combobox",anchor:"50%",name:"contacttypeid",fieldLabel:"Type",store:"ContactTypes",displayField:"title",valueField:"contacttypeid",forceSelection:!0,allowBlank:!1,queryMode:"local",listConfig:{getInnerTpl:function(){return'<div data-qtip="{description}">{title}</div>'}}},{xtype:"textfield",name:"dunsnumber",fieldLabel:"DUNS #",anchor:"100%"},{xtype:"contactdetail"},{xtype:"textareafield",name:"comment",fieldLabel:"Comment",grow:!0,growMax:100,growMin:80,anchor:"100%"}]}]},{xtype:"tabpanel",itemId:"group",activeTab:0,items:[{xtype:"form",itemId:"groupForm",autoScroll:!0,bodyPadding:10,title:"Group",trackResetOnLoad:!0,dockedItems:[{xtype:"contacttoolbar"}],items:[{xtype:"checkboxfield",name:"inactive",anchor:"100%",fieldLabel:"Inactive?",hideLabel:!0,boxLabel:"Inactive?",boxLabelAlign:"before"},{xtype:"fieldcontainer",layout:{defaultMargins:{top:0,right:15,bottom:0,left:0},type:"hbox"},combineErrors:!0,msgTarget:"side",anchor:"100%",items:[{xtype:"textfield",name:"name",fieldLabel:"Name",allowBlank:!1,flex:1},{xtype:"textfield",width:165,name:"acronym",fieldLabel:"Acronym",allowBlank:!1,labelWidth:75},{xtype:"checkboxfield",name:"organization",fieldLabel:"Organization?",allowBlank:!1,hideLabel:!0,boxLabel:"Organization?",boxLabelAlign:"before",inputValue:"true"}]},{xtype:"combobox",anchor:"50%",name:"contacttypeid",fieldLabel:"Type",store:"ContactTypes",displayField:"title",valueField:"contacttypeid",forceSelection:!0,allowBlank:!1,queryMode:"local",listConfig:{getInnerTpl:function(){return'<div data-qtip="{description}">{title}</div>'}}},{xtype:"filtercombo",itemId:"parentGroup",anchor:"100%",name:"parentgroupid",fieldLabel:"Primary Parent",store:"ContactGroupIDs",displayField:"fullname",valueField:"contactid",forceSelection:!1,queryMode:"local",validator:function(a){var b=this.up("form#groupForm").getRecord().getId(),c=this.getValue();return 0===c||null===c||(b===c?"A group cannot be its own parent":-1!==this.getStore().indexOfId(c)||"You must make a selection from the list")}},{xtype:"textfield",name:"dunsnumber",fieldLabel:"DUNS #",anchor:"100%"},{xtype:"contactdetail"},{xtype:"textareafield",name:"comment",fieldLabel:"Comment",grow:!0,growMax:100,growMin:80,anchor:"100%"}]}]}]}),a.callParent(arguments)}}),Ext.define("PTS.view.contact.window.Window",{extend:"PTS.view.controls.ConfigWindow",alias:"widget.contactwindow",requires:["PTS.view.contact.window.ContactForm"],height:Ext.Element.getViewportHeight()-40,minWidth:750,width:900,layout:{type:"border"},closable:!1,title:"Edit Contact",constrain:!0,modal:!0,y:10,initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"contactform",region:"center"}],dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"tbfill"},{xtype:"button",text:"Close",action:"closewindow"}]}],tools:[{xtype:"tool",type:"close",action:"closewindow"}]}),a.callParent(arguments)}}),Ext.define("PTS.controller.contact.Contact",{extend:"Ext.app.Controller",views:["contact.window.Window"],controllers:["contact.window.Window"],init:function(){var a=this.getController("contact.tab.ContactTab"),b=this.getController("contact.window.Window");a.init(),b.init()},openContact:function(a,b){var c,d,e=!!b&&b.getId();a=a||"person",!1!==e?(d=b.getContactName(),c=Ext.create(this.getContactWindowWindowView(),{title:"Edit Contact: "+d})):c=Ext.create(this.getContactWindowWindowView(),{title:"New Contact"}),this.application.fireEvent("opencontact",e,a),c.show()}}),Ext.define("Extensible.calendar.dd.DayDragZone",{extend:"Extensible.calendar.dd.DragZone",ddGroup:"DayViewDD",resizeSelector:".ext-evt-rsz",getDragData:function(a){var b=a.getTarget(this.resizeSelector,2,!0);if(b){var c=b.parent(this.eventSelector),d=this.view.getEventRecordFromEl(c);if(!d)return;return{type:"eventresize",xy:a.getXY(),ddel:c.dom,eventStart:d.data[Extensible.calendar.data.EventMappings.StartDate.name],eventEnd:d.data[Extensible.calendar.data.EventMappings.EndDate.name],proxy:this.proxy}}var b=a.getTarget(this.eventSelector,3);if(b){var d=this.view.getEventRecordFromEl(b);if(!d)return;return{type:"eventdrag",xy:a.getXY(),ddel:b,eventStart:d.data[Extensible.calendar.data.EventMappings.StartDate.name],eventEnd:d.data[Extensible.calendar.data.EventMappings.EndDate.name],proxy:this.proxy}}return b=this.view.getDayAt(a.getX(),a.getY()),b.el?{type:"caldrag",dayInfo:b,proxy:this.proxy}:null}}),Ext.define("Extensible.calendar.dd.DayDropZone",{extend:"Extensible.calendar.dd.DropZone",ddGroup:"DayViewDD",dateRangeFormat:"{0}-{1}",dateFormat:"n/j",onNodeOver:function(a,b,c,d){var e,f=this.createText,g=Extensible.Date.use24HourTime?"G:i":"g:ia";if("caldrag"==d.type){this.dragStartMarker||(this.dragStartMarker=a.el.parent().createChild({style:"position:absolute;"}),this.dragStartMarker.setBox(d.dayInfo.timeBox),this.dragCreateDt=d.dayInfo.date);var h,i=this.dragStartMarker.getBox();i.height=Math.ceil(Math.abs(c.getY()-i.y)/a.timeBox.height)*a.timeBox.height,c.getY()<i.y?(i.height+=a.timeBox.height,i.y=i.y-i.height+a.timeBox.height,h=Extensible.Date.add(this.dragCreateDt,{minutes:this.ddIncrement})):a.date=Extensible.Date.add(a.date,{minutes:this.ddIncrement}),this.shim(this.dragCreateDt,i);var j=Extensible.Date.diff(this.dragCreateDt,a.date),k=Extensible.Date.add(this.dragCreateDt,{millis:j});this.dragStartDate=Extensible.Date.min(this.dragCreateDt,k),this.dragEndDate=h||Extensible.Date.max(this.dragCreateDt,k),e=Ext.String.format(this.dateRangeFormat,Ext.Date.format(this.dragStartDate,g),Ext.Date.format(this.dragEndDate,g))}else{var l=Ext.get(d.ddel),m=l.parent().parent(),i=l.getBox();if(i.width=m.getWidth(),"eventdrag"==d.type){if(void 0===this.dragOffset){var n=this.view.getDayAt(d.xy[0],d.xy[1]).timeBox;this.dragOffset=n.y-i.y}else i.y=a.timeBox.y;e=Ext.Date.format(a.date,this.dateFormat+" "+g),i.x=a.el.getLeft(),this.shim(a.date,i),f=this.moveText}if("eventresize"==d.type){this.resizeDt||(this.resizeDt=a.date),i.x=m.getLeft(),i.height=Math.ceil(Math.abs(c.getY()-i.y)/a.timeBox.height)*a.timeBox.height,c.getY()<i.y?i.y-=i.height:a.date=Extensible.Date.add(a.date,{minutes:this.ddIncrement}),this.shim(this.resizeDt,i);var j=Extensible.Date.diff(this.resizeDt,a.date),k=Extensible.Date.add(this.resizeDt,{millis:j}),o=Extensible.Date.min(d.eventStart,k),p=Extensible.Date.max(d.eventStart,k);d.resizeDates={StartDate:o,EndDate:p},e=Ext.String.format(this.dateRangeFormat,Ext.Date.format(o,g),Ext.Date.format(p,g)),f=this.resizeText}}return d.proxy.updateMsg(Ext.String.format(f,e)),this.dropAllowed},shim:function(a,b){Ext.each(this.shims,function(a){a&&(a.isActive=!1,a.hide())});var c=this.shims[0];c||(c=this.createShim(),this.shims[0]=c),c.isActive=!0,c.show(),c.setBox(b)},onNodeDrop:function(a,b,c,d){if(a&&d){if("eventdrag"==d.type){var e=this.view.getEventRecordFromEl(d.ddel);return this.view.onEventDrop(e,a.date),this.onCalendarDragComplete(),delete this.dragOffset,!0}if("eventresize"==d.type){var e=this.view.getEventRecordFromEl(d.ddel);return this.view.onEventResize(e,d.resizeDates),this.onCalendarDragComplete(),delete this.resizeDt,!0}if("caldrag"==d.type)return Ext.destroy(this.dragStartMarker),delete this.dragStartMarker,delete this.dragCreateDt,this.view.onCalendarEndDrag(this.dragStartDate,this.dragEndDate,Ext.bind(this.onCalendarDragComplete,this)),!0}return this.onCalendarDragComplete(),!1}}),Ext.define("Extensible.calendar.view.DayBody",{extend:"Extensible.calendar.view.AbstractCalendar",alias:"widget.extensible.daybodyview",requires:["Ext.XTemplate","Extensible.calendar.template.DayBody","Extensible.calendar.data.EventMappings","Extensible.calendar.dd.DayDragZone","Extensible.calendar.dd.DayDropZone"],dayColumnElIdDelimiter:"-day-col-",hourIncrement:60,initComponent:function(){this.callParent(arguments),!0===this.readOnly&&(this.enableEventResize=!1),this.incrementsPerHour=this.hourIncrement/this.ddIncrement,this.minEventHeight=this.minEventDisplayMinutes/(this.hourIncrement/this.hourHeight),this.addEvents({beforeeventresize:!0,eventresize:!0,dayclick:!0})},initDD:function(){var a={view:this,createText:this.ddCreateEventText,moveText:this.ddMoveEventText,resizeText:this.ddResizeEventText,ddIncrement:this.ddIncrement,ddGroup:this.ddGroup||this.id+"-DayViewDD"};this.el.ddScrollConfig={vthresh:Ext.isIE||Ext.isOpera?100:40,hthresh:-1,frequency:50,increment:100,ddGroup:this.ddGroup||this.id+"-DayViewDD"},this.dragZone=Ext.create("Extensible.calendar.dd.DayDragZone",this.el,Ext.apply({},a)),this.dropZone=Ext.create("Extensible.calendar.dd.DayDropZone",this.el,a)},refresh:function(a){Extensible.log("refresh (DayBodyView)");var b=this.el.getScroll().top;this.callParent(arguments),this.scrollReady&&this.scrollTo(b)},scrollTo:function(a,b){b=b||Ext.isIE||Ext.isOpera,b?Ext.defer(function(){this.el.scrollTo("top",a),this.scrollReady=!0},10,this):(this.el.scrollTo("top",a),this.scrollReady=!0)},afterRender:function(){this.tpl||(this.tpl=Ext.create("Extensible.calendar.template.DayBody",{id:this.id,dayCount:this.dayCount,showTodayText:this.showTodayText,todayText:this.todayText,showTime:this.showTime,showHourSeparator:this.showHourSeparator,viewStartHour:this.viewStartHour,viewEndHour:this.viewEndHour,hourIncrement:this.hourIncrement,hourHeight:this.hourHeight})),this.tpl.compile(),this.addCls("ext-cal-body-ct"),this.callParent(arguments);var a=Math.max(this.scrollStartHour,this.viewStartHour),b=Math.max(0,a-this.viewStartHour);b>0&&this.scrollTo(b*this.hourHeight)},forceSize:Ext.emptyFn,onEventResize:function(a,b){if(!1!==this.fireEvent("beforeeventresize",this,a,b)){var c=Extensible.Date,d=Extensible.calendar.data.EventMappings.StartDate.name,e=Extensible.calendar.data.EventMappings.EndDate.name;if(0===c.compare(a.data[d],b.StartDate)&&0===c.compare(a.data[e],b.EndDate))return;a.set(d,b.StartDate),a.set(e,b.EndDate),this.onEventUpdate(null,a),this.fireEvent("eventresize",this,a)}},getEventBodyMarkup:function(){return this.eventBodyMarkup||(this.eventBodyMarkup=["{Title}",'<tpl if="_isReminder">','<i class="ext-cal-ic ext-cal-ic-rem">&#160;</i>',"</tpl>",'<tpl if="_isRecurring">','<i class="ext-cal-ic ext-cal-ic-rcr">&#160;</i>',"</tpl>"].join("")),this.eventBodyMarkup},getEventTemplate:function(){return this.eventTpl||(this.eventTpl=Ext.isIE||Ext.isOpera?Ext.create("Ext.XTemplate",'<div id="{_elId}" class="ext-cal-evt {_extraCls}" ','style="left: {_left}%; width: {_width}%; top: {_top}px;">','<div class="ext-cal-evb">&#160;</div>','<dl style="height: {_height}px;" class="ext-cal-evdm">','<dd class="ext-evt-bd">',this.getEventBodyMarkup(),"</dd>",this.enableEventResize?'<div class="ext-evt-rsz"><div class="ext-evt-rsz-h">&#160;</div></div>':"","</dl>",'<div class="ext-cal-evb">&#160;</div>',"</div>"):Ext.create("Ext.XTemplate",'<div id="{_elId}" class="{_extraCls} ext-cal-evt ext-cal-evr" ','style="left: {_left}%; width: {_width}%; top: {_top}px; height: {_height}px;">','<div class="ext-evt-bd">',this.getEventBodyMarkup(),"</div>",this.enableEventResize?'<div class="ext-evt-rsz"><div class="ext-evt-rsz-h">&#160;</div></div>':"","</div>"),this.eventTpl.compile()),this.eventTpl},getEventAllDayTemplate:function(){if(!this.eventAllDayTpl){var a,b=this.getEventBodyMarkup();a=Ext.isIE||Ext.isOpera?Ext.create("Ext.XTemplate",'<div class="ext-cal-evt" ','style="left: {_left}%; width: {_width}%; top: {_top}px; height: {_height}px;">','<div class="{_extraCls} {spanCls} ext-cal-evo">','<div class="ext-cal-evm">','<div class="ext-cal-evi">',b,"</div>","</div>","</div>","</div>"):Ext.create("Ext.XTemplate",'<div class="{_extraCls} {spanCls} ext-cal-evt ext-cal-evr" ','style="left: {_left}%; width: {_width}%; top: {_top}px; height: {_height}px;">',b,"</div>"),a.compile(),this.eventAllDayTpl=a}return this.eventAllDayTpl},getTemplateEventData:function(a){var b=Extensible.calendar.data.EventMappings,c=[this.getEventSelectorCls(a[b.EventId.name])],d={},e="x-cal-default",f=a[b.Title.name],g=Extensible.Date.use24HourTime?"G:i ":"g:ia ";a[b.RRule.name];if(this.getTemplateEventBox(a),this.calendarStore&&a[b.CalendarId.name]){var h=this.calendarStore.findRecord(Extensible.calendar.data.CalendarMappings.CalendarId.name,a[b.CalendarId.name]);h&&(e="x-cal-"+h.data[Extensible.calendar.data.CalendarMappings.ColorId.name])}if(e+=(a._renderAsAllDay?"-ad":"")+(Ext.isIE||Ext.isOpera?"-x":""),c.push(e),this.getEventClass){var h=this.getEventRecord(a[b.EventId.name]),i=this.getEventClass(h,!!a._renderAsAllDay,d,this.store);c.push(i)}
return d._extraCls=c.join(" "),d._isRecurring=a.Recurrence&&""!=a.Recurrence,d._isReminder=a[b.Reminder.name]&&""!=a[b.Reminder.name],d.Title=(a[b.IsAllDay.name]?"":Ext.Date.format(a[b.StartDate.name],g))+(f&&0!=f.length?f:this.defaultEventTitleText),Ext.applyIf(d,a)},getEventPositionOffsets:function(){return{top:0,height:-1}},getTemplateEventBox:function(a){var b=this.hourHeight/this.hourIncrement,c=a[Extensible.calendar.data.EventMappings.StartDate.name],d=a[Extensible.calendar.data.EventMappings.EndDate.name],e=Math.max(c.getHours()-this.viewStartHour,0),f=Math.min(d.getHours()-this.viewStartHour,this.viewEndHour-this.viewStartHour),g=e*this.hourIncrement,h=f*this.hourIncrement,i=Extensible.Date.add(Ext.Date.clone(d),{hours:this.viewEndHour,clearTime:!0}),j=this.getEventPositionOffsets();c.getHours()>=this.viewStartHour&&(g+=c.getMinutes()),d<=i&&(h+=d.getMinutes()),a._left=0,a._width=100,a._top=g*b+j.top,a._height=Math.max((h-g)*b,this.minEventHeight)+j.height},renderItems:function(){for(var a=0,b=[];a<this.dayCount;a++)for(var c,d=emptyCells=skipped=0,e=this.eventGrid[0][a],f=e?e.length:0;d<f;d++)if(c=e[d]){var g=c.data||c.event.data,h=Extensible.calendar.data.EventMappings,i=!0===g[h.IsAllDay.name],k=this.isEventSpanning(c.event||c),l=i||k;l||(Ext.apply(g,{cls:"ext-cal-ev",_positioned:!0}),b.push({data:this.getTemplateEventData(g),date:Extensible.Date.add(this.viewStart,{days:a})}))}for(var m=j=0,n=[],o=b.length;m<o;m++){var c=b[m].data,p=null,q=c[Extensible.calendar.data.EventMappings.StartDate.name].getDate();for(j=0;j<o;j++)m!=j&&(p=b[j].data,this.isOverlapping(c,p)&&(c._overlap=void 0==c._overlap?1:c._overlap+1,m<j&&(void 0===c._overcol&&(c._overcol=0),p._overcol=c._overcol+1,n[q]=n[q]?Math.max(n[q],p._overcol):p._overcol)))}for(m=0;m<o;m++){var c=b[m].data,q=c[Extensible.calendar.data.EventMappings.StartDate.name].getDate();if(void 0!==c._overlap){var r=100/(n[q]+1);c._overlap;c._width=r,c._left=r*c._overcol}var s=this.getEventTemplate().apply(c),t=this.id+"-day-col-"+Ext.Date.format(b[m].date,"Ymd");Ext.core.DomHelper.append(t,s)}this.fireEvent("eventsrendered",this)},getDayEl:function(a){return Ext.get(this.getDayId(a))},getDayId:function(a){return Ext.isDate(a)&&(a=Ext.Date.format(a,"Ymd")),this.id+this.dayColumnElIdDelimiter+a},getDaySize:function(){var a=this.el.down(".ext-cal-day-col-inner").getBox();return{height:a.height,width:a.width}},getDayAt:function(a,b){var c=this.el.down(".ext-cal-day-times").getWidth(),d=this.el.getBox(),e=this.getDaySize(!1),f=a-d.x-c,g=Math.floor(f/e.width),h=this.el.getScroll(),i=this.el.down(".ext-cal-bg-row"),j=i.getHeight()/this.incrementsPerHour,k=b-d.y-j+h.top,l=Math.max(0,Math.ceil(k/j)),m=l*(this.hourIncrement/this.incrementsPerHour),n=Extensible.Date.add(this.viewStart,{days:g,minutes:m,hours:this.viewStartHour}),o=this.getDayEl(n),p=a;return o&&(p=o.getLeft()),{date:n,el:o,timeBox:{x:p,y:l*this.hourHeight/this.incrementsPerHour+d.y-h.top,width:e.width,height:j}}},onClick:function(a,b){if(!this.dragPending&&!Extensible.calendar.view.DayBody.superclass.onClick.apply(this,arguments)&&null===a.getTarget(".ext-cal-day-times",3)){var c=a.getTarget("td",3);if(c&&c.id&&c.id.indexOf(this.dayElIdDelimiter)>-1){var d=this.getDateFromId(c.id,this.dayElIdDelimiter);return void this.onDayClick(Ext.Date.parseDate(d,"Ymd"),!0,Ext.get(this.getDayId(d)))}var e=this.getDayAt(a.getX(),a.getY());e&&e.date&&this.onDayClick(e.date,!1,null)}}}),Ext.define("Extensible.calendar.view.Day",{extend:"Ext.Container",alias:"widget.extensible.dayview",requires:["Extensible.calendar.view.AbstractCalendar","Extensible.calendar.view.DayHeader","Extensible.calendar.view.DayBody"],showTime:!0,showTodayText:!0,dayCount:1,enableEventResize:!0,ddIncrement:30,minEventDisplayMinutes:30,showHourSeparator:!0,viewStartHour:0,viewEndHour:24,scrollStartHour:7,hourHeight:42,hideMode:"offsets",initComponent:function(){this.ddCreateEventText=this.ddCreateEventText||Extensible.calendar.view.AbstractCalendar.prototype.ddCreateEventText,this.ddMoveEventText=this.ddMoveEventText||Extensible.calendar.view.AbstractCalendar.prototype.ddMoveEventText,this.dayCount=this.dayCount>7?7:this.dayCount<1?1:this.dayCount;var a=Ext.apply({},this.initialConfig);a.showTime=this.showTime,a.showTodayText=this.showTodayText,a.todayText=this.todayText,a.dayCount=this.dayCount,a.weekCount=1,a.readOnly=this.readOnly,a.ddIncrement=this.ddIncrement,a.minEventDisplayMinutes=this.minEventDisplayMinutes;var b=Ext.applyIf({xtype:"extensible.dayheaderview",id:this.id+"-hd",ownerCalendarPanel:this.ownerCalendarPanel},a),c=Ext.applyIf({xtype:"extensible.daybodyview",enableEventResize:this.enableEventResize,showHourSeparator:this.showHourSeparator,viewStartHour:this.viewStartHour,viewEndHour:this.viewEndHour,scrollStartHour:this.scrollStartHour,hourHeight:this.hourHeight,id:this.id+"-bd",ownerCalendarPanel:this.ownerCalendarPanel},a);this.items=[b,c],this.addCls("ext-cal-dayview ext-cal-ct"),this.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.header=Ext.getCmp(this.id+"-hd"),this.body=Ext.getCmp(this.id+"-bd"),this.body.on("eventsrendered",this.forceSize,this),this.on("resize",this.onResize,this)},refresh:function(){Extensible.log("refresh (DayView)"),this.header.refresh(),this.body.refresh()},forceSize:function(){Ext.defer(function(){var a=this.el.up(".x-panel-body"),b=this.el.down(".ext-cal-day-header"),c=a.getHeight()-b.getHeight();this.el.down(".ext-cal-body-ct").setHeight(c-1)},1,this)},onResize:function(){this.forceSize(),Ext.defer(this.refresh,Ext.isIE?1:0,this)},doHide:function(){this.header.doHide.apply(this,arguments),this.body.doHide.apply(this,arguments)},getViewBounds:function(){return this.header.getViewBounds()},getStartDate:function(){return this.header.getStartDate()},setStartDate:function(a){this.header.setStartDate(a,!0),this.body.setStartDate(a)},renderItems:function(){this.header.renderItems(),this.body.renderItems()},isToday:function(){return this.header.isToday()},moveTo:function(a){return this.header.moveTo(a),this.body.moveTo(a,!0)},moveNext:function(){return this.header.moveNext(),this.body.moveNext(!0)},movePrev:function(a){return this.header.movePrev(),this.body.movePrev(!0)},moveDays:function(a){return this.header.moveDays(a),this.body.moveDays(a,!0)},moveToday:function(){return this.header.moveToday(),this.body.moveToday(!0)},showEventEditor:function(a,b){return Extensible.calendar.view.AbstractCalendar.prototype.showEventEditor.apply(this,arguments)},dismissEventEditor:function(a){return Extensible.calendar.view.AbstractCalendar.prototype.dismissEventEditor.apply(this,arguments)}}),Ext.define("Extensible.calendar.view.MultiDay",{extend:"Extensible.calendar.view.Day",alias:"widget.extensible.multidayview",dayCount:3,startDayIsStatic:!1,moveNext:function(a){return this.moveDays(this.startDayIsStatic?7:this.dayCount,a)},movePrev:function(a){return this.moveDays(this.startDayIsStatic?-7:-this.dayCount,a)}}),Ext.define("Extensible.calendar.view.Week",{extend:"Extensible.calendar.view.MultiDay",alias:"widget.extensible.weekview",dayCount:7}),Ext.define("Extensible.calendar.CalendarPanel",{extend:"Ext.panel.Panel",alias:"widget.extensible.calendarpanel",requires:["Ext.layout.container.Card","Extensible.calendar.view.Day","Extensible.calendar.view.Week","Extensible.calendar.view.Month","Extensible.calendar.view.MultiDay","Extensible.calendar.view.MultiWeek"],enableRecurrence:!1,showDayView:!0,showMultiDayView:!1,showWeekView:!0,showMultiWeekView:!0,showMonthView:!0,showNavBar:!0,todayText:"Today",showTodayText:!0,showTime:!0,readOnly:!1,showNavToday:!0,showNavJump:!0,showNavNextPrev:!0,jumpToText:"Jump to:",goText:"Go",dayText:"Day",multiDayText:"{0} Days",weekText:"Week",multiWeekText:"{0} Weeks",monthText:"Month",editModal:!1,enableEditDetails:!0,layout:{type:"card",deferredRender:!0},startDate:new Date,initComponent:function(){this.tbar={cls:"ext-cal-toolbar",border:!0,items:[]},this.viewCount=0;var a=this.multiDayViewCfg&&this.multiDayViewCfg.dayCount||3,b=this.multiWeekViewCfg&&this.multiWeekViewCfg.weekCount||2;if(this.showNavToday&&this.tbar.items.push({id:this.id+"-tb-today",text:this.todayText,handler:this.onTodayClick,scope:this}),this.showNavNextPrev&&(this.tbar.items.push({id:this.id+"-tb-prev",handler:this.onPrevClick,scope:this,iconCls:"x-tbar-page-prev"}),this.tbar.items.push({id:this.id+"-tb-next",handler:this.onNextClick,scope:this,iconCls:"x-tbar-page-next"})),this.showNavJump&&(this.tbar.items.push(this.jumpToText),this.tbar.items.push({id:this.id+"-tb-jump-dt",xtype:"datefield",width:120,showToday:!1}),this.tbar.items.push({id:this.id+"-tb-jump",text:this.goText,handler:this.onJumpClick,scope:this})),this.tbar.items.push("->"),this.showDayView&&(this.tbar.items.push({id:this.id+"-tb-day",text:this.dayText,handler:this.onDayNavClick,scope:this,toggleGroup:this.id+"-tb-views"}),this.viewCount++),this.showMultiDayView){var c=Ext.String.format(this.getMultiDayText(a),a);this.tbar.items.push({id:this.id+"-tb-multiday",text:c,handler:this.onMultiDayNavClick,scope:this,toggleGroup:this.id+"-tb-views"}),this.viewCount++}if(this.showWeekView&&(this.tbar.items.push({id:this.id+"-tb-week",text:this.weekText,handler:this.onWeekNavClick,scope:this,toggleGroup:this.id+"-tb-views"}),this.viewCount++),this.showMultiWeekView){var c=Ext.String.format(this.getMultiWeekText(b),b);this.tbar.items.push({id:this.id+"-tb-multiweek",text:c,handler:this.onMultiWeekNavClick,scope:this,toggleGroup:this.id+"-tb-views"}),this.viewCount++}(this.showMonthView||0==this.viewCount)&&(this.tbar.items.push({id:this.id+"-tb-month",text:this.monthText,handler:this.onMonthNavClick,scope:this,toggleGroup:this.id+"-tb-views"}),this.viewCount++,this.showMonthView=!0);var d=this.viewCount-1;this.activeItem=void 0===this.activeItem?d:this.activeItem>d?d:this.activeItem,!1===this.showNavBar&&(delete this.tbar,this.addCls("x-calendar-nonav")),this.callParent(arguments),this.addEvents({eventadd:!0,eventupdate:!0,beforeeventdelete:!0,eventdelete:!0,eventcancel:!0,viewchange:!0,editdetails:!0}),this.addCls("x-cal-panel"),this.eventStore&&(this.store=this.eventStore,delete this.eventStore),this.setStore(this.store);var e={showToday:this.showToday,todayText:this.todayText,showTodayText:this.showTodayText,showTime:this.showTime,readOnly:this.readOnly,enableRecurrence:this.enableRecurrence,store:this.store,calendarStore:this.calendarStore,editModal:this.editModal,enableEditDetails:this.enableEditDetails,ownerCalendarPanel:this};if(this.showDayView){var f=Ext.apply({xtype:"extensible.dayview",title:this.dayText},e);f=Ext.apply(Ext.apply(f,this.viewConfig),this.dayViewCfg),f.id=this.id+"-day",this.initEventRelay(f),this.add(f)}if(this.showMultiDayView){var g=Ext.apply({xtype:"extensible.multidayview",title:this.getMultiDayText(a)},e);g=Ext.apply(Ext.apply(g,this.viewConfig),this.multiDayViewCfg),g.id=this.id+"-multiday",this.initEventRelay(g),this.add(g)}if(this.showWeekView){var h=Ext.applyIf({xtype:"extensible.weekview",title:this.weekText},e);h=Ext.apply(Ext.apply(h,this.viewConfig),this.weekViewCfg),h.id=this.id+"-week",this.initEventRelay(h),this.add(h)}if(this.showMultiWeekView){var i=Ext.applyIf({xtype:"extensible.multiweekview",title:this.getMultiWeekText(b)},e);i=Ext.apply(Ext.apply(i,this.viewConfig),this.multiWeekViewCfg),i.id=this.id+"-multiweek",this.initEventRelay(i),this.add(i)}if(this.showMonthView){var j=Ext.applyIf({xtype:"extensible.monthview",title:this.monthText,listeners:{weekclick:{fn:function(a,b){this.showWeek(b)},scope:this}}},e);j=Ext.apply(Ext.apply(j,this.viewConfig),this.monthViewCfg),j.id=this.id+"-month",this.initEventRelay(j),this.add(j)}this.add(Ext.applyIf({xtype:"extensible.eventeditform",id:this.id+"-edit",calendarStore:this.calendarStore,enableRecurrence:this.enableRecurrence,listeners:{eventadd:{scope:this,fn:this.onEventAdd},eventupdate:{scope:this,fn:this.onEventUpdate},eventdelete:{scope:this,fn:this.onEventDelete},eventcancel:{scope:this,fn:this.onEventCancel}}},this.editViewCfg))},initEventRelay:function(a){a.listeners=a.listeners||{},a.listeners.afterrender={fn:function(a){this.relayEvents(a,["eventsrendered","eventclick","dayclick","eventover","eventout","beforedatechange","datechange","rangeselect","beforeeventmove","eventmove","initdrag","dayover","dayout","beforeeventresize","eventresize","eventadd","eventupdate","beforeeventdelete","eventdelete","eventcancel"]),a.on("editdetails",this.onEditDetails,this)},scope:this,single:!0}},afterRender:function(){this.callParent(arguments),this.body.addCls("x-cal-body"),this.updateNavState(),this.setActiveView()},getMultiDayText:function(a){return this.multiDayText},getMultiWeekText:function(a){return this.multiWeekText},setStore:function(a,b){var c=this.store;!b&&c&&c.un("write",this.onWrite,this),a&&a.on("write",this.onWrite,this),this.store=a},onStoreAdd:function(a,b,c){this.hideEditForm()},onStoreUpdate:function(a,b,c){c==Ext.data.Record.COMMIT&&this.hideEditForm()},onStoreRemove:function(a,b){this.hideEditForm()},onWrite:function(a,b){var c=b.records[0];switch(b.action){case"create":this.onStoreAdd(a,c);break;case"update":this.onStoreUpdate(a,c,Ext.data.Record.COMMIT);break;case"destroy":this.onStoreRemove(a,c)}},onEditDetails:function(a,b,c){!1!==this.fireEvent("editdetails",this,a,b,c)&&this.showEditForm(b)},save:function(){this.store.autoSync||this.store.sync()},onEventAdd:function(a,b){b.store||(this.store.add(b),this.save()),this.fireEvent("eventadd",this,b)},onEventUpdate:function(a,b){this.save(),this.fireEvent("eventupdate",this,b)},onEventDelete:function(a,b){this.store.remove(b),this.save(),this.fireEvent("eventdelete",this,b)},onEventCancel:function(a,b){this.hideEditForm(),this.fireEvent("eventcancel",this,b)},showEditForm:function(a){return this.preEditView=this.layout.getActiveItem().id,this.setActiveView(this.id+"-edit"),this.layout.getActiveItem().loadRecord(a),this},hideEditForm:function(){return this.preEditView&&(this.setActiveView(this.preEditView),delete this.preEditView),this},setActiveView:function(a,b){var c,d=this,e=d.layout,f=d.id+"-edit";b&&(d.startDate=b),a!==e.getActiveItem().id&&(c=d.getDockedItems("toolbar")[0],c&&c[a===f?"hide":"show"](),e.setActiveItem(a||d.activeItem),d.doComponentLayout(),d.activeView=e.getActiveItem(),a!==f&&(a&&a!==d.preEditView&&e.activeItem.setStartDate(d.startDate,!0),d.updateNavState()),d.fireViewChange())},fireViewChange:function(){if(this.layout&&this.layout.getActiveItem){var a=this.layout.getActiveItem(),b=Ext.Date.clone;if(a){if(a.getViewBounds)var c=a.getViewBounds(),d={activeDate:b(a.getStartDate()),viewStart:b(c.start),viewEnd:b(c.end)};a.dismissEventEditor&&a.dismissEventEditor(),this.fireEvent("viewchange",this,a,d)}}},updateNavState:function(){var a=this,b=a.layout.activeItem;if(b&&!1!==a.showNavBar){var c=b.id.split(a.id+"-")[1],d=Ext.getCmp(a.id+"-tb-"+c);a.showNavToday&&Ext.getCmp(a.id+"-tb-today").setDisabled(b.isToday()),d.toggle(!0)}},setStartDate:function(a){return Extensible.log("setStartDate (CalendarPanel"),this.startDate=a,this.layout.activeItem.setStartDate(a,!0),this.updateNavState(),this.fireViewChange(),this},showWeek:function(a){this.setActiveView(this.id+"-week",a)},onTodayClick:function(){this.startDate=this.layout.activeItem.moveToday(!0),this.updateNavState(),this.fireViewChange()},onJumpClick:function(){var a=Ext.getCmp(this.id+"-tb-jump-dt").getValue();""!==a&&(this.startDate=this.layout.activeItem.moveTo(a,!0),this.updateNavState(),this.fireViewChange())},onPrevClick:function(){this.startDate=this.layout.activeItem.movePrev(!0),this.updateNavState(),this.fireViewChange()},onNextClick:function(){this.startDate=this.layout.activeItem.moveNext(!0),this.updateNavState(),this.fireViewChange()},onDayNavClick:function(){this.setActiveView(this.id+"-day")},onMultiDayNavClick:function(){this.setActiveView(this.id+"-multiday")},onWeekNavClick:function(){this.setActiveView(this.id+"-week")},onMultiWeekNavClick:function(){this.setActiveView(this.id+"-multiweek")},onMonthNavClick:function(){this.setActiveView(this.id+"-month")},getActiveView:function(){return this.layout.activeItem}}),Ext.define("PTS.view.dashboard.Calendar",{extend:"Extensible.calendar.CalendarPanel",alias:"widget.dashboardcalendar",requires:["Extensible.calendar.data.MemoryEventStore","Extensible.calendar.data.MemoryCalendarStore","Extensible.calendar.data.EventStore","Extensible.calendar.CalendarPanel","PTS.data.Calendar","Extensible.calendar.data.CalendarMappings","Extensible.calendar.data.EventMappings"],showDayView:!1,showWeekView:!1,readOnly:!0,initComponent:function(){var a=this;Ext.applyIf(a,{eventStore:Ext.create("Extensible.calendar.data.EventStore",{autoLoad:!0,pageSize:void 0,proxy:{type:"rest",url:PTS.baseURL+"/deliverable/calendar",noCache:!0,reader:{type:"json",root:"data"},listeners:{exception:function(a,b,c,d){var e=b.message?b.message:Ext.decode(b.responseText).message;Ext.Msg.alert("Server Error",e)}}}})}),a.callParent(arguments)}}),Ext.define("PTS.view.dashboard.Dashboard",{extend:"Ext.panel.Panel",alias:"widget.dashboard",requires:["PTS.view.dashboard.Calendar","Extensible.calendar.gadget.CalendarListPanel","PTS.view.dashboard.DeliverableList","PTS.view.dashboard.TaskList"],layout:{type:"border"},title:"Dashboard",initComponent:function(){var a=this,b=Ext.create("Extensible.calendar.data.MemoryCalendarStore",{data:Ext.create("PTS.data.Calendar"),storeId:"CalendarStore"});Ext.applyIf(a,{items:[{region:"west",width:179,border:!1,items:[{xtype:"datepicker",id:"app-nav-picker",cls:"ext-cal-nav-picker",listeners:{select:{fn:function(a,b){Ext.ComponentQuery.query("dashboardcalendar")[0].setStartDate(b)},scope:this}}},{xtype:"extensible.calendarlist",store:b,border:!1,width:178}]},{xtype:"dashboardcalendar",id:"pts-dashboardcalendar",calendarStore:b,bodyPadding:"",style:{border:"1px",padding:0},region:"center",viewConfig:{showHeader:!0}},{xtype:"tabpanel",width:Ext.getBody().getWidth()>1490?700:590,title:"Tasks and Deliverables",minWidth:550,region:"east",collapsible:!0,split:!0,preventHeader:!0,animCollapse:!Ext.isIE8,items:[{xtype:"tasklist",title:"Tasks"},{xtype:"deliverablelist",title:"Deliverables"}]}]}),a.callParent(arguments)}}),Ext.define("PTS.controller.dashboard.Dashboard",{extend:"Ext.app.Controller",views:["dashboard.Dashboard","dashboard.DeliverableList","dashboard.TaskList"],init:function(){var a=this.getController("dashboard.Calendar"),b=this.getController("dashboard.TaskList"),c=this.getController("dashboard.DeliverableList");a.init(),b.init(),c.init(),this.control({"dashboard tasklist":{itemdblclick:this.openProject},"dashboard deliverablelist":{itemdblclick:this.openProject}})},openProject:function(a,b){var c=b.getId(),d=b.get("modificationid"),e=function(){var a=this,b=a.down("agreementstree").getStore(),e=a.down("projectagreements"),f=function(a){var b=a.getNodeById("d-"+c+"-"+d).getPath();this.down("agreementstree").selectPath(b),this.getEl().unmask()};a.getEl().mask("Loading..."),a.down("tabpanel").setActiveTab(e),b.getRootNode().hasChildNodes()?f(b):b.on("load",f,a,{single:!0})};void 0===b.getProjectCode&&(b.getProjectCode=function(){return b.get("projectcode")}),this.getController("project.Project").openProject(b,e)}}),Ext.define("PTS.view.project.window.ProjectContacts",{extend:"Ext.panel.Panel",alias:"widget.projectcontacts",requires:["Ext.ux.CheckColumn","Ext.ux.grid.HeaderToolTip","PTS.view.contact.ContactLists","Ext.selection.CheckboxModel","Ext.grid.plugin.DragDrop"],layout:{align:"stretch",padding:5,type:"hbox"},title:"Contacts",initComponent:function(){var a,b=this;a=Ext.create("Ext.grid.plugin.CellEditing",{itemId:"contactEditor",pluginId:"contactEditor",clicksToEdit:1,listeners:{beforeedit:function(a){return!a.column||!a.column.isCheckerHd&&!a.column.is("actioncolumn")}}}),Ext.applyIf(b,{items:[{xtype:"contactlists",flex:1},{xtype:"gridpanel",itemId:"projectContactsList",title:"Project Contacts",store:"ProjectContacts",flex:1,selModel:Ext.create("Ext.selection.CheckboxModel",{injectCheckbox:!1,mode:"SIMPLE",checkOnly:!0}),plugins:[a,"headertooltip"],viewConfig:{plugins:[{ptype:"gridviewdragdrop",pluginId:"contactsddplugin"}]},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",iconCls:"pts-menu-deletebasic",text:"Remove",action:"removecontacts"},{xtype:"button",iconCls:"pts-menu-savebasic",text:"Save",action:"savecontacts"},{xtype:"button",iconCls:"pts-menu-refresh",text:"Refresh",action:"refreshcontacts"}]},{xtype:"pagingtoolbar",store:"ProjectContacts",displayInfo:!0}],columns:[{xtype:"gridcolumn",sortable:!1,dataIndex:"name",flex:1,text:"Name"},{xtype:"gridcolumn",dataIndex:"roletypeid",renderer:function(a,b,c,d,e,f,g){var h=g.getHeaderAtIndex(e).getEditor(),i=h.getStore().find(h.valueField,a,0,!1,!0,!0),j=h.getStore().getAt(i);return j?j.get(h.displayField):a},editor:{xtype:"combobox",itemId:"roletypeCbxProject",typeAhead:!0,forceSelection:!0,triggerAction:"all",displayField:"code",valueField:"roletypeid",selectOnTab:!0,store:"RoleTypes",lazyRender:!0,listClass:"x-combo-list-small",queryMode:"local",listConfig:{getInnerTpl:function(){return'<div data-qtip="{description}">{code}</div>'}},listeners:{blur:function(a){a.getStore().clearFilter()}}},flex:1,text:"Role"},{xtype:"checkcolumn",itemId:"reminderCbx",dataIndex:"reminder",text:"Notice?",width:55,tooltip:"Receive reminder notices?"},{xtype:"checkcolumn",dataIndex:"partner",text:"Partner?",width:55,tooltip:"Identify contact as partner for reporting."}]}]}),b.callParent(arguments)}}),Ext.define("PTS.view.project.window.ProjectKeywords",{extend:"Ext.panel.Panel",alias:"widget.projectkeywords",requires:["PTS.view.controls.KeywordTree","Ext.ux.grid.FilterBar","Ext.grid.plugin.DragDrop","Ext.grid.column.Template"],layout:{type:"border"},title:"Keywords",initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"gridpanel",itemId:"projectKeywords",region:"center",multiSelect:!0,viewConfig:{stripeRows:!1,plugins:{ptype:"gridviewdragdrop",dropGroup:"keywords",dragGroup:"deletekeywords"},getRowClass:function(a,b,c,d){return a.phantom?"pts-grid-row-phantom":""}},store:"ProjectKeywords",columns:[{text:"Keyword",flex:1,sortable:!0,dataIndex:"text"}],title:"Project Keywords",dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",iconCls:"pts-menu-deletebasic",text:"Remove",action:"removekeywords"},{xtype:"button",iconCls:"pts-menu-savebasic",text:"Save",action:"savekeywords"},{xtype:"button",iconCls:"pts-menu-refresh",text:"Refresh",action:"refreshkeywords"}]}]},{xtype:"tabpanel",flex:1,title:"Keywords",preventHeader:!0,region:"west",split:!0,activeTab:0,tabPosition:"bottom",items:[{xtype:"keywordtree",itemId:"keywordTree",title:"Keyword Tree"},{xtype:"gridpanel",itemId:"keywordSearch",title:"Search",store:"Keywords",columns:[{xtype:"gridcolumn",dataIndex:"text",flex:1,text:"Keyword",renderer:function(a,b,c,d,e,f,g){var h=c.get("fullname");return h?'<span data-qtip="'+h+'">'+a+"</span>":a}},{xtype:"gridcolumn",hidden:!0,dataIndex:"fullname",flex:2,text:"Full Path"},{xtype:"templatecolumn",width:28,text:"",hideable:!1,cls:"x-action-col-cell",tpl:'<tpl if="definition"><div data-qtip="{[Ext.htmlEncode(values.definition)]}" class="pts-col-info"></div></tpl>'},{xtype:"templatecolumn",width:28,text:"",hideable:!1,cls:"x-action-col-cell",tpl:'<tpl if="text"><div data-qtip="Add: {[Ext.htmlEncode(values.text)]}" class="pts-col-add"></div></tpl>',action:"addkeyword"}],viewConfig:{copy:!0,plugins:{ptype:"gridviewdragdrop",dragGroup:"keywords"}},dockedItems:[{xtype:"filterbar",searchStore:"Keywords",dock:"top"},{xtype:"pagingtoolbar",displayInfo:!0,store:"Keywords",dock:"top"}]}]}]}),a.callParent(arguments)}}),Ext.define("PTS.view.project.window.ProjectMetadata",{extend:"PTS.view.controls.MetadataPanel",alias:"widget.projectmetadata"}),Ext.define("PTS.view.project.form.MetadataForm",{extend:"Ext.form.Panel",alias:"widget.metadataform",requires:["Ext.ux.form.ItemSelector","Ext.ux.form.BoxSelect"],autoScroll:!0,bodyPadding:5,border:0,initComponent:function(){var a=this;a.initialConfig=Ext.apply({trackResetOnLoad:!0},a.initialConfig),Ext.applyIf(a,{defaults:{validateOnChange:!0},items:[{xtype:"boxselect",name:"topiccategory",fieldLabel:"Topic Categories",anchor:"100%",store:"TopicCategories",displayField:"codename",valueField:"topiccategoryid",allowBlank:!1,listConfig:{getInnerTpl:function(){return'<div data-qtip="{description}">{codename}</div>'}},emptyText:"Pick one or more categories",queryMode:"local",style:{marginBottom:"25px"}},{xtype:"itemselector",name:"projectcategory",anchor:"100%",fieldLabel:"Project Categories",delimiter:null,store:"ProjectCategories",displayField:"category",valueField:"projectcategoryid",msgTarget:"side",style:{marginBottom:"25px"}},{xtype:"itemselector",name:"usertype",anchor:"100%",fieldLabel:"User Types",delimiter:null,store:"UserTypes",displayField:"usertype",valueField:"usertypeid",msgTarget:"side"}]}),a.callParent(arguments)}}),Ext.define("PTS.view.controls.SimpleLink",{extend:"Ext.Component",alias:"widget.simplelink",baseCls:Ext.baseCSSPrefix+"simplelink",maskOnDisable:!0,getElConfig:function(){var a=this;return{tag:"a",id:a.id,href:"#",html:a.text?Ext.util.Format.htmlEncode(a.text):a.html||""}},initComponent:function(){var a=this;a.on("afterRender",function(){a.mon(a.getEl(),"click",a.handler,a)}),a.callParent(arguments)},handler:Ext.emptyFn}),Ext.define("GeoExt.data.reader.Feature",{extend:"Ext.data.reader.Json",alias:"reader.feature",extractData:function(a){var b,c,d,e,f=this,g=[],h=f.model,i=a.length;for(!a.length&&Ext.isObject(a)&&(a=[a],i=1),e=0;e<i;e++)c=a[e],c.isModel?g.push(c):(d=new h(void 0,f.getId(c),c),d.data=b={},d.phantom=!1,f.convertRecordData(b,c,d),g.push(d),f.implicitIncludes&&f.readAssociated(d,c));return g},buildExtractors:function(a){var b,c,d,e=this,f=e.getIdProperty(),g=e.totalProperty,h=e.successProperty,i=e.messageProperty;!0===a&&delete e.convertRecordData,e.convertRecordData||(g&&(e.getTotal=e.createAccessor(g)),h&&(e.getSuccess=e.createAccessor(h)),i&&(e.getMessage=e.createAccessor(i)),f?(c=e.model.prototype.fields.get(f),c&&(d=c.mapping,f=void 0!==d&&null!==d?d:f),b=e.createAccessor(f),e.getId=function(a){var c=b.call(e,a);return void 0===c||""===c?null:c}):e.getId=function(){return null},e.buildFieldExtractors(),e.root?e.getRoot=e.createAccessor(e.root):e.getRoot=function(a){return a},e.convertRecordData=e.convertFeatureRecordData)},convertFeatureRecordData:function(a,b,c){var d=[];if(b){var e=c.fields;if(b.attributes)for(var f=0,g=e.length;f<g;f++){var h,i=e.items[f];if(/[\[\.]/.test(i.mapping))try{h=new Function("obj","return obj."+i.mapping)(b.attributes)}catch(a){h=i.defaultValue}else h=b.attributes[i.mapping||i.name]||i.defaultValue;i.convert&&(h=i.convert(h,c)),a[i.name]=h}c.state=b.state,b.state!=OpenLayers.State.INSERT&&b.state!=OpenLayers.State.UPDATE||c.setDirty();var j=b.state===OpenLayers.State.INSERT?void 0:b.id;a.id=j}return d}}),Ext.define("PTS.view.controls.TextareaTriggerField",{extend:"Ext.form.field.Trigger",alias:"widget.areatrigger",requires:"Ext.window.Window",fieldSubTpl:['<textarea id="{id}" style="height:{height}"','<tpl if="name">name="{name}" </tpl>','<tpl if="rows">rows="{rows}" </tpl>','<tpl if="cols">cols="{cols}" </tpl>','<tpl if="tabIdx">tabIndex="{tabIdx}" </tpl>','class="{fieldCls} {typeCls}" ','autocomplete="off">',"</textarea>",'<div id="{cmpId}-triggerWrap" class="{triggerWrapCls}" role="presentation">',"{triggerEl}",'<div class="{clearCls}" role="presentation"></div>',"</div>",{compiled:!0,disableFormats:!0}],rows:2,triggerCls:"pts-trigger-zoom",height:22,style:{overflow:"hidden"},preventScrollbars:!0,onTriggerClick:function(a){var b=this,c=b.getRawValue();Ext.create("Ext.window.Window",{title:"Comment",layout:"fit",width:400,height:300,items:[{xtype:"textarea",flex:1,height:"100%",value:c}],buttons:[{xtype:"button",text:"OK",handler:function(a){var c=a.up("window").down("textarea").getRawValue();b.setValue(c),a.up("window").close()}},{xtype:"button",text:"Cancel",handler:function(a){a.up("window").close()}}],resizable:!0,maximizable:!0,modal:!0,animateTarget:b.getEl()}).show()},onRender:function(a,b){var c=this;Ext.applyIf(c.subTplData,{cols:c.cols,rows:c.rows}),c.callParent(arguments)},afterRender:function(){var a=this;a.callParent(arguments),a.preventScrollbars&&a.inputEl.setStyle("overflow","hidden"),a.inputEl.setStyle("height",a.height+"px")}}),Ext.define("PTS.view.project.window.AgreementsTree",{extend:"Ext.tree.Panel",alias:"widget.agreementstree",requires:["Ext.tree.plugin.TreeViewDragDrop"],border:"0 0 0 1",title:"Agreements",store:"AgreementsTree",rootVisible:!1,useArrows:!0,bodyCls:"pts-agreementstree",viewConfig:{copy:!0,plugins:{ptype:"treeviewdragdrop",pluginId:"agreementsddplugin"},getAgreementId:function(a){var b,c=a.getDepth();for(b=0;b<c;b++){if(20===a.parentNode.get("typeid"))return a.getId();a=a.parentNode}},getDataId:function(a,b){var c,d=a.getDepth();for(c=0;c<d;c++){if(a.parentNode.get("typeid")===b)return a.get("dataid");a=a.parentNode}}},initComponent:function(){var a=this;Ext.applyIf(a,{columns:[{xtype:"treecolumn",dataIndex:"text",flex:3,text:"Title",renderer:function(a,b,c){var d=c.get("code");return d?a+": <em>"+d+"</em>":a}},{xtype:"gridcolumn",width:75,align:"center",dataIndex:"type",text:"Type"}],tools:[{xtype:"tool",tooltip:"Refresh",type:"refresh",hidden:!1},{xtype:"tool",tooltip:"Expand All",type:"expand",hidden:!0},{xtype:"tool",tooltip:"Collapse All",type:"collapse",hidden:!1}]}),a.callParent(arguments)}}),Ext.define("PTS.view.project.form.ProjectForm",{extend:"Ext.form.Panel",alias:"widget.projectform",requires:["PTS.view.controls.DateRangeField","PTS.view.controls.SimpleLink","Ext.form.field.Display"],autoScroll:!0,bodyPadding:5,title:"Project",initComponent:function(){var a=this;a.initialConfig=Ext.apply({trackResetOnLoad:!0},a.initialConfig),Ext.applyIf(a,{dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",text:"Edit",iconCls:"pts-menu-editbasic",hidden:!0,action:"editproject"},{xtype:"button",text:"Delete",iconCls:"pts-menu-deletebasic",action:"deleteproject"},{xtype:"button",text:"Save",iconCls:"pts-menu-savebasic",formBind:!0,action:"saveproject"},{xtype:"button",text:"Reset",iconCls:"pts-menu-reset",action:"resetproject"}]}],items:[{xtype:"fieldset",title:"Project",anchor:"-15",items:[{xtype:"fieldcontainer",minWidth:400,layout:{align:"stretchmax",type:"hbox"},combineErrors:!0,fieldLabel:"Project ID",items:[{xtype:"displayfield",padding:"0 35 0 0",value:PTS.orgcode,hideLabel:!0},{xtype:"numberfield",width:75,name:"fiscalyear",value:2012,fieldLabel:"Fiscal Year",hideLabel:!0,labelAlign:"right",labelPad:3,labelSeparator:"",labelWidth:35,allowBlank:!1,emptyText:"Fiscal Year",allowDecimals:!1,hideTrigger:!0},{xtype:"displayfield",margin:"0 2",value:"--",hideLabel:!0},{xtype:"textfield",width:150,name:"number",fieldLabel:"Project ID",hideLabel:!0,labelAlign:"right",labelSeparator:"",labelWidth:8,allowBlank:!1,emptyText:"Unique ID"}]},{xtype:"textfield",name:"title",fieldLabel:"Title",allowBlank:!1,emptyText:"Project Title",maxLength:150,enforceMaxLength:!0,anchor:"100%"},{xtype:"textfield",name:"shorttitle",fieldLabel:"Short Title",allowBlank:!1,emptyText:"Short Title",maxLength:60,enforceMaxLength:!0,anchor:"60%"},{xtype:"combobox",name:"parentprojectid",fieldLabel:"Parent Project",displayField:"projectcode",listConfig:{getInnerTpl:function(){return"<div>{projectcode}: {shorttitle}</div>"}},store:"ProjectIDs",valueField:"projectid",anchor:"100%",queryParam:"filter"},{xtype:"fieldcontainer",layout:{type:"anchor"},fieldLabel:"Dates",items:[{xtype:"daterangefield",itemId:"startDate",name:"startdate",fieldLabel:"Start",allowBlank:!1,vfield:"beginDate",endDateField:"endDate",vtype:"daterange",labelWidth:50},{xtype:"daterangefield",itemId:"endDate",name:"enddate",allowBlank:!1,vfield:"endDate",startDateField:"startDate",vtype:"daterange",fieldLabel:"End",labelWidth:50}]},{xtype:"displayfield",
name:"uuid",submitValue:!1,fieldLabel:"UUID",anchor:"100%"},{xtype:"fieldcontainer",layout:{align:"stretchmax",type:"hbox"},fieldLabel:"ScienceBase ID",items:[{xtype:"textfield",name:"sciencebaseid",allowBlank:!0,emptyText:"ScienceBase ID",hideLabel:!0,width:300},{xtype:"simplelink",text:"View in ScienceBase",margin:"0 10",cls:"x-form-item-label",handler:function(){window.open("https://www.sciencebase.gov/catalog/item/"+this.prev("textfield[name=sciencebaseid]").value,"_sb")}}]}]},{xtype:"fieldset",collapsible:!0,title:"Description",anchor:"-15",items:[{xtype:"textareafield",name:"description",allowBlank:!1,grow:!0,growMin:80,anchor:"100%"}]},{xtype:"fieldset",collapsible:!0,title:"Abstract",anchor:"-15",items:[{xtype:"textareafield",name:"abstract",grow:!0,growMin:80,anchor:"100%"}]},{xtype:"fieldset",collapsible:!0,title:"Supplemental",anchor:"-15",items:[{xtype:"textareafield",name:"supplemental",grow:!0,growMin:80,anchor:"100%"}]}]}),a.callParent(arguments)}}),Ext.define("PTS.view.controls.CommentEditGrid",{extend:"PTS.view.controls.RowEditGrid",alias:"widget.commenteditgrid",requires:["Ext.grid.plugin.RowEditing","PTS.store.GroupUsers","PTS.view.controls.TextareaTriggerField"],columns:[{xtype:"gridcolumn",dataIndex:"comment",text:"Comment",flex:1,editor:{xtype:"areatrigger",text:"Comment"}},{xtype:"gridcolumn",dataIndex:"contactid",width:150,renderer:function(a){var b=Ext.getStore("GroupUsers"),c=b.find("contactid",a,0,!1,!0,!0),d=b.getAt(c);return d?d.get("fullname"):a},text:"User"},{xtype:"datecolumn",dataIndex:"datemodified",text:"Date"}],initComponent:function(){var a=this;a.callParent(arguments),a.getStore().on("add",function(a,b){Ext.each(b,function(){var a=this;null===a.get("contactid")&&a.set("contactid",PTS.user.get("contactid"))})}),a.on("edit",function(a,b){var c=a.record;c.dirty&&(c.beginEdit(),c.set("datemodified",new Date),c.endEdit())})}}),Ext.define("PTS.view.project.window.ProjectAgreements",{extend:"Ext.panel.Panel",alias:"widget.projectagreements",requires:["PTS.view.project.window.AgreementsTree"],layout:{type:"border"},title:"Agreements",initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"agreementitemdetail",flex:2,region:"center",minWidth:450},{xtype:"agreementstree",split:!0,collapsible:!1,flex:1,region:"west"}]}),a.callParent(arguments)}}),Ext.define("PTS.view.project.window.Window",{extend:"PTS.view.controls.ConfigWindow",alias:"widget.projectwindow",requires:["PTS.view.project.form.ProjectForm","PTS.view.project.window.ProjectContacts","PTS.view.project.window.ProjectMetadata","PTS.view.project.form.MetadataForm","PTS.view.project.window.ProjectAgreements","PTS.view.controls.CommentEditGrid","PTS.view.project.window.ProjectKeywords","PTS.view.project.ProjectMap","GeoExt.selection.FeatureModel","Ext.grid.plugin.CellEditing"],height:Ext.Element.getViewportHeight()-40,minWidth:750,layout:{type:"fit"},closable:!1,maximizable:!0,title:"Edit Project",constrain:!0,modal:!0,y:10,addTools:function(){var a=this;a.callParent(),a.addTool({xtype:"tool",type:"close",action:"closewindow"})},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"tabpanel",itemId:"projecttabpanel",items:[{xtype:"projectform"},{xtype:"projectcontacts"},{xtype:"projectagreements"},{title:"Comments",xtype:"commenteditgrid",store:"ProjectComments"},{xtype:"projectkeywords"},{xtype:"panel",defaults:{preventHeader:!0},layout:{type:"border"},title:"Map",items:[{xtype:"projectmap",commonStore:"CommonVectors",center:"-16760019.526289, 9118642.6397498",zoom:4,region:"center"},{xtype:"gridpanel",itemId:"featureGrid",store:"ProjectVectors",height:250,split:!0,autoScroll:!0,title:"Feature List",region:"south",columns:[{xtype:"gridcolumn",dataIndex:"name",flex:1,text:"Name",editor:{xtype:"textfield",allowBlank:!1}},{xtype:"gridcolumn",dataIndex:"comment",flex:2,text:"Description",editor:{xtype:"textfield",allowBlank:!1}}],selModel:{selectControl:{id:"PTS-Select-Row"}},selType:"featuremodel",plugins:[Ext.create("Ext.grid.plugin.CellEditing",{pluginId:"cellEdit",clicksToEdit:1})]}]},{xtype:"projectmetadata",formItems:[{xtype:"metadataform"}]}]}],dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"tbfill"},{xtype:"button",text:"Close",action:"closewindow"}]}]}),a.callParent(arguments)}}),Ext.define("GeoExt.data.FeatureStore",{extend:"Ext.data.Store",requires:["GeoExt.data.reader.Feature"],statics:{LAYER_TO_STORE:1,STORE_TO_LAYER:2},isLayerBinded:!1,layer:null,featureFilter:null,constructor:function(a){a=Ext.apply({proxy:{type:"memory",reader:{type:"feature",idProperty:"id"}}},a),a.layer&&(this.layer=a.layer,delete a.layer),a.features&&(a.data=a.features),delete a.features,this.callParent([a]);var b={initDir:a.initDir};delete a.initDir,this.layer&&this.bind(this.layer,b)},destroy:function(){this.unbind(),this.callParent()},bind:function(a,b){if(b=b||{},!this.isLayerBinded){this.layer=a,this.isLayerBinded=!0;var c=b.initDir;void 0==b.initDir&&(c=GeoExt.data.FeatureStore.LAYER_TO_STORE|GeoExt.data.FeatureStore.STORE_TO_LAYER);var d=a.features.slice(0);c&GeoExt.data.FeatureStore.STORE_TO_LAYER&&this.each(function(b){a.addFeatures([b.raw])},this),c&GeoExt.data.FeatureStore.LAYER_TO_STORE&&a.features.length>0&&this.loadRawData(d,!0),this.layer.events.on({featuresadded:this.onFeaturesAdded,featuresremoved:this.onFeaturesRemoved,featuremodified:this.onFeatureModified,scope:this}),this.on({load:this.onLoad,clear:this.onClear,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,scope:this}),this.fireEvent("bind",this,this.layer)}},unbind:function(){this.isLayerBinded&&(this.layer.events.un({featuresadded:this.onFeaturesAdded,featuresremoved:this.onFeaturesRemoved,featuremodified:this.onFeatureModified,scope:this}),this.un({load:this.onLoad,clear:this.onClear,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,scope:this}),this.layer=null,this.isLayerBinded=!1)},addFeatures:function(a){return this.loadRawData(a,!0)},removeFeatures:function(a){a=Ext.isArray(a)?a.slice(0):Array.prototype.slice.apply(arguments),Ext.Array.each(a,function(a){this.remove(this.getByFeature(a))},this)},getByFeature:function(a){return this.getAt(this.findBy(function(b,c){return b.raw==a}))},getById:function(a){return(this.snapshot||this.data).findBy(function(b){return b.raw.id===a})},addFeaturesToLayer:function(a){for(var b=[],c=0,d=a.length;c<d;c++)b.push(a[c].raw);this._adding=!0,this.layer.addFeatures(b),delete this._adding},onFeaturesAdded:function(a){if(!this._adding){var b=a.features,c=b;if(this.featureFilter){c=[];for(var d=0,e=b.length;d<e;d++){var f=b[d];!1!==this.featureFilter.evaluate(f)&&c.push(f)}}this._adding=!0,this.loadRawData(c,!0),delete this._adding}},onFeaturesRemoved:function(a){if(!this._removing)for(var b=a.features,c=b.length-1;c>=0;c--){var d=this.getByFeature(b[c]);d&&(this._removing=!0,this.remove(d),delete this._removing)}},onFeatureModified:function(a){var b=this.getByFeature(a.feature);if(b){var c=this.proxy.reader.read(a.feature).records[0];Ext.Object.each(c.getData(),function(a,c){b.set(a,c)},this)}},onLoad:function(a,b,c){c&&(this._addRecords||(this._removing=!0,this.layer.removeAllFeatures(),delete this._removing),this._adding||(this._adding=!0,this.addFeaturesToLayer(b),delete this._adding)),delete this._addRecords},onClear:function(a){this._removing=!0,this.layer.removeFeatures(this.layer.features),delete this._removing},onAdd:function(a,b,c){this._adding||this.addFeaturesToLayer(b)},onRemove:function(a,b,c){if(!this._removing){var d=b.raw;null!=this.layer.getFeatureById(d.id)&&(this._removing=!0,this.layer.removeFeatures([d]),delete this._removing)}},onUpdate:function(a,b,c){if(!this._updating){var d=b.raw;d.state!==OpenLayers.State.INSERT&&(d.state=OpenLayers.State.UPDATE);!1!==this.layer.events.triggerEvent("beforefeaturemodified",{feature:d})&&(Ext.Object.each(b.data,function(a){d.attributes[a]=b.get(a)}),this._updating=!0,this.layer.events.triggerEvent("featuremodified",{feature:d}),delete this._updating)}},loadRecords:function(a,b){b&&b.addRecords&&(this._addRecords=!0),this.callParent(arguments)}}),Ext.define("PTS.model.ProjectVector",{extend:"PTS.model.Base",fields:[{name:"fid",convert:function(a,b){return b.raw instanceof OpenLayers.Feature.Vector?b.raw.fid:"This is not a Feature"}},{name:"projectid",type:"int",useNull:!0},{name:"name",type:"mystring",useNull:!0},{name:"comment",type:"mystring",useNull:!0}]}),Ext.define("PTS.store.ProjectVectors",{extend:"GeoExt.data.FeatureStore",model:"PTS.model.ProjectVector",autoLoad:!1,sorters:["name"]}),Ext.define("PTS.controller.project.Project",{extend:"Ext.app.Controller",requires:["PTS.model.Modification","PTS.model.Deliverable","PTS.model.Funding"],views:["project.window.Window"],refs:[{ref:"projectWindow",selector:"projectwindow"}],stores:["ProjectVectors"],init:function(){var a=this.getController("project.tab.ProjectTab"),b=this.getController("project.window.Window");a.init(),b.init(),this.application.on({saveproject:this.onSaveProject,scope:this})},openProject:function(a,b,c){var d,e,f,g=!!a&&a.get("projectid");!1!==g?(e=a.getProjectCode(),d=Ext.create(this.getProjectWindowWindowView(),{title:"Edit Project: "+e,projectId:g}),f=d.down("#projecttabpanel>commenteditgrid").getStore(),f.setProxy({type:"rest",url:PTS.baseURL+"/projectcomment",appendId:!0,api:{read:PTS.baseURL+"/project/"+g+"/projectcomment"},reader:{type:"json",root:"data"}}),f.load()):(d=Ext.create(this.getProjectWindowWindowView(),{title:"New Project"}),d.down("#projecttabpanel").items.each(function(){"projectform"!==this.getXType()&&this.disable()})),this.application.fireEvent("openproject",g),d.show(c,b)},onSaveProject:function(a){var b=this.getProjectWindow();b.down("#projecttabpanel").items.each(function(){"projectform"!==this.getXType()&&this.enable()});var c=b.down("#projecttabpanel>commenteditgrid").getStore();c.setProxy({type:"rest",url:PTS.baseURL+"/projectcomment",appendId:!0,api:{read:PTS.baseURL+"/project/"+a.getId()+"/projectcomment"},reader:{type:"json",root:"data"}}),c.load()}}),Ext.define("Ext.ux.layout.component.form.MultiSelect",{extend:"Ext.layout.component.field.Field",alias:["layout.multiselectfield"],type:"multiselectfield",defaultHeight:200,sizeBodyContents:function(a,b){var c=this;Ext.isNumber(b)||(b=c.defaultHeight),c.owner.panel.setSize(a,b)}}),Ext.define("PTS.controller.dashboard.Calendar",{extend:"Ext.app.Controller",requires:["Extensible.calendar.data.EventModel","Extensible.calendar.data.CalendarModel"],views:["dashboard.Calendar"],init:function(){this.control({dashboardcalendar:{eventclick:this.eventClick}}),Extensible.calendar.data.EventMappings={CreatedBy:{name:"Manager",mapping:"manager"},DateReceived:{name:"Received",mapping:"receiveddate",type:"mydate"},PersonId:{name:"PersonID",mapping:"personid",type:"int"},Type:{name:"Type",mapping:"type",type:"string"},ProjectCode:{name:"ProjectCode",mapping:"projectcode",type:"string"},ProjectTitle:{name:"ProjectTitle",mapping:"shorttitle",type:"string"},ProjectId:{name:"projectid",mapping:"projectid",type:"int"},ModificationId:{name:"modificationid",mapping:"modificationid",type:"int"},Status:{name:"Status",mapping:"status",type:"string",convert:function(a){return a||"Not Received"}},Completed:{name:"Completed",mapping:"completed",type:"mybool"},EventId:{name:"ID",mapping:"deliverableid",type:"int"},CalendarId:{name:"CalendarId",mapping:"id",type:"int",convert:this.getCalendar},Title:{name:"EvtTitle",mapping:"title"},StartDate:{name:"StartDt",mapping:"duedate",type:"mydate"},EndDate:{name:"EndDt",mapping:"duedate",type:"mydate"},RRule:{name:"RecurRule",mapping:"recur"},Location:{name:"Location",mapping:"location"},Notes:{name:"Desc",mapping:"description"},Url:{name:"LinkUrl",mapping:"uri"},IsAllDay:{name:"AllDay",mapping:"allday",type:"boolean",defaultValue:!0},Reminder:{name:"Reminder",mapping:"reminder"}},Extensible.calendar.data.EventModel.reconfigure(),Extensible.calendar.data.EventModel.implement({getProjectCode:function(){return this.get("ProjectCode")}})},getCalendar:function(a,b){var c=b.data.StartDt,d=new Date;return d.setHours(0,0,0,0),"Overdue"===b.data.Status?1:b.data.Completed?5:b.data.Received?4:c<d?1:c>Ext.Date.add(d,Ext.Date.DAY,30)?3:2},eventClick:function(a,b){this.getController("dashboard.Dashboard").openProject(a,b)}}),Ext.define("PTS.model.Task",{extend:"PTS.model.Base",fields:[{name:"deliverableid",type:"int"},{name:"contactid",type:"int"},{name:"modificationid",type:"int",useNull:!0},{name:"projectid",type:"int",useNull:!0},{name:"title",type:"mystring",useNull:!0},{name:"duedate",type:"mydate"},{name:"assignee",type:"mystring",useNull:!0},{name:"status",type:"mystring",useNull:!0},{name:"projectcode",type:"mystring",useNull:!0},{name:"shorttitle",type:"mystring",useNull:!0}],idProperty:"deliverableid",proxy:{type:"ajax",url:PTS.baseURL+"/task",reader:{type:"json",root:"data"}}}),Ext.define("PTS.store.Tasks",{extend:"Ext.data.Store",model:"PTS.model.Task",autoLoad:!0,remoteSort:!0,remoteFilter:!0,storeId:"Tasks",pageSize:PTS.Defaults.pageSize,sorters:["duedate"],filters:[{property:"completed",value:"false"}]}),Ext.define("PTS.controller.dashboard.TaskList",{extend:"Ext.app.Controller",stores:["Tasks"],views:["dashboard.TaskList"],init:function(){this.control({"tasklist button[action=togglecomplete]":{toggle:this.toggleComplete},"tasklist button[action=filtertask]":{change:this.filterTask}})},filterTask:function(a,b){var c,d=this.getTasksStore();switch(d.remoteFilter=!1,d.clearFilter(!0),d.remoteFilter=!0,b.filter){case"user":d.filters.add(new Ext.util.Filter({property:"contactid",value:PTS.user.get("contactid")}));break;case"today":c=new Date,d.filters.add(new Ext.util.Filter({property:"duedate",value:Ext.Date.clearTime(c)}));break;default:d.clearFilter()}this.showComplete||d.filters.add(new Ext.util.Filter({property:"completed",value:"false"})),d.load()},toggleComplete:function(a,b){var c=this.getTasksStore(),d=c.filters;this.showComplete=b,b?d.removeAt(d.findIndex("property","completed")):d.add(new Ext.util.Filter({property:"completed",value:"false"})),c.load()}}),Ext.define("PTS.model.DeliverableListing",{extend:"PTS.model.Base",fields:[{name:"deliverableid",persist:!1,type:"int",useNull:!0},{name:"modificationid",type:"int",useNull:!0},{name:"projectid",type:"int",useNull:!0},{name:"duedate",type:"mydate"},{name:"startdate",type:"mydate"},{name:"enddate",type:"mydate"},{name:"receiveddate",type:"mydate"},{name:"title",type:"mystring",useNull:!0},{name:"projectcode",type:"mystring",useNull:!0},{name:"project",type:"mystring",useNull:!0},{name:"contact",type:"mystring",useNull:!0},{name:"email",type:"mystring",useNull:!0},{name:"dayspastdue",type:"int",useNull:!0},{name:"completed",type:"mybool",useNull:!0},{name:"status",type:"mystring",useNull:!0},{name:"agreementnumber",type:"mystring",useNull:!0},{name:"staffcomments",type:"mystring",useNull:!0},{name:"reminder",type:"mybool",useNull:!0},{name:"staffonly",type:"mybool",useNull:!0}],idProperty:"deliverableid",proxy:{type:"rest",url:PTS.baseURL+"/deliverabledue",reader:{type:"json",root:"data"}}}),Ext.define("PTS.store.DeliverableListings",{extend:"Ext.data.Store",model:"PTS.model.DeliverableListing",autoLoad:!0,remoteSort:!0,remoteFilter:!0,pageSize:PTS.Defaults.pageSize,sorters:["duedate"],filters:[{property:"dayspastdue",value:[">",0]}]}),Ext.define("PTS.controller.dashboard.DeliverableList",{extend:"Ext.app.Controller",stores:["DeliverableListings"],views:["dashboard.DeliverableList"],init:function(){this.control({"deliverablelist button[action=filterdeliverable]":{change:this.filterDeliverable}})},filterDeliverable:function(a,b){var c=a.up("deliverablelist").getStore();switch(c.remoteFilter=!1,c.clearFilter(!0),c.remoteFilter=!0,b.filter){case"over":c.filter([{property:"dayspastdue",value:[">",0]}]);break;case"soon":c.filter([{property:"dayspastdue",value:["<=",0]},{property:"dayspastdue",value:[">",-30]},{property:"receiveddate",value:["null"]},{property:"status",value:["not","Canceled"]}]);break;case"incomplete":c.filter([{property:"completed",value:"false"},{property:"receiveddate",value:["not null"]}]);break;case"complete":c.filter([{property:"completed",value:"true"}]);break;case"notcompleted":c.filter([{property:"status",value:["where not in",["Completed","Archived","Published","Canceled"]]}]);break;case"undelivered":c.filter([{property:"status",value:"Undelivered"}]);break;default:c.clearFilter()}}}),Ext.define("PTS.view.controls.FilterByStatusMenu",{extend:"Ext.button.Button",alias:"widget.filterstatusmenu",requires:["Ext.menu.Menu","Ext.form.field.Checkbox"],initComponent:function(){var a=this,b=[{xtype:"button",text:"Apply",handler:a.updateFilter,scope:a},"-"],c=Ext.create("Ext.menu.Menu",{plain:!0,items:b});Ext.Ajax.request({url:PTS.baseURL+"/status",params:{sort:'[{"property":"weight","direction":"ASC"}]'},method:"GET",success:function(b,d){var e=Ext.decode(b.responseText);Ext.each(e.data,function(a){c.add({xtype:"menucheckitem",text:a.status})},a),a.enable()},failure:function(b,c){a.disable()}}),Ext.applyIf(a,{disabled:!0,text:"Status",tooltip:"Filter by <b>Status</b>",menu:c}),a.callParent(arguments)},updateFilter:function(){var a=this,b=a.ownerCt.query("menu menucheckitem[checked]"),c=a.up("grid").getStore(),d=[];b.length>0?(Ext.each(b,function(a){d.push(a.text)}),c.remoteFilter=!1,c.clearFilter(!0),c.remoteFilter=!0,c.filter([{property:"status",value:["where in",d]}]),a.setText("<b>Status</b>")):(c.clearFilter(),a.setText("Status"))}}),Ext.define("PTS.view.project.tab.ProjectDetail",{extend:"Ext.tab.Panel",alias:"widget.projectdetail",requires:["Ext.ux.grid.PrintGrid","Ext.ux.grid.SaveGrid"],title:"Project Details",activeTab:0,initComponent:function(){var a=this;Ext.applyIf(a,{style:{backgroundColor:"#FFF",backgroundImage:"none"},defaults:{layout:"fit"},items:[{xtype:"treepanel",itemId:"projectAgreements",title:"Agreements",store:"ProjectAgreementsTree",uri:"tree",lines:!1,useArrows:!0,rootVisible:!1,viewConfig:{disableSelection:!0},columns:[{xtype:"treecolumn",dataIndex:"text",width:300,text:"Title"},{xtype:"gridcolumn",dataIndex:"type",text:"Type",width:75},{xtype:"gridcolumn",flex:1,dataIndex:"code",text:"Agreement #"}]},{xtype:"deliverablelist",title:"Deliverables",store:"ProjectDeliverables",initFilter:"all",uri:"deliverabledue"},{xtype:"gridpanel",itemId:"projectContacts",title:"Contacts",store:"ProjectContacts",uri:"projectcontactfull",dockedItems:[{xtype:"pagingtoolbar",store:"ProjectContacts",dock:"top",displayInfo:!0,plugins:[Ext.create("Ext.ux.grid.PrintGrid",{printHidden:!0}),Ext.create("Ext.ux.grid.SaveGrid",{})]}],columns:[{xtype:"gridcolumn",sortable:!1,dataIndex:"name",flex:1,text:"Name"},{xtype:"gridcolumn",dataIndex:"role",sortable:!1,flex:1,text:"Role"},{xtype:"booleancolumn",dataIndex:"partner",sortable:!1,text:"Partner?",width:55},{xtype:"booleancolumn",dataIndex:"reminder",sortable:!1,text:"Notice?",width:55}]}]}),a.callParent(arguments)}}),Ext.define("PTS.view.project.tab.ProjectList",{extend:"Ext.grid.Panel",alias:"widget.projectlist",requires:["PTS.util.Format","Ext.ux.grid.PrintGrid","Ext.ux.grid.SaveGrid","Ext.ux.grid.FilterBar","PTS.view.controls.FilterByStatusMenu"],store:"ProjectListings",title:"Project List",preventHeader:!0,initComponent:function(){var a=this;Ext.applyIf(a,{dockedItems:[{xtype:"pagingtoolbar",store:"ProjectListings",displayInfo:!0,plugins:[Ext.create("Ext.ux.grid.PrintGrid",{}),Ext.create("Ext.ux.grid.SaveGrid",{})],items:[{xtype:"filterstatusmenu"}]}],columns:[{xtype:"actioncolumn",width:25,items:[{iconCls:"pts-world-link",tooltip:"Open Website",handler:function(a,b,c){var d=a.getStore().getAt(b),e=d.get("fiscalyear"),f=d.get("number"),g=PTS.user.get("projecturiformat").replace(/(%s)/,e).replace(/(%s)/,f<10?"0"+f:f);window.open(g)}}]},{xtype:"gridcolumn",dataIndex:"projectcode",text:"Project"},{xtype:"gridcolumn",dataIndex:"title",text:"Title",flex:1},{xtype:"gridcolumn",hidden:!0,dataIndex:"shorttitle",text:"Short Title",flex:1},{xtype:"gridcolumn",dataIndex:"status",text:"Status",width:80},{xtype:"booleancolumn",text:"Export",trueText:"Yes",falseText:"No",dataIndex:"exportmetadata",hidden:!0,width:55},{text:"Funding",columns:[{dataIndex:"allocated",text:"Allocated",width:75,sortable:!0,renderer:Ext.util.Format.usMoney},{dataIndex:"invoiced",text:"Invoiced",width:75,sortable:!0,renderer:Ext.util.Format.usMoney},{dataIndex:"difference",text:"Difference",width:75,sortable:!0,renderer:PTS.util.Format.netFunds},{dataIndex:"leveraged",text:"Leveraged",width:75,sortable:!0,hidden:!0,renderer:Ext.util.Format.usMoney}]}]}),a.callParent(arguments),a.addDocked({xtype:"filterbar",searchStore:a.store,dock:"bottom"})}}),Ext.define("PTS.view.project.tab.ProjectTab",{extend:"Ext.panel.Panel",alias:"widget.projecttab",requires:["PTS.view.project.tab.ProjectList","PTS.view.project.tab.ProjectDetail"],layout:{type:"border"},title:"Projects",initComponent:function(){var a=this;Ext.applyIf(a,{dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",iconCls:"pts-menu-add",text:"Add Project",itemId:"newprojectbtn",action:"addproject"},{xtype:"button",iconCls:"pts-menu-edit",text:"Edit Project",itemId:"editprojectbtn",action:"editproject",disabled:!0}]}],items:[{xtype:"projectlist",region:"center",itemId:"pts-project-grid"},{xtype:"panel",width:150,layout:{type:"border"},bodyStyle:{border:"none",backgroundColor:"#FFF",backgroundImage:"none"},collapsible:!0,animCollapse:!Ext.isIE8,preventHeader:!0,title:"Project Details",flex:1,region:"east",split:!0,defaults:{preventHeader:!0},items:[{xtype:"projectdetail",region:"center"}]}]}),a.callParent(arguments)}}),Ext.define("PTS.controller.project.tab.ProjectTab",{extend:"Ext.app.Controller",views:["project.tab.ProjectTab"],refs:[{ref:"projectList",selector:"projecttab > projectlist"},{ref:"projectTab",selector:"projecttab"}],init:function(){var a=this.getController("project.tab.ProjectList"),b=this.getController("project.tab.ProjectDetail");a.init(),b.init(),this.control({"projecttab button[action=addproject]":{click:this.newProject},"projecttab button[action=editproject]":{click:this.editProject}}),this.application.on({projectlistselect:this.onProjectListSelect,scope:this})},newProject:function(){this.getController("project.Project").openProject()},editProject:function(){var a=this.getController("project.Project"),b=this.getProjectList().getSelectionModel().getSelection()[0];b&&a.openProject(b)},onProjectListSelect:function(a){this.getProjectTab().down("button[action=editproject]").setDisabled(!a)}}),Ext.define("PTS.model.ProjectComment",{extend:"PTS.model.Base",fields:[{name:"projectcommentid",type:"integer",useNull:!0,persist:!1},{name:"projectid",type:"int",useNull:!0},{name:"contactid",type:"int",useNull:!0},{name:"comment",type:"mystring",useNull:!0},{name:"publish",type:"myboolean",useNull:!0,defaultValue:!1},{name:"datemodified",type:"mydate",useNull:!0,defaultValue:new Date}],idProperty:"projectcommentid",validations:[{type:"length",field:"comment",min:1},{type:"length",field:"projectid",min:1},{type:"length",field:"contactid",min:1}],proxy:{type:"rest",url:PTS.baseURL+"/projectcomment",reader:{type:"json",root:"data"},limitParam:void 0}}),Ext.define("PTS.model.CommonVector",{extend:"PTS.model.Base",fields:[{name:"id",type:"int",useNull:!0},{name:"text",type:"mystring",useNull:!0},{name:"comment",type:"mystring",useNull:!0},{name:"wkt",type:"mystring",useNull:!0}],proxy:{type:"ajax",url:PTS.baseURL+"/commonfeature",reader:{type:"json",root:"data"}}}),Ext.define("PTS.store.ProjectComments",{extend:"Ext.data.Store",model:"PTS.model.ProjectComment",autoLoad:!1}),Ext.define("PTS.store.CommonVectors",{extend:"Ext.data.Store",model:"PTS.model.CommonVector",autoLoad:!1,sorters:["text"]}),Ext.define("PTS.controller.project.window.Window",{extend:"Ext.app.Controller",views:["project.window.Window"],stores:["ProjectComments","ProjectVectors","CommonVectors"],refs:[{ref:"projectWindow",selector:"projectwindow"},{ref:"projectForm",selector:"projectwindow projectform"},{ref:"projectMap",selector:"projectwindow projectmap"},{ref:"featureGrid",selector:"projectwindow #featureGrid"}],init:function(){var a=this.getController("project.form.ProjectForm"),b=this.getController("project.window.ProjectContacts"),c=this.getController("project.window.ProjectMetadata"),d=this.getController("project.window.ProjectAgreements"),e=this.getController("project.window.ProjectKeywords");a.init(),b.init(),d.init(),e.init(),c.init(),this.control({"projectwindow [action=closewindow]":{click:this.closeWindow},projectwindow:{beforeclose:this.onBeforeClose},"projectwindow>tabpanel>commenteditgrid":{edit:this.onCommentRowEdit},"projectwindow projectmap":{beforerender:this.onProjectMapBeforeRender,afterlayout:this.onProjectMapAfterLayout},"projectwindow projectmap maptoolbar":{beforerender:this.onMapToolbarBeforeRender},"projectwindow projectmap maptoolbar #addFeature menuitem":{click:this.onAddFeatureMenuClick},"projectwindow projectmap maptoolbar button#modify":{toggle:this.onModifyBtnToggle},"projectwindow #featureGrid gridview":{viewready:this.onFeatureGridReady},"projectwindow #featureGrid":{deselect:this.onFeatureGridDeselect}})},closeWindow:function(){this.getProjectWindow().close()},onBeforeClose:function(){this.getProjectVectorsStore().unbind(),this.application.fireEvent("closeproject")},onCommentRowEdit:function(a,b){var c=this.getProjectForm().getRecord(),d=c.getId();a.record.set("projectid",d),a.store.sync()},onMapToolbarBeforeRender:function(a){a.maskCmp=this.getProjectMap().ownerCt},onAddFeatureMenuClick:function(a,b){var c=this.getCommonVectorsStore().getById(a.itemId),d=c.get("wkt");d&&this.getProjectMap().addVector(d)},onProjectMapAfterLayout:function(a){a.projectVectors.protocol.options.params={projectid:this.getProjectWindow().projectId},a.projectVectors.events.on({beforedeletetoggle:function(a){a.feature.state!==OpenLayers.State.DELETE&&this.getSelectionModel().deselect(this.getStore().getByFeature(a.feature),!0)},deletetoggle:function(a){var b=this.getStore().getByFeature(a.feature),c=this.getView().getNode(b),d=Ext.get(c);a.feature.state===OpenLayers.State.DELETE?d&&d.addCls("pts-delete-highlight"):d&&d.removeCls("pts-delete-highlight")},loadstart:function(b){a.ownerCt.getEl().mask("Loading project features...")},loadend:function(b){var c,d,e,f=b.response;f.code!==OpenLayers.Protocol.Response.SUCCESS&&PTS.app.showError("There was an error loading the features.</br>Error: "+Ext.decode(f.priv.responseText).message),a.zoomOnLoad&&b.object.features.length&&(c=b.object.getDataExtent(),d=a.map,e=d.getZoomForExtent(c),e<=a.maxZoomOnLoad?d.zoomToExtent(c):d.setCenter(c.getCenterLonLat(),a.maxZoomOnLoad,!1,!1)),a.zoomOnLoad=!1,a.ownerCt.getEl().unmask()},refresh:function(a){this.getSelectionModel().deselectAll()},ptsfeaturesupdated:function(a){var b,c=this.getStore(),d=a.requestType.toLowerCase();"create"===d?(b=a.reqFeatures,"array"!==Ext.typeOf(b)&&(b=[b]),Ext.each(b,function(a){c.getById(a.id).commit()})):(b=a.features,Ext.each(b,function(a){c.data.findBy(function(b){return b.raw.fid===a.fid}).commit()}))},scope:this.getFeatureGrid()}),a.projectVectors.setVisibility(!0)},onProjectMapBeforeRender:function(a){var b,c=this.getFeatureGrid();b=new OpenLayers.Control.SelectFeature(a.projectVectors,{id:"PTS-Select-Hover",hover:!0,highlightOnly:!0,renderIntent:"temporary",unhighlight:function(a){var b=a.layer;!1!==this.events.triggerEvent("beforefeatureunhighlighted",{feature:a})&&(void 0===a._prevHighlighter?delete a._lastHighlighter:a._prevHighlighter==this.id?delete a._prevHighlighter:(a._lastHighlighter=a._prevHighlighter,delete a._prevHighlighter),b.drawFeature(a,a.style||a.layer.style||"default"),this.events.triggerEvent("featureunhighlighted",{feature:a}))},overFeature:function(a,b){var d=a.layer;if(this.hover&&(this.highlightOnly?this.highlight(a):-1==OpenLayers.Util.indexOf(d.selectedFeatures,a)&&this.select(a)),!b){var e=c.getStore().getByFeature(a),f=c.getView().getNode(e),g=Ext.get(f);g&&g.addCls("pts-vector-highlight")}},outFeature:function(a){if(this.hover){if(this.highlightOnly){if(!1!==this.events.triggerEvent("beforefeatureunhighlighted",{feature:a})&&a._lastHighlighter==this.id)if(a._prevHighlighter&&a._prevHighlighter!=this.id){delete a._lastHighlighter;var b=this.map.getControl(a._prevHighlighter);b&&b.highlight(a)}else this.unhighlight(a)}else this.unselect(a);var d=c.getStore().getByFeature(a),e=c.getView().getNode(d),f=Ext.get(e);f&&f.removeCls("pts-vector-highlight")}}}),b.events.on({beforefeatureunhighlighted:function(a){var c=b.map.getControlsBy("id","PTS-Modify-Feature")[0].feature;if(b.highlightOnly&&a.feature===c)return b.layer.drawFeature(a.feature,"select"),!1},beforefeaturehighlighted:function(a){if("vertex"===a.feature.renderIntent){var c=b.map.getControlsBy("id","PTS-Modify-Feature")[0].feature;return!(!b.highlightOnly||a.feature!==c)&&(b.layer.drawFeature(a.feature,"temporary"),!1)}},scope:this}),a.map.addControl(b),b.activate(),this.getProjectVectorsStore().bind(a.projectVectors)},onModifyBtnToggle:function(a,b){var c,d=this.getFeatureGrid().getSelectionModel().selected;b&&1===d.length&&(c=a.up("projectmap").map,c.getControlsBy("id","PTS-Modify-Feature")[0].selectControl.select(d.first().raw))},onFeatureGridReady:function(a){var b,c,d=a.getSelectionModel().selectControl,e=(this.getProjectMap().map.getControlsBy("id","PTS-Select-Hover")[0],a.getStore()),f=a.ownerCt.getPlugin("cellEdit");d.onSelect=function(a){b=this.map.getControlsBy("id","PTS-Modify-Feature")[0],b.active&&b.selectFeature(a)},c=function(b,c){Ext.each(c,function(b){b.beginEdit(),b.set("projectid",a.up("projectwindow").projectId),b.endEdit()})},e.on({add:c,load:c}),f.on({beforeedit:function(a){if(a.record.raw.state===OpenLayers.State.DELETE)return!1}}),a.ownerCt.on({beforeselect:function(a,b){if(b.raw.state===OpenLayers.State.DELETE)return!1}}),a.on({itemmouseenter:function(a,b){if(a.ownerCt.getPlugin("cellEdit").activeRecord!==b){b.raw.layer.map.getControlsBy("id","PTS-Select-Hover")[0].overFeature(b.raw,!0)}},itemmouseleave:function(a,b){var c,d=b.raw.layer,e=d.map;a.ownerCt.getPlugin("cellEdit").activeRecord!==b?(c=e.getControlsBy("id","PTS-Select-Hover")[0],c.outFeature(b.raw)):d.drawFeature(b.raw,"select")},destroy:function(a){e.un("add",c,e),e.un("load",c,e)},scope:this})},onFeatureGridDeselect:function(a,b,c){a.view.ownerCt.getPlugin("cellEdit").completeEdit(),a.selectControl.unselect(b.raw)}}),Ext.define("PTS.model.ProjectListing",{extend:"PTS.model.Base",requires:["PTS.util.Format"],fields:[{name:"projectid",type:"int"},{name:"orgid",type:"int"},{name:"parentprojectid",type:"int"},{name:"title",type:"mystring",useNull:!0},{name:"shorttitle",type:"mystring",useNull:!0},{name:"fiscalyear",type:"int"},{name:"number",type:"int"},{name:"allocated",type:"number"},{name:"invoiced",type:"number"},{name:"difference",type:"number"},{name:"leveraged",type:"number"},{name:"startdate",type:"mydate"},{name:"enddate",type:"mydate"},{name:"description",type:"mystring",useNull:!0},{name:"abstract",type:"mystring",useNull:!0},{name:"uuid",type:"mystring",useNull:!0},{name:"projectcode",type:"mystring",useNull:!0},{name:"status",type:"mystring",useNull:!0},{name:"exportmetadata",type:"myboolean"}],idProperty:"projectid",proxy:{type:"rest",url:PTS.baseURL+"/projectlist",reader:{type:"json",root:"data"}},getProjectCode:function(){var a=this.get("projectcode");return a||(a=PTS.orgcode+this.get("fiscalyear")+"-"+this.get("number")),a}}),Ext.define("PTS.store.ProjectListings",{extend:"Ext.data.Store",model:"PTS.model.ProjectListing",remoteSort:!0,remoteFilter:!0,pageSize:PTS.Defaults.pageSize,sorters:[{property:"fiscalyear",direction:"DESC"},{property:"number",direction:"DESC"}]}),Ext.define("PTS.controller.project.tab.ProjectList",{extend:"Ext.app.Controller",stores:["ProjectListings"],models:["ProjectListing"],views:["project.tab.ProjectList"],refs:[{ref:"projectList",selector:"projecttab > projectlist"}],init:function(){
this.control({projectlist:{itemdblclick:this.editProject,viewready:this.onProjectListReady,select:this.onProjectListSelect}}),this.application.on({saveproject:this.onSaveProject,deleteproject:this.onDeleteProject,scope:this})},editProject:function(a,b){this.getController("project.Project").openProject(b)},onProjectListReady:function(a){var b=a.getStore();b&&b.on("load",function(a,b,c,d){a.count()>0&&this.getSelectionModel().select(0)},a),b.load()},onProjectListSelect:function(a,b){this.application.fireEvent("projectlistselect",b)},onSaveProject:function(a,b){var c,d,e=this.getProjectListingsStore(),f=this.getProjectListingModel(),g=a.getId();c=e.indexOfId(g),-1===c?(d=Ext.create(f),e.insert(0,d)):d=e.getAt(c),d.fields.each(function(b){d.set(b.name,a.get(b.name))}),d.set("projectcode",d.getProjectCode()),d.commit()},onDeleteProject:function(a,b){var c=this.getProjectListingsStore();Ext.each(b.records,function(a){var b=a.getId();c.remove(c.getById(b))})}}),Ext.define("PTS.model.AgreementsTree",{extend:"PTS.model.Base",fields:[{name:"dataid",type:"string"},{name:"fkey",type:"auto"},{name:"typeid",type:"int"},{name:"text",type:"mystring",useNull:!0},{name:"code",type:"mystring",useNull:!0},{name:"parentcode",type:"mystring",useNull:!0},{name:"type",type:"mystring",useNull:!0},{name:"status",type:"mystring",useNull:!0},{name:"invalid",type:"boolean"},{name:"hilite",type:"boolean"},{name:"readonly",type:"boolean",defaultValue:!1},{name:"defIcon",type:"mystring",useNull:!0},{name:"parentItm",type:"mystring",useNull:!0}],idProperty:"id",proxy:{type:"memory"}}),Ext.define("PTS.store.ProjectAgreementsTree",{extend:"Ext.data.TreeStore",model:"PTS.model.AgreementsTree",clearOnLoad:!0,folderSort:!1,autoLoad:!1,root:{children:[]}}),Ext.define("PTS.store.ProjectDeliverables",{extend:"PTS.store.DeliverableListings",model:"PTS.model.DeliverableListing",autoLoad:!1,filters:[]}),Ext.define("PTS.model.ProjectContact",{extend:"PTS.model.Base",fields:[{name:"projectcontactid",type:"int",persist:!1,useNull:!0},{name:"contactid",type:"int",useNull:!0},{name:"projectid",type:"int",useNull:!0},{name:"roletypeid",type:"int",useNull:!0},{name:"priority",type:"int",useNull:!0},{name:"name",persist:!1},{name:"role",persist:!1},{name:"type",persist:!1},{name:"contactprojectcode"},{name:"partner",type:"boolean",default:!1,useNull:!0,convert:function(a){return!this.useNull||void 0!==a&&null!==a&&""!==a?"false"!==a&&!!a:null}},{name:"projectcode",type:"mystring",persist:!1},{name:"shorttitle",type:"mystring",persist:!1},{name:"reminder",type:"boolean",defaultValue:!1,useNull:!0},{name:"namerole",persist:!1,convert:function(a,b){return b.data.name+": "+b.data.role}}],idProperty:"projectcontactid",proxy:{type:"rest",url:PTS.baseURL+"/projectcontact",appendId:!0,reader:{type:"json",root:"data"}}}),Ext.define("PTS.store.ProjectInvoicers",{extend:"Ext.data.Store",model:"PTS.model.ProjectContact",autoLoad:!1,sorters:["name"]}),Ext.define("PTS.store.ProjectRecipients",{extend:"Ext.data.Store",model:"PTS.model.ProjectContact",autoLoad:!1,sorters:["name"]}),Ext.define("PTS.store.NoticeRecipients",{extend:"Ext.data.Store",model:"PTS.model.ProjectContact",autoLoad:!1,sorters:["name"]}),Ext.define("PTS.store.ProjectFunders",{extend:"Ext.data.Store",model:"PTS.model.ProjectContact",autoLoad:!1,sorters:["name"]}),Ext.define("PTS.store.ProjectContacts",{extend:"Ext.data.Store",model:"PTS.model.ProjectContact",requires:["PTS.store.ProjectFunders","PTS.store.ProjectInvoicers","PTS.store.ProjectRecipients","PTS.store.NoticeRecipients"],autoLoad:!1,listeners:{datachanged:{fn:function(a,b,c,d){var e=[],f=[],g=[],h=[],i=[1,5,6,7,10,11],j=[],k=[5,6,7],l=[],m=Ext.getStore("ProjectFunders"),n=Ext.getStore("ProjectInvoicers"),o=Ext.getStore("ProjectRecipients"),p=Ext.getStore("NoticeRecipients"),q=Ext.getStore("GroupUsers");return a.each(function(a){var b=a.get("roletypeid"),c=a.get("contactid");4!==b&&10!==b||e.push(a.copy()),Ext.Array.indexOf(i,b)>-1&&-1===Ext.Array.indexOf(j,c)&&(f.push(a.copy()),j.push(c)),Ext.Array.indexOf(k,b)>-1&&-1===Ext.Array.indexOf(l,c)&&(h.push(a.copy()),l.push(c)),11===b&&g.push(a.copy())}),q.each(function(a){var b=a.get("contactid");0!==b&&-1===Ext.Array.indexOf(l,b)&&(a.set("name",a.get("lastname")+", "+a.get("firstname")),h.push(a.copy()),l.push(b))}),m.loadRecords(e,{addRecords:!1}),n.loadRecords(f,{addRecords:!1}),o.loadRecords(g,{addRecords:!1}),p.loadRecords(h,{addRecords:!1}),!0}}}}),Ext.define("PTS.controller.project.tab.ProjectDetail",{extend:"Ext.app.Controller",stores:["ProjectAgreementsTree","ProjectDeliverables","ProjectContacts"],models:["AgreementsTree"],views:["project.tab.ProjectDetail"],refs:[{ref:"projectAgreements",selector:"projectdetail > #projectAgreements"},{ref:"projectDetail",selector:"projecttab projectdetail"}],init:function(){this.control({"projectdetail > #projectAgreements":{beforeitemdblclick:this.onProjectAgreementsDblClick,load:this.onProjectAgreementsLoad},"projectdetail > deliverablelist":{itemdblclick:this.onDeliverableDblClick},"projectdetail > #projectContacts":{itemdblclick:this.onContactDblClick},"projectdetail > deliverablelist #printBtn":{click:this.onDelPrintBtnClick},"projectdetail > #projectContacts #printBtn":{click:this.onContactPrintBtnClick},"projecttab projectdetail tab":{activate:this.onProjectDetailTabActivate}}),this.application.on({projectlistselect:this.onSelectProject,scope:this})},onSelectProject:function(a){var b=a.getId(),c=this.getProjectDetail(),d=c.query("treepanel, grid"),e=c.getActiveTab().getStore();if(Ext.each(d,function(a){a.getStore().setProxy({type:"ajax",url:PTS.baseURL+"/project/"+b+"/"+a.uri,reader:{type:"json",root:a.isXType("grid")?"data":""}})}),e.loading&&e.lastOperation){var f,g=Ext.Ajax.requests;for(f in g)g.hasOwnProperty(f)&&g[f].options===e.lastOperation.request&&Ext.Ajax.abort(g[f])}e.on("beforeload",function(a,b){a.lastOperation=b},this,{single:!0}),e.load(),this.projectRecord=a},onProjectDetailTabActivate:function(a){a.card.getStore().load()},onDelPrintBtnClick:function(a){var b=this.projectRecord.get("projectcode");a.mainTitle=function(){return this.child("cycle#filter").getActiveItem().text+" Deliverables for "+b}},onContactPrintBtnClick:function(a){var b=this.projectRecord.get("projectcode");a.mainTitle=function(){return"Project Contacts for "+b}},onProjectAgreementsDblClick:function(a,b){var c=b.getPath(),d=function(a){this.down("agreementstree").selectPath(c),this.getEl().unmask()};return this.openProjectAgreement(d),!1},onProjectAgreementsLoad:function(a,b,c,d){c&&this.getProjectAgreements().expandPath("/root/art-0")},onDeliverableDblClick:function(a,b){var c=b.getId(),d=b.get("modificationid"),e=function(a){var b=a.getNodeById("d-"+c+"-"+d).getPath();this.down("agreementstree").selectPath(b),this.getEl().unmask()};return this.openProjectAgreement(e),!1},onContactDblClick:function(a,b){var c=b.get("contactid"),d=b.get("name").split(" -> ").pop(),e=b.get("type"),f={getId:function(){return c},getContactName:function(){return d}};return this.getController("contact.Contact").openContact(e,f),!1},openProjectAgreement:function(a){var b=function(){var b=this,c=b.down("agreementstree").getStore(),d=b.down("projectagreements");b.getEl().mask("Loading..."),b.down("tabpanel").setActiveTab(d),c.getRootNode().hasChildNodes()?a(c):c.on("load",a,b,{single:!0})};this.getController("project.Project").openProject(this.projectRecord,b)}}),Ext.define("PTS.util.mixin.FixRemoteQuery",{fixRemoteQuery:function(a){var b='[{"property":"'+a.combo.displayField+'","value":["ilike","'+a.query+'"]}]';a.query=b}}),Ext.define("PTS.controller.project.form.ProjectForm",{extend:"Ext.app.Controller",mixins:{fixQuery:"PTS.util.mixin.FixRemoteQuery"},views:["project.form.ProjectForm"],models:["Project"],stores:["ProjectIDs"],refs:[{ref:"projectForm",selector:"projectform"}],init:function(){this.control({"projectform button[action=saveproject]":{click:this.saveProject},"projectform button[action=resetproject]":{click:this.resetProject},"projectform button[action=deleteproject]":{click:this.confirmDelete},"projectform combobox[queryMode=remote]":{beforequery:this.fixRemoteQuery}}),this.application.on({openproject:this.onOpenProject,scope:this})},onOpenProject:function(a){this.loadRecord(a)},onLoadProject:function(a){this.application.fireEvent("loadproject",a)},onSaveProject:function(a,b){this.application.fireEvent("saveproject",a,b)},onDeleteProject:function(a,b){this.application.fireEvent("deleteproject",a,b)},saveProject:function(){var a=this.getProjectForm().getForm(),b=this.getProjectForm().getEl(),c=a.getRecord();b.mask("Saving..."),a.updateRecord(c),c.save({success:function(a,c){var d=this.getProjectForm();d.loadRecord(a),d.up("window").projectId=a.getId(),b.unmask(),this.onSaveProject(a,c)},failure:function(a,c){b.unmask(),Ext.MessageBox.show({title:"Error",msg:"There was an error saving the project.</br>Error:"+PTS.app.getError(),buttons:Ext.MessageBox.OK,icon:Ext.Msg.ERROR})},scope:this})},confirmDelete:function(a){var b=a.getEl(),c=function(a){"yes"===a&&this.deleteProject()};Ext.MessageBox.show({title:"Confirm Deletion",msg:"Are you sure you want to delete this project?",buttons:Ext.MessageBox.YESNO,icon:Ext.Msg.WARNING,fn:c,scope:this,animateTarget:b})},deleteProject:function(){var a=this.getProjectForm().getForm(),b=this.getProjectForm().getEl(),c=a.getRecord();b.mask("Deleting..."),c.destroy({success:function(a,c){b.unmask(),this.onDeleteProject(a,c),this.getProjectForm().up("window").close()},failure:function(a,c){b.unmask(),Ext.MessageBox.show({title:"Error",msg:"There was an error deleting the project.</br>Error:"+PTS.app.getError(),buttons:Ext.MessageBox.OK,icon:Ext.Msg.ERROR})},scope:this})},resetProject:function(){this.getProjectForm().getForm().reset()},loadRecord:function(a){var b=this,c=this.getProjectModel(),d=this.getProjectForm();a?c.load(a,{success:function(a){d.loadRecord(a),b.onLoadProject(a)},failure:function(a,b){Ext.MessageBox.show({title:"Error",msg:"There was an error loading the project.</br>Error:"+PTS.app.getError(),buttons:Ext.MessageBox.OK,icon:Ext.Msg.ERROR})}}):(d.loadRecord(Ext.create(c)),b.onLoadProject(d.getForm().getRecord()))}}),Ext.define("PTS.view.controls.ReorderColumn",{extend:"Ext.grid.column.Action",alias:"widget.reordercolumn",header:"Priority",tooltip:"The priority is set by order of appearance.",constructor:function(a){var b=this,c=Ext.apply({},a);Ext.apply(c,{width:50,items:[{getClass:function(a,b,c,d){return d>0?(this.items[0].tooltip="Move up","pts-arrow-up"):"pts-arrow-up-disabled"},handler:function(a,b,c){if(b>0){var d,e,f=a.getStore(),g=f.getAt(b);f.removeAt(b),g.phantom||Ext.Array.remove(f.removed,g),f.insert(b-1,g),d=a.getNode(b-1),e=Ext.get(d),e.addCls("pts-grid-row-hilite"),e.highlight("ffff9c",{attr:"backgroundColor",easing:"easeIn",duration:1500,callback:function(){e.removeCls("pts-grid-row-hilite")},scope:e}),this.fireEvent("moverow",g)}}},{getClass:function(a,b,c,d,e,f){return d+1!==f.getCount()?(this.items[1].tooltip="Move down","pts-arrow-down"):"pts-arrow-down-disabled"},handler:function(a,b,c){if(b-1<a.getStore().getCount()){var d,e,f=a.getStore(),g=f.getAt(b);f.removeAt(b),g.phantom||Ext.Array.remove(f.removed,g),f.insert(b+1,g),d=a.getNode(b+1),e=Ext.get(d),e.addCls("pts-grid-row-hilite"),e.highlight("ffff9c",{attr:"backgroundColor",easing:"easeIn",duration:1500,callback:function(){e.removeCls("pts-grid-row-hilite")},scope:e}),this.fireEvent("moverow",g)}}}]}),b.callParent([c]),b.addEvents("moverow")}}),Ext.define("PTS.model.ContactGroup",{extend:"PTS.model.Base",fields:[{name:"contactid",mapping:"contactid",type:"int",persist:!1},{name:"parentgroupid",type:"int",persist:!1},{name:"name",type:"mystring",useNull:!0},{name:"fullname",type:"mystring",useNull:!0,persist:!1},{name:"acronym",type:"mystring",useNull:!0},{name:"organization",type:"myboolean",useNull:!0},{name:"contacttypeid",type:"int",useNull:!0},{name:"dunsnumber",type:"mystring",useNull:!0},{name:"comment",type:"mystring",useNull:!0},{name:"inactive",type:"myboolean"}],idProperty:"contactid",hasMany:[{model:"PTS.model.Address",name:"addresses"},{model:"PTS.model.Phone",name:"phones"},{model:"PTS.model.EAddress",name:"eaddresses"},{model:"PTS.model.ContactContactGroup",name:"contactcontactgroups"}],proxy:{type:"rest",url:PTS.baseURL+"/contactgroup",reader:{type:"json",root:"data"},writer:{type:"ajson"}},getContactName:function(){return this.get("name")},getContactType:function(){return"group"}}),Ext.define("PTS.store.ContactGroups",{extend:"Ext.data.Store",model:"PTS.model.ContactGroup",remoteSort:!0,remoteFilter:!0,pageSize:PTS.Defaults.pageSize,sorters:{property:"fullname",direction:"ASC"}}),Ext.define("PTS.store.DDContactGroups",{extend:"PTS.store.ContactGroups",remoteFilter:!0}),Ext.define("PTS.model.Person",{extend:"PTS.model.Base",fields:[{name:"contactid",mapping:"contactid",type:"int",persist:!1},{name:"firstname",type:"mystring",useNull:!0},{name:"lastname",type:"mystring",useNull:!0},{name:"middlename",type:"mystring",useNull:!0},{name:"suffix",type:"mystring",useNull:!0},{name:"positionid",type:"int",useNull:!0},{name:"contacttypeid",type:"int",useNull:!0},{name:"dunsnumber",type:"mystring"},{name:"comment",type:"mystring"},{name:"inactive",type:"myboolean"},{name:"prigroupid",type:"int",persist:!1},{name:"priacronym",type:"mystring",persist:!1,useNull:!0},{name:"prigroupname",type:"mystring",persist:!1,useNull:!0},{name:"priareacode",type:"int",persist:!1,useNull:!0},{name:"priphnumber",type:"int",persist:!1,useNull:!0},{name:"priextension",type:"int",persist:!1,useNull:!0},{name:"pricountryiso",type:"mystring",persist:!1,useNull:!0},{name:"priemail",type:"mystring",persist:!1,useNull:!0}],idProperty:"contactid",hasMany:[{model:"PTS.model.Address",name:"addresses"},{model:"PTS.model.Phone",name:"phones"},{model:"PTS.model.EAddress",name:"eaddresses"}],proxy:{type:"rest",url:PTS.baseURL+"/person",reader:{type:"json",root:"data"},writer:{type:"ajson"}},getContactName:function(){var a=this.get("firstname");return this.get("lastname")+", "+a},getContactType:function(){return"person"}}),Ext.define("PTS.store.Persons",{extend:"Ext.data.Store",model:"PTS.model.Person",remoteSort:!0,remoteFilter:!0,pageSize:PTS.Defaults.pageSize,sorters:{property:"lastname",direction:"ASC"},proxy:{type:"rest",url:PTS.baseURL+"/person",api:{read:PTS.baseURL+"/personlist"},reader:{type:"json",root:"data"},writer:{type:"ajson"}}}),Ext.define("PTS.model.RoleType",{extend:"PTS.model.Base",fields:[{name:"roletypeid",type:"int",persist:!1},{name:"code",type:"mystring",useNull:!0},{name:"roletype",type:"mystring",useNull:!0},{name:"description",type:"mystring",useNull:!0}],idProperty:"roletypeid",proxy:{type:"rest",url:PTS.baseURL+"/roletype",reader:{type:"json",root:"data"}}}),Ext.define("PTS.store.RoleTypes",{extend:"Ext.data.Store",model:"PTS.model.RoleType",autoLoad:!0,sorters:["code"]}),Ext.define("PTS.store.DDPersons",{extend:"PTS.store.Persons",remoteFilter:!0});Ext.define("PTS.controller.project.window.ProjectContacts",{extend:"Ext.app.Controller",requires:["PTS.view.controls.ReorderColumn"],views:["project.window.ProjectContacts"],models:["ProjectContact"],stores:["ProjectContacts","ContactGroups","DDContactGroups","Persons","RoleTypes","DDPersons"],refs:[{ref:"projectContacts",selector:"projectcontacts"},{ref:"contactLists",selector:"projectcontacts #contactLists"},{ref:"projectContactsList",selector:"projectcontacts #projectContactsList"}],init:function(){this.control({projectcontacts:{activate:this.activate},"projectcontacts button[action=addcontacts]":{click:this.addContacts},"projectcontacts button[action=removecontacts]":{click:this.removeContacts},"projectcontacts button[action=savecontacts]":{click:this.saveContacts},"projectcontacts button[action=refreshcontacts]":{click:this.refreshContacts},"projectcontacts #contactLists > gridpanel":{activate:this.activateList,beforerender:this.beforeRenderContactLists},"projectcontacts #contactLists > gridpanel > gridview":{beforedrop:this.removeContactsByDrag},"projectcontacts #projectContactsList > gridview":{afterrender:this.afterRenderProjectContactsList,drop:this.dropProjectContactsList},"projectcontacts #projectContactsList":{beforerender:this.beforeRenderProjectContactsList,edit:this.onEditRole},"combo[itemId=roletypeCbxProject]":{select:this.onSelectRoleType}}),this.application.on({openproject:this.onOpenProject,saveproject:this.onSaveProject,scope:this})},dropProjectContactsList:function(a,b){var c=this.getProjectContactsStore().indexOf(b.records[0]);this.getProjectContactsList().getPlugin("contactEditor").startEditByPosition({row:c,column:2})},setProxy:function(a,b){b.setProxy({type:"rest",url:PTS.baseURL+"/projectcontact",appendId:!0,api:{read:PTS.baseURL+"/project/"+a+"/contacts"},reader:{type:"json",root:"data"}})},onOpenProject:function(a){var b=this.getProjectContactsStore();a&&(this.setProxy(a,b),b.load())},onSelectRoleType:function(a,b){this.getProjectContactsList().getPlugin("contactEditor").completeEdit()},onEditRole:function(a,b){var c={5:null,6:null,7:null,12:null,13:null},d={4:null,10:null},e=b.record;"roletypeid"===b.field&&(void 0!==c[b.value]?e.set("reminder",!0):e.set("reminder",!1)),"roletypeid"===b.field&&(void 0!==d[b.value]&&e.get("contactid")!==PTS.user.get("groupid")?e.set("partner",!0):e.set("partner",!1))},onSaveProject:function(a){var b=this.getProjectContactsStore(),c=a.getId();c&&(this.setProxy(c,b),b.load())},activate:function(a){},activateList:function(a){var b=a.getStore();0===b.getCount()&&b.load()},beforeRenderContactLists:function(a){var b=Ext.create("Ext.grid.column.Column",a.getSelectionModel().getHeaderConfig());a.headerCt.insert(0,b)},saveContacts:function(){var a=this.getProjectContactsStore(),b=this.getProjectContactsList().getEl(),c=!!(a.getRemovedRecords().length+a.getUpdatedRecords().length+a.getNewRecords().length);-1===a.findExact("roletypeid",null)?(c&&b.mask("Saving..."),a.each(function(){var b=this,c=b.get("priority"),d=a.indexOf(b);c!==d&&b.set("priority",d)}),a.getBatchListeners=function(){var c=a,d={scope:c,exception:function(c,d){b.unmask(),Ext.MessageBox.show({title:"Error",msg:"There was an error saving the contacts.</br>Error:"+PTS.app.getError(),buttons:Ext.MessageBox.OK,icon:Ext.Msg.ERROR}),a.rejectChanges()}};return"operation"==c.batchUpdateMode?d.operationcomplete=c.onBatchOperationComplete:d.complete=c.onBatchComplete,d},a.sync({success:function(){b.unmask(),PTS.app.fireEvent("syncprojectcontacts",a)},failure:function(){b.unmask(),Ext.MessageBox.show({title:"Error",msg:"There was an error saving the contacts.</br>Error:"+PTS.app.getError(),buttons:Ext.MessageBox.OK,icon:Ext.Msg.ERROR})},callback:function(){}})):PTS.app.showError("All contacts must be assigned a role before saving.")},removeContacts:function(){var a=this.getProjectContactsList(),b=a.getSelectionModel().getSelection();a.getStore().remove(b)},refreshContacts:function(){var a=this.getProjectContactsList();a.getStore().load({callback:function(b,c,d){a.getStore().removed=[]}})},addContacts:function(){var a=this.getContactLists().getActiveTab(),b=a.getSelectionModel().getSelection(),c={copy:!0,view:a.getView(),records:b},d=this.getProjectContactsList();d.getView().getPlugin("contactsddplugin").dropZone.handleNodeDrop(c),d.getView().fireEvent("drop",null,c,null,null)},removeContactsByDrag:function(a,b,c,d,e){return this.getProjectContactsStore().remove(b.records),!1},beforeRenderProjectContactsList:function(a){var b=Ext.create("Ext.grid.column.Column",a.getSelectionModel().getHeaderConfig());a.headerCt.insert(0,b),a.headerCt.insert(a.headerCt.getColumnCount()+1,{xtype:"reordercolumn"})},afterRenderProjectContactsList:function(a){a.getPlugin("contactsddplugin").dropZone.handleNodeDrop=function(a,b,c){var d,e,f,g,h=this.view,i=h.getStore(),j=h.up("projectwindow").projectId;if(a.copy){for(e=a.records,a.records=[],f=0,g=e.length;f<g;f++){var k=e[f].data;void 0===k.name&&(k.name=k.lastname+", "+k.firstname);var l=Ext.create("PTS.model.ProjectContact",{name:k.name,roletypeid:"",contactid:k.contactid,projectid:j,partner:!1});l.phantom=!0,a.records.push(l)}a.view.getSelectionModel().deselect(e)}else a.view.store.remove(a.records,a.view===h);d=i.indexOf(b),"before"!==c&&d++,i.insert(d,a.records),h.getSelectionModel().select(a.records)}}}),Ext.define("PTS.model.ProjectMetadata",{extend:"PTS.model.Base",fields:[{name:"projectid",type:"int",persist:!1},{name:"projectcategory",type:"auto",useNull:!0,convert:function(a){return Ext.isString(a)?a.split(","):a}},{name:"usertype",type:"auto",useNull:!0,convert:function(a){return Ext.isString(a)?a.split(","):a}},{name:"topiccategory",type:"mystring",useNull:!0,convert:function(a){return Ext.isString(a)?a.split(","):a}}],idProperty:"projectid",proxy:{type:"rest",url:PTS.baseURL+"/projectmetadata",reader:{type:"json",root:"data"}}}),Ext.define("PTS.model.TopicCategory",{extend:"PTS.model.Base",fields:[{name:"topiccategoryid",type:"int",persist:!1},{name:"code",type:"mystring",useNull:!0},{name:"codename",type:"mystring",useNull:!0},{name:"description",type:"mystring",useNull:!0}],idProperty:"topiccategoryid",proxy:{type:"rest",url:PTS.baseURL+"/topiccategory",reader:{type:"json",root:"data"}}}),Ext.define("PTS.model.UserType",{extend:"PTS.model.Base",fields:[{name:"usertypeid",type:"int",persist:!1},{name:"usertype",type:"mystring",useNull:!0},{name:"code",type:"mystring",useNull:!0},{name:"description",type:"mystring",useNull:!0}],idProperty:"usertypeid",proxy:{type:"rest",url:PTS.baseURL+"/usertype",reader:{type:"json",root:"data"}}}),Ext.define("PTS.model.ProjectCategory",{extend:"PTS.model.Base",fields:[{name:"projectcategoryid",type:"int",persist:!1},{name:"category",type:"mystring",useNull:!0},{name:"code",type:"mystring",useNull:!0},{name:"description",type:"mystring",useNull:!0}],idProperty:"projectcategoryid",proxy:{type:"rest",url:PTS.baseURL+"/projectcategory",reader:{type:"json",root:"data"}}}),Ext.define("PTS.store.TopicCategories",{extend:"Ext.data.Store",model:"PTS.model.TopicCategory",autoLoad:!0,sorters:[{property:"codename",direction:"ASC"}]}),Ext.define("PTS.store.UserTypes",{extend:"Ext.data.Store",model:"PTS.model.UserType",autoLoad:!0,sorters:[{property:"usertype",direction:"ASC"}]}),Ext.define("PTS.store.ProjectCategories",{extend:"Ext.data.Store",model:"PTS.model.ProjectCategory",autoLoad:!0,sorters:[{property:"category",direction:"ASC"}]}),Ext.define("PTS.controller.project.window.ProjectMetadata",{extend:"Ext.app.Controller",requires:[],views:["project.window.ProjectMetadata"],models:["Project","ProjectMetadata"],stores:["TopicCategories","UserTypes","ProjectCategories"],refs:[{ref:"projectMetadata",selector:"projectmetadata"},{ref:"metadataForm",selector:"projectmetadata metadataform"},{ref:"metadataPreview",selector:"projectmetadata #metadataPreview"}],init:function(){this.control({projectmetadata:{activate:this.activate},"projectmetadata button[action=goback]":{click:this.clickBack},"projectmetadata button[action=openpreview]":{click:this.openPreview},"projectmetadata button[action=json]":{click:this.clickPreview},"projectmetadata button[action=xml]":{click:this.clickPreview},"projectmetadata button[action=html]":{click:this.clickPreview},"projectmetadata button[action=reset]":{click:this.clickReset},"projectmetadata button[action=save]":{click:this.clickSave},"projectmetadata #publishBtn":{change:this.publish},"projectmetadata metadataform":{validitychange:this.onValidityChange}}),this.application.on({loadproject:this.onLoadProject,saveproject:this.onLoadProject,scope:this})},onValidityChange:function(a,b){var c=this.getProjectMetadata().down("button[action=save]");b?c.enable():c.disable()},onDirtyChange:function(a,b){var c=this.getProjectMetadata().down("button[action=save]"),d=this.getProjectMetadata().down("button[action=reset]");b?(d.enable(),a.isValid()&&c.enable()):(d.disable(),c.disable())},onLoadProject:function(a){var b=a.get("exportmetadata")?1:0,c=this.getProjectMetadata().down("#publishBtn"),d=c.menu.items,e=a.get("projectid"),f=this.getProjectMetadataModel(),g=this.getMetadataForm();c.setActiveItem(d.get(b),!0),e&&(g.setLoading(!0,!0),f.load(e,{success:function(a){g.loadRecord(a)}}))},activate:function(a){},clickReset:function(a){this.getMetadataForm().getForm().reset()},clickSave:function(a){var b=this.getMetadataForm().getForm(),c=this.getMetadataForm().getEl(),d=b.getRecord();c.mask("Saving..."),b.updateRecord(d),d.save({success:function(a,b){this.getMetadataForm().loadRecord(a),c.unmask()},failure:function(a,b){c.unmask(),Ext.create("widget.uxNotification",{title:"Error",iconCls:"ux-notification-icon-error",html:"There was an error saving the project metadata.</br>Error: "+PTS.app.getError()}).show()},scope:this})},clickBack:function(a){this.getProjectMetadata().getLayout().setActiveItem(0)},clickPreview:function(a){var b=this.getMetadataPreview(),c=b.getEl(),d=b.up("projectwindow").projectId,e=this.getProjectMetadata(),f=e.getLayout(),g=e.down("button[action=openpreview]");f.setActiveItem(1),f.getActiveItem().body.scrollTo("top",0),c.mask("Generating Preview..."),g.previewType=a.action,c.child("code").load({url:"/project/"+d+"/metadata."+a.action+"?pretty=1",renderer:function(b,d){b.getTarget().update(hljs.highlight(a.action,d.responseText).value),c.unmask()}})},openPreview:function(a){var b=a.up("projectwindow").projectId;window.open("/project/"+b+"/metadata."+a.previewType+"?pretty=1","_blank",null,!0)},publish:function(a){var b=a.up("projectwindow"),c=b.down("projectform").getForm().getRecord(),d=a.getActiveItem().action,e=b.projectId;a.disable(),Ext.Ajax.request({url:"/project/"+e+"/metadata/publish",method:d,success:function(a,b){c.set("exportmetadata","DELETE"===d?0:1),c.save({failure:function(a,b){Ext.create("widget.uxNotification",{title:"Error",iconCls:"ux-notification-icon-error",html:"The metadata was "+d=="DELETE"?"unpublished":"published. However, there was an error saving the project.</br>Error:"+PTS.app.getError()}).show()}})},failure:function(b){var c=a.menu.items;a.setActiveItem(c.get("DELETE"===d?1:0),!0),Ext.create("widget.uxNotification",{title:"Error",iconCls:"ux-notification-icon-error",html:"There was an error publishing the metadata.</br>Error:"+PTS.app.getError()}).show()},callback:function(b,c){a.enable()}})}}),Ext.define("PTS.controller.project.window.ProjectAgreements",{extend:"Ext.app.Controller",views:["project.window.ProjectAgreements"],models:["Modification"],refs:[{ref:"agreementsTab",selector:"projectagreements"},{ref:"agreementsTree",selector:"agreementstree"},{ref:"itemDetail",selector:"agreementitemdetail"}],init:function(){var a=this.getController("project.window.AgreementsTree"),b=this.getController("project.window.ItemDetail");a.init(),b.init(),this.control({projectagreements:{beforerender:this.onBeforeRender},agreementstree:{select:this.onSelectItem},agreementitemdetail:{beforerender:this.onBeforeRenderItemDetail},"agreementitemdetail #mainItemToolbar":{beforerender:this.onRenderItemToolbar}})},newItemBtn:Ext.create("Ext.Action",{itemId:"newItemBtn",text:"New",iconCls:"pts-menu-addbasic",hidden:!0,handler:function(){Ext.Msg.alert("Click",'You clicked on "New".')},listeners:{show:function(){var a=this.ownerCt.child("#rootBtn");a&&a.hide()}}}),editItemBtn:Ext.create("Ext.Action",{itemId:"editItemBtn",text:"Edit",iconCls:"pts-menu-editbasic",disabled:!0,handler:function(a,b){var c=Ext.ComponentQuery.query("projectagreements #itemDetail")[0],d=c.getLayout().getActiveItem().child("#itemForm");c.setIconCls("pts-panel-unlocked"),Ext.each(d.query("field"),function(){this.doNotEnable?this.getEl().setOpacity(.5):this.setReadOnly(!1)}),Ext.each(Ext.ComponentQuery.query("#editItemBtn"),function(){this.disable()})}}),deleteItemBtn:Ext.create("Ext.Action",{itemId:"deleteItemBtn",text:"Delete",iconCls:"pts-menu-deletebasic",disabled:!0,handler:function(){var a=Ext.ComponentQuery.query("projectagreements")[0],b=a.down("#itemDetail"),c=b.getLayout().getActiveItem(),d=c.child("#itemForm").getForm(),e=function(c){if("yes"===c){var e=d.getRecord(),f=a.down("agreementstree"),g=f.getSelectionModel().getSelection()[0];a.getEl().mask("Deleting..."),e.destroy({success:function(b,c){var d=g.get("parentItm");PTS.app.fireEvent("savedeliverable",c.records[0],c),f.getView().select(g.parentNode),g.remove(!0),d&&!f.getRootNode().findChild("parentItm",d,!0)&&f.getStore().getNodeById(d).set("readonly",!1),a.getEl().unmask()},failure:function(c,d){Ext.MessageBox.show({title:"Error",msg:"There was a problem deleting the record.</br>"+PTS.app.getError(),buttons:Ext.MessageBox.OK,animateTarget:b.down("#deleteItemBtn").getEl(),fn:function(){a.getEl().unmask()},icon:Ext.Msg.ERROR})}})}};!0===c.ptsConfirmDelete?Ext.MessageBox.show({title:"Confirm Deletion",msg:"Are you sure you want to delete this <b>"+c.title+"</b>?",buttons:Ext.MessageBox.YESNO,icon:Ext.Msg.WARNING,fn:e,animateTarget:b.down("#deleteItemBtn").getEl()}):e("yes")}}),resetItemBtn:Ext.create("Ext.Action",{itemId:"resetItemBtn",text:"Reset",iconCls:"pts-menu-reset",disabled:!0,handler:function(a){a.up("panel").getLayout().getActiveItem().child("#itemForm").getForm().reset()}}),saveItemBtn:Ext.create("Ext.Action",{itemId:"saveItemBtn",text:"Save",iconCls:"pts-menu-savebasic",disabled:!0,handler:function(){var a=Ext.ComponentQuery.query("projectagreements")[0],b=a.down("#itemDetail"),c=b.getLayout().getActiveItem(),d=c.child("#itemForm").getForm(),e=d.getRecord(),f=a.down("agreementstree"),g=f.getSelectionModel().getSelection()[0],h=e.phantom;a.getEl().mask("Saving..."),d.updateRecord(e),e.save({success:function(e,i){var j,k,l,m,n,o=e.get("title"),p=c.itemId;"PTS.model.Deliverable"===Ext.getClassName(e)&&PTS.app.fireEvent("savedeliverable",e,i),"PTS.model.Modification"===Ext.getClassName(e)&&PTS.app.fireEvent("savemodification",e,i,h),d.loadRecord(e),j={text:o,cls:e.get("invalid")?"pts-deliverable-invalid":null,leaf:!0,draggable:!1,dataid:e.getId()},h?(j.parentcode=e.get("parentcode"),"itemCard-20"!==p&&"itemCard-60"!==p||(l=[{children:[],text:"Deliverables",id:"df-"+e.getId(),iconCls:"task-folder",leaf:!1,draggable:!1,typeid:30,fkey:{modificationid:e.getId()},defIcon:"pts-page-blue"},{children:[],text:"Funds",id:"ff-"+e.getId(),iconCls:"task-folder",leaf:!1,draggable:!1,typeid:50,fkey:{modificationid:e.getId()},defIcon:"pts-money-dollar"},{children:[],text:"Tasks",id:"tf-"+e.getId(),iconCls:"task-folder",leaf:!1,draggable:!1,typeid:40,fkey:{modificationid:e.getId()},defIcon:"pts-page-orange"}],e.get("parentmodificationid")||(m={children:[],text:"Modifications",parentcode:e.get("modificationcode"),id:"mf-"+e.getId(),iconCls:"task-folder",leaf:!1,draggable:!1,typeid:60,fkey:{projectid:e.get("projectid"),modtypeid:e.get("modtypeid"),parentmodificationid:e.getId()}},l.push(m)),j.children=l,j.leaf=!1),g||("itemCard-10"===p?g=a.down("agreementstree").getStore().getNodeById("prt-0"):"itemCard-20"===p?g=a.down("agreementstree").getStore().getNodeById("art-0"):Ext.Error.raise("TreeRecord Not Set")),g.get("dataid")?(n=g.parentNode,j.iconCls=n.get("defIcon"),k=n.appendChild(j)):(j.iconCls=g.get("defIcon"),k=g.appendChild(j)),f.getView().select(k),f.expandPath(k.getPath())):(n=g.findChild("text","Modifications"))&&n.set("parentcode",e.get("modificationcode")),b.setTitle(o),a.getEl().unmask()},failure:function(b,c){var d,e=a.down("agreementstree"),f=e.getSelectionModel().getSelection()[0];d=f?"There was an error saving "+f.get("text"):"There was an error saving the record",Ext.create("widget.uxNotification",{title:"Error",iconCls:"ux-notification-icon-error",html:d+".</br>Error:"+PTS.app.getError()}).show(),a.getEl().unmask()},scope:a})}}),getContextMenu:function(){return Ext.create("Ext.menu.Menu",{margin:"0 0 10 0",items:[this.newItemBtn,this.editItemBtn,this.deleteItemBtn]})},getNewItemBtnHandler:function(a,b,c){var d=this,e=d.getItemDetail(),f=e.up("projectwindow").projectId;return function(){
var g,h=e.down("#itemCard-"+a+" #itemForm"),i=Ext.create(h.model);e.getLayout().setActiveItem("itemCard-"+a),g=c?c.get("fkey")?c.get("fkey"):c.parentNode.get("fkey"):{projectid:f},i.beginEdit(),i.set(g),i.endEdit(!0),h.loadRecord(i).reset(),d.application.fireEvent("newitem",i,h),Ext.each(h.query("field"),function(){this.setReadOnly(!1)}),e.setTitle(b),e.setIconCls("pts-menu-addbasic"),Ext.each(e.query("#editItemBtn, #deleteItemBtn"),function(){this.disable()}),e.enable()}},getBtnConfig:function(a){var b;switch(a){case 0:return!1;case 10:b="New Proposal";break;case 20:b="New Agreement";break;case 30:b="New Deliverable";break;case 40:b="New Task";break;case 50:b="New Funding";break;case 60:b="New Modification";break;default:return!1}return{iconCls:"pts-menu-addbasic",text:b}},updateNewItemBtn:function(a,b){var c=this.newItemBtn,d=this.getBtnConfig(a).text,e=this.getNewItemBtnHandler(a,d,b);c.setText(d),c.setHandler(e),c.enable(),c.show()},onBeforeRender:function(a){var b=this.getBtnConfig(20),c=this.getBtnConfig(10);b.handler=this.getNewItemBtnHandler(20,b.text),c.handler=this.getNewItemBtnHandler(10,c.text),a.addDocked([{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"rootBtn",text:"New",iconCls:"pts-menu-add",menu:{xtype:"menu",items:[b,c]},listeners:{afterrender:function(){this.ownerCt.child("#newItemBtn").hide()},show:function(){this.ownerCt.child("#newItemBtn").hide()}}},this.newItemBtn]}])},onBeforeRenderItemDetail:function(a){var b=this;a.items.each(function(a){var c=a.down("#itemForm");c&&c.on({dirtychange:{fn:function(a,b){b?(this.resetItemBtn.enable(),a.isValid()&&this.saveItemBtn.enable()):(this.resetItemBtn.disable(),this.saveItemBtn.disable())},scope:b},validitychange:{fn:function(a,b){b&&a.isDirty()?this.saveItemBtn.enable():this.saveItemBtn.disable()},scope:b}})},b)},onRenderItemToolbar:function(a){a.add([this.editItemBtn,this.deleteItemBtn,this.saveItemBtn,this.resetItemBtn])},onSelectItem:function(a,b,c,d){var e,f,g=this,h=b.get("typeid"),i=b.get("dataid"),j=b.get("parentItm"),k=!!b.get("readonly"),l=this.getAgreementsTab(),m=this.getItemDetail(),n=[this.editItemBtn,this.deleteItemBtn],o=this.saveItemBtn,p=this.resetItemBtn,q=this.getAgreementsTree().getView();!h&&i?(h=b.parentNode.get("typeid"),f=m.down("#itemCard-"+h),e=f.down("#itemForm"),m.getEl().mask("Loading..."),Ext.each(e.query("field"),function(){var a=this;a.isXType("combobox")&&a.getStore().clearFilter()}),Ext.ModelMgr.getModel(e.model).load(i,{success:function(a){if(e.loadRecord(a),g.application.fireEvent("itemload",a,e),Ext.each(e.query("field"),function(){this.setReadOnly(!0)}),m.setIconCls("pts-panel-locked"),Ext.each(n,function(){this.setDisabled(k)}),m.getLayout().setActiveItem(f),e.isXType("form")&&(e.getForm().isDirty()?(p.enable(),e.getForm().isValid()&&o.enable()):(p.disable(),o.disable())),j){var c=q.getStore().getById(j);q.addRowCls(c,"pts-deliverable-highlight"),q.getSelectionModel().on("selectionchange",function(a,b){this.removeRowCls(c,"pts-deliverable-highlight")},q,{single:!0})}m.setTitle(b.get("text")),m.getEl().unmask(),m.enable()},failure:function(a,b){Ext.MessageBox.show({title:"Error",msg:"There was an error loading the record.</br>Error:"+PTS.app.getError(),buttons:Ext.MessageBox.OK,icon:Ext.Msg.ERROR}),m.getEl().unmask()}})):(Ext.each(n,function(){this.disable()}),m.getLayout().setActiveItem(0),m.setTitle(b.get("text")),m.setIconCls("x-tree-icon-parent")),this.updateNewItemBtn(h,b),l.down("#rootBtn").hide()}}),Ext.define("PTS.model.KeywordNode",{extend:"PTS.model.Base",fields:[{name:"keywordid",type:"string"},{name:"text",type:"mystring",useNull:!0},{name:"definition",type:"mystring",useNull:!0},{name:"fullname",type:"mystring",useNull:!0}],idProperty:"keywordid",proxy:{type:"rest",url:PTS.baseURL+"/keyword/tree",reader:{type:"json"},appendId:!0}}),Ext.define("PTS.model.ProjectKeyword",{extend:"PTS.model.Base",fields:[{name:"projectkeywordid",type:"integer",useNull:!0,persist:!1},{name:"keywordid",type:"mystring",useNull:!0},{name:"projectid",type:"integer",useNull:!0},{name:"text",type:"mystring",useNull:!0,persist:!1},{name:"definition",type:"mystring",useNull:!0,persist:!1}],idProperty:"projectkeywordid",proxy:{type:"rest",url:PTS.baseURL+"/project/keyword",reader:{type:"json"},appendId:!0}}),Ext.define("PTS.store.KeywordNodes",{extend:"Ext.data.TreeStore",model:"PTS.model.KeywordNode",clearOnLoad:!0,autoLoad:!0}),Ext.define("PTS.store.ProjectKeywords",{extend:"Ext.data.Store",model:"PTS.model.ProjectKeyword",clearOnLoad:!0,autoLoad:!1,sorters:{property:"text",direction:"ASC"}}),Ext.define("PTS.store.Keywords",{extend:"Ext.data.Store",model:"PTS.model.KeywordNode",autoLoad:!0,remoteSort:!0,remoteFilter:!0,pageSize:PTS.Defaults.pageSize+5,sorters:{property:"text",direction:"ASC"},proxy:{type:"rest",url:PTS.baseURL+"/keywordlist",reader:{type:"json",root:"data"}}}),Ext.define("PTS.controller.project.window.ProjectKeywords",{extend:"Ext.app.Controller",views:["project.window.ProjectKeywords"],models:["KeywordNode","ProjectKeyword"],stores:["KeywordNodes","ProjectKeywords","Keywords"],refs:[{ref:"projectWindow",selector:"projectwindow"},{ref:"keywordTree",selector:"projectwindow projectkeywords #keywordTree"},{ref:"keywordSearch",selector:"projectwindow projectkeywords #keywordSearch"},{ref:"projectKeywords",selector:"projectwindow #projectKeywords"}],init:function(){this.control({"projectwindow projectkeywords #keywordTree":{render:this.onRemoveTargetRender},"projectwindow projectkeywords #keywordSearch":{render:this.onRemoveTargetRender},"projectwindow #projectKeywords gridview":{itemadd:this.onItemAdd,beforedrop:this.onBeforeDrop},"projectwindow projectkeywords button[action=removekeywords]":{render:this.onRemoveTargetRender,click:this.removeKeywords},"projectwindow projectkeywords button[action=savekeywords]":{click:this.saveKeywords},"projectwindow projectkeywords button[action=refreshkeywords]":{click:this.refreshKeywords},"projectwindow projectkeywords templatecolumn[action=addkeyword]":{click:this.onActionAddClick}}),this.application.on({openproject:this.onOpenProject,saveproject:this.onSaveProject,scope:this})},setProxy:function(a,b){var c=PTS.baseURL+"/project/"+a+"/projectkeywordlist";b.getProxy().api.read!==c&&b.setProxy({type:"rest",url:PTS.baseURL+"/projectkeyword",appendId:!0,api:{read:c},reader:{type:"json",root:"data"},limitParam:void 0})},onOpenProject:function(a){var b=this.getProjectKeywordsStore();a&&(this.setProxy(a,b),b.load())},onSaveProject:function(a){var b=this.getProjectKeywordsStore();a&&(this.setProxy(a.getId(),b),b.load())},onBeforeDrop:function(a,b,c,d){var e,f,g=this.getProjectKeywordsStore(),h=b.records,i=h.length,j="",k=g.getRemovedRecords(),l="before"===d?g.indexOf(c):g.indexOf(c)+1,m=[];for(e=0;e<i;e++)f=h[e],-1!==g.findExact("keywordid",f.getId())?j+="<br /> "+f.get("text"):k.length>0&&Ext.Array.some(k,function(a){if(a.get("keywordid")===f.get("keywordid"))return f=a,!0})?(f.reject(),f.restored=!0,m.push(f),Ext.Array.remove(g.removed,f)):m.push(this.getProjectKeywordModel().create({projectid:f.get("projectid"),keywordid:f.get("keywordid"),text:f.get("text")}));return m.length&&g.insert(l,m),""!==j&&Ext.create("widget.uxNotification",{title:"Notice",iconCls:"ux-notification-icon-information",html:"The following keywords have already been added:<br />"+j}).show(),!1},onItemAdd:function(a,b,c){var d=this.getProjectWindow().projectId;Ext.each(a,function(a){a.restored||(a.set("projectid",d),a.setDirty(),a.phantom=!0)})},removeKeywordsByDrag:function(a,b,c,d,e){return this.getProjectKeywordsStore().remove(b.records),!1},onRemoveTargetRender:function(a){var b=this.getProjectKeywordsStore();Ext.create("Ext.dd.DropTarget",a.getEl(),{ddGroup:"deletekeywords",notifyDrop:function(a,c,d){return b.remove(d.records),!0}})},saveKeywords:function(){var a=this.getProjectKeywordsStore(),b=this.getProjectKeywords().getEl();!!(a.getRemovedRecords().length+a.getUpdatedRecords().length+a.getNewRecords().length)&&b.mask("Saving..."),a.getBatchListeners=function(){var c=a,d={scope:c,exception:function(a,c){b.unmask(),PTS.app.setError("There was an error saving the keywords.</br>Error:"+PTS.app.getError())}};return"operation"===c.batchUpdateMode?d.operationcomplete=c.onBatchOperationComplete:d.complete=c.onBatchComplete,d},a.sync({success:function(){b.unmask()},failure:function(){b.unmask(),Ext.create("widget.uxNotification",{title:"Error",iconCls:"ux-notification-icon-error",html:"There was an error saving the keywords.</br>Error:"+PTS.app.getError()}).show()},callback:function(){}})},removeKeywords:function(){var a=this.getProjectKeywords(),b=a.getSelectionModel().getSelection();a.getStore().remove(b)},refreshKeywords:function(){var a=this.getProjectKeywords();a.getStore().load({callback:function(b,c,d){a.getStore().removed=[]}})},onActionAddClick:function(a,b,c,d){var e=a.getStore().getAt(c),f={records:[e]},g=this.getProjectKeywordsStore().last();this.onBeforeDrop(void 0,f,g)}}),Ext.define("PTS.view.controls.ManagerCombo",{extend:"Ext.form.field.ComboBox",alias:"widget.managercombo",name:"personid",fieldLabel:"Manager",store:"GroupUsers",displayField:"fullname",valueField:"contactid",forceSelection:!0,allowBlank:!1,queryMode:"local",listConfig:{getInnerTpl:function(){return'<span <tpl if="inactive">style="color:gray;"</tpl>>{fullname}</span>'}},listeners:{beforeselect:{fn:function(a,b){if(b.get("inactive"))return!1}}},initComponent:function(){this.callParent(arguments)}}),Ext.define("PTS.model.Status",{extend:"PTS.model.Base",fields:[{name:"statusid",type:"int"},{name:"modtypeid",type:"int"},{name:"code",type:"mystring",useNull:!0},{name:"status",type:"mystring",useNull:!0},{name:"description",type:"mystring",useNull:!0},{name:"weight",type:"int"}],proxy:{type:"rest",url:PTS.baseURL+"/statuslist",reader:{type:"json",root:"data"},limitParam:void 0}}),Ext.define("PTS.view.controls.CurrencyField",{extend:"Ext.form.field.Number",alias:"widget.currencyfield",hideTrigger:!0,setValue:function(a){this.callParent(arguments),Ext.isEmpty(this.getValue())||this.setRawValue(Ext.util.Format.currency(this.getValue()))},removeFormat:function(a){if(Ext.isEmpty(a))return"";var b=new RegExp(Ext.util.Format.thousandSeparator,"gi");return a=a.toString().replace(Ext.util.Format.currencySign,"").replace(b,""),a%1==0?Ext.util.Format.number(a,"0"):Ext.util.Format.number(a,"0.00")},parseValue:function(a){return this.callParent([this.removeFormat(a)])},getErrors:function(a){return this.callParent([this.removeFormat(a)])},getSubmitData:function(){var a={};return a[this.name]=this.removeFormat(this.callParent(arguments)[this.name]),a},preFocus:function(){this.setRawValue(this.removeFormat(this.getRawValue())),this.callParent(arguments)}}),Ext.define("PTS.store.AgreementsTree",{extend:"Ext.data.TreeStore",model:"PTS.model.AgreementsTree",clearOnLoad:!1,folderSort:!0,autoLoad:!1,root:{children:[]}}),Ext.define("PTS.store.Statuses",{extend:"Ext.data.Store",model:"PTS.model.Status",autoLoad:!0}),Ext.define("PTS.view.controls.StatusCombo",{extend:"PTS.view.controls.FilterCombo",alias:"widget.statuscombo",requires:["PTS.store.Statuses","Ext.form.field.ComboBox"],displayField:"code",store:"Statuses",valueField:"statusid",forceSelection:!0,typeAhead:!1,queryMode:"local",lastQuery:"",listConfig:{getInnerTpl:function(){return'<div data-qtip="{description}">{code}</div>'}},initComponent:function(){this.callParent(arguments)}}),Ext.define("PTS.view.project.form.ProposalForm",{extend:"Ext.panel.Panel",alias:"widget.proposalform",requires:["PTS.view.controls.ManagerCombo","PTS.view.controls.StatusCombo","PTS.view.controls.CommentEditGrid","Ext.ux.form.ItemSelector"],itemId:"itemCard-10",ptsConfirmDelete:!0,title:"Proposal",layout:"border",defaults:{trackResetOnLoad:!0,autoScroll:!0,preventHeader:!0},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"form",itemId:"itemForm",model:"PTS.model.Modification",layout:"anchor",region:"center",bodyPadding:10,defaults:{anchor:"100%"},items:[{xtype:"datefield",name:"datecreated",fieldLabel:"Received",allowBlank:!1},{xtype:"combobox",name:"personid",fieldLabel:"Manager",store:"GroupUsers",displayField:"fullname",valueField:"contactid",forceSelection:!0,allowBlank:!1,queryMode:"local"},{xtype:"combobox",name:"modtypeid",fieldLabel:"Type",store:"ProposalTypes",displayField:"type",valueField:"modtypeid",forceSelection:!0,allowBlank:!1,queryMode:"local",listConfig:{getInnerTpl:function(){return'<div data-qtip="{description}">{type}</div>'}}},{xtype:"textfield",name:"modificationcode",fieldLabel:"Proposal #"},{xtype:"textfield",name:"title",fieldLabel:"Title",emptyText:"Title",maxLength:250,enforceMaxLength:!0,allowBlank:!1},{xtype:"textfield",name:"shorttitle",fieldLabel:"Short Title",emptyText:"Short Title",maxLength:60,enforceMaxLength:!0,allowBlank:!1},{xtype:"textareafield",name:"description",fieldLabel:"Description",allowBlank:!1,grow:!0}]},{xtype:"tabpanel",disabled:!0,itemId:"relatedDetails",title:"Details",region:"south",collapsible:!0,animCollapse:!Ext.isIE8,split:!0,activeTab:0,flex:1,defaults:{bodyStyle:"padding:10px"},items:[{xtype:"roweditgrid",store:"ModStatuses",uri:"modstatus",title:"Status",columns:[{xtype:"gridcolumn",dataIndex:"statusid",renderer:function(a,b,c,d,e,f,g){var h=g.getHeaderAtIndex(e).getEditor(),i=h.getStore().find(h.valueField,a,0,!1,!0,!0),j=h.getStore().getAt(i);return j?j.get(h.displayField):a},editor:{xtype:"statuscombo"},text:"Status"},{xtype:"datecolumn",dataIndex:"effectivedate",editor:{xtype:"datefield"},text:"Effective Date"},{xtype:"gridcolumn",dataIndex:"comment",editor:{xtype:"textfield"},flex:2,text:"Comment"}]},{title:"Contacts",xtype:"form",itemId:"contactsForm",trackResetOnLoad:!0,disabled:!1,layout:"fit",bodyPadding:10,border:0,dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",iconCls:"pts-menu-savebasic",text:"Save",action:"save",disabled:!1},{xtype:"button",iconCls:"pts-menu-reset",text:"Reset",action:"reset"}]}],items:[{xtype:"itemselector",name:"modificationcontact",height:"100%",innerAlign:"stretch",delimiter:null,store:"ProjectContacts",displayField:"namerole",valueField:"projectcontactid",msgTarget:"side"}]},{title:"Comments",disabled:!1,xtype:"commenteditgrid",store:"ModificationComments",uri:"modcomment"}]}]}),a.callParent(arguments)}}),Ext.define("PTS.view.project.form.AgreementForm",{extend:"Ext.panel.Panel",alias:"widget.agreementform",requires:["PTS.view.controls.ManagerCombo","PTS.view.controls.StatusCombo","PTS.view.controls.RowEditGrid","Ext.form.field.VTypes","PTS.view.controls.CommentEditGrid","Ext.ux.form.ItemSelector"],itemId:"itemCard-20",ptsConfirmDelete:!0,title:"Agreement",layout:"border",defaults:{trackResetOnLoad:!0,autoScroll:!0,preventHeader:!0},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"form",itemId:"itemForm",model:"PTS.model.Modification",layout:"anchor",region:"center",bodyPadding:10,items:[{xtype:"fieldcontainer",layout:{align:"stretchmax",type:"hbox"},margin:"0 0 10 0",combineErrors:!1,fieldLabel:"Period",items:[{xtype:"daterangefield",itemId:"startDate",margin:"0 20 0 0",name:"startdate",fieldLabel:"Start",vfield:"beginDate",endDateField:"endDate",vtype:"daterange",labelWidth:45,width:150},{xtype:"datefield",itemId:"endDate",name:"enddate",fieldLabel:"End",startDateField:"startDate",vfield:"endDate",vtype:"daterange",labelWidth:40,width:150}]},{xtype:"fieldcontainer",itemId:"modcodeCon",hidden:!0,layout:{align:"stretchmax",type:"hbox"},combineErrors:!0,fieldLabel:"Agreement #",items:[{xtype:"displayfield",padding:"0 35 0 0",name:"parentcode",hideLabel:!0,width:85,valueToRaw:function(a){return Ext.String.ellipsis(a,14)}},{xtype:"displayfield",name:"codedelimiter",margin:"0 2",width:5,value:"/",hideLabel:!0},{xtype:"textfield",name:"modcode",width:150,submitValue:!1,hideLabel:!0,validator:function(a){return!0!==this.isVisible(!0)||a.length>0||"You must enter a number for Modifications."}}]},{xtype:"textfield",name:"modificationcode",fieldLabel:"Agreement #",anchor:"100%"},{xtype:"textfield",name:"title",fieldLabel:"Title",allowBlank:!1,anchor:"100%"},{xtype:"managercombo",allowBlank:!1},{xtype:"combobox",name:"modtypeid",fieldLabel:"Type",store:"AgreementTypes",displayField:"type",valueField:"modtypeid",forceSelection:!0,allowBlank:!1,queryMode:"local",listConfig:{getInnerTpl:function(){return'<div data-qtip="{description}">{type}</div>'}},anchor:"50%"},{xtype:"textareafield",name:"description",fieldLabel:"Description",grow:!0,allowBlank:!1,anchor:"100%"}]},{xtype:"tabpanel",disabled:!0,itemId:"relatedDetails",title:"Details",region:"south",collapsible:!0,animCollapse:!Ext.isIE8,split:!0,activeTab:0,flex:1,defaults:{bodyStyle:"padding:10px"},items:[{xtype:"roweditgrid",store:"ModStatuses",itemId:"statusGrid",uri:"modstatus",title:"Status",columns:[{xtype:"gridcolumn",dataIndex:"statusid",renderer:function(a,b,c,d,e,f,g){var h=g.getHeaderAtIndex(e).getEditor(),i=h.getStore().find(h.valueField,a,0,!1,!0,!0),j=h.getStore().getAt(i);return j?j.get(h.displayField):a},editor:{xtype:"statuscombo",allowBlank:!1},text:"Status"},{xtype:"datecolumn",dataIndex:"effectivedate",editor:{xtype:"datefield",allowBlank:!1},text:"Effective Date"},{xtype:"gridcolumn",dataIndex:"comment",editor:{xtype:"textfield"},flex:2,text:"Comment"}]},{xtype:"roweditgrid",store:"PurchaseRequests",uri:"purchaserequest",title:"PPR Reference #",columns:[{header:"Reference #",dataIndex:"purchaserequest",sortable:!0,hideable:!1,flex:1,editor:{xtype:"textfield",allowBlank:!1}},{header:"Comment",dataIndex:"comment",flex:2,editor:{xtype:"textfield"}}]},{title:"Contacts",xtype:"form",itemId:"contactsForm",trackResetOnLoad:!0,disabled:!1,layout:"fit",bodyPadding:10,border:0,dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",iconCls:"pts-menu-savebasic",text:"Save",action:"save",disabled:!1},{xtype:"button",iconCls:"pts-menu-reset",text:"Reset",action:"reset"}]}],items:[{xtype:"itemselector",name:"modificationcontact",height:"100%",innerAlign:"stretch",delimiter:null,store:"ProjectContacts",displayField:"namerole",valueField:"projectcontactid",msgTarget:"side"}]},{title:"Comments",disabled:!1,xtype:"commenteditgrid",store:"ModificationComments",uri:"modcomment"}]}]}),a.callParent(arguments)}}),Ext.define("PTS.view.project.form.DeliverableForm",{extend:"Ext.panel.Panel",alias:"widget.deliverableform",requires:["PTS.view.controls.ManagerCombo","PTS.view.controls.StatusCombo","PTS.view.controls.RowEditGrid","PTS.view.controls.CommentEditGrid","Ext.form.CheckboxGroup","PTS.view.controls.TextareaTriggerField"],itemId:"itemCard-30",title:"Deliverable",layout:"border",defaults:{trackResetOnLoad:!0,autoScroll:!0,preventHeader:!0},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"form",itemId:"itemForm",model:"PTS.model.Deliverable",layout:"anchor",region:"center",bodyPadding:10,items:[{xtype:"container",itemId:"mainCon",layout:{type:"anchor"},anchor:"100%",defaults:{allowBlank:!1},items:[{xtype:"fieldcontainer",fieldLabel:"Title",layout:{align:"stretchmax",type:"hbox"},combineErrors:!0,items:[{xtype:"textfield",name:"code",emptyText:"Code",hideLabel:!0,width:40},{xtype:"displayfield",name:"codedelimiter",margin:"0 2",width:5,value:"/",hideLabel:!0},{xtype:"textfield",name:"title",fieldLabel:"Title",hideLabel:!0,flex:1}]},{xtype:"textareafield",name:"description",fieldLabel:"Description",grow:!0,anchor:"100%"},{xtype:"combobox",name:"deliverabletypeid",fieldLabel:"Type",anchor:"100%",store:"DeliverableTypes",displayField:"type",valueField:"deliverabletypeid",forceSelection:!0,queryMode:"local",listConfig:{getInnerTpl:function(){return'<div data-qtip="{description}">{type}</div>'}}}]},{xtype:"fieldcontainer",itemId:"delPeriod",hidden:!0,defaults:{width:155,labelWidth:35},layout:{align:"stretchmax",type:"hbox"},fieldLabel:"Period",items:[{xtype:"daterangefield",itemId:"startDate",name:"startdate",fieldLabel:"Start",margin:"0 20 0 0",vfield:"beginDate",endDateField:"endDate",vtype:"daterange"},{xtype:"daterangefield",itemId:"endDate",name:"enddate",vfield:"endDate",startDateField:"startDate",vtype:"daterange",fieldLabel:"End"}]},{xtype:"managercombo"},{xtype:"datefield",name:"duedate",fieldLabel:"Date Due",allowBlank:!1},{xtype:"fieldcontainer",fieldLabel:"Reminder",layout:"column",anchor:"100%",items:[{xtype:"checkboxfield",name:"reminder",boxLabel:"Auto?",width:100},{xtype:"checkboxfield",name:"staffonly",boxLabel:"Staff Only?"}]},{xtype:"fieldcontainer",fieldLabel:"Publication",layout:"column",anchor:"100%",items:[{xtype:"checkboxfield",name:"publish",boxLabel:"Publishable",width:100},{xtype:"checkboxfield",name:"restricted",boxLabel:"Restricted",listeners:{change:function(a,b,c){a.up("form").down("field[name=accessdescription]").validate()}}}]},{xtype:"textareafield",name:"accessdescription",fieldLabel:"Access Description",grow:!0,anchor:"100%",validator:function(a){var b=this.up("form").down("checkboxfield[name=restricted]");return!b.getValue()||b.getValue()===!!a||"Access Description is required when publication is restricted"}}]},{xtype:"tabpanel",itemId:"relatedDetails",title:"Details",region:"south",collapsible:!0,animCollapse:!Ext.isIE8,split:!0,flex:1,defaults:{bodyStyle:"padding:10px",disabled:!0},items:[{xtype:"roweditgrid",store:"DeliverableModStatuses",uri:"deliverablemodstatus",itemId:"statusGrid",title:"Status",disabled:!1,columns:[{xtype:"gridcolumn",dataIndex:"deliverablestatusid",renderer:function(a,b,c,d,e,f,g){var h=g.getHeaderAtIndex(e).getEditor(),i=h.getStore().find(h.valueField,a,0,!1,!0,!0),j=h.getStore().getAt(i);return j?j.get(h.displayField):a},editor:{xtype:"statuscombo",store:"DeliverableStatuses",valueField:"deliverablestatusid",allowBlank:!1},text:"Status"},{xtype:"datecolumn",dataIndex:"effectivedate",editor:{xtype:"datefield",allowBlank:!1,maxValue:new Date},text:"Effective Date"},{xtype:"gridcolumn",dataIndex:"contactid",hidden:!1,renderer:function(a){var b=Ext.getStore("GroupUsers"),c=b.find("contactid",a,0,!1,!0,!0),d=b.getAt(c);return d?d.get("fullname"):a},text:"User"},{xtype:"gridcolumn",dataIndex:"comment",editor:{xtype:"areatrigger",text:"Comment"},flex:1,text:"Comment"}]},{xtype:"roweditgrid",store:"DeliverableNotices",uri:"deliverablenotice",title:"Notices",disabled:!1,extraButtons:[{text:"Send Notice",itemId:"sendNotice",iconCls:"pts-menu-emailgo"}],columns:[{xtype:"gridcolumn",dataIndex:"noticeid",renderer:function(a,b,c,d,e,f,g){var h=g.getHeaderAtIndex(e).getEditor(),i=h.getStore().find(h.valueField,a,0,!1,!0,!0),j=h.getStore().getAt(i);return j?j.get(h.displayField):a},editor:{xtype:"statuscombo",store:"Notices",valueField:"noticeid",allowBlank:!1},text:"Notice"},{xtype:"gridcolumn",dataIndex:"recipientid",renderer:function(a,b,c,d,e,f,g){var h=g.getHeaderAtIndex(e).getEditor(),i=h.getStore().find(h.valueField,a,0,!1,!0,!0),j=h.getStore().getAt(i);return j?j.get(h.displayField):a===PTS.user.get("groupid")?"Staff":a},editor:{xtype:"filtercombo",store:"NoticeRecipients",displayField:"name",valueField:"contactid",allowBlank:!1,forceSelection:!0,typeAhead:!1,queryMode:"local",lastQuery:""},text:"Recipient"},{xtype:"datecolumn",dataIndex:"datesent",editor:{xtype:"datefield",allowBlank:!1,maxValue:new Date},text:"Date Sent"},{xtype:"gridcolumn",dataIndex:"contactid",hidden:!1,renderer:function(a){var b=Ext.getStore("GroupUsers"),c=b.find("contactid",a,0,!1,!0,!0),d=b.getAt(c);return d?d.get("fullname"):a},text:"User"},{xtype:"gridcolumn",dataIndex:"comment",editor:{xtype:"textfield"},flex:1,text:"Comment"}]},{title:"Comments",disabled:!1,xtype:"commenteditgrid",store:"DeliverableComments",uri:"deliverablecomment"}]}]}),a.callParent(arguments)}}),Ext.define("PTS.view.project.form.TaskForm",{extend:"PTS.view.project.form.DeliverableForm",alias:"widget.taskform",requires:["Ext.form.RadioGroup"],itemId:"itemCard-40",title:"Task",initComponent:function(){this.callParent(arguments),this.down("#relatedDetails>roweditgrid#statusGrid gridcolumn[dataIndex=deliverablestatusid]").getEditor().bindStore("TaskStatuses")}}),Ext.define("PTS.view.project.form.FundingForm",{extend:"Ext.panel.Panel",alias:"widget.fundingform",requires:["PTS.view.controls.CurrencyField","PTS.view.controls.CommentEditGrid"],itemId:"itemCard-50",title:"Funding",layout:"border",defaults:{trackResetOnLoad:!0,autoScroll:!1,preventHeader:!0},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"form",itemId:"itemForm",model:"PTS.model.Funding",title:"Funding",layout:"anchor",region:"north",height:200,collapsible:!0,animCollapse:!Ext.isIE8,split:!0,bodyPadding:10,autoScroll:!0,items:[{xtype:"textfield",name:"title",fieldLabel:"Title",anchor:"100%",allowBlank:!1},{xtype:"combobox",name:"projectcontactid",fieldLabel:"Funding Source",anchor:"100%",store:"ProjectFunders",displayField:"name",valueField:"projectcontactid",forceSelection:!0,allowBlank:!1,queryMode:"local"},{xtype:"combobox",name:"fundingtypeid",fieldLabel:"Type",anchor:"100%",store:"FundingTypes",displayField:"type",valueField:"fundingtypeid",forceSelection:!0,allowBlank:!1,queryMode:"local",listConfig:{getInnerTpl:function(){return'<div data-qtip="{description}">{type}</div>'}}},{xtype:"currencyfield",name:"amount",fieldLabel:"Amount",allowBlank:!1,minValue:.01},{xtype:"combobox",name:"fundingrecipientid",itemId:"recipientCombo",fieldLabel:"Funding Recipient",anchor:"100%",store:"ProjectRecipients",displayField:"name",valueField:"projectcontactid",forceSelection:!0,allowBlank:!1,queryMode:"local"}]},{xtype:"tabpanel",itemId:"relatedDetails",title:"Details",region:"center",activeTab:0,items:[{xtype:"roweditgrid",store:"CostCodes",uri:"costcode",title:"Cost Codes",columns:[{xtype:"gridcolumn",dataIndex:"costcode",width:250,renderer:function(a,b,c,d,e,f,g){var h=g.getHeaderAtIndex(e).getEditor(),i=h.getStore().find(h.valueField,a,0,!1,!0,!0),j=h.getStore().getAt(i);return j?j.get(h.displayField):a},editor:{xtype:"combobox",store:"ContactCostCodes",queryMode:"local",displayField:"costcode",valueField:"costcode",typeAhead:!1,allowBlank:!1,blankText:"A Cost Code is required."},text:"Cost Code"},{xtype:"datecolumn",dataIndex:"startdate",editor:{xtype:"datefield",allowBlank:!1,blankText:"The Start Date is required."},text:"Start Date"},{xtype:"datecolumn",dataIndex:"enddate",editor:{xtype:"datefield",allowBlank:!1,blankText:"The End Date is required."},text:"End Date"}]},{xtype:"invoicegridform",title:"Invoices"},{title:"Comments",disabled:!1,xtype:"commenteditgrid",store:"FundingComments",uri:"fundingcomment"}]}]}),a.callParent(arguments)}}),Ext.define("PTS.view.project.form.ModificationForm",{extend:"PTS.view.project.form.AgreementForm",alias:"widget.modificationform",itemId:"itemCard-60",title:"Modification",initComponent:function(){var a,b=this;b.callParent(arguments),a=b.down("#itemForm"),a.getForm().findField("modtypeid").disable(!0),a.down("#modcodeCon").show(),a.getForm().findField("modificationcode").hide()}}),Ext.define("PTS.view.project.window.ItemDetail",{extend:"Ext.panel.Panel",alias:"widget.agreementitemdetail",requires:["PTS.view.project.form.ProposalForm","PTS.view.project.form.AgreementForm","PTS.view.project.form.DeliverableForm","PTS.view.project.form.TaskForm","PTS.view.project.form.FundingForm","PTS.view.project.form.ModificationForm"],itemId:"itemDetail",style:{borderWidth:"1px 0 0 1px",padding:0},activeItem:0,layout:{type:"card"},title:"Detail",initComponent:function(){var a=this;Ext.applyIf(a,{defaults:{preventHeader:!0,trackResetOnLoad:!0,autoScroll:!1,border:0},items:[{xtype:"container",html:'<div style="margin: 2em auto;text-align:center;">Use the toolbar to create a new item or select anexisting item from the tree.</div>',itemId:"itemCard-0"},{xtype:"proposalform",itemId:"itemCard-10",title:"Proposal"},{xtype:"agreementform",itemId:"itemCard-20",title:"Agreement"},{xtype:"deliverableform",itemId:"itemCard-30",title:"Deliverable"},{xtype:"taskform",itemId:"itemCard-40",title:"Task"},{xtype:"fundingform",title:"Funding",itemId:"itemCard-50"},{xtype:"modificationform",title:"Modification",itemId:"itemCard-60"}],dockedItems:[{xtype:"toolbar",itemId:"mainItemToolbar",dock:"top"}]}),a.callParent(arguments)}}),Ext.define("PTS.controller.project.window.AgreementsTree",{extend:"Ext.app.Controller",views:["project.window.AgreementsTree","project.window.ItemDetail"],models:["AgreementsTree"],stores:["AgreementsTree"],refs:[{ref:"itemDetail",selector:"agreementitemdetail"},{ref:"treeView",selector:"agreementstree treeview"}],init:function(){this.control({agreementstree:{beforerender:this.beforeRender},"agreementstree treeview":{afterrender:this.afterRenderView,beforedrop:this.beforeDrop},"agreementstree tool[type=expand]":{click:this.expandAll},"agreementstree tool[type=collapse]":{click:this.collapseAll},"agreementstree tool[type=refresh]":{click:this.refresh}}),this.application.on({closeproject:this.onCloseProject,scope:this})},beforeRender:function(a){var b=a.up("window").projectId,c=a.getStore();c.setProxy({type:"ajax",url:PTS.baseURL+"/project/"+b+"/tree",reader:{type:"json"}}),c.load({scope:this,callback:function(b,c,d){this.expandAll(a.down("tool[type=expand]"))}})},afterRenderView:function(a){var b=a.getPlugin("agreementsddplugin");b.dragZone.isPreventDrag=function(a,b){return!1===b.get("allowDrag")||30!==b.parentNode.get("typeid")||!!a.getTarget(this.view.expanderSelector)},b.dropZone.onNodeDrop=function(a,b,c,d){var e=this,f=!1,g={wait:!1,processDrop:function(b){return d.records=b||d.records,e.invalidateDrop(),e.handleNodeDrop(d,e.overRecord,e.currentPosition),f=!0,e.fireViewEvent("drop",a,d,e.overRecord,e.currentPosition),d},cancelDrop:function(){e.invalidateDrop(),f=!0}},h=!1;if(e.valid){if(h=e.fireViewEvent("beforedrop",a,d,e.overRecord,e.currentPosition,g),g.wait)return;!1!==h&&(f||g.processDrop())}return h},b.dropZone.isValidDropPoint=function(a,b,c,d,e){if(!a||!e.item)return!1;var f,g,h=this.view,i=h.getRecord(a),j=e.records,k=j.length,l=j.length,m=function(a){return a.get("parentItm")===g.getId()};if(30!=i.get("typeid")||"append"!==b)return!1;for(f=0;f<l;f++){if(g=j[f],i.contains(g))return!1;if(i.findChildBy(m))return!1}if(!(i&&b&&k))return!1;for(f=0;f<l;f++)if(g=j[f],g.isNode&&g.contains(i))return!1;return!("append"===b&&!1===i.get("allowDrop")||"append"!==b&&!1===i.parentNode.get("allowDrop")||Ext.Array.contains(j,i))}},beforeDrop:function(a,b,c,d,e){var f,g,h,i,j=this.getTreeView(),k=b.records[0];e.wait=!0,f=j.getAgreementId(k),g=j.getAgreementId(c),h=(i=f===g)?"Are you sure you want to copy this Deliverable? <br/>The original will be cancelled.":"Create a copy of the deliverable?",Ext.MessageBox.confirm("Confirm",h,function(a){var b,d,f,g;if("yes"===a)if(i)b=j.up("tabpanel"),d=b.down("deliverableform #itemForm").getRecord(),b.getEl().mask("Processing..."),g=d.copy(),Ext.data.Model.id(g),k.set("invalid",!0),k.set("readonly",!0),j.addRowCls(k,"pts-deliverable-invalid"),g.beginEdit(),g.phantom=!0,g.data.id=null,g.set("deliverableid",null),g.set("modificationid",j.getDataId(c,60)),g.set("invalid",!1),g.set("parentmodificationid",d.get("modificationid")),g.set("parentdeliverableid",d.get("deliverableid")),g.endEdit(),g.save({success:function(a,c){var g,h,i=c.records[0],l=i.get("deliverableid"),m=i.get("modificationid");f=k.copy(),f.setId("d-"+l+"-"+m),f.set("dataid",m+"/deliverable/"+l),f.set("invalid",!1),f.set("readonly",!1),f.set("cls",""),f.set("parentItm","d-"+d.get("deliverableid")+"-"+d.get("modificationid")),f.set("iconCls","pts-page-bluecopy"),g=e.processDrop([f]),h=j.getNode(g.records[0]),j.getSelectionModel().select(j.getTreeStore().getNodeById(h.id)),b.getEl().unmask()},failure:function(a,c){Ext.MessageBox.show({title:"Error",msg:"Could not update the new deliverable.</br>Error:"+PTS.app.getError(),buttons:Ext.MessageBox.OK,icon:Ext.Msg.ERROR}),b.getEl().unmask()},scope:this});else{var h=j.getDataId(c,60)||j.getDataId(c,20);b=j.up("tabpanel"),d=b.down("deliverableform #itemForm").getRecord(),b.getEl().mask("Processing..."),g=d.copy(),
Ext.data.Model.id(g),g.beginEdit(),g.phantom=!0,g.data.id=null,g.set("deliverableid",null),g.set("modificationid",h),g.set("invalid",!1),g.endEdit(),g.save({success:function(a,c){var d,g,h=c.records[0],i=h.get("deliverableid"),l=h.get("modificationid");f=k.copy(),f.setId("d-"+i+"-"+l),f.set("dataid",l+"/deliverable/"+i),f.set("invalid",!1),f.set("readonly",!1),f.set("cls",""),d=e.processDrop([f]),g=j.getNode(d.records[0]),j.getSelectionModel().select(j.getTreeStore().getNodeById(g.id)),b.getEl().unmask()},failure:function(a,c){Ext.MessageBox.show({title:"Error",msg:"Could not update the new deliverable.</br>Error:"+PTS.app.getError(),buttons:Ext.MessageBox.OK,icon:Ext.Msg.ERROR}),b.getEl().unmask()},scope:this})}else e.cancelDrop()},this)},expandAll:function(a,b){var c=a.ownerCt;c.child("tool[type=collapse]").show(),a.hide(),c.up("treepanel").collapseAll(),c.up("treepanel").expandAll()},collapseAll:function(a,b){var c=a.ownerCt;c.child("tool[type=expand]").show(),a.hide(),c.up("treepanel").collapseAll()},refresh:function(a,b){var c=a.ownerCt,d=this.getItemDetail(),e=c.up("treepanel").getStore();d.getLayout().setActiveItem(0),c.up("projectagreements").down("#rootBtn").show(),d.setTitle("Detail"),d.setIconCls("x-tree-icon-parent"),e.getRootNode().removeAll(),e.load()},clear:function(){this.getAgreementsTreeStore().getRootNode().removeAll()},onCloseProject:function(){this.clear()}}),Ext.define("PTS.model.ModType",{extend:"PTS.model.Base",fields:[{name:"modtypeid",type:"int",persist:!1},{name:"code",type:"mystring",useNull:!0},{name:"type",type:"mystring",useNull:!0},{name:"description",type:"mystring",useNull:!0}],idProperty:"modtypeid",proxy:{type:"rest",url:PTS.baseURL+"/modtype",reader:{type:"json",root:"data"}}}),Ext.define("PTS.store.ModTypes",{extend:"Ext.data.Store",model:"PTS.model.ModType",autoLoad:!0,listeners:{load:{fn:function(a,b,c,d){var e=[],f=[],g=Ext.getStore("ProposalTypes"),h=Ext.getStore("AgreementTypes");a.each(function(a){var b="proposal".toLowerCase();a.get("type").indexOf(b)+1?f.push(a):e.push(a)}),void 0===g?Ext.create("Ext.data.Store",{storeId:"ProposalTypes",model:"PTS.model.ModType",data:f}):g.loadRecords(f,{addRecords:!1}),void 0===h?Ext.create("Ext.data.Store",{storeId:"AgreementTypes",model:"PTS.model.ModType",data:e}):h.loadRecords(e,{addRecords:!1})}}}}),Ext.define("PTS.controller.project.window.ItemDetail",{extend:"Ext.app.Controller",views:["project.window.ItemDetail","project.form.ProposalForm"],models:["GroupUser","ModType"],stores:["GroupUsers","ModTypes"],init:function(){var a=[this.getController("project.form.AgreementForm"),this.getController("project.form.ModificationForm"),this.getController("project.form.ProposalForm"),this.getController("project.form.FundingForm"),this.getController("project.form.DeliverableForm"),this.getController("project.form.TaskForm")];Ext.each(a,function(a){a.init()})}}),Ext.define("PTS.model.ModificationContact",{extend:"PTS.model.Base",fields:[{name:"modificationid",type:"int",persist:!1},{name:"modificationcontact",type:"auto",useNull:!0,convert:function(a){return Ext.isString(a)?a.split(","):a}}],idProperty:"modificationid",proxy:{type:"rest",url:PTS.baseURL+"/modificationcontact",api:{read:PTS.baseURL+"/modificationcontactlist"},reader:{type:"json",root:"data"}}}),Ext.define("PTS.model.PurchaseRequest",{extend:"PTS.model.Base",fields:[{name:"purchaserequestid",type:"integer",useNull:!0,persist:!1},{name:"purchaserequest",type:"mystring",useNull:!0},{name:"modificationid",type:"int",useNull:!0},{name:"comment",type:"mystring",useNull:!0}],idProperty:"purchaserequestid",validations:[{type:"length",field:"purchaserequest",min:1},{type:"length",field:"modificationid",min:1}],proxy:{type:"rest",url:PTS.baseURL+"/purchaserequest",reader:{type:"json",root:"data"},limitParam:void 0}}),Ext.define("PTS.model.ModStatus",{extend:"PTS.model.Base",fields:[{name:"modstatusid",persist:!1,type:"int",useNull:!0},{name:"modificationid",type:"int",useNull:!0},{name:"statusid",type:"int",useNull:!0},{name:"weight",type:"int",useNull:!0},{name:"effectivedate",type:"mydate",useNull:!0},{name:"comment",type:"mystring",useNull:!0}],idProperty:"modstatusid",validations:[{type:"length",field:"modificationid",min:1},{type:"length",field:"statusid",min:1},{type:"presence",field:"effectivedate"}],proxy:{type:"rest",url:PTS.baseURL+"/modstatus",api:{read:PTS.baseURL+"/modstatuslist"},reader:{type:"json",root:"data"}}}),Ext.define("PTS.store.PurchaseRequests",{extend:"Ext.data.Store",model:"PTS.model.PurchaseRequest",autoLoad:!1,autoSync:!1,proxy:{type:"rest",url:PTS.baseURL+"/purchaserequest",reader:{type:"json",root:"data"},writer:{type:"json"}}}),Ext.define("PTS.store.ModStatuses",{extend:"Ext.data.Store",model:"PTS.model.ModStatus",autoLoad:!1,autoSync:!1,sorters:[{property:"effectivedate",direction:"DESC"},{property:"weight",direction:"DESC"}]}),Ext.define("PTS.controller.project.form.BaseModificationForm",{extend:"Ext.app.Controller",models:["ModificationContact"],stores:["PurchaseRequests","Statuses","ModStatuses"],init:function(){},getContactsForm:function(){return this.getAgreementCard().down("#relatedDetails>form#contactsForm")},onNewItem:function(a,b){if(this.getAgreementCard().itemId===b.ownerCt.itemId){var c=b.ownerCt.query("#relatedDetails>roweditgrid"),d=this.getContactsForm();b.ownerCt.down("#relatedDetails").disable(),Ext.each(c,function(a){a.getStore().removeAll()}),delete d.getForm().reset()._record}},onItemLoad:function(a,b){var c=this.getStatusesStore(),d=[{id:"type",property:"modtypeid",value:a.get("modtypeid"),exactMatch:!0}];if(this.getAgreementCard().itemId===b.ownerCt.itemId){var e=b.ownerCt.query("#relatedDetails>roweditgrid"),f=a.getId(),g=this.getContactsForm(),h=this.getModel("ModificationContact");Ext.each(e,function(a){var b=a.getStore();a.tab.active?(this.updateDetailStore(b,f,a.uri),b.load({callback:function(b,c,d){d&&a.up("#relatedDetails").enable()},scope:a})):b.removeAll()},this),f&&h.load(f,{success:function(a){g.loadRecord(a)}}),b.ownerCt.down("#relatedDetails gridcolumn[dataIndex=statusid]").getEditor().baseFilter=d,c.clearFilter(),c.filter(d),c.sort("weight")}},onDetailRowEdit:function(a,b){var c=this.getAgreementForm().getRecord(),d=c.getId();a.record.set("modificationid",d),a.store.sync()},onDetailActivate:function(a){var b,c,d=this.getAgreementForm().getRecord();void 0!==d&&(b=a.getStore(),b.isLoading()||0!==b.count()||(c=d.getId(),this.updateDetailStore(b,c,a.uri),b.load()))},updateDetailStore:function(a,b,c){a.setProxy({type:"rest",url:PTS.baseURL+"/"+c,api:{read:PTS.baseURL+"/modification/"+b+"/"+c},reader:{type:"json",root:"data"}})},validateStatus:function(a,b){var c=b.newValues.statusid;if(2===c&&c!==b.originalValues.statusid){var d=this.getAgreementForm().getRecord().getId(),e=(b.record,this),f=new Ext.LoadMask(b.grid,{msg:"Validating. Please wait..."});return f.show(),Ext.Ajax.request({url:PTS.baseURL+"/deliverablestatuslist",params:{filter:'[{"property":"deliverablestatusid","value":["<",40]},{"property":"modificationid","value":'+d+"}]"},method:"GET",success:function(c){Ext.JSON.decode(c.responseText).total>0?(b.column.getEditor().markInvalid("This agreement has incomplete deliverables."),Ext.create("widget.uxNotification",{title:"Error",iconCls:"ux-notification-icon-error",html:"This agreement has incomplete deliverables."}).show()):(a.getEditor().completeEdit(),e.onDetailRowEdit(b)),f.destroy()},failure:function(){f.destroy(),Ext.create("widget.uxNotification",{title:"Error",iconCls:"ux-notification-icon-error",html:"There was an error validating the status entry. </br>Error:"+PTS.app.getError()}).show()},scope:this}),!1}},clickContactReset:function(a){this.getContactsForm().getForm().reset()},clickContactSave:function(a){var b=this.getContactsForm().getForm(),c=this.getContactsForm().getEl(),d=b.getRecord();c.mask("Saving..."),b.updateRecord(d),d.save({success:function(a,b){this.getContactsForm().loadRecord(a),c.unmask()},failure:function(a,b){c.unmask(),Ext.create("widget.uxNotification",{title:"Error",iconCls:"ux-notification-icon-error",html:"There was an error saving the contacts.</br>Error: "+PTS.app.getError()}).show()},scope:this})},updateContacts:function(a){var b=this.getContactsForm().down("itemselector");b.rendered&&(b.bindStore(a),b.setRawValue(b.rawValue))}}),Ext.define("PTS.model.ModificationComment",{extend:"PTS.model.Base",fields:[{name:"modcommentid",type:"integer",useNull:!0,persist:!1},{name:"modificationid",type:"int",useNull:!0},{name:"contactid",type:"int",useNull:!0},{name:"comment",type:"mystring",useNull:!0},{name:"publish",type:"myboolean",useNull:!0,defaultValue:!1},{name:"datemodified",type:"mydate",useNull:!0,defaultValue:new Date}],idProperty:"modcommentid",validations:[{type:"length",field:"comment",min:1},{type:"length",field:"modificationid",min:1},{type:"length",field:"contactid",min:1}],proxy:{type:"rest",url:PTS.baseURL+"/modcomment",reader:{type:"json",root:"data"},limitParam:void 0}}),Ext.define("PTS.store.ModificationComments",{extend:"Ext.data.Store",model:"PTS.model.ModificationComment",autoLoad:!1}),Ext.define("PTS.controller.project.form.AgreementForm",{extend:"PTS.controller.project.form.BaseModificationForm",views:["project.form.AgreementForm"],models:["PurchaseRequest","Status","ModStatus"],stores:["PurchaseRequests","Statuses","ModStatuses","ModificationComments"],refs:[{ref:"agreementForm",selector:"agreementform#itemCard-20 #itemForm"},{ref:"agreementCard",selector:"agreementform#itemCard-20"}],init:function(){this.control({"agreementform#itemCard-20 roweditgrid":{edit:this.onDetailRowEdit,activate:this.onDetailActivate},"agreementform#itemCard-20 #statusGrid":{validateedit:this.validateStatus},"agreementform#itemCard-20 #contactsForm button[action=reset]":{click:this.clickContactReset},"agreementform#itemCard-20 #contactsForm button[action=save]":{click:this.clickContactSave}}),this.application.on({itemload:this.onItemLoad,newitem:this.onNewItem,syncprojectcontacts:this.updateContacts,scope:this})}}),Ext.define("PTS.controller.project.form.ModificationForm",{extend:"PTS.controller.project.form.BaseModificationForm",views:["project.form.AgreementForm","project.form.ModificationForm"],models:["PurchaseRequest","Status","ModStatus"],stores:["PurchaseRequests","Statuses","ModStatuses"],refs:[{ref:"agreementForm",selector:"modificationform#itemCard-60 #itemForm"},{ref:"agreementCard",selector:"modificationform#itemCard-60"}],init:function(){this.control({"modificationform#itemCard-60 roweditgrid":{edit:this.onDetailRowEdit,activate:this.onDetailActivate},"agreementform#itemCard-60 #statusGrid":{validateedit:this.validateStatus},"agreementform#itemCard-60 textfield[name=modcode]":{change:this.onChangeCode},"agreementform#itemCard-60 #contactsForm button[action=reset]":{click:this.clickContactReset},"agreementform#itemCard-60 #contactsForm button[action=save]":{click:this.clickContactSave}}),this.application.on({itemload:this.onItemLoad,newitem:this.onNewItem,savemodification:this.onSaveModification,syncprojectcontacts:this.updateContacts,scope:this})},onSaveModification:function(a,b,c){if(c){var d=this.getModStatusesStore(),e=this.getModStatusModel().create({statusid:10,comment:"This status was automatically created.",effectivedate:new Date,modificationid:a.get("modificationid")});d.add(e),d.sync()}},onNewItem:function(a,b){if(this.getAgreementCard().itemId===b.ownerCt.itemId){var c=b.up("#projecttabpanel").down("agreementstree").getSelectionModel().selected.first().get("parentcode"),d=b.getForm();a.set("parentcode",c),d.findField("parentcode").setValue(c),d.findField("modcode").setValue("").resetOriginalValue()}this.callParent(arguments)},onItemLoad:function(a,b){if(this.getAgreementCard().itemId===b.ownerCt.itemId){var c,d,e=b.getForm(),f=e.findField("modcode"),g=e.findField("codedelimiter").getValue(),h=a.get("modificationcode").split(g),i=String(a.get("parentcode"));c=h.length>1?h.slice(1).join(g):h[0],null!==c&&"null"!=c||(c=""),f.setValue(c).resetOriginalValue(),a.get("modificationcode")&&h[0]!==i&&(d="The parent code for this modification has changed.<br/>Do you want to update the code for this modification now?</br>",Ext.Msg.show({title:"Update Code?",msg:d,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,fn:function(b,d){if("yes"===b){var f=Ext.Msg.show({title:"Saving...",msg:"Saving Mod. Please wait...",wait:!0,icon:Ext.window.MessageBox.INFO});e.findField("modificationcode").setRawValue(i+g+c),e.updateRecord(a),a.save({callback:function(a,b){f.close()}})}},scope:this}))}this.callParent(arguments)},onChangeCode:function(a){var b=a.up("form").getForm(),c=b.getRecord(),d=b.findField("modcode").getValue(),e=b.findField("codedelimiter").getValue(),f=c.get("parentcode")+e+d;b.findField("modificationcode").setRawValue(f)}}),Ext.define("PTS.controller.project.form.ProposalForm",{extend:"PTS.controller.project.form.BaseModificationForm",views:["project.form.ProposalForm"],models:["Status","ModStatus"],stores:["Statuses","ModStatuses","ModificationComments"],refs:[{ref:"agreementForm",selector:"proposalform#itemCard-10 #itemForm"},{ref:"agreementCard",selector:"proposalform#itemCard-10"}],init:function(){this.control({"proposalform#itemCard-10 roweditgrid":{edit:this.onDetailRowEdit,activate:this.onDetailActivate}}),this.application.on({itemload:this.onItemLoad,newitem:this.onNewItem,scope:this})}}),Ext.define("PTS.model.FundingType",{extend:"PTS.model.Base",fields:[{name:"fundingtypeid",type:"int",persist:!1},{name:"code",type:"mystring",useNull:!0},{name:"type",type:"mystring",useNull:!0},{name:"description",type:"mystring",useNull:!0}],idProperty:"fundingtypeid",proxy:{type:"rest",url:PTS.baseURL+"/fundingtype",reader:{type:"json",root:"data"}}}),Ext.define("PTS.model.CostCode",{extend:"PTS.model.Base",fields:[{name:"costcodeid",type:"int",persist:!1},{name:"fundingid",type:"int",persist:!0},{name:"costcode",type:"mystring",useNull:!0},{name:"startdate",type:"mydate",useNull:!0},{name:"enddate",type:"mydate",useNull:!0}],idProperty:"costcodeid",validations:[{type:"length",field:"costcodeid",min:1},{type:"length",field:"fundingid",min:1},{type:"presence",field:"costcode"},{type:"presence",field:"startdate"},{type:"presence",field:"enddate"}],proxy:{type:"rest",url:PTS.baseURL+"/costcode",reader:{type:"json",root:"data"}}}),Ext.define("PTS.model.ContactCostCode",{extend:"PTS.model.Base",fields:[{name:"costcode",type:"mystring",persist:!1,useNull:!0},{name:"contactid",type:"int",persist:!1,useNull:!0}],idProperty:"costcode",proxy:{type:"rest",url:PTS.baseURL+"/contactcostcode",reader:{type:"json",root:"data"}}}),Ext.define("PTS.model.FundingComment",{extend:"PTS.model.Base",fields:[{name:"fundingcommentid",type:"integer",useNull:!0,persist:!1},{name:"fundingid",type:"int",useNull:!0},{name:"contactid",type:"int",useNull:!0},{name:"comment",type:"mystring",useNull:!0},{name:"datemodified",type:"mydate",useNull:!0,defaultValue:new Date}],idProperty:"fundingcommentid",validations:[{type:"length",field:"comment",min:1},{type:"length",field:"fundingid",min:1},{type:"length",field:"contactid",min:1}],proxy:{type:"rest",url:PTS.baseURL+"/fundingcomment",reader:{type:"json",root:"data"},limitParam:void 0}}),Ext.define("PTS.store.FundingTypes",{extend:"Ext.data.Store",model:"PTS.model.FundingType",autoLoad:!0}),Ext.define("PTS.store.CostCodes",{extend:"Ext.data.Store",model:"PTS.model.CostCode",autoLoad:!1,autoSync:!1}),Ext.define("PTS.store.ContactCostCodes",{extend:"Ext.data.Store",model:"PTS.model.ContactCostCode",autoLoad:!0}),Ext.define("PTS.store.FundingComments",{extend:"Ext.data.Store",model:"PTS.model.FundingComment",autoLoad:!1}),Ext.define("PTS.controller.project.form.FundingForm",{extend:"Ext.app.Controller",views:["project.form.FundingForm"],stores:["FundingTypes","ProjectFunders","CostCodes","ContactCostCodes","FundingComments","ProjectRecipients"],refs:[{ref:"fundingForm",selector:"fundingform>form"},{ref:"fundingCard",selector:"fundingform"}],init:function(){this.getController("project.form.InvoiceGridForm").init(),this.control({"fundingform #relatedDetails>roweditgrid":{edit:this.onDetailRowEdit,activate:this.onDetailActivate},"fundingform #relatedDetails invoicegridform":{activate:this.onInvoiceActivate}}),this.application.on({openproject:this.onOpenProject,itemload:this.onItemLoad,newitem:this.onNewItem,scope:this})},onOpenProject:function(a){this.getProjectFundersStore().setProxy({type:"rest",url:PTS.baseURL+"/projectfunder",appendId:!0,api:{read:PTS.baseURL+"/project/"+a+"/funder"},reader:{type:"json",root:"data"}})},onNewItem:function(a,b){if(this.getFundingCard().itemId===b.ownerCt.itemId){var c=b.ownerCt.query("#relatedDetails>roweditgrid, #relatedDetails invoicegridform #invoiceList"),d=this.getProjectRecipientsStore();b.ownerCt.down("#relatedDetails").disable(),Ext.each(c,function(a){a.getStore().removeAll()}),1===d.count()&&this.getFundingForm().down("combo#recipientCombo").setValue(d.getAt(0).getId())}},onItemLoad:function(a,b){if(this.getFundingCard().itemId===b.ownerCt.itemId){var c=b.ownerCt.query("#relatedDetails>roweditgrid,#relatedDetails invoicegridform #invoiceList"),d=a.getId(),e=b.ownerCt.down("invoicegridform");Ext.each(c,function(a){var b=a.getStore();(void 0===a.tab?a.ownerCt.tab.active:a.tab.active)?(this.updateDetailStore(b,d,a.uri),b.load({callback:function(b,c,d){d&&a.up("#relatedDetails").enable()},scope:a})):b.removeAll()},this),e.rendered&&e.getLayout().setActiveItem(0)}},onDetailRowEdit:function(a,b){var c=this.getFundingForm().getRecord(),d=c.getId();a.record.set("fundingid",d),a.store.sync()},onDetailActivate:function(a){var b,c,d=this.getFundingForm().getRecord();void 0!==d&&(b=a.getStore(),b.isLoading()||0!==b.count()||(c=d.getId(),this.updateDetailStore(b,c,a.uri),b.load()))},onInvoiceActivate:function(a){var b=a.down("#invoiceList");this.onDetailActivate(b)},updateDetailStore:function(a,b,c){a.setProxy({type:"rest",url:PTS.baseURL+"/"+c,api:{read:PTS.baseURL+"/funding/"+b+"/"+c},reader:{type:"json",root:"data"}})}}),Ext.define("PTS.model.DeliverableType",{extend:"PTS.model.Base",fields:[{name:"deliverabletypeid",type:"int",persist:!1},{name:"code",type:"mystring",useNull:!0},{name:"type",type:"mystring",useNull:!0},{name:"description",type:"mystring",useNull:!0},{name:"isocodename",type:"mystring",useNull:!0},{name:"product",type:"myboolean",useNull:!0}],idProperty:"deliverabletypeid",proxy:{type:"rest",url:PTS.baseURL+"/deliverabletype",reader:{type:"json",root:"data"}}}),Ext.define("PTS.store.DeliverableTypes",{extend:"Ext.data.Store",model:"PTS.model.DeliverableType",autoLoad:!0,sorters:[{property:"code",direction:"ASC"}],listeners:{load:{fn:function(a,b,c,d){var e=[],f=[],g=Ext.getStore("TaskTypes"),h=Ext.getStore("ProductTypes");a.each(function(a){a.get("product")&&f.push(a)}),void 0===h?Ext.create("Ext.data.Store",{storeId:"ProductTypes",model:"PTS.model.DeliverableType",data:f}):h.loadRecords(f,{addRecords:!1}),a.each(function(b){var c="task".toLowerCase();b.get("type").indexOf(c)>-1&&(e.push(b),a.remove(b))}),void 0===g?Ext.create("Ext.data.Store",{storeId:"TaskTypes",model:"PTS.model.DeliverableType",data:e}):g.loadRecords(e,{addRecords:!1})}}}}),Ext.define("PTS.model.DeliverableComment",{extend:"PTS.model.Base",fields:[{name:"deliverablecommentid",type:"integer",useNull:!0,persist:!1},{name:"deliverableid",type:"int",useNull:!0},{name:"contactid",type:"int",useNull:!0},{name:"comment",type:"mystring",useNull:!0},{name:"datemodified",type:"mydate",useNull:!0,defaultValue:new Date}],idProperty:"deliverablecommentid",validations:[{type:"length",field:"comment",min:1},{type:"length",field:"deliverableid",min:1},{type:"length",field:"contactid",min:1}],proxy:{type:"rest",url:PTS.baseURL+"/deliverablecomment",reader:{type:"json",root:"data"},limitParam:void 0}}),Ext.define("PTS.model.DeliverableStatus",{extend:"PTS.model.Base",fields:[{name:"deliverablestatusid",type:"int",persist:!1},{name:"code",type:"mystring",useNull:!0},{name:"status",type:"mystring",useNull:!0},{name:"description",type:"mystring",useNull:!0}],idProperty:"deliverablestatusid",proxy:{type:"rest",url:PTS.baseURL+"/deliverablestatus",reader:{type:"json",root:"data"},limitParam:void 0}}),Ext.define("PTS.model.DeliverableModStatus",{extend:"PTS.model.Base",fields:[{name:"deliverablemodstatusid",persist:!1,type:"int",useNull:!0},{name:"deliverableid",type:"int",useNull:!0},{name:"modificationid",type:"int",useNull:!0},{name:"deliverablestatusid",type:"int",useNull:!0},{name:"contactid",type:"int",useNull:!0},{name:"effectivedate",type:"mydate",useNull:!0,defaultValue:new Date},{name:"comment",type:"mystring",useNull:!0}],idProperty:"deliverablemodstatusid",validations:[{type:"length",field:"modificationid",min:1},{type:"length",field:"deliverableid",min:1},{type:"length",field:"deliverablestatusid",min:1},{type:"presence",field:"effectivedate"}],proxy:{type:"rest",url:PTS.baseURL+"/deliverablemodstatus",reader:{type:"json",root:"data"}}}),Ext.define("PTS.model.DeliverableNotice",{extend:"PTS.model.Base",fields:[{name:"deliverablenoticeid",persist:!1,type:"int",useNull:!0},{name:"deliverableid",type:"int",useNull:!0},{name:"modificationid",type:"int",useNull:!0},{name:"noticeid",type:"int",useNull:!0},{name:"recipientid",type:"int",useNull:!0},{name:"contactid",type:"int",useNull:!0},{name:"datesent",type:"mydate",useNull:!0,defaultValue:new Date},{name:"comment",type:"mystring",useNull:!0}],idProperty:"deliverablenoticeid",validations:[{type:"length",field:"modificationid",min:1},{type:"length",field:"deliverableid",min:1},{type:"length",field:"noticeid",min:1},{type:"presence",field:"effectivedate"}],proxy:{type:"rest",url:PTS.baseURL+"/deliverablenotice",reader:{type:"json",root:"data"}}}),Ext.define("PTS.model.Notice",{extend:"PTS.model.Base",fields:[{name:"noticeid",type:"int",persist:!1},{name:"code",type:"mystring",useNull:!0},{name:"title",type:"mystring",useNull:!0},{name:"description",type:"mystring",useNull:!0},{name:"priority",type:"int"}],idProperty:"noticeid",proxy:{type:"rest",url:PTS.baseURL+"/notice",reader:{type:"json",root:"data"},limitParam:void 0}}),Ext.define("PTS.store.DeliverableComments",{extend:"Ext.data.Store",model:"PTS.model.DeliverableComment",autoLoad:!1}),Ext.define("PTS.store.DeliverableStatuses",{extend:"Ext.data.Store",model:"PTS.model.DeliverableStatus",autoLoad:!0,sorters:[{property:"deliverablestatusid",direction:"ASC"}]}),Ext.define("PTS.store.DeliverableModStatuses",{extend:"Ext.data.Store",model:"PTS.model.DeliverableModStatus",autoLoad:!1,autoSync:!1,sorters:[{property:"effectivedate",direction:"DESC"},{property:"deliverablestatusid",direction:"DESC"}],listeners:{add:function(a,b){Ext.each(b,function(){var a=this;null===a.get("contactid")&&a.set("contactid",PTS.user.get("contactid"))})}}}),Ext.define("PTS.store.DeliverableNotices",{extend:"Ext.data.Store",model:"PTS.model.DeliverableNotice",autoLoad:!1,autoSync:!1,sorters:[{property:"datesent",direction:"DESC"},{property:"deliverablenoticeid",direction:"DESC"}],listeners:{add:function(a,b){Ext.each(b,function(){var a=this;null===a.get("contactid")&&a.set("contactid",PTS.user.get("contactid"))})}}}),Ext.define("PTS.store.Notices",{extend:"Ext.data.Store",model:"PTS.model.Notice",autoLoad:!0,sorters:[{property:"priority",direction:"ASC"}]}),Ext.define("PTS.controller.project.form.DeliverableForm",{extend:"Ext.app.Controller",views:["project.form.DeliverableForm"],models:["DeliverableType","ModStatus"],stores:["DeliverableTypes","DeliverableComments","DeliverableStatuses","DeliverableModStatuses","DeliverableNotices","NoticeRecipients","Notices"],refs:[{ref:"deliverableForm",selector:"deliverableform#itemCard-30 #itemForm"},{ref:"deliverableCard",selector:"deliverableform#itemCard-30"}],init:function(){this.control({"deliverableform#itemCard-30 #relatedDetails>roweditgrid":{edit:this.onDetailRowEdit,activate:this.onDetailActivate},"deliverableform#itemCard-30 #relatedDetails>#statusGrid":{validateedit:this.validateStatus},"deliverableform#itemCard-30 #mainCon combobox[name=deliverabletypeid]":{change:this.onChangeDelType},"deliverableform button#sendNotice":{click:this.sendNotice}}),this.application.on({itemload:this.onItemLoad,newitem:this.onNewItem,savedeliverable:this.onSave,scope:this})},sendNotice:function(a){var b=a.up("deliverableform").down("#itemForm").getRecord(),c=b.get("deliverableid"),d=a.up("roweditgrid"),e=new Ext.LoadMask(d,{msg:"Sending Notice. Please wait..."}),f=PTS.app.getStore("ProjectContacts").findExact("reminder",!0),g=f>-1?"":" No recipients are selected  (see Contacts tab), so this notice will only be sent to staff.",h=function(a){"yes"===a&&(e.show(),Ext.Ajax.request({url:PTS.baseURL+"/deliverable/"+c+"/reminder",method:"POST",success:function(a,b){d.getStore().load()},failure:function(a,b){var c=404===a.status?"Could not find any notices to send. Have you selected any recipients (see Contacts tab)?":"Failed to send notice due to server error.";PTS.app.showError(c)},callback:function(a,b,c){e.destroy()}}))};Ext.MessageBox.show({title:"Confirm Notice",msg:"Are you sure you want to send a reminder notice?"+g,buttons:Ext.MessageBox.YESNO,icon:Ext.Msg.WARNING,fn:h,scope:this,animateTarget:a.getEl()})},onNewItem:function(a,b){if(this.getDeliverableCard().itemId===b.ownerCt.itemId){var c=b.ownerCt.query("#relatedDetails>roweditgrid");b.ownerCt.down("#relatedDetails").disable(),Ext.each(c,function(a){a.getStore().removeAll()})}},onItemLoad:function(a,b){var c,d=!!a.get("parentdeliverableid");if("PTS.model.Deliverable"===Ext.getClassName(a)&&(c=this.getDeliverableForm().down("#mainCon"),c.items.each(function(a){a.doNotEnable=!!d,a.getEl().setOpacity(1)})),this.getDeliverableCard().itemId===b.ownerCt.itemId){var e=b.ownerCt.query("#relatedDetails>roweditgrid"),f=a.get("deliverableid");Ext.each(e,function(a){var b=a.getStore();(void 0===a.tab?a.ownerCt.tab.active:a.tab.active)?(this.updateDetailStore(b,f,a.uri),b.load({callback:function(b,c,d){d&&a.up("#relatedDetails").enable()},scope:a})):b.removeAll()},this)}},onDetailRowEdit:function(a,b){var c=this.getDeliverableForm().getRecord(),d=c.get("deliverableid"),e=c.get("modificationid");a.record.set("deliverableid",d),c.fields.containsKey("modificationid")&&a.record.set("modificationid",e),a.store.sync()},onDetailActivate:function(a){var b,c,d=this.getDeliverableForm().getRecord();void 0!==d&&(b=a.getStore(),b.isLoading()||0!==b.count()||(c=d.get("deliverableid"),this.updateDetailStore(b,c,a.uri),b.load()))},onChangeDelType:function(a,b,c){a.up("form").down("#delPeriod").setVisible(6===b||13===b||25===b)},onSave:function(a,b){var c,d=b.request.method,e=a.data;switch(d){case"POST":c=PTS.baseURL+"/deliverable/calendar/event";break;case"PUT":case"DELETE":c=PTS.baseURL+"/deliverable/calendar/event/"+e.deliverableid}Ext.Ajax.request({url:c,method:d,jsonData:Ext.encode(e),failure:function(a,b){Ext.create("widget.uxNotification",{title:"Error",iconCls:"ux-notification-icon-error",html:"Publishing to calendar failed </br>Error:"+PTS.app.getError()}).show()}})},updateDetailStore:function(a,b,c){a.setProxy({type:"rest",url:PTS.baseURL+"/"+c,api:{read:PTS.baseURL+"/deliverable/"+b+"/"+c},reader:{type:"json",root:"data"}})},validateStatus:function(a,b){var c=b.newValues.deliverablestatusid,d=b.newValues.effectivedate.getTime(),e=b.originalValues.effectivedate.getTime(),f=b.originalValues.deliverablestatusid;if(c===f&&d===e)return!0;var g=b.record,h=this.getDeliverableForm().getRecord().get("modificationid"),i=new Ext.LoadMask(b.grid,{msg:"Validating. Please wait..."});return i.show(),Ext.Ajax.request({url:PTS.baseURL+"/modificationstatus",params:{filter:'[{"property":"modificationid","value":'+h+"}]"},method:"GET",success:function(e){var f=Ext.JSON.decode(e.responseText),j=f.data[0],k=void 0===j?"Not Defined":j.status,l="The agreement has has been marked <b>Completed</b>. ",m=this,n=b.store.data.filter("phantom",!1);n.sort([{property:"effectivedate",direction:"DESC"},{property:"deliverablestatusid",direction:"DESC"}]),n=n.first(),f.total>0&&j.weight>=90&&n&&n.getId()===g.getId()&&(c<40||d<n.get("effectivedate").getTime())?(b.column.getEditor().markInvalid(l),Ext.create("widget.uxNotification",{title:"Error",iconCls:"ux-notification-icon-error",html:l+"Change the status of the agreement first."}).show()):(a.getEditor().completeEdit(),m.onDetailRowEdit(b),c>=40&&(0===f.total||j.weight<90&&j.incdeliverables<=1)&&(l="This agreement status is currently <i>"+k+"</i>.<br/>Do you want to set the status to <b>Completed</b>?</br>You may also enter a comment (optional).</br></br>",Ext.Msg.show({title:"Set Agreement Status?",msg:l,buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,prompt:!0,fn:function(a,b){if("yes"===a){var c=m.getModStatusModel().create({modificationid:h,statusid:2,effectivedate:new Date,comment:b}),d=Ext.Msg.show({title:"Saving...",msg:"Saving status. Please wait...",wait:!0,icon:Ext.window.MessageBox.INFO});c.save({callback:function(a,b){d.close()}})}},scope:m}))),i.destroy()},failure:function(){i.destroy(),Ext.create("widget.uxNotification",{title:"Error",iconCls:"ux-notification-icon-error",html:"There was an error validating the status entry. </br>Error:"+PTS.app.getError()}).show()},scope:this}),!1}}),Ext.define("PTS.store.TaskStatuses",{extend:"PTS.store.DeliverableStatuses",proxy:{type:"rest",url:PTS.baseURL+"/taskstatus",reader:{type:"json",root:"data"},limitParam:void 0}}),Ext.define("PTS.controller.project.form.TaskForm",{extend:"PTS.controller.project.form.DeliverableForm",views:["project.form.TaskForm"],models:["DeliverableType"],stores:["DeliverableTypes","DeliverableComments","TaskStatuses"],refs:[{ref:"deliverableForm",selector:"deliverableform#itemCard-40 #itemForm"},{ref:"deliverableCard",selector:"deliverableform#itemCard-40"}],init:function(){this.control({"taskform #itemForm":{beforerender:this.onBeforeRender},"taskform#itemCard-40 #relatedDetails>roweditgrid":{edit:this.onDetailRowEdit,activate:this.onDetailActivate}}),this.application.on({itemload:this.onItemLoad,newitem:this.onNewItem,scope:this})},onBeforeRender:function(a){var b,c,d,e,f=[];Ext.getStore("TaskTypes").each(function(a){f.push({boxLabel:a.get("type"),name:"deliverabletypeid",inputValue:a.get("deliverabletypeid")})}),b={xtype:"radiogroup",fieldLabel:"Type",items:f,width:300,listeners:{change:function(a,b,c){a.up("#itemForm").getForm().checkDirty()}}},e=a.down("#mainCon"),c=e.down("combobox[name=deliverabletypeid]"),d=e.items.indexOf(c),e.remove(c),e.insert(d,b),a.down("#delPeriod").hide()}}),Ext.define("PTS.model.Invoice",{extend:"PTS.model.Base",fields:[{name:"invoiceid",type:"int",persist:!1},{name:"fundingid",type:"int",useNull:!0},{name:"projectcontactid",type:"int",useNull:!0},{name:"datereceived",type:"mydate",useNull:!0},{name:"dateclosed",type:"mydate",useNull:!0},{name:"amount",type:"number",useNull:!0},{name:"title",type:"mystring",useNull:!0}],idProperty:"invoiceid",hasMany:[{model:"PTS.model.CostCodeInvoice",name:"costcodes"}],proxy:{type:"rest",url:PTS.baseURL+"/invoice",reader:{type:"json",root:"data"},writer:{type:"ajson"}}}),Ext.define("PTS.store.Invoices",{extend:"Ext.data.Store",model:"PTS.model.Invoice",autoLoad:!1,autoSync:!1}),Ext.define("PTS.model.CostCodeInvoice",{extend:"PTS.model.Base",fields:[{name:"costcodeinvoiceid",type:"int",useNull:!0},{name:"costcodeid",type:"int",useNull:!0},{name:"invoiceid",type:"int",useNull:!0},{name:"datecharged",type:"mydate",useNull:!0},{name:"amount",type:"number",useNull:!0}],idProperty:"costcodeinvoiceid",validations:[{type:"length",field:"costcodeid",min:1},{type:"length",field:"invoiceid",min:1},{type:"presence",field:"datecharged"},{type:"presence",field:"amount"}],proxy:{type:"rest",url:PTS.baseURL+"/costcodeinvoice",reader:{type:"json",root:"data"}}}),Ext.define("PTS.view.project.form.InvoiceGridForm",{extend:"Ext.panel.Panel",alias:"widget.invoicegridform",
requires:["PTS.view.controls.RowEditGrid","PTS.view.controls.CurrencyField","Ext.util.Format.usMoney","Ext.grid.column.Number"],activeItem:0,layout:{type:"card"},title:"Invoices",defaults:{autoScroll:!0,border:0},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"gridpanel",itemId:"invoiceList",uri:"invoice",store:"Invoices",columns:[{xtype:"gridcolumn",dataIndex:"title",text:"Title",flex:1},{xtype:"numbercolumn",dataIndex:"amount",text:"Amount"},{xtype:"datecolumn",dataIndex:"datereceived",text:"Received"},{xtype:"datecolumn",dataIndex:"dateclosed",text:"Closed"}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",text:"Edit",iconCls:"pts-menu-editbasic",action:"editinvoice",disabled:!0},{xtype:"button",text:"Add",iconCls:"pts-menu-addbasic",action:"addinvoice"}]}]},{xtype:"form",itemId:"invoiceForm",model:"PTS.model.Invoice",trackResetOnLoad:!0,border:0,layout:{align:"stretch",padding:10,type:"vbox"},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",action:"showlist",iconCls:"pts-menu-viewlist",text:"Show List"},{xtype:"button",action:"deleteinvoice",iconCls:"pts-menu-deletebasic",text:"Delete"},{xtype:"button",action:"saveinvoice",iconCls:"pts-menu-savebasic",text:"Save",formBind:!0},{xtype:"button",action:"resetinvoice",iconCls:"pts-menu-reset",text:"Reset"}]}],items:[{xtype:"container",border:0,padding:"0 0 10 0",layout:{type:"anchor"},items:[{xtype:"textfield",name:"title",fieldLabel:"Title",anchor:"100%",allowBlank:!1},{xtype:"combobox",name:"projectcontactid",fieldLabel:"Contact",displayField:"name",valueField:"projectcontactid",store:"ProjectInvoicers",typeAhead:!1,queryMode:"local",forceSelection:!0,allowBlank:!1,anchor:"100%"},{xtype:"currencyfield",name:"amount",fieldLabel:"Amount",allowBlank:!1},{xtype:"fieldcontainer",layout:{type:"hbox"},fieldLabel:"Dates",hideLabel:!0,items:[{xtype:"datefield",name:"datereceived",fieldLabel:"Received",flex:1},{xtype:"datefield",name:"dateclosed",margin:"0 0 0 10",fieldLabel:"Closed",labelAlign:"right",labelPad:15,flex:0}]}]},{xtype:"roweditgrid",itemId:"costCodes",title:"Cost Codes",syncOnRemoveRow:!1,flex:1,columns:[{xtype:"gridcolumn",dataIndex:"costcodeid",renderer:function(a,b,c,d,e,f,g){var h=g.getHeaderAtIndex(e).getEditor(),i=h.getStore().find(h.valueField,a,0,!1,!0,!0),j=h.getStore().getAt(i);return j?j.get(h.displayField):a},editor:{xtype:"combobox",displayField:"costcode",valueField:"costcodeid",store:"CostCodes",typeAhead:!1,queryMode:"local",forceSelection:!1,allowBlank:!1},text:"Cost Code",flex:2},{xtype:"datecolumn",dataIndex:"datecharged",editor:{xtype:"datefield"},text:"Date Charged"},{xtype:"numbercolumn",dataIndex:"amount",editor:{xtype:"currencyfield",allowBlank:!1},flex:1,text:"Amount",renderer:Ext.util.Format.usMoney}]}]}]}),a.callParent(arguments)}}),Ext.define("PTS.store.CostCodeInvoices",{extend:"Ext.data.Store",model:"PTS.model.CostCodeInvoice",autoLoad:!1,autoSync:!1}),Ext.define("PTS.controller.project.form.InvoiceGridForm",{extend:"Ext.app.Controller",views:["project.form.InvoiceGridForm"],models:["Invoice"],stores:["ProjectContacts","ProjectInvoicers","Invoices","CostCodeInvoices","CostCodes"],refs:[{ref:"invoiceGridForm",selector:"invoicegridform"},{ref:"invoiceList",selector:"invoicegridform>#invoiceList"},{ref:"invoiceForm",selector:"invoicegridform>#invoiceForm"},{ref:"fundingForm",selector:"fundingform>form"}],init:function(){this.control({"invoicegridform>#invoiceList":{selectionchange:this.onInvoiceSelection,itemdblclick:this.onDblClickInvoice},"#invoiceList button[action=editinvoice]":{click:this.editInvoiceHandler},"#invoiceList button[action=addinvoice]":{click:this.addInvoice},"#invoiceForm button[action=saveinvoice]":{click:this.saveInvoice},"#invoiceForm button[action=deleteinvoice]":{click:this.deleteInvoice},"#invoiceForm button[action=resetinvoice]":{click:this.resetInvoice},"#invoiceForm button[action=showlist]":{click:this.showInvoiceList},"invoicegridform>#invoiceForm roweditgrid#costCodes":{beforeremoverow:this.beforeRemoveCostcode}})},onInvoiceSelection:function(a,b){this.getInvoiceGridForm().down("#invoiceList button[action=editinvoice]").setDisabled(!a.getCount())},showInvoiceList:function(){this.getInvoiceGridForm().getLayout().setActiveItem("invoiceList")},editInvoiceHandler:function(){var a=this.getInvoiceList().getSelectionModel().getSelection()[0];this.editInvoice(a)},resetInvoice:function(){this.getInvoiceForm().getForm().reset()},onDblClickInvoice:function(a,b){this.editInvoice(b)},editInvoice:function(a){var b,c,d=this.getInvoiceForm(),e=this.getCostCodesStore();e.count()||e.isLoading()||0!==e.count()||(c=d.down("roweditgrid#costCodes"),c.getEl().mask("Loading..."),b=d.up("fundingform").down("#itemForm").getRecord().getId(),this.getController("project.form.FundingForm").updateDetailStore(e,b,"costcode"),e.load(function(a,b,d){c.getView().refresh(),c.getEl().unmask()})),d.loadRecord(a),d.down("roweditgrid#costCodes").bindStore(a.costcodes()),this.getInvoiceGridForm().getLayout().setActiveItem(1)},addInvoice:function(){var a,b,c=this.getInvoiceForm(),d=this.getCostCodesStore(),e=Ext.create(this.getInvoiceModel());d.count()||d.isLoading()||0!==d.count()||(b=c.down("roweditgrid#costCodes"),b.getEl().mask("Loading..."),a=c.up("fundingform").down("#itemForm").getRecord().getId(),this.getController("project.form.FundingForm").updateDetailStore(d,a,"costcode"),d.load(function(a,c,d){b.getView().refresh(),b.getEl().unmask()})),c.loadRecord(e),c.down("roweditgrid#costCodes").bindStore(e.costcodes()),this.getInvoiceGridForm().getLayout().setActiveItem(1)},saveInvoice:function(){var a={},b=this.getInvoiceForm(),c=b.getForm(),d=c.getRecord(),e=b.down("roweditgrid#costCodes").getStore(),f=e.getRemovedRecords(),g=this.getFundingForm().getRecord().getId();if(0===e.count()||0===e.collect("costcodeid").length)return void Ext.MessageBox.show({title:"Error",msg:"At least one Cost Code is required.</br>",buttons:Ext.MessageBox.OK,animateTarget:b.down("button[action=saveinvoice]").getEl(),fn:function(){b.getEl().unmask()},icon:Ext.Msg.ERROR});b.getEl().mask("Saving..."),d.set("fundingid",g),c.updateRecord(d),f.length>0&&(a.destroy=f),e.getProxy().batch(a,{scope:this,exception:function(a,c){var d,f=e;b.getEl().unmask(),"destroy"===c.action&&(d=c.records[0],d.reject(),Ext.Array.remove(f.removed,d),f.add(d))},complete:{fn:function(){var a=this;d.save({success:function(d,e){var f=a.getInvoicesStore(),g=f.indexOfId(d.getId());c.loadRecord(d),b.down("roweditgrid#costCodes").bindStore(d.costcodes()),Ext.each(b.query("field"),function(){this.resetOriginalValue()}),-1!==g?(f.removeAt(g),f.insert(g,d)):f.add(d),b.getEl().unmask()},failure:function(a,c){Ext.MessageBox.show({title:"Error",msg:"There was a problem saving the invoice.</br>"+PTS.app.getError(),buttons:Ext.MessageBox.OK,animateTarget:b.down("button[action=saveinvoice]").getEl(),fn:function(){b.getEl().unmask()},icon:Ext.Msg.ERROR})},scope:this})},scope:this}})},deleteInvoice:function(){var a=this.getInvoiceForm(),b=a.getForm(),c=b.getRecord();a.getEl().mask("Loading..."),c.destroy({success:function(b,d){var e=this.getInvoicesStore(),f=e.indexOfId(c.getId());-1!==f&&e.removeAt(f),a.getEl().unmask(),this.getInvoiceGridForm().getLayout().setActiveItem("invoiceList")},failure:function(b,c){Ext.MessageBox.show({title:"Error",msg:"There was a problem deleting the invoice.</br>"+PTS.app.getError(),buttons:Ext.MessageBox.OK,animateTarget:a.down("button[action=deleteinvoice]").getEl(),fn:function(){a.getEl().unmask()},icon:Ext.Msg.ERROR})},scope:this})},beforeRemoveCostcode:function(a,b){if(1===b.count())return Ext.MessageBox.show({title:"Error",msg:"At least one Cost Code is required.</br>",buttons:Ext.MessageBox.OK,animateTarget:this.getInvoiceForm().down("roweditgrid#costCodes button#removeRow").getEl(),icon:Ext.Msg.ERROR}),!1}}),Ext.define("Ext.ux.grid.PagingToolbarResizer",{extend:"Ext.AbstractPlugin",alias:"plugin.pagingtoolbarresizer",options:[5,10,15,20,25,30,50,75,100,200,300,500,1e3],mode:"remote",displayText:"Records per Page",constructor:function(a){Ext.apply(this,a),this.callParent(arguments)},init:function(a){var b=this.options,c=a.store,d=Ext.create("Ext.form.field.ComboBox",{typeAhead:!1,triggerAction:"all",forceSelection:!0,lazyRender:!0,editable:!1,mode:this.mode,value:c.pageSize,width:50,store:b,listeners:{select:function(a,b,d){c.pageSize=b[0].data.field1,c.load()}}}),e=a.items.indexOf(a.items.map.refresh);a.insert(++e,"-"),a.insert(++e,this.displayText),a.insert(++e,d),a.insert(++e,"-"),a.on({beforedestroy:function(){d.destroy()}})}}),Ext.define("PTS.view.product.tab.ProductList",{extend:"Ext.grid.Panel",alias:"widget.productlist",requires:["Ext.ux.grid.PrintGrid","Ext.ux.grid.SaveGrid","Ext.ux.grid.FilterBar","Ext.ux.grid.PagingToolbarResizer"],store:"Products",title:"Product List",preventHeader:!0,initComponent:function(){var a=this,b=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:"Group: {name} ({rows.length})",startCollapsed:!0});Ext.applyIf(a,{features:[b],dockedItems:[{xtype:"pagingtoolbar",store:"Products",displayInfo:!0,plugins:[Ext.create("Ext.ux.grid.PrintGrid",{}),Ext.create("Ext.ux.grid.SaveGrid",{}),Ext.create("Ext.ux.grid.PagingToolbarResizer",{options:[25,50,100,200,500]})]}],columns:[{xtype:"actioncolumn",width:25,items:[{iconCls:"pts-world-link",tooltip:"Open Website",handler:function(a,b,c){var d=a.getStore().getAt(b),e=d.get("fiscalyear"),f=d.get("number"),g=PTS.user.get("producturiformat").replace(/(%s)/,e).replace(/(%s)/,f<10?"0"+f:f);window.open(g)}}]},{xtype:"gridcolumn",dataIndex:"projectcode",text:"Project"},{xtype:"gridcolumn",dataIndex:"title",text:"Title",flex:1},{xtype:"gridcolumn",hidden:!0,dataIndex:"description",text:"Description",flex:1},{xtype:"gridcolumn",text:"Type",dataIndex:"type"},{xtype:"gridcolumn",hidden:!1,dataIndex:"productgroup",text:"Group",flex:1},{xtype:"booleancolumn",text:"Export",trueText:"Yes",falseText:"No",dataIndex:"exportmetadata",width:55},{xtype:"booleancolumn",text:"Is Group",trueText:"Yes",falseText:"No",dataIndex:"isgroup",width:55},{text:"Time Period",hidden:!0,columns:[{xtype:"datecolumn",dataIndex:"startdate",text:"Begin",hidden:!0,width:75,sortable:!0},{xtype:"datecolumn",dataIndex:"enddate",text:"End",hidden:!0,width:75,sortable:!0}]}]}),a.callParent(arguments),a.addDocked({xtype:"filterbar",searchStore:a.store,dock:"bottom"})}}),Ext.define("PTS.view.product.tab.ProductTab",{extend:"Ext.panel.Panel",alias:"widget.producttab",requires:["PTS.view.product.tab.ProductList"],layout:{type:"border"},title:"Products",initComponent:function(){var a=this;Ext.applyIf(a,{dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",iconCls:"pts-menu-add",text:"Add Product",itemId:"newproductbtn",action:"addproduct"},{xtype:"button",iconCls:"pts-menu-edit",text:"Edit Product",itemId:"editproductbtn",action:"editproduct",disabled:!0}]}],items:[{xtype:"productlist",region:"center",itemId:"pts-product-grid"},{xtype:"panel",width:150,layout:{type:"border"},bodyStyle:{border:"none",backgroundColor:"#FFF",backgroundImage:"none"},collapsible:!0,animCollapse:!Ext.isIE8,preventHeader:!0,title:"Product Details",flex:1,region:"east",split:!0,defaults:{preventHeader:!0},items:[{region:"center"}]}]}),a.callParent(arguments)}}),Ext.define("PTS.controller.product.tab.ProductTab",{extend:"Ext.app.Controller",views:["product.tab.ProductTab"],refs:[{ref:"productList",selector:"producttab > productlist"},{ref:"productTab",selector:"producttab"}],init:function(){this.getController("product.tab.ProductList").init(),this.control({"producttab button[action=addproduct]":{click:this.newProduct},"producttab button[action=editproduct]":{click:this.editProduct}}),this.application.on({productlistselect:this.onProductListSelect,scope:this})},newProduct:function(){this.getController("product.Product").openProduct()},editProduct:function(){var a=this.getController("product.Product"),b=this.getProductList().getSelectionModel().getSelection()[0];b&&a.openProduct(b)},onProductListSelect:function(a){this.getProductTab().down("button[action=editproduct]").setDisabled(!a)}}),Ext.define("PTS.model.OnlineResource",{extend:"PTS.model.Base",fields:[{name:"onlineresourceid",type:"int",persist:!1},{name:"productid",type:"int"},{name:"onlinefunctionid",type:"int"},{name:"uri",type:"mystring",useNull:!0},{name:"title",type:"mystring",useNull:!0},{name:"description",type:"mystring",useNull:!0}],idProperty:"onlineresourceid",proxy:{type:"rest",url:PTS.baseURL+"/onlineresource",reader:{type:"json",root:"data"},limitParam:void 0}}),Ext.define("PTS.store.OnlineFunctions",{extend:"Ext.data.Store",fields:[{name:"onlinefunctionid",type:"int"},{name:"codename",type:"string"},{name:"description"}],proxy:{type:"rest",url:PTS.baseURL+"/onlinefunction",reader:{type:"json",root:"data"},limitParam:void 0},autoLoad:!0,sorters:[{property:"codename",direction:"ASC"}]}),Ext.define("PTS.store.DateTypes",{extend:"Ext.data.Store",fields:[{name:"datetypeid",type:"int"},{name:"codename",type:"string"},{name:"description"}],proxy:{type:"rest",url:PTS.baseURL+"/datetype",reader:{type:"json",root:"data"},limitParam:void 0},autoLoad:!0,sorters:[{property:"codename",direction:"ASC"}]}),Ext.define("PTS.model.ProductStatus",{extend:"PTS.model.Base",fields:[{name:"productstatusid",persist:!1,type:"int",useNull:!0},{name:"productid",type:"int",useNull:!0},{name:"contactid",type:"int",useNull:!0},{name:"datetypeid",type:"int",useNull:!0},{name:"effectivedate",type:"mydate",useNull:!0},{name:"comment",type:"mystring",useNull:!0}],idProperty:"productstatusid",validations:[{type:"length",field:"productid",min:1},{type:"length",field:"datetypeid",min:1},{type:"presence",field:"effectivedate"}],proxy:{type:"rest",url:PTS.baseURL+"/productstatus",reader:{type:"json",root:"data"}}}),Ext.define("PTS.model.ProductStep",{extend:"PTS.model.Base",fields:[{name:"productstepid",persist:!1,type:"int",useNull:!0},{name:"productid",type:"int",useNull:!0},{name:"productcontactid",type:"int",useNull:!0},{name:"priority",type:"int",useNull:!0},{name:"stepdate",type:"mydate",useNull:!0},{name:"description",type:"mystring",useNull:!0},{name:"rationale",type:"mystring",useNull:!0}],idProperty:"productstepid",validations:[{type:"length",field:"productid",min:1},{type:"length",field:"description",min:1},{type:"presence",field:"stepdate"}],proxy:{type:"rest",url:PTS.baseURL+"/productstep",reader:{type:"json",root:"data"}}}),Ext.define("PTS.model.ProductVector",{extend:"PTS.model.Base",fields:[{name:"fid",convert:function(a,b){return b.raw instanceof OpenLayers.Feature.Vector?b.raw.fid:"This is not a Feature"}},{name:"productid",type:"int",useNull:!0},{name:"name",type:"mystring",useNull:!0},{name:"comment",type:"mystring",useNull:!0}]}),Ext.define("PTS.store.OnlineResources",{extend:"Ext.data.Store",model:"PTS.model.OnlineResource",autoLoad:!1,sorters:[{property:"onlineresourceid",direction:"ASC"}]}),Ext.define("PTS.store.ProductStatuses",{extend:"Ext.data.Store",model:"PTS.model.ProductStatus",autoLoad:!1,autoSync:!1,sorters:[{property:"effectivedate",direction:"DESC"},{property:"productstatusid",direction:"DESC"}]}),Ext.define("PTS.store.ProductSteps",{extend:"Ext.data.Store",model:"PTS.model.ProductStep",autoLoad:!1,autoSync:!1,sorters:[{property:"priority",direction:"ASC"}]}),Ext.define("PTS.store.ProductVectors",{extend:"GeoExt.data.FeatureStore",model:"PTS.model.ProductVector",autoLoad:!1,sorters:["name"]}),Ext.define("PTS.controller.product.window.Window",{extend:"Ext.app.Controller",views:["product.window.Window","product.form.ProductForm"],stores:["OnlineResources","OnlineFunctions","DateTypes","ProductStatuses","ProductSteps","ProductVectors","CommonVectors"],refs:[{ref:"productWindow",selector:"productwindow"},{ref:"productForm",selector:"productwindow productform"},{ref:"productMap",selector:"productwindow projectmap"},{ref:"featureGrid",selector:"productwindow #featureGrid"}],init:function(){var a=this.getController("product.form.ProductForm"),b=this.getController("product.window.ProductContacts"),c=this.getController("product.window.ProductMetadata"),d=this.getController("product.window.ProductKeywords"),e=this.getController("product.window.ProductSteps");a.init(),b.init(),d.init(),c.init(),e.init(),this.control({"productwindow [action=closewindow]":{click:this.closeWindow},productwindow:{beforeclose:this.onBeforeClose},"productwindow gridform":{loadrecord:this.onGridFormLoadRecord},"productwindow>tabpanel>roweditgrid":{edit:this.onRowEdit},"productwindow projectmap":{beforerender:this.onProductMapBeforeRender,afterlayout:this.onProductMapAfterLayout},"productwindow projectmap maptoolbar":{beforerender:this.onMapToolbarBeforeRender},"productwindow projectmap maptoolbar #addFeature menuitem":{click:this.onAddFeatureMenuClick},"productwindow projectmap maptoolbar button#modify":{toggle:this.onModifyBtnToggle},"productwindow #featureGrid gridview":{viewready:this.onFeatureGridReady},"productwindow #featureGrid":{deselect:this.onFeatureGridDeselect}})},closeWindow:function(){this.getProductWindow().close()},onBeforeClose:function(){this.getProductVectorsStore().unbind(),this.application.fireEvent("closeproduct")},onGridFormLoadRecord:function(a){var b=this.getProductWindow().productId;a.get("productid")||a.set("productid",b)},onRowEdit:function(a,b){var c=this.getProductWindow().productId,d=a.record;d.set("productid",c),d.set("contactid",PTS.user.get("contactid")),a.store.sync()},onCommentRowEdit:function(a,b){var c=this.getProductForm().getRecord(),d=c.getId();a.record.set("productid",d),a.store.sync()},onMapToolbarBeforeRender:function(a){a.maskCmp=this.getProductMap().ownerCt},onAddFeatureMenuClick:function(a,b){var c=this.getCommonVectorsStore().getById(a.itemId),d=c.get("wkt");d&&this.getProductMap().addVector(d)},onProductMapAfterLayout:function(a){a.projectVectors.protocol.options.params={productid:this.getProductWindow().productId},a.projectVectors.events.on({beforedeletetoggle:function(a){a.feature.state!==OpenLayers.State.DELETE&&this.getSelectionModel().deselect(this.getStore().getByFeature(a.feature),!0)},deletetoggle:function(a){var b=this.getStore().getByFeature(a.feature),c=this.getView().getNode(b),d=Ext.get(c);a.feature.state===OpenLayers.State.DELETE?d&&d.addCls("pts-delete-highlight"):d&&d.removeCls("pts-delete-highlight")},loadstart:function(b){a.ownerCt.getEl().mask("Loading product features...")},loadend:function(b){var c,d,e,f=b.response;f.code!==OpenLayers.Protocol.Response.SUCCESS&&PTS.app.showError("There was an error loading the features.</br>Error: "+Ext.decode(f.priv.responseText).message),a.zoomOnLoad&&b.object.features.length&&(c=b.object.getDataExtent(),d=a.map,e=d.getZoomForExtent(c),e<=a.maxZoomOnLoad?d.zoomToExtent(c):d.setCenter(c.getCenterLonLat(),a.maxZoomOnLoad,!1,!1)),a.zoomOnLoad=!1,a.ownerCt.getEl().unmask()},refresh:function(a){this.getSelectionModel().deselectAll()},ptsfeaturesupdated:function(a){var b,c=this.getStore(),d=a.requestType.toLowerCase();"create"===d?(b=a.reqFeatures,"array"!==Ext.typeOf(b)&&(b=[b]),Ext.each(b,function(a){c.getById(a.id).commit()})):(b=a.features,Ext.each(b,function(a){c.data.findBy(function(b){return b.raw.fid===a.fid}).commit()}))},scope:this.getFeatureGrid()}),a.projectVectors.setVisibility(!0)},onProductMapBeforeRender:function(a){var b,c=this.getFeatureGrid();b=new OpenLayers.Control.SelectFeature(a.projectVectors,{id:"PTS-Select-Hover",hover:!0,highlightOnly:!0,renderIntent:"temporary",unhighlight:function(a){var b=a.layer;!1!==this.events.triggerEvent("beforefeatureunhighlighted",{feature:a})&&(void 0===a._prevHighlighter?delete a._lastHighlighter:a._prevHighlighter==this.id?delete a._prevHighlighter:(a._lastHighlighter=a._prevHighlighter,delete a._prevHighlighter),b.drawFeature(a,a.style||a.layer.style||"default"),this.events.triggerEvent("featureunhighlighted",{feature:a}))},overFeature:function(a,b){var d=a.layer;if(this.hover&&(this.highlightOnly?this.highlight(a):-1==OpenLayers.Util.indexOf(d.selectedFeatures,a)&&this.select(a)),!b){var e=c.getStore().getByFeature(a),f=c.getView().getNode(e),g=Ext.get(f);g&&g.addCls("pts-vector-highlight")}},outFeature:function(a){if(this.hover){if(this.highlightOnly){if(!1!==this.events.triggerEvent("beforefeatureunhighlighted",{feature:a})&&a._lastHighlighter==this.id)if(a._prevHighlighter&&a._prevHighlighter!=this.id){delete a._lastHighlighter;var b=this.map.getControl(a._prevHighlighter);b&&b.highlight(a)}else this.unhighlight(a)}else this.unselect(a);var d=c.getStore().getByFeature(a),e=c.getView().getNode(d),f=Ext.get(e);f&&f.removeCls("pts-vector-highlight")}}}),b.events.on({beforefeatureunhighlighted:function(a){var c=b.map.getControlsBy("id","PTS-Modify-Feature")[0].feature;if(b.highlightOnly&&a.feature===c)return b.layer.drawFeature(a.feature,"select"),!1},beforefeaturehighlighted:function(a){if("vertex"===a.feature.renderIntent){var c=b.map.getControlsBy("id","PTS-Modify-Feature")[0].feature;return!(!b.highlightOnly||a.feature!==c)&&(b.layer.drawFeature(a.feature,"temporary"),!1)}},scope:this}),a.map.addControl(b),b.activate(),this.getProductVectorsStore().bind(a.projectVectors)},onModifyBtnToggle:function(a,b){var c,d=this.getFeatureGrid().getSelectionModel().selected;b&&1===d.length&&(c=a.up("projectmap").map,c.getControlsBy("id","PTS-Modify-Feature")[0].selectControl.select(d.first().raw))},onFeatureGridReady:function(a){var b,c,d=a.getSelectionModel().selectControl,e=(this.getProductMap().map.getControlsBy("id","PTS-Select-Hover")[0],a.getStore()),f=a.ownerCt.getPlugin("cellEdit");d.onSelect=function(a){b=this.map.getControlsBy("id","PTS-Modify-Feature")[0],b.active&&b.selectFeature(a)},c=function(b,c){Ext.each(c,function(b){b.beginEdit(),b.set("productid",a.up("productwindow").productId),b.endEdit()})},e.on({add:c,load:c}),f.on({beforeedit:function(a){if(a.record.raw.state===OpenLayers.State.DELETE)return!1}}),a.ownerCt.on({beforeselect:function(a,b){if(b.raw.state===OpenLayers.State.DELETE)return!1}}),a.on({itemmouseenter:function(a,b){if(a.ownerCt.getPlugin("cellEdit").activeRecord!==b){b.raw.layer.map.getControlsBy("id","PTS-Select-Hover")[0].overFeature(b.raw,!0)}},itemmouseleave:function(a,b){var c,d=b.raw.layer,e=d.map;a.ownerCt.getPlugin("cellEdit").activeRecord!==b?(c=e.getControlsBy("id","PTS-Select-Hover")[0],c.outFeature(b.raw)):d.drawFeature(b.raw,"select")},destroy:function(a){e.un("add",c,e),e.un("load",c,e)},scope:this})},onFeatureGridDeselect:function(a,b,c){a.view.ownerCt.getPlugin("cellEdit").completeEdit(),a.selectControl.unselect(b.raw)}}),Ext.define("PTS.store.Products",{extend:"Ext.data.Store",model:"PTS.model.Product",remoteSort:!0,remoteFilter:!0,pageSize:PTS.Defaults.pageSize,sorters:[{property:"projectcode",direction:"DESC"},{property:"productgroup",direction:"ASC"},{property:"title",direction:"ASC"}]}),Ext.define("PTS.controller.product.tab.ProductList",{extend:"Ext.app.Controller",stores:["Products","ProjectIDs"],models:["Product"],views:["product.tab.ProductList"],refs:[{ref:"productList",selector:"producttab > productlist"}],init:function(){this.control({productlist:{itemdblclick:this.editProduct,viewready:this.onProductListReady,select:this.onProductListSelect}}),this.application.on({saveproduct:this.onSaveProduct,deleteproduct:this.onDeleteProduct,scope:this})},editProduct:function(a,b){this.getController("product.Product").openProduct(b)},onProductListReady:function(a){var b=a.getStore();b&&b.on("load",function(a,b,c,d){a.count()>0&&this.getSelectionModel().select(0)},a),b.load()},onProductListSelect:function(a,b){this.application.fireEvent("productlistselect",b)},onSaveProduct:function(a,b){var c,d,e=this.getProductsStore(),f=this.getProductModel(),g=a.getId(),h=a.get("projectid");c=e.indexOfId(g),-1===c?(d=Ext.create(f),e.insert(0,d)):d=e.getAt(c),d.fields.each(function(b){d.set(b.name,a.get(b.name))});var i=h?this.getProjectIDsStore().getById(h).get("projectcode"):"None";d.set("projectcode",i),d.commit()},onDeleteProduct:function(a,b){var c=this.getProductsStore();Ext.each(b.records,function(a){var b=a.getId();c.remove(c.getById(b))})}}),Ext.define("PTS.store.IsoProgressTypes",{extend:"Ext.data.Store",fields:[{name:"isoprogresstypeid",type:"int"},{name:"codename",type:"string"},{name:"description"},{name:"product",type:"myboolean"}],proxy:{type:"rest",url:PTS.baseURL+"/productprogresstype",reader:{type:"json",root:"data"},limitParam:void 0},autoLoad:!0,sorters:[{property:"codename",direction:"ASC"}]}),Ext.define("PTS.model.MaintenanceFrequency",{extend:"PTS.model.Base",fields:[{name:"maintenancefrequencyid",type:"int",persist:!1},{name:"code",type:"mystring",useNull:!0},{name:"codename",type:"mystring",useNull:!0},{name:"description",type:"mystring",useNull:!0}],idProperty:"maintenancefrequencyid",proxy:{type:"rest",url:PTS.baseURL+"/maintenancefrequency",reader:{type:"json",root:"data"}}}),Ext.define("PTS.store.MaintenanceFrequencies",{extend:"Ext.data.Store",model:"PTS.model.MaintenanceFrequency",proxy:{type:"rest",url:PTS.baseURL+"/maintenancefrequency",reader:{type:"json",root:"data"},limitParam:void 0},autoLoad:!0,sorters:[{property:"code",direction:"ASC"}]}),Ext.define("PTS.controller.product.form.ProductForm",{extend:"Ext.app.Controller",mixins:{fixQuery:"PTS.util.mixin.FixRemoteQuery"},views:["product.form.ProductForm"],models:["Product"],stores:["ProjectIDs","IsoProgressTypes","MaintenanceFrequencies"],refs:[{ref:"productForm",selector:"productform"}],init:function(){this.control({"productform button[action=saveproduct]":{click:this.saveProduct},"productform button[action=resetproduct]":{click:this.resetProduct},"productform button[action=deleteproduct]":{click:this.confirmDelete},"productform combobox[queryMode=remote]":{beforequery:this.fixRemoteQuery}}),this.application.on({openproduct:this.onOpenProduct,scope:this})},onOpenProduct:function(a){this.loadRecord(a)},onLoadProduct:function(a){this.application.fireEvent("loadproduct",a)},onSaveProduct:function(a,b){this.application.fireEvent("saveproduct",a,b)},onDeleteProduct:function(a,b){this.application.fireEvent("deleteproduct",a,b)},saveProduct:function(){var a=this.getProductForm().getForm(),b=this.getProductForm().getEl(),c=a.getRecord();b.mask("Saving..."),a.updateRecord(c),c.save({success:function(a,c){var d=this.getProductForm();d.loadRecord(a),d.up("window").productId=a.getId(),b.unmask(),this.onSaveProduct(a,c)},failure:function(a,c){b.unmask(),Ext.MessageBox.show({title:"Error",msg:"There was an error saving the product.</br>Error:"+PTS.app.getError(),buttons:Ext.MessageBox.OK,icon:Ext.Msg.ERROR})},scope:this})},confirmDelete:function(a){var b=a.getEl(),c=function(a){"yes"===a&&this.deleteProduct()};Ext.MessageBox.show({title:"Confirm Deletion",msg:"Are you sure you want to delete this product?",buttons:Ext.MessageBox.YESNO,icon:Ext.Msg.WARNING,fn:c,scope:this,animateTarget:b})},deleteProduct:function(){var a=this.getProductForm().getForm(),b=this.getProductForm().getEl(),c=a.getRecord();b.mask("Deleting..."),c.destroy({success:function(a,c){b.unmask(),this.onDeleteProduct(a,c),this.getProductForm().up("window").close()},failure:function(a,c){b.unmask(),Ext.MessageBox.show({title:"Error",msg:"There was an error deleting the product.</br>Error:"+PTS.app.getError(),buttons:Ext.MessageBox.OK,icon:Ext.Msg.ERROR})},scope:this})},resetProduct:function(){this.getProductForm().getForm().reset()},loadRecord:function(a){var b=this,c=this.getProductModel(),d=this.getProductForm();a?c.load(a,{success:function(a){d.loadRecord(a),b.onLoadProduct(a)},failure:function(a,b){Ext.MessageBox.show({title:"Error",msg:"There was an error loading the product.</br>Error:"+PTS.app.getError(),buttons:Ext.MessageBox.OK,icon:Ext.Msg.ERROR})}}):(d.loadRecord(Ext.create(c)),b.onLoadProduct(d.getForm().getRecord()))}}),Ext.define("PTS.model.ProductContact",{extend:"PTS.model.Base",fields:[{name:"productcontactid",type:"int",persist:!1,useNull:!0},{name:"contactid",type:"int",useNull:!0},{name:"productid",type:"int",useNull:!0},{name:"isoroletypeid",type:"int",useNull:!0},{name:"name",persist:!1},{name:"role",persist:!1},{name:"namerole",type:"string",persist:!1,convert:function(a,b){return b.get("name")+"("+b.get("role")+")"}}],idProperty:"productcontactid",proxy:{type:"rest",url:PTS.baseURL+"/productcontact",appendId:!0,reader:{type:"json",root:"data"}}}),Ext.define("PTS.store.ProductContacts",{extend:"Ext.data.Store",model:"PTS.model.ProductContact",requires:[],autoLoad:!1}),Ext.define("PTS.store.IsoRoleTypes",{extend:"Ext.data.Store",fields:[{name:"isoroletypeid",type:"int"},{name:"codename",type:"string"},{name:"description"}],proxy:{type:"rest",url:PTS.baseURL+"/isoroletype",reader:{type:"json",root:"data"},limitParam:void 0},autoLoad:!0,sorters:[{property:"codename",direction:"ASC"}]}),Ext.define("PTS.controller.product.window.ProductContacts",{extend:"Ext.app.Controller",requires:["PTS.view.controls.ReorderColumn"],views:["product.window.ProductContacts"],models:["ProductContact"],stores:["ProductContacts","ContactGroups","DDContactGroups","Persons","IsoRoleTypes","DDPersons"],refs:[{ref:"productContacts",selector:"productcontacts"},{ref:"contactLists",selector:"productcontacts #contactLists"},{ref:"productContactsList",selector:"productcontacts #productContactsList"}],init:function(){this.control({productcontacts:{activate:this.activate},"productcontacts button[action=addcontacts]":{click:this.addContacts},"productcontacts button[action=removecontacts]":{click:this.removeContacts},"productcontacts button[action=savecontacts]":{click:this.saveContacts},"productcontacts button[action=refreshcontacts]":{click:this.refreshContacts},"productcontacts #contactLists > gridpanel":{activate:this.activateList,beforerender:this.beforeRenderContactLists},"productcontacts #contactLists > gridpanel > gridview":{beforedrop:this.removeContactsByDrag},"productcontacts #productContactsList > gridview":{afterrender:this.afterRenderProductContactsList,drop:this.dropProductContactsList},"productcontacts #productContactsList":{beforerender:this.beforeRenderProductContactsList},"combo[itemId=roletypeCbxProduct]":{select:this.onSelectRoleType}}),this.application.on({openproduct:this.onOpenProduct,saveproduct:this.onSaveProduct,scope:this})},dropProductContactsList:function(a,b){var c=this.getProductContactsStore().indexOf(b.records[0]);this.getProductContactsList().getPlugin("contactEditor").startEditByPosition({row:c,column:2})},setProxy:function(a,b){b.setProxy({type:"rest",url:PTS.baseURL+"/productcontact",appendId:!0,api:{read:PTS.baseURL+"/product/"+a+"/productcontactlist"},reader:{type:"json",root:"data"}})},onOpenProduct:function(a){var b=this.getProductContactsStore();a&&(this.setProxy(a,b),b.load())},onSelectRoleType:function(a,b){this.getProductContactsList().getPlugin("contactEditor").completeEdit()},onSaveProduct:function(a){var b=this.getProductContactsStore(),c=a.getId();c&&(this.setProxy(c,b),b.load())},activate:function(a){},activateList:function(a){var b=a.getStore();0===b.getCount()&&b.load()},beforeRenderContactLists:function(a){var b=Ext.create("Ext.grid.column.Column",a.getSelectionModel().getHeaderConfig());a.headerCt.insert(0,b)},saveContacts:function(){var a=this.getProductContactsStore(),b=this.getProductContactsList().getEl(),c=!!(a.getRemovedRecords().length+a.getUpdatedRecords().length+a.getNewRecords().length);-1===a.findExact("isoroletypeid",null)?(c&&b.mask("Saving..."),a.each(function(){var b=this,c=b.get("priority"),d=a.indexOf(b);c!==d&&b.set("priority",d)}),a.getBatchListeners=function(){var c=a,d={scope:c,exception:function(a,c){b.unmask(),Ext.MessageBox.show({title:"Error",msg:"There was an error saving the contacts.</br>Error:"+PTS.app.getError(),buttons:Ext.MessageBox.OK,icon:Ext.Msg.ERROR})}};return"operation"==c.batchUpdateMode?d.operationcomplete=c.onBatchOperationComplete:d.complete=c.onBatchComplete,d},a.sync({success:function(){b.unmask()},failure:function(){b.unmask(),
Ext.MessageBox.show({title:"Error",msg:"There was an error saving the contacts.</br>Error:"+PTS.app.getError(),buttons:Ext.MessageBox.OK,icon:Ext.Msg.ERROR})},callback:function(){}})):PTS.app.showError("All contacts must be assigned a role before saving.")},removeContacts:function(){var a=this.getProductContactsList(),b=a.getSelectionModel().getSelection();a.getStore().remove(b)},refreshContacts:function(){var a=this.getProductContactsList();a.getStore().load({callback:function(b,c,d){a.getStore().removed=[]}})},addContacts:function(){var a=this.getContactLists().getActiveTab(),b=a.getSelectionModel().getSelection(),c={copy:!0,view:a.getView(),records:b},d=this.getProductContactsList();d.getView().getPlugin("contactsddplugin").dropZone.handleNodeDrop(c),d.getView().fireEvent("drop",null,c,null,null)},removeContactsByDrag:function(a,b,c,d,e){return this.getProductContactsStore().remove(b.records),!1},beforeRenderProductContactsList:function(a){var b=Ext.create("Ext.grid.column.Column",a.getSelectionModel().getHeaderConfig());a.headerCt.insert(0,b)},afterRenderProductContactsList:function(a){a.getPlugin("contactsddplugin").dropZone.handleNodeDrop=function(a,b,c){var d,e,f,g,h=this.view,i=h.getStore(),j=h.up("productwindow").productId;if(a.copy){for(e=a.records,a.records=[],f=0,g=e.length;f<g;f++){var k=e[f].data;void 0===k.name&&(k.name=k.lastname+", "+k.firstname);var l=Ext.create("PTS.model.ProductContact",{name:k.name,isoroletypeid:"",contactid:k.contactid,productid:j});l.phantom=!0,a.records.push(l)}a.view.getSelectionModel().deselect(e)}else a.view.store.remove(a.records,a.view===h);d=i.indexOf(b),"before"!==c&&d++,i.insert(d,a.records),h.getSelectionModel().select(a.records)}}}),Ext.define("PTS.model.ProductMetadata",{extend:"PTS.model.Base",fields:[{name:"productid",type:"int",persist:!1},{name:"topiccategory",type:"auto",useNull:!0,convert:function(a){return Ext.isString(a)?a.split(","):a}},{name:"spatialformat",type:"auto",useNull:!0,convert:function(a){return Ext.isString(a)?a.split(","):a}},{name:"epsgcode",type:"auto",useNull:!0,convert:function(a){return Ext.isString(a)?a.split(","):a}},{name:"wkt",type:"string"}],idProperty:"productid",proxy:{type:"rest",url:PTS.baseURL+"/productmetadata",reader:{type:"json",root:"data"}}}),Ext.define("PTS.model.EpsgCode",{extend:"PTS.model.Base",fields:[{name:"srid",type:"int",persist:!1},{name:"srid_text",type:"mystring",persist:!1},{name:"name",type:"mystring",useNull:!0}],idProperty:"srid",proxy:{type:"rest",url:PTS.baseURL+"/epsg",reader:{type:"json",root:"data"}}}),Ext.define("PTS.store.SpatialFormats",{extend:"Ext.data.Store",fields:[{name:"spatialformatid",type:"int"},{name:"codename",type:"string"},{name:"description"}],proxy:{type:"rest",url:PTS.baseURL+"/spatialformat",reader:{type:"json",root:"data"},limitParam:void 0},autoLoad:!0,sorters:[{property:"codename",direction:"ASC"}]}),Ext.define("PTS.store.EpsgCodes",{extend:"Ext.data.Store",model:"PTS.model.EpsgCode",autoLoad:!1,remoteSort:!0,remoteFilter:!0,sorters:[{property:"srid",direction:"ASC"}]}),Ext.define("PTS.controller.product.window.ProductMetadata",{extend:"Ext.app.Controller",requires:[],mixins:{fixQuery:"PTS.util.mixin.FixRemoteQuery"},views:["product.window.ProductMetadata"],models:["Product","ProductMetadata"],stores:["TopicCategories","EpsgCodes","SpatialFormats"],refs:[{ref:"productMetadata",selector:"productmetadata"},{ref:"metadataForm",selector:"productmetadata productmetadataform"},{ref:"metadataPreview",selector:"productmetadata #metadataPreview"}],init:function(){this.control({productmetadata:{activate:this.activate},"productmetadata button[action=goback]":{click:this.clickBack},"productmetadata button[action=openpreview]":{click:this.openPreview},"productmetadata button[action=json]":{click:this.clickPreview},"productmetadata button[action=xml]":{click:this.clickPreview},"productmetadata button[action=html]":{click:this.clickPreview},"productmetadata button[action=reset]":{click:this.clickReset},"productmetadata button[action=save]":{click:this.clickSave},"productmetadata #publishBtn":{change:this.publish},"productmetadata productmetadataform":{validitychange:this.onValidityChange},"productmetadata productmetadataform combobox[queryMode=remote]":{beforequery:this.fixRemoteQuery}}),this.application.on({loadproduct:this.onLoadProduct,saveproduct:this.onLoadProduct,scope:this})},onValidityChange:function(a,b){var c=this.getProductMetadata().down("button[action=save]");b?c.enable():c.disable()},onDirtyChange:function(a,b){var c=this.getProductMetadata().down("button[action=save]"),d=this.getProductMetadata().down("button[action=reset]");b?(d.enable(),a.isValid()&&c.enable()):(d.disable(),c.disable())},onLoadProduct:function(a){var b=a.get("exportmetadata")?1:0,c=this.getProductMetadata().down("#publishBtn"),d=c.menu.items,e=a.get("productid"),f=this.getProductMetadataModel(),g=this.getMetadataForm();c.setActiveItem(d.get(b),!0),e&&(g.setLoading(!0,!0),f.load(e,{success:function(a){g.loadRecord(a),g.setLoading(!1)}}))},activate:function(a){},clickReset:function(a){this.getMetadataForm().getForm().reset()},clickSave:function(a){var b=this.getMetadataForm().getForm(),c=this.getMetadataForm().getEl(),d=b.getRecord();c.mask("Saving..."),b.updateRecord(d),d.save({success:function(a,b){this.getMetadataForm().loadRecord(a),c.unmask()},failure:function(a,b){c.unmask(),Ext.create("widget.uxNotification",{title:"Error",iconCls:"ux-notification-icon-error",html:"There was an error saving the product metadata.</br>Error: "+PTS.app.getError()}).show()},scope:this})},clickBack:function(a){this.getProductMetadata().getLayout().setActiveItem(0)},clickPreview:function(a){var b=this.getMetadataPreview(),c=b.getEl(),d=b.up("productwindow").productId,e=this.getProductMetadata(),f=e.getLayout(),g=e.down("button[action=openpreview]");f.setActiveItem(1),f.getActiveItem().body.scrollTo("top",0),c.mask("Generating Preview..."),g.previewType=a.action,c.child("code").load({url:"/product/"+d+"/metadata."+a.action+"?pretty=1",renderer:function(b,d){b.getTarget().update(hljs.highlight(a.action,d.responseText).value),c.unmask()}})},openPreview:function(a){var b=a.up("productwindow").productId;window.open("/product/"+b+"/metadata."+a.previewType+"?pretty=1","_blank",null,!0)},publish:function(a){var b=a.up("productwindow"),c=b.down("productform").getForm().getRecord(),d=a.getActiveItem().action,e=b.productId;a.disable(),Ext.Ajax.timeout=18e4,Ext.Ajax.request({url:"/product/"+e+"/metadata/publish",timeout:18e4,method:d,success:function(a,b){c.set("exportmetadata","DELETE"===d?0:1),c.save({failure:function(a,b){Ext.create("widget.uxNotification",{title:"Error",iconCls:"ux-notification-icon-error",html:"The metadata was "+d=="DELETE"?"unpublished":"published. However, there was an error saving the product.</br>Error:"+PTS.app.getError()}).show()}})},failure:function(b){var c=a.menu.items;a.setActiveItem(c.get("DELETE"===d?1:0),!0),Ext.create("widget.uxNotification",{title:"Error",iconCls:"ux-notification-icon-error",html:"There was an error publishing the metadata.</br>Error:"+PTS.app.getError()}).show()},callback:function(b,c){a.enable()}})}}),Ext.define("PTS.model.ProductKeyword",{extend:"PTS.model.Base",fields:[{name:"productkeywordid",type:"integer",useNull:!0,persist:!1},{name:"keywordid",type:"mystring",useNull:!0},{name:"productid",type:"integer",useNull:!0},{name:"text",type:"mystring",useNull:!0,persist:!1},{name:"definition",type:"mystring",useNull:!0,persist:!1}],idProperty:"productkeywordid",proxy:{type:"rest",url:PTS.baseURL+"/productkeyword",api:{read:PTS.baseURL+"/productkeywordlist"},reader:{type:"json"},appendId:!0}}),Ext.define("PTS.store.ProductKeywords",{extend:"Ext.data.Store",model:"PTS.model.ProductKeyword",clearOnLoad:!0,autoLoad:!1,sorters:{property:"text",direction:"ASC"}}),Ext.define("PTS.controller.product.window.ProductKeywords",{extend:"Ext.app.Controller",views:["product.window.ProductKeywords"],models:["KeywordNode","ProductKeyword"],stores:["KeywordNodes","ProductKeywords","Keywords"],refs:[{ref:"productWindow",selector:"productwindow"},{ref:"keywordTree",selector:"productwindow productkeywords #keywordTree"},{ref:"keywordSearch",selector:"productwindow productkeywords #keywordSearch"},{ref:"productKeywords",selector:"productwindow #productKeywords"}],init:function(){this.control({"productwindow productkeywords #keywordTree":{render:this.onRemoveTargetRender},"productwindow productkeywords #keywordSearch":{render:this.onRemoveTargetRender},"productwindow #productKeywords gridview":{itemadd:this.onItemAdd,beforedrop:this.onBeforeDrop},"productwindow productkeywords button[action=removekeywords]":{render:this.onRemoveTargetRender,click:this.removeKeywords},"productwindow productkeywords button[action=savekeywords]":{click:this.saveKeywords},"productwindow productkeywords button[action=refreshkeywords]":{click:this.refreshKeywords},"productwindow productkeywords templatecolumn[action=addkeyword]":{click:this.onActionAddClick}}),this.application.on({openproduct:this.onOpenProduct,saveproduct:this.onSaveProduct,scope:this})},setProxy:function(a,b){b.setProxy({type:"rest",url:PTS.baseURL+"/productkeyword",appendId:!0,api:{read:PTS.baseURL+"/product/"+a+"/productkeywordlist"},reader:{type:"json",root:"data"},limitParam:void 0})},onOpenProduct:function(a){var b=this.getProductKeywordsStore();a&&(this.setProxy(a,b),b.load())},onSaveProduct:function(a){var b=this.getProductKeywordsStore();a&&(this.setProxy(a.getId(),b),b.load())},onBeforeDrop:function(a,b,c,d){var e,f,g=this.getProductKeywordsStore(),h=b.records,i=h.length,j="",k=g.getRemovedRecords(),l="before"===d?g.indexOf(c):g.indexOf(c)+1,m=[];for(e=0;e<i;e++)f=h[e],-1!==g.findExact("keywordid",f.getId())?j+="<br /> "+f.get("text"):k.length>0&&Ext.Array.some(k,function(a){if(a.get("keywordid")===f.get("keywordid"))return f=a,!0})?(f.reject(),f.restored=!0,m.push(f),Ext.Array.remove(g.removed,f)):m.push(this.getProductKeywordModel().create({productid:f.get("productid"),keywordid:f.get("keywordid"),text:f.get("text")}));return m.length&&g.insert(l,m),""!==j&&Ext.create("widget.uxNotification",{title:"Notice",iconCls:"ux-notification-icon-information",html:"The following keywords have already been added:<br />"+j}).show(),!1},onItemAdd:function(a,b,c){var d=this.getProductWindow().productId;Ext.each(a,function(a){a.restored||(a.set("productid",d),a.setDirty(),a.phantom=!0)})},removeKeywordsByDrag:function(a,b,c,d,e){return this.getProductKeywordsStore().remove(b.records),!1},onRemoveTargetRender:function(a){var b=this.getProductKeywordsStore();Ext.create("Ext.dd.DropTarget",a.getEl(),{ddGroup:"deletekeywords",notifyDrop:function(a,c,d){return b.remove(d.records),!0}})},saveKeywords:function(){var a=this.getProductKeywordsStore(),b=this.getProductKeywords().getEl();!!(a.getRemovedRecords().length+a.getUpdatedRecords().length+a.getNewRecords().length)&&b.mask("Saving..."),a.getBatchListeners=function(){var c=a,d={scope:c,exception:function(a,c){b.unmask(),PTS.app.setError("There was an error saving the keywords.</br>Error:"+PTS.app.getError())}};return"operation"===c.batchUpdateMode?d.operationcomplete=c.onBatchOperationComplete:d.complete=c.onBatchComplete,d},a.sync({success:function(){b.unmask()},failure:function(){b.unmask(),Ext.create("widget.uxNotification",{title:"Error",iconCls:"ux-notification-icon-error",html:"There was an error saving the keywords.</br>Error:"+PTS.app.getError()}).show()},callback:function(){}})},removeKeywords:function(){var a=this.getProductKeywords(),b=a.getSelectionModel().getSelection();a.getStore().remove(b)},refreshKeywords:function(){var a=this.getProductKeywords();a.getStore().load({callback:function(b,c,d){a.getStore().removed=[]}})},onActionAddClick:function(a,b,c,d){var e=a.getStore().getAt(c),f={records:[e]},g=this.getProductKeywordsStore().last();this.onBeforeDrop(void 0,f,g)}}),Ext.define("PTS.controller.product.window.ProductSteps",{extend:"Ext.app.Controller",requires:["PTS.view.controls.ReorderColumn"],views:["product.window.ProductSteps"],models:["ProductStep"],stores:["ProductSteps","ProductContacts"],refs:[{ref:"stepGrid",selector:"productsteps grid"}],init:function(){this.control({productsteps:{activate:this.activate,beforesaverow:this.updatePriority},"productsteps grid":{beforerender:this.beforeRenderProductStepsList},"productsteps grid reordercolumn":{moverow:this.onReorder},"productsteps grid > gridview":{afterrender:this.afterRenderProductStepsList,drop:this.onReorder}}),this.application.on({openproduct:this.onOpenProduct,scope:this})},setProxy:function(a,b){b.setProxy({type:"rest",url:PTS.baseURL+"/productstep",appendId:!0,api:{read:PTS.baseURL+"/product/"+a+"/productstep"},reader:{type:"json",root:"data"}})},onOpenProduct:function(a){var b=this.getProductStepsStore();a&&(this.setProxy(a,b),b.load())},onReorder:function(){var a=this.getProductStepsStore(),b=this.getStepGrid(),c=b.getView().getSelectionModel(),d=c.getSelection()[0];this.updatePriority(null,a),a.sync({callback:function(){d?c.select(a.indexOfId(d.getId()),!1):c.deselectAll()}})},activate:function(a){var b=a.down("grid").getStore();0===b.getCount()&&b.load()},updatePriority:function(a,b){a&&a.phantom?a.set("priority",b.count()):b.each(function(a){var c=a.get("priority"),d=b.indexOf(a);c!==d&&a.set("priority",d)})},beforeRenderProductStepsList:function(a){a.headerCt.insert(a.headerCt.getColumnCount()+1,{xtype:"reordercolumn",header:"Order"})},afterRenderProductStepsList:function(a){a.getPlugin("stepsddplugin").dropZone.handleNodeDrop=function(a,b,c){var d,e=this.view,f=e.getStore();a.view.store.remove(a.records,a.view===e),d=f.indexOf(b),"before"!==c&&d++,f.insert(d,a.records),e.getSelectionModel().select(a.records)}}}),Ext.define("Ext.ux.grid.GrabField",{extend:"Ext.AbstractPlugin",requires:["Ext.button.Button"],alias:"plugin.pagingtoolbargrabfield",delimiter:", \n",windowTitle:"Data",constructor:function(a){a&&Ext.apply(this,a),this.callParent(arguments)},init:function(a){var b,c=this,d=a.items.indexOf(a.child("#refresh"));b=Ext.create("Ext.button.Button",{text:c.text,iconCls:c.iconCls,tooltip:c.tooltip,scope:c,handler:function(a){var b=a.up("gridpanel"),c=b.getStore(),d=[],e=this;e.dataindex?(c.each(function(a){d.push(a.get(e.dataindex))},e),Ext.Msg.show({title:e.windowTitle,value:d.join(e.delimiter),width:400,defaultTextHeight:300,buttons:Ext.Msg.OK,multiline:!0,animateTarget:a,icon:Ext.window.MessageBox.INFO})):Ext.Error.raise("Ext.ux.grid.GrabField: No dataindex specified.")}}),a.insert(d+1,b),a.on("change",function(a,c){b.setDisabled(!c.total)})}}),Ext.define("PTS.view.contact.GroupList",{extend:"Ext.grid.Panel",alias:"widget.grouplist",requires:["Ext.ux.grid.PrintGrid","Ext.ux.grid.SaveGrid","Ext.ux.grid.FilterBar"],title:"Group",store:"ContactGroups",itemId:"group",initComponent:function(){var a=this;Ext.applyIf(a,{dockedItems:[{xtype:"pagingtoolbar",store:"ContactGroups",displayInfo:!0,plugins:[Ext.create("Ext.ux.grid.PrintGrid",{}),Ext.create("Ext.ux.grid.SaveGrid",{})]}],columns:[{xtype:"gridcolumn",dataIndex:"fullname",text:"Full Name",flex:1},{xtype:"gridcolumn",dataIndex:"name",text:"Name",flex:1,hidden:!0},{xtype:"gridcolumn",dataIndex:"acronym",text:"Acronym"},{xtype:"booleancolumn",dataIndex:"organization",text:"Organization?",trueText:"Yes",falseText:"No"}]}),a.callParent(arguments),a.addDocked({xtype:"filterbar",searchStore:a.store,dock:"bottom"})}}),Ext.define("PTS.view.contact.tab.ContactTabDetail",{extend:"Ext.tab.Panel",alias:"widget.contacttabdetail",requires:["Ext.ux.grid.PrintGrid","Ext.ux.grid.SaveGrid","PTS.view.contact.GroupDDList","PTS.view.contact.PersonDDList"],title:"Contact Details",activeTab:0,initComponent:function(){var a=this;Ext.applyIf(a,{style:{backgroundColor:"#FFF",backgroundImage:"none"},defaults:{layout:"fit"},items:[{xtype:"gridpanel",itemId:"contactProjects",title:"Projects",store:"ContactProjects",dockedItems:[{xtype:"pagingtoolbar",store:"ContactProjects",dock:"top",displayInfo:!0,plugins:[Ext.create("Ext.ux.grid.PrintGrid",{printHidden:!0}),Ext.create("Ext.ux.grid.SaveGrid",{})]}],columns:[{xtype:"gridcolumn",dataIndex:"projectcode",text:"Project"},{xtype:"gridcolumn",dataIndex:"shorttitle",text:"Short Title",flex:2},{xtype:"gridcolumn",dataIndex:"role",flex:1,text:"Role"}]},{xtype:"panel",itemId:"contactLists",getStore:function(){return this.getLayout().getActiveItem().getStore()},title:"Contacts",style:{borderWidth:"1px 0 0 1px",padding:0},activeItem:1,layout:{type:"card"},defaults:{autoScroll:!0,border:0},items:[{xtype:"gridpanel",itemId:"personsList",store:"PersonGroups",uri:"grouppersonfull",columns:[{xtype:"gridcolumn",dataIndex:"firstname",text:"First Name"},{xtype:"gridcolumn",dataIndex:"lastname",text:"Last Name"},{xtype:"gridcolumn",dataIndex:"position",text:"Position",flex:1},{xtype:"gridcolumn",dataIndex:"groupname",flex:1,text:"Name"}]},{xtype:"gridpanel",itemId:"groupsList",store:"PersonGroups",uri:"grouppersonfull",columns:[{xtype:"gridcolumn",dataIndex:"groupfullname",flex:2,text:"Full Name"},{xtype:"gridcolumn",dataIndex:"acronym",text:"Acronym"},{xtype:"gridcolumn",dataIndex:"position",text:"Position",flex:1},{xtype:"gridcolumn",dataIndex:"groupname",flex:1,text:"Name",hidden:!0}]}]}]}),a.callParent(arguments)}}),Ext.define("PTS.view.contact.PersonList",{extend:"Ext.grid.Panel",alias:"widget.personlist",requires:["Ext.ux.grid.PrintGrid","Ext.ux.grid.SaveGrid","Ext.ux.grid.FilterBar","Ext.ux.grid.GrabField"],title:"Person",remoteSort:"true",filterBar:!0,initComponent:function(){var a,b=this;Ext.applyIf(b,{store:"Persons",itemId:"person",columns:[{xtype:"gridcolumn",dataIndex:"firstname",text:"First"},{xtype:"gridcolumn",dataIndex:"lastname",text:"Last"},{xtype:"gridcolumn",dataIndex:"prigroupname",text:"Primary Group",flex:1},{xtype:"gridcolumn",dataIndex:"priemail",text:"E-mail",flex:1},{text:"Phone",defaults:{menuDisabled:!0},columns:[{xtype:"gridcolumn",dataIndex:"pricountryiso",text:"Country",sortable:!0,hidden:!0,width:65},{xtype:"gridcolumn",dataIndex:"priareacode",text:"Area",sortable:!0,width:60},{xtype:"gridcolumn",dataIndex:"priphnumber",text:"Phone",width:100},{xtype:"gridcolumn",dataIndex:"priextension",text:"Ext",width:75}]}]}),b.callParent(arguments),a=[{xtype:"pagingtoolbar",store:b.store,displayInfo:!0,plugins:[Ext.create("Ext.ux.grid.GrabField",{iconCls:"pts-menu-email",dataindex:"priemail",tooltip:"Get all visible e-mail addresses",delimiter:", \n",windowTitle:"E-mail addresses"}),Ext.create("Ext.ux.grid.PrintGrid",{}),Ext.create("Ext.ux.grid.SaveGrid",{})],dock:"top"}],b.filterBar&&a.push({xtype:"filterbar",searchStore:b.store,dock:"bottom"}),b.addDocked(a)}}),Ext.define("PTS.view.contact.tab.ContactTab",{extend:"Ext.panel.Panel",alias:"widget.contacttab",requires:["PTS.view.contact.PersonList","PTS.view.contact.GroupList","PTS.view.contact.tab.ContactTabDetail"],border:0,layout:{type:"border"},title:"Contacts",initComponent:function(){var a=this;Ext.applyIf(a,{dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",iconCls:"pts-menu-add",text:"Add Contact",itemId:"newcontactbtn",action:"addcontact"},{xtype:"button",iconCls:"pts-menu-edit",text:"Edit Contact",itemId:"editcontactbtn",action:"editcontact",disabled:!0}]}],items:[{xtype:"tabpanel",border:0,itemId:"contactList",activeTab:0,flex:1,region:"center",items:[{xtype:"personlist",title:"Person"},{xtype:"grouplist",title:"Group"}]},{xtype:"panel",border:0,width:150,layout:{type:"border"},bodyStyle:{border:"none",backgroundColor:"#FFF",backgroundImage:"none"},collapsible:!0,animCollapse:!Ext.isIE8,preventHeader:!0,title:"Contact Details",flex:1,region:"east",split:!0,items:[{xtype:"contacttabdetail",region:"center",preventHeader:!0}]}]}),a.callParent(arguments)}}),Ext.define("PTS.controller.contact.tab.ContactTab",{extend:"Ext.app.Controller",views:["contact.tab.ContactTab"],refs:[{ref:"personList",selector:"contacttab > personlist"},{ref:"contactTab",selector:"contacttab"}],init:function(){var a=this.getController("contact.tab.ContactList"),b=this.getController("contact.tab.ContactTabDetail");a.init(),b.init(),this.control({"contacttab button[action=addcontact]":{click:this.newContact},"contacttab button[action=editcontact]":{click:this.editContact}}),this.application.on({contactlistselect:this.onContactListSelect,contactlistactivate:this.onContactListActivate,scope:this})},newContact:function(){var a=this.getController("contact.Contact"),b=this.getController("contact.tab.ContactList"),c=b.getContactList().getItemId();a.openContact(c)},editContact:function(){var a=this.getController("contact.Contact"),b=this.getController("contact.tab.ContactList"),c=b.getContactList().getSelectionModel().getSelection()[0],d=c.getContactType();c&&a.openContact(d,c)},onContactListSelect:function(a){this.getContactTab().down("button[action=editcontact]").setDisabled(!a)},onContactListActivate:function(a){var b=a.getSelectionModel().getCount();this.getContactTab().down("button[action=editcontact]").setDisabled(!b)}}),Ext.define("PTS.controller.contact.window.Window",{extend:"Ext.app.Controller",views:["contact.window.Window"],refs:[{ref:"contactWindow",selector:"contactwindow"}],init:function(){this.getController("contact.window.ContactForm").init(),this.control({"contactwindow [action=closewindow]":{click:this.closeWindow}})},closeWindow:function(){this.getContactWindow().close()}}),Ext.define("PTS.controller.contact.tab.ContactList",{extend:"Ext.app.Controller",stores:["Persons","ContactGroups"],views:["contact.PersonList","contact.GroupList","contact.tab.ContactTab"],refs:[{ref:"contactLists",selector:"contacttab > #contactList"}],init:function(){this.control({"contacttab personlist":{itemdblclick:this.editContact,viewready:this.onContactListReady,select:this.onContactListSelect,activate:this.onContactListActivate},"contacttab grouplist":{itemdblclick:this.editContact,viewready:this.onContactListReady,select:this.onContactListSelect,activate:this.onContactListActivate}}),this.application.on({savecontact:this.onSaveContact,deletecontact:this.onDeleteContact,scope:this})},getContactList:function(){return this.getContactLists().getActiveTab()},editContact:function(a,b){var c=this.getController("contact.Contact"),d=b.getContactType();c.openContact(d,b)},onContactListReady:function(a){var b=a.getStore();b&&b.on("load",function(a,b,c,d){a.count()>0&&this.getSelectionModel().select(0)},a),b.load()},onContactListSelect:function(a,b){this.application.fireEvent("contactlistselect",b)},onContactListActivate:function(a){this.application.fireEvent("contactlistactivate",a)},onSaveContact:function(a,b){var c,d,e,f=a.getId();switch(a.getContactType()){case"person":c=this.getPersonsStore();break;case"group":c=this.getContactGroupsStore()}d=c.indexOfId(f),-1===d?c.insert(0,a):(e=c.getAt(d),e.fields.each(function(b){e.set(b.name,a.get(b.name))}),e.commit())},onDeleteContact:function(a,b){var c;switch(b.records[0].getContactType()){case"person":c=this.getPersonsStore();break;case"group":c=this.getContactGroupsStore()}Ext.each(b.records,function(a){var b=a.getId();c.remove(c.getById(b))})}}),Ext.define("PTS.store.ContactProjects",{extend:"Ext.data.Store",model:"PTS.model.ProjectContact",remoteFilter:!0,autoLoad:!1,proxy:{type:"ajax",url:PTS.baseURL+"/projectcontactfull",reader:{type:"json",root:"data"},limitParam:void 0}}),Ext.define("PTS.model.PersonGroup",{extend:"PTS.model.Base",fields:[{name:"contactid",type:"int",persist:!1},{name:"groupid",type:"int",persist:!1},{name:"positionid",type:"int",persist:!1},{name:"firstname",type:"mystring",useNull:!0},{name:"lastname",type:"mystring",useNull:!0},{name:"middlename",type:"mystring",useNull:!0},{name:"suffix",type:"mystring",useNull:!0},{name:"groupfullname",type:"mystring",useNull:!0},{name:"groupname",type:"mystring",useNull:!0},{name:"acronym",type:"mystring",useNull:!0},{name:"position",type:"mystring",useNull:!0},{name:"fullname",convert:function(a,b){return b.data.lastname+", "+b.data.firstname}}],proxy:{type:"ajax",url:PTS.baseURL+"/grouppersonfull",reader:{type:"json",root:"data"},limitParam:void 0}}),Ext.define("PTS.store.PersonGroups",{extend:"Ext.data.Store",model:"PTS.model.PersonGroup",autoLoad:!1}),Ext.define("PTS.controller.contact.tab.ContactTabDetail",{extend:"Ext.app.Controller",stores:["ContactProjects","PersonGroups"],views:["contact.tab.ContactTabDetail"],refs:[{ref:"contactDetail",selector:"contacttab contacttabdetail"},{ref:"contactLists",selector:"contacttab contacttabdetail #contactLists"}],init:function(){this.control({"contacttab contacttabdetail tab":{activate:this.onContactDetailTabActivate},"contacttab contacttabdetail #contactLists":{activate:this.onContactDetailListsActivate}}),this.application.on({contactlistselect:this.onSelectContact,contactlistactivate:this.onContactListActivate,scope:this})},onSelectContact:function(a){var b,c,d=a.getId(),e="group"===a.getContactType()?0:1,f=this.getContactDetail(),g=f.getActiveTab().getStore(),h=this.getContactLists(),i={property:"contactids",value:["where in array",d]},j="Projects for ";0===e?(c={property:"groupids",value:["where in array",d]},h.setTitle("Persons"),j+=a.get("fullname")):(c={property:"contactid",value:d},h.setTitle("Groups"),j+=a.getContactName()),h.rendered&&h.getLayout().setActiveItem(e),b=[[this.getContactProjectsStore(),i],[this.getPersonGroupsStore(),c]],Ext.each(b,function(a){var b=a[0];b.remoteFilter=!1,b.clearFilter(!0),b.filter(a[1]),b.remoteFilter=!0}),g.load(),this.contactRecord=a,this.updateProjectsPrintBtnTitle(j)},onContactListActivate:function(a){var b=a.getSelectionModel().getSelection()[0];b&&this.onSelectContact(b)},onContactDetailTabActivate:function(a){a.card.getStore().load()},onContactDetailListsActivate:function(a){var b="group"===this.contactRecord.getContactType()?0:1;a.getLayout().setActiveItem(b)},updateProjectsPrintBtnTitle:function(a){this.getContactDetail().down("#contactProjects #printBtn").mainTitle=function(){return a}}}),Ext.define("PTS.model.Address",{extend:"PTS.model.Base",fields:[{name:"addressid",type:"int",useNull:!0},{name:"contactid",type:"int",useNull:!0},{name:"addresstypeid",type:"int",useNull:!0},{name:"street1",type:"mystring",useNull:!0},{name:"street2",type:"mystring",useNull:!0},{name:"city",type:"mystring",useNull:!0},{name:"postalcode",type:"mystring",useNull:!0},{name:"postal4",type:"int",useNull:!0},{name:"stateid",type:"int",useNull:!0},{name:"countyid",type:"int",useNull:!0},{name:"countryiso",type:"mystring",useNull:!0},{name:"comment",type:"mystring",useNull:!0},{name:"priority",type:"int",useNull:!0,defaultValue:1}],idProperty:"addressid",proxy:{type:"rest",url:PTS.baseURL+"/address",reader:{type:"json",root:"data"}}}),Ext.define("PTS.model.EAddress",{extend:"PTS.model.Base",fields:[{name:"eaddressid",type:"int",useNull:!0},{name:"contactid",type:"int",useNull:!0},{name:"eaddresstypeid",type:"int",useNull:!0},{name:"uri",type:"mystring",useNull:!0},{name:"priority",type:"int",useNull:!0,defaultValue:1}],idProperty:"eaddressid",proxy:{type:"rest",url:PTS.baseURL+"/eaddress",reader:{type:"json",root:"data"}}}),Ext.define("PTS.model.Phone",{extend:"PTS.model.Base",fields:[{name:"phoneid",type:"int",useNull:!0},{name:"contactid",type:"int",useNull:!0},{name:"phonetypeid",type:"int",useNull:!0},{name:"areacode",type:"int",useNull:!0},{name:"phnumber",type:"int",useNull:!0},{name:"extension",type:"int",useNull:!0},{name:"countryiso",type:"mystring",useNull:!0},{name:"priority",type:"int",useNull:!0,defaultValue:1}],idProperty:"phoneid",proxy:{type:"rest",url:PTS.baseURL+"/phone",reader:{type:"json",root:"data"}}}),Ext.define("PTS.model.ContactType",{extend:"PTS.model.Base",fields:[{name:"contacttypeid",type:"int",persist:!1},{name:"code",type:"mystring",useNull:!0},{name:"title",type:"mystring",useNull:!0},{name:"description",type:"mystring",useNull:!0}],idProperty:"contacttypeid",proxy:{type:"rest",url:PTS.baseURL+"/contacttype",reader:{type:"json",root:"data"}}}),Ext.define("PTS.model.ContactContactGroup",{extend:"PTS.model.Base",fields:[{name:"contactcontactgroupid",type:"int",useNull:!0},{name:"contactid",type:"int",useNull:!0},{name:"groupid",type:"int",useNull:!0},{name:"positionid",type:"int",useNull:!0},{name:"priority",type:"int",useNull:!0,defaultValue:1e4},{name:"name",persist:!1,type:"mystring",useNull:!0}],idProperty:"contactcontactgroupid",proxy:{type:"rest",url:PTS.baseURL+"/contactcontactgroup",appendId:!0,reader:{type:"json",root:"data"}}}),Ext.define("PTS.model.ContactGroupID",{extend:"PTS.model.Base",fields:[{name:"contactid",mapping:"contactid",type:"int",persist:!1},{name:"fullname",type:"mystring",useNull:!0,persist:!1}],idProperty:"contactid"}),Ext.define("PTS.store.ContactTypes",{extend:"Ext.data.Store",model:"PTS.model.ContactType",autoLoad:!0}),Ext.define("PTS.store.ContactContactGroups",{extend:"Ext.data.Store",model:"PTS.model.ContactContactGroup"}),Ext.define("PTS.store.ContactGroupIDs",{extend:"Ext.data.Store",model:"PTS.model.ContactGroupID",remoteSort:!1,autoLoad:!0,sorters:{property:"fullname",direction:"ASC"},proxy:{type:"ajax",url:PTS.baseURL+"/contactgrouplist",reader:{type:"json",root:"data"},limitParam:void 0}}),Ext.define("PTS.controller.contact.window.ContactForm",{extend:"Ext.app.Controller",views:["contact.window.ContactForm","contact.window.PersonGroups"],models:["Person","ContactGroup","Address","EAddress","Phone"],stores:["ContactTypes","ContactContactGroups","ContactGroupIDs","ContactGroups","DDContactGroups","Persons","DDPersons"],refs:[{ref:"contactForm",selector:"contactform"}],init:function(){var a=this.getController("contact.window.PersonGroups"),b=this.getController("contact.window.ContactDetail");a.init(),b.init(),this.control({"contactform button[action=savecontact]":{click:this.saveContact},"contactform button[action=resetcontact]":{click:this.resetContact},"contactform button[action=deletecontact]":{click:this.confirmDelete}}),this.application.on({opencontact:this.onOpenContact,scope:this})},getActiveForm:function(){return this.getContactForm().getLayout().getActiveItem().down("form")},getActiveModel:function(){switch(this.getActiveForm().getItemId()){case"personForm":return this.getPersonModel();case"groupForm":return this.getContactGroupModel();default:Ext.Error.raise("No model found for item!")}},onOpenContact:function(a,b){var c,d,e,f=this.getContactForm();switch(b){case"person":d={title:"Manage Groups",disabled:!a};break;case"group":d={title:"Manage Members",disabled:!a}}c=Ext.create("PTS.view.contact.window.PersonGroups",d),e=function(){f.getLayout().setActiveItem(b),this.loadRecord(a),f.getLayout().getActiveItem().add(c)},f.rendered?e.call(this):f.on("render",e,this,{single:!0})},onSaveContact:function(a,b){var c,d;"PTS.model.ContactGroup"===Ext.getClassName(a)&&(d=this.getContactGroupIDsStore(),c=d.getById(a.getId()),c?c.set("fullname",a.get("fullname")):d.add(a),d.sort()),this.application.fireEvent("savecontact",a,b)},onDeleteContact:function(a,b){var c,d;"PTS.model.ContactGroup"===Ext.getClassName(a)&&(d=this.getContactGroupIDsStore(),c=d.getById(a.getId()),d.remove(c)),this.application.fireEvent("deletecontact",a,b)},onLoadContact:function(a,b){this.application.fireEvent("loadcontact",a,b)},saveFieldSet:function(a,b,c){var d,e;if(b.isDirty()&&b.isValid())if(e=parseInt(b.down("#recordId").getValue(),10),d=a.getById(e))d.beginEdit(),Ext.each(b.query("field"),function(){d.set(this.name,this.getValue())}),d.endEdit();else{var f={};Ext.each(b.query("field"),function(){f[this.name]=this.getValue()}),Ext.applyIf(f,c),d=a.add(f),d[0].setDirty()}},saveParentGroup:function(a,b,c){var d;if(b.isValid()&&b.isDirty())if(parseInt(b.getValue(),10),d=a.getAt(0))d.beginEdit(),d.set("groupid",b.getValue()),d.endEdit();else{var e={contactid:c,groupid:b.getValue(),positionid:0,priority:1};d=a.add(e),d[0].setDirty()}},deleteFieldSet:function(a,b){var c,d,e;d=parseInt(b.down("#recordId").getValue(),10),(c=a.getById(d))&&a.remove(c),
(e=b.down("checkboxfield#delete"))&&e.disable()},deleteParentGroup:function(a){var b;(b=a.getAt(0))&&a.remove(b)},saveAllFieldSets:function(a,b,c){var d,e,f=a||this.getActiveForm(),g=b||f.getForm(),h=c||g.getRecord(),i=[{type:"fax",val:"1"},{type:"office",val:"3"},{type:"mobile",val:"2"}],j=[{type:"mail",val:"1"},{type:"physical",val:"2"}],k=[{type:"web",val:"2"},{type:"email",val:"1"}];Ext.each(j,function(a){d=h.addresses(),e=f.down("fieldset#"+a.type+"Address"),e.down("checkboxfield#delete").getValue()?this.deleteFieldSet(d,e):this.saveFieldSet(d,e,{addresstypeid:a.val})},this),Ext.each(k,function(a){d=h.eaddresses(),e=f.down("fieldcontainer#"+a.type+"Address"),""===Ext.String.trim(e.down("textfield[name=uri]").getValue())&&e.isDirty()?this.deleteFieldSet(d,e):this.saveFieldSet(d,e,{eaddresstypeid:a.val})},this),Ext.each(i,function(a){d=h.phones(),e=f.down("fieldcontainer#"+a.type+"Phone"),e.down("checkboxfield#delete").getValue()?this.deleteFieldSet(d,e):this.saveFieldSet(d,e,{phonetypeid:a.val})},this),(e=f.down("field#parentGroup"))&&(d=h.contactcontactgroups(),null===e.getValue()&&e.isDirty()?this.deleteParentGroup(d,e):this.saveParentGroup(d,e,h.getId()))},saveContact:function(){var a=this.getActiveForm(),b=a.getForm(),c=b.getRecord();a.getEl().mask("Saving..."),b.updateRecord(c),this.saveAllFieldSets(a,b,c),c.save({success:function(c,d){Ext.each(a.query("field"),function(){this.setValue(""),this.clearInvalid()}),b.loadRecord(c),this.loadRecordDetails(c,a),Ext.each(this.getActiveForm().query("field"),function(){this.resetOriginalValue()}),this.onSaveContact(c,d),a.getEl().unmask()},failure:function(b,d){c.associations.items.length&&c.associations.each(function(a){var b=c[a.name]();b.remove(b.getNewRecords())},this),a.getEl().unmask(),Ext.MessageBox.show({title:"Error",msg:"There was a problem saving the contact.</br>"+PTS.app.getError(),buttons:Ext.MessageBox.OK,animateTarget:a.down("button[action=savecontact]").getEl(),icon:Ext.Msg.ERROR})},scope:this})},confirmDelete:function(a){var b=a.getEl(),c=function(a){"yes"===a&&this.deleteContact()};Ext.MessageBox.show({title:"Confirm Deletion",msg:"Are you sure you want to delete this contact?",buttons:Ext.MessageBox.YESNO,icon:Ext.Msg.WARNING,fn:c,scope:this,animateTarget:b})},deleteContact:function(){var a=this.getActiveForm().getForm(),b=a.getRecord();b.destroy({success:function(a,c){this.onDeleteContact(b,c),this.getContactForm().up("window").close()},scope:this})},resetContact:function(){var a=this.getActiveForm(),b=a.getForm(),c=b.getRecord();c.associations.items.length&&c.associations.each(function(a){c[a.name]().rejectChanges()}),c.reject(),b.reset()},loadFieldSet:function(a,b,c){var d=b.items.get("delete");c&&(c.setValue(!0),c.resetOriginalValue()),Ext.each(b.query("field"),function(){var b,c=this,d=this.getName();void 0!==(b=a.get(d))&&(c.setValue(b),c.resetOriginalValue())}),d&&d.enable()},loadRecord:function(a){var b=this.getActiveModel(),c=this.getActiveForm();a?(c.getEl().mask("Loading..."),b.load(a,{success:function(a){c.loadRecord(a),this.loadRecordDetails(a,c),this.onLoadContact(c,a),c.getEl().unmask()},failure:function(a,b){c.getEl().unmask(),Ext.MessageBox.show({title:"Error",msg:"The was a problem loading the record.</br>Error:"+PTS.app.getError(),buttons:Ext.MessageBox.OK,icon:Ext.Msg.ERROR})},scope:this})):c.loadRecord(Ext.create(b))},loadRecordDetails:function(a,b){var c,d,e,f=[{type:"fax",val:"1"},{type:"office",val:"3"},{type:"mobile",val:"2"}],g=[{type:"web",val:"2"},{type:"email",val:"1"}];a.addresses().count()&&((c=a.addresses().findRecord("addresstypeid",1))&&(d=b.down("fieldset#mailAddress"),e=d.down("checkbox[name=mailingCbx]"),this.loadFieldSet(c,d,e)),(c=a.addresses().findRecord("addresstypeid",2))&&(d=b.down("fieldset#physicalAddress"),e=d.down("checkbox[name=physicalCbx]"),this.loadFieldSet(c,d,e))),a.phones().count()&&(e=b.down("checkbox[name=phoneCbx]"),Ext.each(f,function(f){(c=a.phones().findRecord("phonetypeid",f.val))&&(d=b.down("fieldcontainer#"+f.type+"Phone"),this.loadFieldSet(c,d,e))},this)),a.eaddresses().count()&&Ext.each(g,function(e){(c=a.eaddresses().findRecord("eaddresstypeid",e.val))&&(d=b.down("fieldcontainer#"+e.type+"Address"),this.loadFieldSet(c,d))},this),(d=b.down("field#parentGroup"))&&(c=a.contactcontactgroups().getAt(0))&&d.setValue(c.get("groupid"))}}),Ext.define("PTS.controller.contact.window.PersonGroups",{extend:"Ext.app.Controller",requires:["PTS.view.controls.ReorderColumn"],views:["contact.window.PersonGroups"],models:["ContactContactGroup"],stores:["ContactGroups","DDContactGroups","ContactContactGroups","Persons","Positions","DDPersons"],refs:[{ref:"personGroups",selector:"persongroups"},{ref:"contactLists",selector:"persongroups #contactLists"},{ref:"groupMembersList",selector:"persongroups #groupMembersList"}],init:function(){this.control({persongroups:{afterrender:this.afterRender},"persongroups button[action=addcontacts]":{click:this.addContacts},"persongroups button[action=removecontacts]":{click:this.removeContacts},"persongroups button[action=savecontacts]":{click:this.saveContacts},"persongroups button[action=refreshcontacts]":{click:this.refreshContacts},"persongroups #contactLists > gridpanel":{beforerender:this.beforeRenderContactLists},"persongroups #contactLists > gridpanel > gridview":{beforedrop:this.removeContactsByDrag},"persongroups #groupMembersList > gridview":{afterrender:this.afterRenderGroupMembersList},"persongroups #groupMembersList":{beforerender:this.beforeRenderGroupMembersList}}),this.application.on({opencontact:this.onOpenContact,savecontact:this.onSaveContact,scope:this})},contactType:null,contactId:null,reorderCol:!0,setProxy:function(a,b,c){var d;switch(c){case"person":d=PTS.baseURL+"/person/"+a+"/group";break;case"group":d=PTS.baseURL+"/contactgroup/"+a+"/member";break;default:Ext.Error.raise("Contact type not supplied!")}b.setProxy({type:"rest",url:PTS.baseURL+"/contactcontactgroup",appendId:!0,api:{read:d,create:d,update:d},reader:{type:"json",root:"data"}})},onOpenContact:function(a,b){var c=this.getContactContactGroupsStore();a&&(this.setProxy(a,c,b),c.load()),this.contactType=b,this.reorderCol="group"!==b,this.contactId=a},onSaveContact:function(a){var b=this.getContactContactGroupsStore(),c=a.getId(),d=a.getContactType();c&&(this.setProxy(c,b,d),this.contactId=c,b.load(),this.getPersonGroups().enable())},afterRender:function(a){var b,c=this.getContactLists().getLayout();switch(this.contactType){case"person":c.setActiveItem(1);break;case"group":c.setActiveItem(0),a.down("#groupMembersList").setTitle("Group Members");break;default:Ext.Error.raise("Contact type not supplied! Cannot activate card.")}b=c.getActiveItem().getStore(),0===b.getCount()&&b.load()},beforeRenderContactLists:function(a){var b=Ext.create("Ext.grid.column.Column",a.getSelectionModel().getHeaderConfig());a.headerCt.insert(0,b)},beforeRenderGroupMembersList:function(a){var b=Ext.create("Ext.grid.column.Column",a.getSelectionModel().getHeaderConfig()),c=a.headerCt;c.insert(0,b),this.reorderCol?c.insert(c.getColumnCount()+1,{xtype:"reordercolumn"}):c.items.each(function(){this.sortable=!0})},afterRenderGroupMembersList:function(a){var b=a.getPlugin("contactsddplugin"),c=this.contactId,d=this.contactType;b.dropZone.handleNodeDrop=function(a,b,e){var f,g,h,i,j=this.view,k=j.getStore();if(a.copy){for(g=a.records,a.records=[],h=0,i=g.length;h<i;h++){var l,m,n=g[h].data;switch(void 0===n.name&&(n.name=n.lastname+", "+n.firstname),d){case"person":m={name:n.name,positionid:"",groupid:n.contactid,contactid:c};break;case"group":m={name:n.name,positionid:"",groupid:c,contactid:n.contactid};break;default:Ext.Error.raise("Contact type not supplied!")}l=Ext.create("PTS.model.ContactContactGroup",m),l.phantom=!0,a.records.push(l)}a.view.getSelectionModel().deselect(g)}else a.view.store.remove(a.records,a.view===j);f=k.indexOf(b),"before"!==e&&f++,k.insert(f,a.records),j.getSelectionModel().select(a.records)}},removeContactsByDrag:function(a,b,c,d,e){return this.getContactContactGroupsStore().remove(b.records),!1},removeContacts:function(){var a=this.getGroupMembersList(),b=a.getSelectionModel().getSelection();a.getStore().remove(b)},refreshContacts:function(){var a=this.getGroupMembersList();a.getStore().load({callback:function(b,c,d){a.getStore().removed=[]}})},addContacts:function(){var a=this.getContactLists().getLayout().getActiveItem(),b=a.getSelectionModel().getSelection(),c={copy:!0,view:a.getView(),records:b};this.getGroupMembersList().getView().getPlugin("contactsddplugin").dropZone.handleNodeDrop(c)},saveContacts:function(){var a=this.getContactContactGroupsStore(),b=this.getGroupMembersList().getEl();this.reorderCol&&a.each(function(){var b=this,c=b.get("priority"),d=a.indexOf(b);c!==d&&b.set("priority",d)}),a.getRemovedRecords().length+a.getUpdatedRecords().length+a.getNewRecords().length&&b.mask("Saving..."),a.getBatchListeners=function(){var c=a,d={scope:c,exception:function(a,c){b.unmask()}};return"operation"==c.batchUpdateMode?d.operationcomplete=c.onBatchOperationComplete:d.complete=c.onBatchComplete,d},a.sync({success:function(){b.unmask()},failure:function(){b.unmask(),Ext.MessageBox.show({title:"Error",msg:"The was a problem saving the contacts.</br>Error:"+PTS.app.getError(),buttons:Ext.MessageBox.OK,icon:Ext.Msg.ERROR})},callback:function(){}})}}),Ext.define("PTS.controller.contact.window.ContactDetail",{extend:"Ext.app.Controller",views:["contact.window.ContactDetail"],models:["Address","EAddress","Phone"],stores:["States"],refs:[{ref:"contactForm",selector:"contactform"}],init:function(){this.control({"contactform contactdetail #sameAddCbx":{change:this.copyMailAddress},"contactform contactdetail countrycombo":{select:this.countryChange},"contactform addressfieldset #postalcode":{blur:this.onPostalBlur,validitychange:this.onPostalValidate},"contactform addressfieldset statecombo":{expand:this.onStateExpand}}),this.application.on({loadcontact:this.onLoadContact,scope:this})},copyMailAddress:function(a){var b=a.up("fieldset"),c=a.up("contactdetail").down("#mailAddress");a.getValue()?Ext.each(c.query("field"),function(a){var c=a.getValue(),d=a.getName(),e=b.down("field[name="+d+"]");"addressid"!==d&&e&&(e.setValue(c),e.disable())}):Ext.each(b.query("field"),function(a){a.enable()})},countryChange:function(a){var b=this.getStatesStore(),c=a.getValue();b.clearFilter(),this.filterState(c)},onPostalBlur:function(a){var b=a.getValue(),c=a.up("addressfieldset"),d=c.down("#country").getValue();a.isDirty()&&!Ext.isEmpty(a.getValue())&&Ext.Ajax.request({url:PTS.baseURL+"/country/"+d+"/postalcode/"+b,success:function(a){var b=c.down("#state"),d=c.down("#city"),e=Ext.decode(a.responseText).data;b.setValue(e.stateid),b.enable(),d.setValue(e.placename),d.enable()},failure:function(b){var c=Ext.decode(b.responseText).message;a.markInvalid(c)}})},onPostalValidate:function(a,b){var c=a.up("addressfieldset");c.down("#state").setDisabled(!b),c.down("#city").setDisabled(!b)},onLoadContact:function(a,b){var c=a.query("#postalcode");Ext.each(c,function(a){var b=a.up("addressfieldset").query("#city, #state"),c=Ext.isEmpty(a.getValue());Ext.each(b,function(){this.setDisabled(c)})})},onStateExpand:function(a){var b=a.up("addressfieldset").down("countrycombo").getValue(),c=this.getStatesStore().filters.get("country");!b||c&&b===c.value||this.filterState(b)},filterState:function(a){this.getStatesStore().filter({id:"country",property:"countryalpha",value:a})}}),Ext.define("PTS.model.ReportTree",{extend:"PTS.model.Base",fields:[{name:"cols",type:"auto"},{name:"fields",type:"auto"},{name:"text",type:"mystring",useNull:!0},{name:"url",type:"mystring",useNull:!0},{name:"model",type:"mystring",useNull:!0},{name:"xtype",type:"mystring",useNull:!0},{name:"limit",type:"int",defaultValue:PTS.Defaults.pageSize},{name:"summary",type:"myboolean",defaultValue:!1},{name:"filterBar",type:"myboolean",defaultValue:!1},{name:"remoteFilter",type:"myboolean",defaultValue:!1},{name:"pbarPlugins",type:"auto"},{name:"pbarItems",type:"auto"}],idProperty:"id"}),Ext.define("PTS.view.report.ReportGrid",{extend:"Ext.grid.Panel",alias:"widget.reportgrid",requires:["Ext.ux.grid.PrintGrid","Ext.ux.grid.SaveGrid","Ext.ux.grid.GrabField","Ext.ux.grid.PagingToolbarResizer","Ext.ux.grid.FilterBar"],autoScroll:!0,title:"Report",store:void 0,pbarPlugins:[],initComponent:function(){var a=this;a.callParent(arguments),a.addDocked({xtype:"pagingtoolbar",store:a.store,dock:"top",displayInfo:!0,plugins:a.pbarPlugins.concat([Ext.create("Ext.ux.grid.PrintGrid",{}),Ext.create("Ext.ux.grid.SaveGrid",{}),Ext.create("Ext.ux.grid.PagingToolbarResizer",{options:[25,50,100,200]})])})}}),Ext.define("PTS.store.ReportTree",{extend:"Ext.data.TreeStore",model:"PTS.model.ReportTree",clearOnLoad:!0,folderSort:!0,autoLoad:!0,proxy:{type:"ajax",url:PTS.baseURL+"/report/tree",reader:{type:"json"}}}),Ext.define("PTS.view.report.tab.ReportTab",{extend:"Ext.panel.Panel",alias:"widget.reporttab",requires:["PTS.view.report.ReportGrid"],layout:{type:"border"},title:"Reports",initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"tabpanel",itemId:"reportPanel",activeTab:0,region:"center",items:[{xtype:"panel",itemId:"helpTab",title:"Help",closable:!1,closeAction:"hide",hidden:!0,bodyPadding:10,html:'Choose a report from the tree on the left. The report will open in a new tab. Tabs may be closed by clicking the button <img height="11px" width="11px" src="extjs/resources/themes/images/default/tab/tab-default-close.gif"/> next to the title. <br /> Some reports have columns that are hidden by default. Hover your pointer over the column title and click the down arrow <img height="11px" width="11px" src="extjs/resources/themes/images/default/button/arrow.gif"/> next to the title to display or hide columns.'}]},{xtype:"treepanel",itemId:"reportTree",width:225,title:"Reports",region:"west",store:"ReportTree",rootVisible:!1,split:!0}]}),a.callParent(arguments)}}),Ext.define("PTS.controller.report.tab.ReportTab",{extend:"Ext.app.Controller",stores:["ReportTree"],models:["ReportTree"],views:["report.tab.ReportTab","report.ReportGrid"],refs:[{ref:"reportTree",selector:"reporttab #reportTree"},{ref:"reportPanel",selector:"reporttab #reportPanel"},{ref:"helpTab",selector:"reporttab #helpTab"}],init:function(){this.control({"reporttab #reportTree":{itemclick:this.onClickItem},"reporttab #reportPanel":{add:this.onAddTab}})},onClickItem:function(a,b,c,d){var e,f=b.data,g=b.internalId+"-reportgrid",h=this.getReportPanel(),i=h.down("#"+g);if(b.isLeaf())if(i)h.setActiveTab(i);else if(e={proxy:{type:"ajax",url:f.url,reader:{type:"json",root:"data"}},autoLoad:!0,remoteSort:!0},f.limit&&(e.pageSize=f.limit),f.model?e.model=f.model:e.fields=f.fields,i={xtype:f.xtype?f.xtype:"reportgrid",filterBar:!!f.filterBar,itemId:g,closable:!0,title:f.text,store:Ext.create("Ext.data.Store",e),tabConfig:{tooltip:f.qtip}},f.cols&&(Ext.each(f.cols,function(a){a.renderer&&(a.renderer=Ext.util.Format[a.renderer]),a.ptsrenderer&&(a.renderer=PTS.util.Format[a.ptsrenderer])}),i.columns=f.cols),f.summary&&(i.features=[{ftype:"summary"}]),f.pbarPlugins&&(i.pbarPlugins=[],Ext.each(f.pbarPlugins,function(a){i.pbarPlugins.push(Ext.create(a.type,a.cfg))})),f.filterBar&&(void 0===i.dockedItems&&(i.dockedItems=[]),i.dockedItems.push({xtype:"filterbar",searchStore:i.store,dock:"bottom"})),i.store.remoteFilter=!(!f.remoteFilter&&!f.filterBar),h.add(i),f.pbarItems){var j=h.down("#"+i.itemId+" pagingtoolbar");Ext.each(f.pbarItems,function(a){j.insert(j.items.length-2,Ext.create(a.type,a.cfg))})}},onAddTab:function(a,b){a.setActiveTab(b)}}),Ext.define("PTS.model.ModDocType",{extend:"PTS.model.Base",fields:[{name:"moddoctypeid",type:"int",persist:!1},{name:"type",type:"mystring",useNull:!0},{name:"code",type:"mystring",useNull:!0},{name:"description",type:"mystring",useNull:!0},{name:"inactive",type:"myboolean"}],idProperty:"moddoctypeid",proxy:{type:"rest",url:PTS.baseURL+"/moddoctype",reader:{type:"json",root:"data"},limitParam:void 0}}),Ext.define("PTS.view.tps.tab.TpsGrid",{extend:"Ext.grid.Panel",alias:"widget.tpsgrid",requires:["Ext.ux.grid.PrintGrid","Ext.ux.grid.SaveGrid","PTS.util.Format","Ext.ux.grid.HeaderToolTip"],autoScroll:!0,store:"TpsRecords",selType:"cellmodel",initComponent:function(){var a,b=this,c=[{xtype:"gridcolumn",dataIndex:"modtype",text:"Agreement Type",locked:!0},{xtype:"gridcolumn",dataIndex:"shorttitle",text:"Project",locked:!0},{xtype:"gridcolumn",dataIndex:"projectcode",text:"Project Code",locked:!0},{xtype:"gridcolumn",dataIndex:"title",hidden:!0,text:"Title",locked:!0},{xtype:"gridcolumn",dataIndex:"modificationcode",hidden:!0,text:"Agreement #",locked:!0},{xtype:"gridcolumn",dataIndex:"principalinv",hidden:!0,text:"PI Name",locked:!0},{xtype:"gridcolumn",dataIndex:"invemail",hidden:!0,text:"PI e-mail",locked:!0},{xtype:"gridcolumn",dataIndex:"recipient",hidden:!0,text:"Funding Recipient",locked:!0}];Ext.applyIf(b,{viewConfig:{},dockedItems:[{xtype:"pagingtoolbar",store:"TpsRecords",dock:"top",displayInfo:!0,plugins:[Ext.create("Ext.ux.grid.PrintGrid",{title:function(){return this.child("cycle#filter").getActiveItem().text+" (TPS Report)"}})],items:["-",{xtype:"cycle",itemId:"filter",showText:!0,action:"filterrecords",tooltip:"Click to filter the Records",menu:{xtype:"menu",width:120,items:[{iconCls:"pts-flag-red",text:"Active",filter:"active"},{iconCls:"pts-flag-green",text:"Funded",filter:"funded"},{iconCls:"pts-flag-white",text:"All",filter:"all"}]}}]}],columns:c}),b.addEvents("beforeselect"),b.callParent(arguments),a=b.getSelectionModel(),a.onMouseDown=function(b,c,d,e,f,g,h){if(a.primaryView!==b)return!1;a.setCurrentPosition({row:g,column:d},b)}}}),Ext.define("PTS.model.ModDocStatusType",{extend:"PTS.model.Base",fields:[{name:"moddocstatustypeid",type:"int",persist:!1},{name:"code",type:"mystring",useNull:!0},{name:"status",type:"mystring",useNull:!0},{name:"description",type:"mystring",useNull:!0},{name:"weight",type:"int",useNull:!0}],idProperty:"moddocstatustypeid",proxy:{type:"ajax",url:PTS.baseURL+"/moddocstatustype",reader:{type:"json",root:"data"},limitParam:void 0}}),Ext.define("PTS.store.ModDocTypes",{extend:"Ext.data.Store",model:"PTS.model.ModDocType",autoLoad:!1,sorters:[{property:"sort",direction:"ASC"},{property:"code",direction:"ASC"}]}),Ext.define("PTS.model.TpsRecord",{extend:"PTS.model.Base",fields:[{name:"modificationid",type:"int",persist:!1}],idProperty:"modificationid",proxy:{type:"ajax",url:PTS.baseURL+"/report/tps",reader:{type:"json",root:"data"}}}),Ext.define("PTS.store.ModDocStatusTypes",{extend:"Ext.data.Store",model:"PTS.model.ModDocStatusType",autoLoad:!0}),Ext.define("PTS.view.tps.tab.TpsDetailGrid",{extend:"PTS.view.controls.RowEditGrid",alias:"widget.tpsdetailgrid",requires:["PTS.store.GroupUsers","PTS.store.ModDocStatusTypes","PTS.view.controls.TextareaTriggerField"],autoScroll:!0,store:"ModDocStatuses",initComponent:function(){var a=this,b=[{xtype:"gridcolumn",dataIndex:"moddocstatustypeid",text:"Status",renderer:function(a){var b=Ext.getStore("ModDocStatusTypes"),c=b.find("moddocstatustypeid",a,0,!1,!0,!0),d=b.getAt(c);return d?d.get("code"):a},editor:{xtype:"statuscombo",store:"ModDocStatusTypes",valueField:"moddocstatustypeid",allowBlank:!1}},{xtype:"datecolumn",dataIndex:"effectivedate",text:"Date",editor:{xtype:"datefield",allowBlank:!1}},{xtype:"gridcolumn",dataIndex:"comment",text:"Comment",flex:1,editor:{xtype:"areatrigger",text:"Comment",allowBlank:!0}},{xtype:"gridcolumn",dataIndex:"contactid",width:125,renderer:function(a){var b=Ext.getStore("GroupUsers"),c=b.find("contactid",a,0,!1,!0,!0),d=b.getAt(c);return d?d.get("fullname"):a},text:"User"}];Ext.applyIf(a,{viewConfig:{},columns:b}),a.callParent(arguments),a.getStore().on("add",function(a,b){Ext.each(b,function(){var a=this;null===a.get("contactid")&&a.set("contactid",PTS.user.get("contactid"))})})}}),Ext.define("PTS.view.tps.tab.TpsTab",{extend:"Ext.panel.Panel",alias:"widget.tpstab",requires:["PTS.view.tps.tab.TpsGrid","PTS.view.tps.tab.TpsDetailGrid"],layout:{type:"border"},title:"TPS Report",initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"tpsgrid",itemId:"tpsGrid",region:"center"},{xtype:"tpsdetailgrid",itemId:"tpsDetail",title:"Details",region:"east",split:!0,flex:.5,minWidth:350,collapsible:!0}]}),a.callParent(arguments)}}),Ext.define("PTS.store.TpsRecords",{extend:"Ext.data.Store",model:"PTS.model.TpsRecord",autoLoad:!1,remoteSort:!0,remoteFilter:!0,pageSize:PTS.Defaults.pageSize+5,filters:[{property:"weight",value:["<",40]}]}),Ext.define("PTS.controller.tps.tab.TpsTab",{extend:"Ext.app.Controller",stores:["ModDocTypes","TpsRecords","ModDocStatusTypes"],models:["ModDocType"],views:["tps.tab.TpsTab"],refs:[{ref:"tpsGrid",selector:"tpstab tpsgrid#tpsGrid"}],init:function(){this.getController("tps.tab.TpsGrid").init(),this.control({tpstab:{render:this.onRender}})},onRender:function(a){var b=new Ext.LoadMask(a,{msg:"Configuring. Please wait..."}),c=this.getTpsGrid(),d=c.columns;this.getModDocTypesStore().load({callback:function(a,e,f){f&&(Ext.each(a,function(a){d.push({xtype:"gridcolumn",dataIndex:"doctype_"+a.data.moddoctypeid,hidden:Boolean(a.data.inactive),tooltip:a.data.description||a.data.text,text:a.data.code,renderer:PTS.util.Format.docStatus})}),c.reconfigure(!1,d),b.destroy(),c.getStore().on("load",function(a,b,c,d){a.count()>0&&this.normalGrid.getSelectionModel().setCurrentPosition({row:0,column:0})},c),c.getStore().load())},scope:this}),b.show()}}),Ext.define("PTS.model.ModDocStatus",{extend:"PTS.model.Base",fields:[{name:"moddocstatusid",type:"integer",useNull:!0,persist:!1},{name:"modificationid",type:"int",useNull:!0},{name:"moddoctypeid",type:"int",useNull:!0},{name:"moddocstatustypeid",type:"int",useNull:!0},{name:"contactid",type:"int",useNull:!0},{name:"comment",type:"mystring",useNull:!0},{name:"effectivedate",type:"mydate",useNull:!0,defaultValue:new Date},{name:"weight",type:"int",useNull:!0,persist:!1}],idProperty:"moddocstatusid",validations:[{type:"length",field:"moddoctypeid",min:1},{type:"length",field:"modificationid",min:1},{type:"length",field:"contactid",min:1}],proxy:{type:"rest",url:PTS.baseURL+"/moddocstatus",reader:{type:"json",root:"data"},limitParam:void 0}}),Ext.define("PTS.store.ModDocStatuses",{extend:"Ext.data.Store",model:"PTS.model.ModDocStatus",autoLoad:!1,sorters:[{property:"effectivedate",direction:"DESC"},{property:"weight",direction:"DESC"}]}),Ext.define("PTS.controller.tps.tab.TpsGrid",{extend:"Ext.app.Controller",stores:["TpsRecords","ModDocTypes","ModDocStatuses","ModDocStatusTypes"],models:[],views:["tps.tab.TpsGrid"],refs:[{ref:"tpsGrid",selector:"tpstab tpsgrid#tpsGrid"},{ref:"detailGrid",selector:"tpstab tpsdetailgrid#tpsDetail"}],init:function(){this.control({"tpstab tpsgrid#tpsGrid":{afterrender:this.onAfterRender},"tpstab tpsgrid#tpsGrid dataview":{beforerefresh:this.onBeforeRefresh},"tpstab tpsdetailgrid#tpsDetail":{edit:this.onDetailRowEdit,removerow:this.onDetailRowRemove},"tpstab tpsgrid#tpsGrid button[action=filterrecords]":{change:this.filterRecords}})},onAfterRender:function(a){var b=a.normalGrid,c=a.getSelectionModel(),d=new Ext.ux.grid.HeaderToolTip;d.createTip.call(b),d.destroy(),b.getView().on("refresh",this.fixScroll,a),a.lockedGrid.getView().on("itemdblclick",this.onTpsGridDblClick,this),c.on("select",this.onSelect,this),c.on("deselect",this.onDeselect,this)},onBeforeRefresh:function(a){a.getSelectionModel().setCurrentPosition()},onSelect:function(a,b,c,d){var e=a.primaryView.ownerCt.columns[d],f=b.data[e.dataIndex],g=e.dataIndex.split("_")[1],h=b.get("modificationid"),i=this.getModDocStatusesStore();if(a.view.up("tpsgrid").lockedGrid.getView().addRowCls(c,"pts-tps-highlight"),i.setProxy({type:"rest",url:PTS.baseURL+"/moddocstatus",appendId:!0,api:{read:PTS.baseURL+"/modification/"+h+"/moddoctype/"+g+"/moddocstatus"},reader:{type:"json",root:"data"}}),null===f){this.getDetailGrid().disable();var j="Details for <i>"+e.text+"</i> ("+b.get("projectcode")+")";this.getDetailGrid().setTitle(j)}else this.getDetailGrid().enable(),i.load({callback:function(a,c,d){var f=d?"Details for <i>"+e.text+"</i> ("+b.get("projectcode")+")":"Load Failed!";this.getDetailGrid().setTitle(f)},scope:this})},onDeselect:function(a,b,c,d){a.view.up("tpsgrid").lockedGrid.getView().removeRowCls(c,"pts-tps-highlight")},onDetailRowEdit:function(a,b){var c=this.getTpsGrid(),d=c.getSelectionModel().getCurrentPosition(),e=Ext.getStore("TpsRecords").getAt(d.row),f=c.normalGrid.columns[d.column],g=f.dataIndex.split("_")[1],h=e.get("modificationid");a.record.set("modificationid",h),a.record.set("moddoctypeid",g),a.store.sync({success:function(a){a.isComplete&&!a.hasException&&this.updateCell(e,f)},scope:this})},onDetailRowRemove:function(a,b){var c=this.getTpsRecordsStore().findRecord("modificationid",a.get("modificationid"),0,!1,!0,!0),d=this.getTpsGrid().normalGrid.headerCt.child("gridcolumn[dataIndex=doctype_"+a.get("moddoctypeid")+"]");this.updateCell(c,d)},fixScroll:function(a){var b=this,c=b.normalGrid;(c.horizontalScroller.rendered?c.horizontalScroller.getHeight():0)>0&&(b.spacerHidden=!1,b.getSpacerEl().removeCls(Ext.baseCSSPrefix+"hidden"))},updateCell:function(a,b){var c,d,e=this,f=e.getModDocStatusTypesStore(),g=e.getModDocStatusesStore(),h=[{property:"effectivedate",direction:"DESC"},{property:"weight",direction:"DESC"}];g.count()>0?(g.sort(h),c=g.first().get("moddocstatustypeid"),d=PTS.util.Format.docStatus(f.findRecord("moddocstatustypeid",c,0,!1,!0,!0).get("code"))):d=PTS.util.Format.docStatus("Not Started"),e.getTpsGrid().getView().getCell(a,b).down("div").dom.innerHTML=d},filterRecords:function(a,b){var c=this.getTpsRecordsStore();switch(c.remoteFilter=!1,c.clearFilter(!0),c.remoteFilter=!0,b.filter){case"active":c.filter({property:"weight",value:["<",40]});break;case"funded":c.filter({property:"weight",value:[">=",40]});break;default:c.loadPage(1)}},onTpsGridDblClick:function(a,b,c){this.openProject(b)},openProject:function(a){var b=a.get("modificationid"),c=function(){var a=this,c=a.down("agreementstree").getStore(),d=a.down("projectagreements"),e=function(a){var c=a.getNodeById("af-"+b).getPath();this.down("agreementstree").selectPath(c),this.getEl().unmask()};a.getEl().mask("Loading..."),a.down("tabpanel").setActiveTab(d),c.getRootNode().hasChildNodes()?e(c):c.on("load",e,a,{single:!0})};void 0===a.getProjectCode&&(a.getProjectCode=function(){return a.get("projectcode")}),this.getController("project.Project").openProject(a,c)}}),Ext.define("PTS.model.UserConfig",{extend:"PTS.model.Base",fields:[{name:"loginid",type:"int",persist:!1},{name:"windowWidth",type:"int",defaultValue:"900"},{name:"pageSize",type:"int",defaultValue:"25"}],idProperty:"loginid",proxy:{type:"rest",url:PTS.baseURL+"/userinfo/config",reader:{type:"json",root:"data"}}}),Ext.define("PTS.view.Viewport",{extend:"Ext.container.Viewport",requires:["PTS.view.MainToolbar","PTS.view.dashboard.Dashboard","PTS.view.project.tab.ProjectTab","PTS.view.product.tab.ProductTab","PTS.view.contact.tab.ContactTab","PTS.view.report.tab.ReportTab","PTS.view.tps.tab.TpsTab"],layout:{type:"border"},initComponent:function(){var a=this;Ext.applyIf(a,{items:[{xtype:"tabpanel",style:{border:"none",backgroundColor:"#FFF",backgroundImage:"none"},bodyPadding:0,preventHeader:!0,title:"Main",activeTab:0,plain:!0,region:"center",items:[{xtype:"dashboard"},{xtype:"projecttab"},{xtype:"producttab"},{xtype:"contacttab",title:"Contacts"},{xtype:"reporttab"},{xtype:"tpstab"}]},{xtype:"maintoolbar",region:"north"},{xtype:"toolbar",height:20,hidden:!0,itemId:"status-toolbar",flex:0,region:"south",items:[{xtype:"tbtext",text:"My Text"}]}]}),a.callParent(arguments)}}),Ext.Loader.setConfig({enabled:!0,paths:{Extensible:"./lib/extensible/src","Extensible.example":"./lib/extensible/examples","Ext.ux":"./ux",GeoExt:"./lib/geoext/src/GeoExt"},disableCaching:!0}),Ext.application({requires:["PTS.Defaults","PTS.model.User","PTS.util.DataTypes","PTS.util.VTypes","PTS.Overrides","PTS.util.ActivityMonitor","PTS.util.AssociationJsonWriter","Ext.ux.window.Notification"],name:"PTS",version:"0.21.1",appFolder:"app",autoCreateViewport:!1,enableQuickTips:!0,models:["User","UserConfig"],stores:["States","Countries","Positions","ProjectIDs","ProductGroupIDs"],controllers:["Main","MainToolbar","dashboard.Dashboard","project.Project","product.Product","contact.Contact","report.Report","tps.Tps"],setError:function(a){this.lastError=a},getError:function(a){var b=this.lastError;return a||b?a||b.length<300?b:b.substr(0,300)+"...":"Unknown error occurred during last request."},showError:function(a){Ext.create("widget.uxNotification",{title:"Error",iconCls:"ux-notification-icon-error",html:a}).show()},launch:function(){Ext.Error.handle=function(a){PTS.app.showError(a.msg)},Ext.Ajax.defaultHeaders={Accept:"application/json","Content-Type":"application/json"},Ext.Ajax.on("requestexception",function(a,b,c){var d=Ext.JSON.decode(b.responseText);!b.aborted&&d&&(PTS.app.setError(d.message),void 0!==c.failure||void 0!==c.operation&&void 0!==c.operation.failure||Ext.create("widget.uxNotification",{title:"Error",iconCls:"ux-notification-icon-error",html:d.message}).show())}),PTS.app=this}});
//# sourceMappingURL=app-all.min.js.map